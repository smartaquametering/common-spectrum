{"version":3,"file":"common-spectrum.min.js","sources":["../node_modules/is-any-array/src/index.js","../node_modules/median-quickselect/lib/median-quickselect.min.js","../node_modules/ml-array-median/lib-es6/index.js","../node_modules/ml-spectra-processing/src/x/xAdd.js","../node_modules/ml-spectra-processing/src/x/xMultiply.js","../node_modules/ml-spectra-processing/src/x/xDivide.js","../node_modules/ml-spectra-processing/src/x/xFindClosestIndex.js","../node_modules/ml-array-sequential-fill/lib-es6/index.js","../node_modules/ml-spectra-processing/src/x/xIsMonotone.js","../node_modules/ml-array-sum/lib-es6/index.js","../node_modules/ml-array-mean/lib-es6/index.js","../node_modules/ml-array-min/lib-es6/index.js","../node_modules/ml-array-max/lib-es6/index.js","../node_modules/ml-spectra-processing/src/x/xSubtract.js","../node_modules/ml-spectra-processing/src/xy/xyCheck.js","../node_modules/ml-spectra-processing/src/xy/xyEnsureGrowingX.js","../node_modules/ml-spectra-processing/src/xy/xyFilterXPositive.js","../node_modules/ml-spectra-processing/src/xy/xyMaxClosestYPoint.js","../node_modules/ml-spectra-processing/src/xy/xyMinClosestYPoint.js","../node_modules/ml-peak-shape-generator/lib-esm/util/constants.js","../node_modules/ml-peak-shape-generator/lib-esm/util/erfinv.js","../node_modules/ml-peak-shape-generator/lib-esm/shapes/1d/Shape1D.js","../node_modules/ml-peak-shape-generator/lib-esm/shapes/1d/gaussian/Gaussian.js","../node_modules/ml-peak-shape-generator/lib-esm/shapes/1d/lorentzian/Lorentzian.js","../node_modules/ml-peak-shape-generator/lib-esm/shapes/1d/pseudoVoigt/PseudoVoigt.js","../node_modules/ml-peak-shape-generator/lib-esm/util/getShape1D.js","../node_modules/ml-savitzky-golay-generalized/src/index.js","../node_modules/ml-gsd/src/gsd.js","../node_modules/assign-symbols/index.js","../node_modules/assign-deep/index.js","../node_modules/ml-spectra-fitting/node_modules/ml-peak-shape-generator/src/util/constants.js","../node_modules/ml-spectra-fitting/node_modules/ml-peak-shape-generator/src/util/erfinv.js","../node_modules/ml-spectra-fitting/node_modules/ml-peak-shape-generator/src/classes/Gaussian.js","../node_modules/ml-spectra-fitting/node_modules/ml-peak-shape-generator/src/classes/Lorentzian.js","../node_modules/ml-spectra-fitting/node_modules/ml-peak-shape-generator/src/classes/PseudoVoigt.js","../node_modules/ml-spectra-fitting/src/shapes/sumOfGaussianLorentzians.js","../node_modules/ml-spectra-fitting/src/shapes/sumOfGaussians.js","../node_modules/ml-spectra-fitting/src/shapes/sumOfLorentzians.js","../node_modules/ml-spectra-fitting/src/checkInput.js","../node_modules/ml-levenberg-marquardt/src/checkOptions.js","../node_modules/ml-levenberg-marquardt/src/errorCalculation.js","../node_modules/ml-array-rescale/lib-es6/index.js","../node_modules/ml-matrix/src/inspect.js","../node_modules/ml-matrix/src/util.js","../node_modules/ml-matrix/src/matrix.js","../node_modules/ml-matrix/src/stat.js","../node_modules/ml-matrix/src/mathOperations.js","../node_modules/ml-matrix/src/views/base.js","../node_modules/ml-matrix/src/views/transpose.js","../node_modules/ml-matrix/src/wrap/WrapperMatrix2D.js","../node_modules/ml-matrix/src/dc/lu.js","../node_modules/ml-matrix/src/dc/util.js","../node_modules/ml-matrix/src/dc/qr.js","../node_modules/ml-matrix/src/dc/svd.js","../node_modules/ml-matrix/src/decompositions.js","../node_modules/ml-levenberg-marquardt/src/step.js","../node_modules/ml-levenberg-marquardt/src/gradientFunction.js","../node_modules/ml-levenberg-marquardt/src/index.js","../node_modules/ml-spectra-fitting/src/selectMethod.js","../node_modules/ml-spectra-fitting/src/index.js","../lib-esm/jsgraph/addStyle.js","../lib-esm/jsgraph/colors.js","../lib-esm/util/appendDistinctParameter.js","../lib-esm/util/appendDistinctValue.js","../node_modules/ml-airpls/src/choleskySolver.js","../node_modules/cuthill-mckee/cuthill-mckee.js","../node_modules/ml-airpls/src/utils.js","../node_modules/ml-airpls/src/index.js","../node_modules/baselines/src/airPLS.js","../node_modules/ml-regression-base/src/maybeToPrecision.js","../node_modules/ml-regression-base/src/index.js","../node_modules/ml-regression-polynomial/src/index.js","../node_modules/ml-regression-base/src/checkArrayLength.js","../node_modules/ml-baseline-correction-regression/src/index.js","../node_modules/baselines/src/iterativePolynomial.js","../node_modules/baselines/node_modules/ml-spectra-processing/src/x/xCheck.js","../node_modules/baselines/node_modules/ml-spectra-processing/src/x/xPadding.js","../node_modules/baselines/node_modules/ml-spectra-processing/src/x/xRolling.js","../node_modules/baselines/node_modules/ml-spectra-processing/src/x/xRollingAverage.js","../node_modules/baselines/node_modules/ml-spectra-processing/src/x/xRollingMedian.js","../node_modules/baselines/src/rollingAverage.js","../node_modules/ml-rolling-ball-baseline/src/rollingBall.js","../node_modules/baselines/src/rollingBall.js","../node_modules/baselines/src/rollingMedian.js","../node_modules/ml-array-normed/lib-es6/index.js","../node_modules/ml-zones/src/normalize.js","../node_modules/ml-zones/src/invert.js","../node_modules/ml-zones/src/zonesWithPoints.js","../node_modules/ml-array-xy-equally-spaced/src/integral.js","../node_modules/ml-array-xy-equally-spaced/src/index.js","../node_modules/ml-array-xy-equally-spaced/src/equallySpacedSlot.js","../node_modules/ml-array-xy-equally-spaced/src/equallySpacedSmooth.js","../node_modules/ml-array-xy-filter-x/src/getZones.js","../node_modules/ml-array-xy-filter-x/src/index.js","../node_modules/ml-pad-array/src/index.js","../node_modules/ml-savitzky-golay/lib-esm/index.js","../node_modules/ml-stat/array.js","../lib-esm/util/getNormalizedSpectrum.js","../node_modules/js-quantities/build/quantities.js","../lib-esm/util/convertUnit.js","../lib-esm/util/ensureRegexp.js","../lib-esm/util/getConvertedVariable.js","../lib-esm/util/getXYSpectrum.js","../lib-esm/Analysis.js","../node_modules/jcampconverter/node_modules/ensure-string/lib-esm/index.js","../node_modules/dynamic-typing/src/parseString.js","../node_modules/jcampconverter/src/complexChromatogram.js","../node_modules/jcampconverter/src/convertToFloatArray.js","../node_modules/jcampconverter/src/parse/fastParseXYData.js","../node_modules/jcampconverter/src/parse/parsePeakTable.js","../node_modules/jcampconverter/src/parse/parseXYA.js","../node_modules/jcampconverter/src/2d/add2D.js","../node_modules/jcampconverter/src/2d/convertTo3DZ.js","../node_modules/jcampconverter/src/2d/generateContourLines.js","../node_modules/nmr-processing/lib-esm/constants/gyromagneticRatio.js","../node_modules/jcampconverter/src/profiling.js","../node_modules/jcampconverter/src/simpleChromatogram.js","../node_modules/jcampconverter/src/postProcessing.js","../node_modules/jcampconverter/src/postProcessingNMR.js","../node_modules/jcampconverter/src/prepareNtuplesDatatable.js","../node_modules/jcampconverter/src/prepareSpectrum.js","../node_modules/jcampconverter/src/convert.js","../lib-esm/from/fromJcamp.js","../node_modules/ensure-string/src/index.js","../node_modules/ml-arrayxy-uniquex/src/index.js","../node_modules/xy-parser/src/index.js","../node_modules/convert-to-jcamp/src/creatorNtuples.js","../node_modules/convert-to-jcamp/src/utils/getNumber.js","../node_modules/convert-to-jcamp/src/utils/peakTableCreator.js","../node_modules/convert-to-jcamp/src/utils/xyDataCreator.js","../node_modules/convert-to-jcamp/src/fromJSON.js","../lib-esm/to/toJcamps.js","../node_modules/convert-to-jcamp/src/fromVariables.js","../lib-esm/to/toText.js","../lib-esm/reactPlot/getReactPlotJSON.js","../lib-esm/index.js","../lib-esm/jsgraph/getJSGraph.js","../lib-esm/jsgraph/getNormalizationAnnotations.js","../lib-esm/AnalysesManager.js","../lib-esm/util/autoPeakPicking.js","../lib-esm/from/fromText.js","../lib-esm/util/peakPicking.js","../lib-esm/to/toJcamp.js"],"sourcesContent":["const toString = Object.prototype.toString;\n\nexport default function isAnyArray(object) {\n  return toString.call(object).endsWith('Array]');\n}\n","(function(){function a(d){for(var e=0,f=d.length-1,g=void 0,h=void 0,i=void 0,j=c(e,f);!0;){if(f<=e)return d[j];if(f==e+1)return d[e]>d[f]&&b(d,e,f),d[j];for(g=c(e,f),d[g]>d[f]&&b(d,g,f),d[e]>d[f]&&b(d,e,f),d[g]>d[e]&&b(d,g,e),b(d,g,e+1),h=e+1,i=f;!0;){do h++;while(d[e]>d[h]);do i--;while(d[i]>d[e]);if(i<h)break;b(d,h,i)}b(d,e,i),i<=j&&(e=h),i>=j&&(f=i-1)}}var b=function b(d,e,f){var _ref;return _ref=[d[f],d[e]],d[e]=_ref[0],d[f]=_ref[1],_ref},c=function c(d,e){return~~((d+e)/2)};'undefined'!=typeof module&&module.exports?module.exports=a:window.median=a})();\n","import isArray from 'is-any-array';\nimport quickSelectMedian from 'median-quickselect';\n\nfunction median(input) {\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  return quickSelectMedian(input.slice());\n}\n\nexport default median;\n","import isAnyArray from 'is-any-array';\n\n/**\n * This function xAdd the first array by the second array or a constant value to each element of the first array\n * @param {Array<Number>} array1 - the array that will be rotated\n * @param {Array|Number} array2\n * @return {Array}\n */\nexport function xAdd(array1, array2) {\n  let isConstant = false;\n  let constant;\n  if (isAnyArray(array2)) {\n    if (array1.length !== array2.length) {\n      throw new Error('sub: size of array1 and array2 must be identical');\n    }\n  } else {\n    isConstant = true;\n    constant = Number(array2);\n  }\n\n  let array3 = new Array(array1.length);\n  if (isConstant) {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] + constant;\n    }\n  } else {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] + array2[i];\n    }\n  }\n\n  return array3;\n}\n","import isAnyArray from 'is-any-array';\n/**\n * This function xMultiply the first array by the second array or a constant value to each element of the first array\n * @param {Array} array1 - the array that will be rotated\n * @param {Array|Number} array2\n * @return {Float64Array}\n */\nexport function xMultiply(array1, array2) {\n  let isConstant = false;\n  let constant;\n  if (isAnyArray(array2)) {\n    if (array1.length !== array2.length) {\n      throw new Error('sub: size of array1 and array2 must be identical');\n    }\n  } else {\n    isConstant = true;\n    constant = Number(array2);\n  }\n\n  let array3 = new Float64Array(array1.length);\n  if (isConstant) {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] * constant;\n    }\n  } else {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] * array2[i];\n    }\n  }\n\n  return array3;\n}\n","import isAnyArray from 'is-any-array';\n\n/**\n * This function divide the first array by the second array or a constant value to each element of the first array\n * @param {Array<Number>} array1 - the array that will be rotated\n * @param {Array<Number>|Number} array2\n * @return {Array}\n */\nexport function xDivide(array1, array2) {\n  let isConstant = false;\n  let constant;\n  if (isAnyArray(array2)) {\n    if (array1.length !== array2.length) {\n      throw new Error('sub: size of array1 and array2 must be identical');\n    }\n  } else {\n    isConstant = true;\n    constant = Number(array2);\n  }\n\n  let array3 = new Array(array1.length);\n  if (isConstant) {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] / constant;\n    }\n  } else {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] / array2[i];\n    }\n  }\n\n  return array3;\n}\n","/**\n * Returns the closest index of a `target` in an ordered array\n * @param {array<Number>} array\n * @param {number} target\n */\n\nexport function xFindClosestIndex(array, target) {\n  let low = 0;\n  let high = array.length - 1;\n  let middle = 0;\n  while (high - low > 1) {\n    middle = low + ((high - low) >> 1);\n    if (array[middle] < target) {\n      low = middle;\n    } else if (array[middle] > target) {\n      high = middle;\n    } else {\n      return middle;\n    }\n  }\n\n  if (low < array.length - 1) {\n    if (Math.abs(target - array[low]) < Math.abs(array[low + 1] - target)) {\n      return low;\n    } else {\n      return low + 1;\n    }\n  } else {\n    return low;\n  }\n}\n","import isArray from 'is-any-array';\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\n/**\n * Fill an array with sequential numbers\n * @param {Array<number>} [input] - optional destination array (if not provided a new array will be created)\n * @param {object} [options={}]\n * @param {number} [options.from=0] - first value in the array\n * @param {number} [options.to=10] - last value in the array\n * @param {number} [options.size=input.length] - size of the array (if not provided calculated from step)\n * @param {number} [options.step] - if not provided calculated from size\n * @return {Array<number>}\n */\n\nfunction sequentialFill() {\n  var input = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (_typeof(input) === 'object' && !isArray(input)) {\n    options = input;\n    input = [];\n  }\n\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  var _options = options,\n      _options$from = _options.from,\n      from = _options$from === void 0 ? 0 : _options$from,\n      _options$to = _options.to,\n      to = _options$to === void 0 ? 10 : _options$to,\n      _options$size = _options.size,\n      size = _options$size === void 0 ? input.length : _options$size,\n      step = _options.step;\n\n  if (size !== 0 && step) {\n    throw new Error('step is defined by the array size');\n  }\n\n  if (!size) {\n    if (step) {\n      size = Math.floor((to - from) / step) + 1;\n    } else {\n      size = to - from + 1;\n    }\n  }\n\n  if (!step && size) {\n    step = (to - from) / (size - 1);\n  }\n\n  if (Array.isArray(input)) {\n    // only works with normal array\n    input.length = 0;\n\n    for (var i = 0; i < size; i++) {\n      input.push(from);\n      from += step;\n    }\n  } else {\n    if (input.length !== size) {\n      throw new Error('sequentialFill typed array must have the correct length');\n    }\n\n    for (var _i = 0; _i < size; _i++) {\n      input[_i] = from;\n      from += step;\n    }\n  }\n\n  return input;\n}\n\nexport { sequentialFill as default };\n","/**\n * Returns true if x is monotone\n * @param {Array} array\n * @return {boolean}\n */\nexport function xIsMonotone(array) {\n  if (array.length <= 2) {\n    return true;\n  }\n  if (array[0] === array[1]) {\n    // maybe a constant series\n    for (let i = 1; i < array.length - 1; i++) {\n      if (array[i] !== array[i + 1]) return false;\n    }\n    return true;\n  }\n\n  if (array[0] < array[array.length - 1]) {\n    for (let i = 0; i < array.length - 1; i++) {\n      if (array[i] >= array[i + 1]) return false;\n    }\n  } else {\n    for (let i = 0; i < array.length - 1; i++) {\n      if (array[i] <= array[i + 1]) return false;\n    }\n  }\n  return true;\n}\n","import isArray from 'is-any-array';\n\nfunction sum(input) {\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  var sumValue = 0;\n\n  for (var i = 0; i < input.length; i++) {\n    sumValue += input[i];\n  }\n\n  return sumValue;\n}\n\nexport default sum;\n","import sum from 'ml-array-sum';\n\nfunction mean(input) {\n  return sum(input) / input.length;\n}\n\nexport default mean;\n","import isArray from 'is-any-array';\n\nfunction min(input) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  var _options$fromIndex = options.fromIndex,\n      fromIndex = _options$fromIndex === void 0 ? 0 : _options$fromIndex,\n      _options$toIndex = options.toIndex,\n      toIndex = _options$toIndex === void 0 ? input.length : _options$toIndex;\n\n  if (fromIndex < 0 || fromIndex >= input.length || !Number.isInteger(fromIndex)) {\n    throw new Error('fromIndex must be a positive integer smaller than length');\n  }\n\n  if (toIndex <= fromIndex || toIndex > input.length || !Number.isInteger(toIndex)) {\n    throw new Error('toIndex must be an integer greater than fromIndex and at most equal to length');\n  }\n\n  var minValue = input[fromIndex];\n\n  for (var i = fromIndex + 1; i < toIndex; i++) {\n    if (input[i] < minValue) minValue = input[i];\n  }\n\n  return minValue;\n}\n\nexport default min;\n","import isArray from 'is-any-array';\n\nfunction max(input) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  var _options$fromIndex = options.fromIndex,\n      fromIndex = _options$fromIndex === void 0 ? 0 : _options$fromIndex,\n      _options$toIndex = options.toIndex,\n      toIndex = _options$toIndex === void 0 ? input.length : _options$toIndex;\n\n  if (fromIndex < 0 || fromIndex >= input.length || !Number.isInteger(fromIndex)) {\n    throw new Error('fromIndex must be a positive integer smaller than length');\n  }\n\n  if (toIndex <= fromIndex || toIndex > input.length || !Number.isInteger(toIndex)) {\n    throw new Error('toIndex must be an integer greater than fromIndex and at most equal to length');\n  }\n\n  var maxValue = input[fromIndex];\n\n  for (var i = fromIndex + 1; i < toIndex; i++) {\n    if (input[i] > maxValue) maxValue = input[i];\n  }\n\n  return maxValue;\n}\n\nexport default max;\n","import isAnyArray from 'is-any-array';\n/**\n * This function xSubtract the first array by the second array or a constant value from each element of the first array\n * @param {Array} array1 - the array that will be rotated\n * @param {Array|Number} array2\n * @return {Array}\n */\nexport function xSubtract(array1, array2) {\n  let isConstant = false;\n  let constant;\n  if (isAnyArray(array2)) {\n    if (array1.length !== array2.length) {\n      throw new Error('sub: size of array1 and array2 must be identical');\n    }\n  } else {\n    isConstant = true;\n    constant = Number(array2);\n  }\n\n  let array3 = new Array(array1.length);\n  if (isConstant) {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] - constant;\n    }\n  } else {\n    for (let i = 0; i < array1.length; i++) {\n      array3[i] = array1[i] - array2[i];\n    }\n  }\n\n  return array3;\n}\n","import isAnyArray from 'is-any-array';\n\n/**\n * Throw an error in no an object of x,y arrays\n * @param {DataXY} [data={}]\n */\nexport function xyCheck(data = {}) {\n  if (!isAnyArray(data.x) || !isAnyArray(data.y)) {\n    throw new Error('Data must be an object of x and y arrays');\n  }\n  if (data.x.length !== data.y.length) {\n    throw new Error('The x and y arrays mush have the same length');\n  }\n}\n","import { xyCheck } from './xyCheck';\n\n/**\n * Filters x,y values to allow strictly growing values in x axis.\n * @param {DataXY} [data={}] - Object that contains property x (an ordered increasing array) and y (an array)\n * @return {DataXY}\n */\nexport function xyEnsureGrowingX(data = {}) {\n  xyCheck(data);\n  const x = Array.from(data.x);\n  const y = Array.from(data.y);\n  let prevX = -Infinity;\n  let ansX = [];\n  let ansY = [];\n\n  for (let index = 0; index < x.length; index++) {\n    if (prevX < x[index]) {\n      ansX.push(x[index]);\n      ansY.push(y[index]);\n      prevX = x[index];\n    }\n  }\n  return { x: ansX, y: ansY };\n}\n","import { xyCheck } from './xyCheck';\n/**\n * Filter out all the points for which x <= 0. Useful to display log scale data\n * @param {DataXY} [data={}]\n * @return {{x:[],y:[]}} An object with the filtered data\n */\n\nexport function xyFilterXPositive(data = {}) {\n  xyCheck(data);\n  const { x, y } = data;\n  const newX = [];\n  const newY = [];\n  for (let i = 0; i < x.length; i++) {\n    if (x[i] > 0) {\n      newX.push(x[i]);\n      newY.push(y[i]);\n    }\n  }\n\n  return { x: newX, y: newY };\n}\n","import { xFindClosestIndex } from '../x/xFindClosestIndex';\n\nimport { xyCheck } from './xyCheck';\n\n/**\n * Find the closest maximum going up hill\n * @param {DataXY} [data={}] - Object that contains property x (an ordered increasing array) and y (an array)\n * @param {object} [options={}]\n * @param {number} [options.target]\n * @param {number} [options.targetIndex=0]\n * @return {{x,y,xIndex}} An object with the x/y value\n */\n\nexport function xyMaxClosestYPoint(data, options = {}) {\n  xyCheck(data);\n  const { x, y } = data;\n\n  let { target, targetIndex } = options;\n\n  if (targetIndex === undefined) {\n    if (target !== undefined) {\n      targetIndex = xFindClosestIndex(x, target);\n    } else {\n      targetIndex = 0;\n    }\n  }\n\n  let previousIndex = Number.MIN_SAFE_INTEGER;\n  let currentIndex = targetIndex;\n\n  let xyMaxY = y[targetIndex];\n\n  while (currentIndex !== previousIndex) {\n    previousIndex = currentIndex;\n    if (currentIndex > 0 && y[currentIndex - 1] > xyMaxY) {\n      currentIndex--;\n    } else if (currentIndex < x.length - 1 && y[currentIndex + 1] > xyMaxY) {\n      currentIndex++;\n    }\n    xyMaxY = y[currentIndex];\n  }\n  return {\n    x: x[currentIndex],\n    y: y[currentIndex],\n    index: currentIndex,\n  };\n}\n","import { xFindClosestIndex } from '../x/xFindClosestIndex';\n\nimport { xyCheck } from './xyCheck';\n\n/**\n * Find the closest minimum going down hill\n * @param {DataXY} [data={}] - Object that contains property x (an ordered increasing array) and y (an array)\n * @param {object} [options={}]\n * @param {number} [options.target]\n * @param {number} [options.targetIndex=0]\n * @return {{x,y,xIndex}} An object with the x/y value\n */\n\nexport function xyMinClosestYPoint(data, options = {}) {\n  xyCheck(data);\n  const { x, y } = data;\n\n  let { target, targetIndex } = options;\n\n  if (targetIndex === undefined) {\n    if (target !== undefined) {\n      targetIndex = xFindClosestIndex(x, target);\n    } else {\n      targetIndex = 0;\n    }\n  }\n\n  let previousIndex = Number.MIN_SAFE_INTEGER;\n  let currentIndex = targetIndex;\n\n  let minY = y[targetIndex];\n\n  while (currentIndex !== previousIndex) {\n    previousIndex = currentIndex;\n    if (currentIndex > 0 && y[currentIndex - 1] < minY) {\n      currentIndex--;\n    } else if (currentIndex < x.length - 1 && y[currentIndex + 1] < minY) {\n      currentIndex++;\n    }\n    minY = y[currentIndex];\n  }\n  return {\n    x: x[currentIndex],\n    y: y[currentIndex],\n    index: currentIndex,\n  };\n}\n","export const GAUSSIAN_EXP_FACTOR = -4 * Math.LN2;\nexport const ROOT_PI_OVER_LN2 = Math.sqrt(Math.PI / Math.LN2);\nexport const ROOT_THREE = Math.sqrt(3);\nexport const ROOT_2LN2 = Math.sqrt(2 * Math.LN2);\nexport const ROOT_2LN2_MINUS_ONE = Math.sqrt(2 * Math.LN2) - 1;\n//# sourceMappingURL=constants.js.map","// https://en.wikipedia.org/wiki/Error_function#Inverse_functions\n// This code yields to a good approximation\n// If needed a better implementation using polynomial can be found on https://en.wikipedia.org/wiki/Error_function#Inverse_functions\nexport default function erfinv(x) {\n    let a = 0.147;\n    if (x === 0)\n        return 0;\n    let ln1MinusXSqrd = Math.log(1 - x * x);\n    let lnEtcBy2Plus2 = ln1MinusXSqrd / 2 + 2 / (Math.PI * a);\n    let firstSqrt = Math.sqrt(lnEtcBy2Plus2 ** 2 - ln1MinusXSqrd / a);\n    let secondSqrt = Math.sqrt(firstSqrt - lnEtcBy2Plus2);\n    return secondSqrt * (x > 0 ? 1 : -1);\n}\n//# sourceMappingURL=erfinv.js.map","export class Shape1D {\n}\n//# sourceMappingURL=Shape1D.js.map","import { ROOT_2LN2, GAUSSIAN_EXP_FACTOR, ROOT_PI_OVER_LN2, } from '../../../util/constants';\nimport erfinv from '../../../util/erfinv';\nimport { Shape1D } from '../Shape1D';\nexport class Gaussian extends Shape1D {\n    constructor(options = {}) {\n        super();\n        const { fwhm = 500, sd, height } = options;\n        this.fwhm = sd ? widthToFWHM(2 * sd) : fwhm;\n        this.height =\n            height === undefined\n                ? Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI) / this.fwhm\n                : height;\n    }\n    fwhmToWidth(fwhm = this.fwhm) {\n        return fwhmToWidth(fwhm);\n    }\n    widthToFWHM(width) {\n        return widthToFWHM(width);\n    }\n    fct(x) {\n        return fct(x, this.fwhm);\n    }\n    getArea() {\n        return getArea({ fwhm: this.fwhm, height: this.height });\n    }\n    getFactor(area) {\n        return getFactor(area);\n    }\n    getData(options = {}) {\n        const { length, factor } = options;\n        return getData({ fwhm: this.fwhm, height: this.height, factor, length });\n    }\n}\n/**\n * Return a parameterized function of a gaussian shape (see README for equation).\n * @returns - the y value of gaussian with the current parameters.\n */\nexport function fct(x, fwhm) {\n    return Math.exp(GAUSSIAN_EXP_FACTOR * Math.pow(x / fwhm, 2));\n}\n/**\n * Compute the value of Full Width at Half Maximum (FWHM) from the width between the inflection points.\n * for more information check the [mathworld page](https://mathworld.wolfram.com/GaussianFunction.html)\n * @returns fwhm\n */\nexport function widthToFWHM(width) {\n    return width * ROOT_2LN2;\n}\n/**\n * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n * for more information check the [mathworld page](https://mathworld.wolfram.com/GaussianFunction.html)\n * @param fwhm - Full Width at Half Maximum.\n * @returns width\n */\nexport function fwhmToWidth(fwhm) {\n    return fwhm / ROOT_2LN2;\n}\n/**\n * Calculate the area of a specific shape.\n * @returns returns the area of the specific shape and parameters.\n */\nexport function getArea(options) {\n    let { fwhm, sd, height = 1 } = options;\n    if (sd)\n        fwhm = widthToFWHM(2 * sd);\n    if (fwhm === undefined) {\n        throw new Error('should pass fwhm or sd parameters');\n    }\n    return (height * ROOT_PI_OVER_LN2 * fwhm) / 2;\n}\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage.\n * @param [area=0.9999] Expected area to be covered.\n * @returns\n */\nexport function getFactor(area = 0.9999) {\n    return Math.sqrt(2) * erfinv(area);\n}\n/**\n * Calculate intensity array of a gaussian shape.\n * @returns {Float64Array} Intensity values.\n */\nexport function getData(options = {}) {\n    let { length, factor = getFactor(), fwhm = 500, sd, height } = options;\n    if (sd)\n        fwhm = widthToFWHM(2 * sd);\n    if (!height) {\n        height = Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI) / fwhm;\n    }\n    if (!length) {\n        length = Math.min(Math.ceil(fwhm * factor), Math.pow(2, 25) - 1);\n        if (length % 2 === 0)\n            length++;\n    }\n    const center = (length - 1) / 2;\n    const data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n        data[i] = fct(i - center, fwhm) * height;\n        data[length - 1 - i] = data[i];\n    }\n    return data;\n}\n//# sourceMappingURL=Gaussian.js.map","import { ROOT_THREE } from '../../../util/constants';\nimport { Shape1D } from '../Shape1D';\nexport class Lorentzian extends Shape1D {\n    constructor(options = {}) {\n        super();\n        const { fwhm = 500, height } = options;\n        this.fwhm = fwhm;\n        this.height = height === undefined ? 2 / Math.PI / fwhm : height;\n    }\n    fwhmToWidth(fwhm = this.fwhm) {\n        return fwhmToWidth(fwhm);\n    }\n    widthToFWHM(width) {\n        return widthToFWHM(width);\n    }\n    fct(x) {\n        return fct(x, this.fwhm);\n    }\n    getArea() {\n        return getArea({ fwhm: this.fwhm, height: this.height });\n    }\n    getFactor(area) {\n        return getFactor(area);\n    }\n    getData(options = {}) {\n        const { length, factor } = options;\n        return getData({ fwhm: this.fwhm, height: this.height, factor, length });\n    }\n}\n/**\n * Return a parameterized function of a lorentzian shape (see README for equation).\n * @param x - x value to calculate.\n * @param fwhm - full width half maximum\n * @returns - the y value of lorentzian with the current parameters.\n */\nexport function fct(x, fwhm) {\n    return Math.pow(fwhm, 2) / (4 * Math.pow(x, 2) + Math.pow(fwhm, 2));\n}\n/**\n * Compute the value of Full Width at Half Maximum (FWHM) from the width between the inflection points.\n * for more information check the [mathworld page](https://mathworld.wolfram.com/LorentzianFunction.html)\n * @param width - Width between the inflection points\n * @returns fwhm\n */\nexport function widthToFWHM(width) {\n    return width * ROOT_THREE;\n}\n/**\n * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n * for more information check the [mathworld page](https://mathworld.wolfram.com/LorentzianFunction.html)\n * @param fwhm - Full Width at Half Maximum.\n * @returns width\n */\nexport function fwhmToWidth(fwhm) {\n    return fwhm / ROOT_THREE;\n}\n/**\n * Calculate the area of a specific shape.\n * @returns returns the area of the specific shape and parameters.\n */\nexport function getArea(options) {\n    const { fwhm, height = 1 } = options;\n    if (fwhm === undefined) {\n        throw new Error('should pass fwhm or sd parameters');\n    }\n    return (height * Math.PI * fwhm) / 2;\n}\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage.\n * @param [area=0.9999] Expected area to be covered.\n * @returns\n */\nexport function getFactor(area = 0.9999) {\n    return 2 * Math.tan(Math.PI * (area - 0.5));\n}\n/**\n * Calculate intensity array of a lorentzian shape.\n * @returns {Float64Array} y values\n */\nexport function getData(options = {}) {\n    let { length, factor = getFactor(), fwhm = 500, height } = options;\n    if (!height) {\n        height = 2 / Math.PI / fwhm;\n    }\n    if (!length) {\n        length = Math.min(Math.ceil(fwhm * factor), Math.pow(2, 25) - 1);\n        if (length % 2 === 0)\n            length++;\n    }\n    const center = (length - 1) / 2;\n    const data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n        data[i] = fct(i - center, fwhm) * height;\n        data[length - 1 - i] = data[i];\n    }\n    return data;\n}\n//# sourceMappingURL=Lorentzian.js.map","import { GAUSSIAN_EXP_FACTOR, ROOT_2LN2_MINUS_ONE, ROOT_PI_OVER_LN2, } from '../../../util/constants';\nimport { Shape1D } from '../Shape1D';\nimport { fct as gaussian, getFactor as getFactorGaussian, } from '../gaussian/Gaussian';\nimport { fct as lorentzian, getFactor as getFactorLorentzian, } from '../lorentzian/Lorentzian';\nexport class PseudoVoigt extends Shape1D {\n    constructor(options = {}) {\n        super();\n        const { fwhm = 500, height, mu = 0.5 } = options;\n        this.mu = mu;\n        this.fwhm = fwhm;\n        this.height =\n            height === undefined\n                ? 1 /\n                    ((mu / Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI)) * fwhm +\n                        ((1 - mu) * fwhm * Math.PI) / 2)\n                : height;\n    }\n    fwhmToWidth(fwhm = this.fwhm, mu = this.mu) {\n        return fwhmToWidth(fwhm, mu);\n    }\n    widthToFWHM(width, mu = this.mu) {\n        return widthToFWHM(width, mu);\n    }\n    fct(x) {\n        return fct(x, this.fwhm, this.mu);\n    }\n    getArea() {\n        return getArea({ fwhm: this.fwhm, height: this.height, mu: this.mu });\n    }\n    getFactor(area) {\n        return getFactor(area);\n    }\n    getData(options = {}) {\n        const { length, factor } = options;\n        return getData({\n            fwhm: this.fwhm,\n            height: this.height,\n            mu: this.mu,\n            factor,\n            length,\n        });\n    }\n}\n/**\n * Return a parameterized function of a pseudo voigt shape (see README for equation).\n * @param x - x value to calculate.\n * @param fwhm - full width half maximum\n * @returns - the y value of pseudo voigt with the current parameters.\n */\nexport function fct(x, fwhm, mu) {\n    return (1 - mu) * lorentzian(x, fwhm) + mu * gaussian(x, fwhm);\n}\n/**\n * Compute the value of Full Width at Half Maximum (FWHM) from the width between the inflection points.\n * @param width - Width between the inflection points\n * @param [mu=0.5] Ratio of gaussian contribution in the shape\n * @returns fwhm\n */\nexport function widthToFWHM(width, mu = 0.5) {\n    return width * (mu * ROOT_2LN2_MINUS_ONE + 1);\n}\n/**\n * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n * @param fwhm - Full Width at Half Maximum.\n * @param [mu=0.5] Ratio of gaussian contribution in the shape\n * @returns width\n */\nexport function fwhmToWidth(fwhm, mu = 0.5) {\n    return fwhm / (mu * ROOT_2LN2_MINUS_ONE + 1);\n}\n/**\n * Calculate the area of a specific shape.\n * @returns returns the area of the specific shape and parameters.\n */\nexport function getArea(options) {\n    const { fwhm, height = 1, mu = 0.5 } = options;\n    if (fwhm === undefined) {\n        throw new Error('should pass fwhm or sd parameters');\n    }\n    return (fwhm * height * (mu * ROOT_PI_OVER_LN2 + (1 - mu) * Math.PI)) / 2;\n}\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage.\n * @param [area=0.9999] Expected area to be covered.\n * @returns\n */\nexport function getFactor(area = 0.9999, mu = 0.5) {\n    return mu < 1 ? getFactorLorentzian(area) : getFactorGaussian(area);\n}\n/**\n * Calculate intensity array of a pseudo voigt shape.\n * @returns {Float64Array} y values\n */\nexport function getData(options = {}) {\n    let { length, factor = getFactor(), fwhm = 500, height, mu = 0.5 } = options;\n    if (!height) {\n        height =\n            1 /\n                ((mu / Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI)) * fwhm +\n                    ((1 - mu) * fwhm * Math.PI) / 2);\n    }\n    if (!length) {\n        length = Math.min(Math.ceil(fwhm * factor), Math.pow(2, 25) - 1);\n        if (length % 2 === 0)\n            length++;\n    }\n    const center = (length - 1) / 2;\n    const data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n        data[i] = fct(i - center, fwhm, mu) * height;\n        data[length - 1 - i] = data[i];\n    }\n    return data;\n}\n//# sourceMappingURL=PseudoVoigt.js.map","import { Gaussian } from '../shapes/1d/gaussian/Gaussian';\nimport { Lorentzian } from '../shapes/1d/lorentzian/Lorentzian';\nimport { PseudoVoigt } from '../shapes/1d/pseudoVoigt/PseudoVoigt';\n/**\n * Generate a instance of a specific kind of shape.\n */\nexport function getShape1D(kind, shapeOptions = {}) {\n    switch (kind) {\n        case 'gaussian':\n            return new Gaussian(shapeOptions);\n        case 'lorentzian':\n            return new Lorentzian(shapeOptions);\n        case 'pseudoVoigt':\n            return new PseudoVoigt(shapeOptions);\n        default: {\n            const unHandled = kind;\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            throw Error(`Unknown distribution ${unHandled}`);\n        }\n    }\n}\n//# sourceMappingURL=getShape1D.js.map","/**\n * Apply Savitzky Golay algorithm\n * @param {array} [ys] Array of y values\n * @param {array|number} [xs] Array of X or deltaX\n * @param {object} [options={}]\n * @param {number} [options.windowSize=9]\n * @param {number} [options.derivative=0]\n * @param {number} [options.polynomial=3]\n * @return {array} Array containing the new ys (same length)\n */\n\nexport default function SavitzkyGolay(ys, xs, options = {}) {\n  let { windowSize = 9, derivative = 0, polynomial = 3 } = options;\n\n  if (windowSize % 2 === 0 || windowSize < 5 || !Number.isInteger(windowSize)) {\n    throw new RangeError(\n      'Invalid window size (should be odd and at least 5 integer number)',\n    );\n  }\n  if (windowSize > ys.length) {\n    throw new RangeError(\n      `Window size is higher than the data length ${windowSize}>${ys.length}`,\n    );\n  }\n  if (derivative < 0 || !Number.isInteger(derivative)) {\n    throw new RangeError('Derivative should be a positive integer');\n  }\n  if (polynomial < 1 || !Number.isInteger(polynomial)) {\n    throw new RangeError('Polynomial should be a positive integer');\n  }\n  if (polynomial >= 6) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'You should not use polynomial grade higher than 5 if you are' +\n        ' not sure that your data arises from such a model. Possible polynomial oscillation problems',\n    );\n  }\n\n  let half = Math.floor(windowSize / 2);\n  let np = ys.length;\n  let ans = new Array(np);\n  let weights = fullWeights(windowSize, polynomial, derivative);\n  let hs = 0;\n  let constantH = true;\n  if (Array.isArray(xs)) {\n    constantH = false;\n  } else {\n    hs = Math.pow(xs, derivative);\n  }\n\n  //For the borders\n  for (let i = 0; i < half; i++) {\n    let wg1 = weights[half - i - 1];\n    let wg2 = weights[half + i + 1];\n    let d1 = 0;\n    let d2 = 0;\n    for (let l = 0; l < windowSize; l++) {\n      d1 += wg1[l] * ys[l];\n      d2 += wg2[l] * ys[np - windowSize + l];\n    }\n    if (constantH) {\n      ans[half - i - 1] = d1 / hs;\n      ans[np - half + i] = d2 / hs;\n    } else {\n      hs = getHs(xs, half - i - 1, half, derivative);\n      ans[half - i - 1] = d1 / hs;\n      hs = getHs(xs, np - half + i, half, derivative);\n      ans[np - half + i] = d2 / hs;\n    }\n  }\n\n  //For the internal points\n  let wg = weights[half];\n  for (let i = windowSize; i <= np; i++) {\n    let d = 0;\n    for (let l = 0; l < windowSize; l++) d += wg[l] * ys[l + i - windowSize];\n    if (!constantH) hs = getHs(xs, i - half - 1, half, derivative);\n    ans[i - half - 1] = d / hs;\n  }\n  return ans;\n}\n\nfunction getHs(h, center, half, derivative) {\n  let hs = 0;\n  let count = 0;\n  for (let i = center - half; i < center + half; i++) {\n    if (i >= 0 && i < h.length - 1) {\n      hs += h[i + 1] - h[i];\n      count++;\n    }\n  }\n  return Math.pow(hs / count, derivative);\n}\n\nfunction GramPoly(i, m, k, s) {\n  let Grampoly = 0;\n  if (k > 0) {\n    Grampoly =\n      ((4 * k - 2) / (k * (2 * m - k + 1))) *\n        (i * GramPoly(i, m, k - 1, s) + s * GramPoly(i, m, k - 1, s - 1)) -\n      (((k - 1) * (2 * m + k)) / (k * (2 * m - k + 1))) *\n        GramPoly(i, m, k - 2, s);\n  } else {\n    if (k === 0 && s === 0) {\n      Grampoly = 1;\n    } else {\n      Grampoly = 0;\n    }\n  }\n  return Grampoly;\n}\n\nfunction GenFact(a, b) {\n  let gf = 1;\n  if (a >= b) {\n    for (let j = a - b + 1; j <= a; j++) {\n      gf *= j;\n    }\n  }\n  return gf;\n}\n\nfunction Weight(i, t, m, n, s) {\n  let sum = 0;\n  for (let k = 0; k <= n; k++) {\n    //console.log(k);\n    sum +=\n      (2 * k + 1) *\n      (GenFact(2 * m, k) / GenFact(2 * m + k + 1, k + 1)) *\n      GramPoly(i, m, k, 0) *\n      GramPoly(t, m, k, s);\n  }\n  return sum;\n}\n\n/**\n *\n * @param m  Number of points\n * @param n  Polynomial grade\n * @param s  Derivative\n */\nfunction fullWeights(m, n, s) {\n  let weights = new Array(m);\n  let np = Math.floor(m / 2);\n  for (let t = -np; t <= np; t++) {\n    weights[t + np] = new Array(m);\n    for (let j = -np; j <= np; j++) {\n      weights[t + np][j + np] = Weight(j, t, np, n, s);\n    }\n  }\n  return weights;\n}\n\n/*function entropy(data,h,options){\n    var trend = SavitzkyGolay(data,h,trendOptions);\n    var copy = new Array(data.length);\n    var sum = 0;\n    var max = 0;\n    for(var i=0;i<data.length;i++){\n        copy[i] = data[i]-trend[i];\n    }\n\n    sum/=data.length;\n    console.log(sum+\" \"+max);\n    console.log(stat.array.standardDeviation(copy));\n    console.log(Math.abs(stat.array.mean(copy))/stat.array.standardDeviation(copy));\n    return sum;\n\n}\n\n\n\nfunction guessWindowSize(data, h){\n    console.log(\"entropy \"+entropy(data,h,trendOptions));\n    return 5;\n}\n*/\n","import { getShape1D } from 'ml-peak-shape-generator';\nimport SG from 'ml-savitzky-golay-generalized';\n\n/**\n * Global spectra deconvolution\n * @param {object} data - Object data with x and y arrays\n * @param {Array<number>} [data.x] - Independent variable\n * @param {Array<number>} [data.y] - Dependent variable\n * @param {object} [options={}] - Options object\n * @param {object} [options.shape={}] - Object that specified the kind of shape to calculate the FWHM instead of width between inflection points. see https://mljs.github.io/peak-shape-generator/#inflectionpointswidthtofwhm\n * @param {object} [options.shape.kind='gaussian']\n * @param {object} [options.shape.options={}]\n * @param {object} [options.sgOptions] - Options object for Savitzky-Golay filter. See https://github.com/mljs/savitzky-golay-generalized#options\n * @param {number} [options.sgOptions.windowSize = 9] - points to use in the approximations\n * @param {number} [options.sgOptions.polynomial = 3] - degree of the polynomial to use in the approximations\n * @param {number} [options.minMaxRatio = 0.00025] - Threshold to determine if a given peak should be considered as a noise\n * @param {number} [options.broadRatio = 0.00] - If `broadRatio` is higher than 0, then all the peaks which second derivative\n * smaller than `broadRatio * maxAbsSecondDerivative` will be marked with the soft mask equal to true.\n * @param {number} [options.noiseLevel = 0] - Noise threshold in spectrum units\n * @param {boolean} [options.maxCriteria = true] - Peaks are local maximum(true) or minimum(false)\n * @param {boolean} [options.smoothY = true] - Select the peak intensities from a smoothed version of the independent variables\n * @param {boolean} [options.realTopDetection = false] - Use a quadratic optimizations with the peak and its 3 closest neighbors\n * to determine the true x,y values of the peak?\n * @param {number} [options.heightFactor = 0] - Factor to multiply the calculated height (usually 2)\n * @param {number} [options.derivativeThreshold = -1] - Filters based on the amplitude of the first derivative\n * @return {Array<object>}\n */\nexport function gsd(data, options = {}) {\n  let {\n    noiseLevel,\n    sgOptions = {\n      windowSize: 9,\n      polynomial: 3,\n    },\n    shape = {},\n    smoothY = true,\n    heightFactor = 0,\n    broadRatio = 0.0,\n    maxCriteria = true,\n    minMaxRatio = 0.00025,\n    derivativeThreshold = -1,\n    realTopDetection = false,\n  } = options;\n\n  let { y: yIn, x } = data;\n\n  const y = yIn.slice();\n  let equalSpaced = isEqualSpaced(x);\n\n  if (maxCriteria === false) {\n    for (let i = 0; i < y.length; i++) {\n      y[i] *= -1;\n    }\n  }\n\n  if (noiseLevel === undefined) {\n    noiseLevel = equalSpaced ? getNoiseLevel(y) : 0;\n  }\n  for (let i = 0; i < y.length; i++) {\n    y[i] -= noiseLevel;\n  }\n  for (let i = 0; i < y.length; i++) {\n    if (y[i] < 0) {\n      y[i] = 0;\n    }\n  }\n  // If the max difference between delta x is less than 5%, then,\n  // we can assume it to be equally spaced variable\n  let yData = y;\n  let dY, ddY;\n  const { windowSize, polynomial } = sgOptions;\n\n  if (equalSpaced) {\n    if (smoothY) {\n      yData = SG(y, x[1] - x[0], {\n        windowSize,\n        polynomial,\n        derivative: 0,\n      });\n    }\n    dY = SG(y, x[1] - x[0], {\n      windowSize,\n      polynomial,\n      derivative: 1,\n    });\n    ddY = SG(y, x[1] - x[0], {\n      windowSize,\n      polynomial,\n      derivative: 2,\n    });\n  } else {\n    if (smoothY) {\n      yData = SG(y, x, {\n        windowSize,\n        polynomial,\n        derivative: 0,\n      });\n    }\n    dY = SG(y, x, {\n      windowSize,\n      polynomial,\n      derivative: 1,\n    });\n    ddY = SG(y, x, {\n      windowSize,\n      polynomial,\n      derivative: 2,\n    });\n  }\n\n  const xData = x;\n  const dX = x[1] - x[0];\n  let maxDdy = 0;\n  let maxY = 0;\n  for (let i = 0; i < yData.length; i++) {\n    if (Math.abs(ddY[i]) > maxDdy) {\n      maxDdy = Math.abs(ddY[i]);\n    }\n    if (Math.abs(yData[i]) > maxY) {\n      maxY = Math.abs(yData[i]);\n    }\n  }\n\n  let lastMax = null;\n  let lastMin = null;\n  let minddY = [];\n  let intervalL = [];\n  let intervalR = [];\n  let broadMask = [];\n\n  // By the intermediate value theorem We cannot find 2 consecutive maximum or minimum\n  for (let i = 1; i < yData.length - 1; ++i) {\n    // filter based on derivativeThreshold\n    if (Math.abs(dY[i]) > derivativeThreshold) {\n      // Minimum in first derivative\n      if (\n        (dY[i] < dY[i - 1] && dY[i] <= dY[i + 1]) ||\n        (dY[i] <= dY[i - 1] && dY[i] < dY[i + 1])\n      ) {\n        lastMin = {\n          x: xData[i],\n          index: i,\n        };\n        if (dX > 0 && lastMax !== null) {\n          intervalL.push(lastMax);\n          intervalR.push(lastMin);\n        }\n      }\n\n      // Maximum in first derivative\n      if (\n        (dY[i] >= dY[i - 1] && dY[i] > dY[i + 1]) ||\n        (dY[i] > dY[i - 1] && dY[i] >= dY[i + 1])\n      ) {\n        lastMax = {\n          x: xData[i],\n          index: i,\n        };\n        if (dX < 0 && lastMin !== null) {\n          intervalL.push(lastMax);\n          intervalR.push(lastMin);\n        }\n      }\n    }\n\n    // Minimum in second derivative\n    if (ddY[i] < ddY[i - 1] && ddY[i] < ddY[i + 1]) {\n      minddY.push(i);\n      broadMask.push(Math.abs(ddY[i]) <= broadRatio * maxDdy);\n    }\n  }\n\n  let widthProcessor = shape.kind\n    ? getShape1D(shape.kind, shape.options).widthToFWHM\n    : (x) => x;\n\n  let signals = [];\n  let lastK = -1;\n  let possible, frequency, distanceJ, minDistance, gettingCloser;\n  for (let j = 0; j < minddY.length; ++j) {\n    frequency = xData[minddY[j]];\n    possible = -1;\n    let k = lastK + 1;\n    minDistance = Number.MAX_VALUE;\n    distanceJ = 0;\n    gettingCloser = true;\n    while (possible === -1 && k < intervalL.length && gettingCloser) {\n      distanceJ = Math.abs(frequency - (intervalL[k].x + intervalR[k].x) / 2);\n\n      // Still getting closer?\n      if (distanceJ < minDistance) {\n        minDistance = distanceJ;\n      } else {\n        gettingCloser = false;\n      }\n      if (distanceJ < Math.abs(intervalL[k].x - intervalR[k].x) / 2) {\n        possible = k;\n        lastK = k;\n      }\n      ++k;\n    }\n\n    if (possible !== -1) {\n      if (Math.abs(yData[minddY[j]]) > minMaxRatio * maxY) {\n        let width = Math.abs(intervalR[possible].x - intervalL[possible].x);\n        signals.push({\n          index: minddY[j],\n          x: frequency,\n          y: maxCriteria\n            ? yData[minddY[j]] + noiseLevel\n            : -yData[minddY[j]] - noiseLevel,\n          width: widthProcessor(width),\n          soft: broadMask[j],\n        });\n\n        signals[signals.length - 1].left = intervalL[possible];\n        signals[signals.length - 1].right = intervalR[possible];\n\n        if (heightFactor) {\n          let yLeft = yData[intervalL[possible].index];\n          let yRight = yData[intervalR[possible].index];\n          signals[signals.length - 1].height =\n            heightFactor *\n            (signals[signals.length - 1].y - (yLeft + yRight) / 2);\n        }\n      }\n    }\n  }\n\n  if (realTopDetection) {\n    determineRealTop(signals, xData, yData);\n  }\n\n  // Correct the values to fit the original spectra data\n  for (let j = 0; j < signals.length; j++) {\n    signals[j].base = noiseLevel;\n  }\n\n  signals.sort((a, b) => {\n    return a.x - b.x;\n  });\n\n  return signals;\n}\n\nconst isEqualSpaced = (x) => {\n  let tmp;\n  let maxDx = 0;\n  let minDx = Number.MAX_SAFE_INTEGER;\n  for (let i = 0; i < x.length - 1; ++i) {\n    tmp = Math.abs(x[i + 1] - x[i]);\n    if (tmp < minDx) {\n      minDx = tmp;\n    }\n    if (tmp > maxDx) {\n      maxDx = tmp;\n    }\n  }\n  return (maxDx - minDx) / maxDx < 0.05;\n};\n\nconst getNoiseLevel = (y) => {\n  let mean = 0;\n\n  let stddev = 0;\n  let length = y.length;\n  for (let i = 0; i < length; ++i) {\n    mean += y[i];\n  }\n  mean /= length;\n  let averageDeviations = new Array(length);\n  for (let i = 0; i < length; ++i) {\n    averageDeviations[i] = Math.abs(y[i] - mean);\n  }\n  averageDeviations.sort((a, b) => a - b);\n  if (length % 2 === 1) {\n    stddev = averageDeviations[(length - 1) / 2] / 0.6745;\n  } else {\n    stddev =\n      (0.5 *\n        (averageDeviations[length / 2] + averageDeviations[length / 2 - 1])) /\n      0.6745;\n  }\n\n  return stddev;\n};\n\nconst determineRealTop = (peakList, x, y) => {\n  let alpha, beta, gamma, p, currentPoint;\n  for (let j = 0; j < peakList.length; j++) {\n    currentPoint = peakList[j].index; // peakList[j][2];\n    // The detected peak could be moved 1 or 2 units to left or right.\n    if (\n      y[currentPoint - 1] >= y[currentPoint - 2] &&\n      y[currentPoint - 1] >= y[currentPoint]\n    ) {\n      currentPoint--;\n    } else {\n      if (\n        y[currentPoint + 1] >= y[currentPoint] &&\n        y[currentPoint + 1] >= y[currentPoint + 2]\n      ) {\n        currentPoint++;\n      } else {\n        if (\n          y[currentPoint - 2] >= y[currentPoint - 3] &&\n          y[currentPoint - 2] >= y[currentPoint - 1]\n        ) {\n          currentPoint -= 2;\n        } else {\n          if (\n            y[currentPoint + 2] >= y[currentPoint + 1] &&\n            y[currentPoint + 2] >= y[currentPoint + 3]\n          ) {\n            currentPoint += 2;\n          }\n        }\n      }\n    }\n    // interpolation to a sin() function\n    if (\n      y[currentPoint - 1] > 0 &&\n      y[currentPoint + 1] > 0 &&\n      y[currentPoint] >= y[currentPoint - 1] &&\n      y[currentPoint] >= y[currentPoint + 1] &&\n      (y[currentPoint] !== y[currentPoint - 1] ||\n        y[currentPoint] !== y[currentPoint + 1])\n    ) {\n      alpha = 20 * Math.log10(y[currentPoint - 1]);\n      beta = 20 * Math.log10(y[currentPoint]);\n      gamma = 20 * Math.log10(y[currentPoint + 1]);\n      p = (0.5 * (alpha - gamma)) / (alpha - 2 * beta + gamma);\n      // console.log(alpha, beta, gamma, `p: ${p}`);\n      // console.log(x[currentPoint]+\" \"+tmp+\" \"+currentPoint);\n      peakList[j].x =\n        x[currentPoint] + (x[currentPoint] - x[currentPoint - 1]) * p;\n      peakList[j].y =\n        y[currentPoint] -\n        0.25 * (y[currentPoint - 1] - y[currentPoint + 1]) * p;\n    }\n  }\n};\n","/*!\n * assign-symbols <https://github.com/jonschlinkert/assign-symbols>\n *\n * Copyright (c) 2015-present, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nconst toString = Object.prototype.toString;\nconst isEnumerable = Object.prototype.propertyIsEnumerable;\nconst getSymbols = Object.getOwnPropertySymbols;\n\nmodule.exports = (target, ...args) => {\n  if (!isObject(target)) {\n    throw new TypeError('expected the first argument to be an object');\n  }\n\n  if (args.length === 0 || typeof Symbol !== 'function' || typeof getSymbols !== 'function') {\n    return target;\n  }\n\n  for (let arg of args) {\n    let names = getSymbols(arg);\n\n    for (let key of names) {\n      if (isEnumerable.call(arg, key)) {\n        target[key] = arg[key];\n      }\n    }\n  }\n  return target;\n};\n\nfunction isObject(val) {\n  return typeof val === 'function' || toString.call(val) === '[object Object]' || Array.isArray(val);\n}\n","/*!\n * assign-deep <https://github.com/jonschlinkert/assign-deep>\n *\n * Copyright (c) 2017-present, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nconst toString = Object.prototype.toString;\nconst assignSymbols = require('assign-symbols');\n\nconst isValidKey = key => {\n  return key !== '__proto__' && key !== 'constructor' && key !== 'prototype';\n};\n\nconst assign = module.exports = (target, ...args) => {\n  let i = 0;\n  if (isPrimitive(target)) target = args[i++];\n  if (!target) target = {};\n  for (; i < args.length; i++) {\n    if (isObject(args[i])) {\n      for (const key of Object.keys(args[i])) {\n        if (isValidKey(key)) {\n          if (isObject(target[key]) && isObject(args[i][key])) {\n            assign(target[key], args[i][key]);\n          } else {\n            target[key] = args[i][key];\n          }\n        }\n      }\n      assignSymbols(target, args[i]);\n    }\n  }\n  return target;\n};\n\nfunction isObject(val) {\n  return typeof val === 'function' || toString.call(val) === '[object Object]';\n}\n\nfunction isPrimitive(val) {\n  return typeof val === 'object' ? val === null : typeof val !== 'function';\n}\n","export const GAUSSIAN_EXP_FACTOR = -4 * Math.LN2;\nexport const ROOT_PI_OVER_LN2 = Math.sqrt(Math.PI / Math.LN2);\nexport const ROOT_THREE = Math.sqrt(3);\nexport const ROOT_2LN2 = Math.sqrt(2 * Math.LN2);\nexport const ROOT_2LN2_MINUS_ONE = Math.sqrt(2 * Math.LN2) - 1;\n","// https://en.wikipedia.org/wiki/Error_function#Inverse_functions\n// This code yields to a good approximation\n\n// If needed a better implementation using polynomial can be found on https://en.wikipedia.org/wiki/Error_function#Inverse_functions\n\nexport default function erfinv(x) {\n  let a = 0.147;\n  if (x === 0) return 0;\n  let ln1MinusXSqrd = Math.log(1 - x * x);\n  let lnEtcBy2Plus2 = ln1MinusXSqrd / 2 + 2 / (Math.PI * a);\n  let firstSqrt = Math.sqrt(lnEtcBy2Plus2 ** 2 - ln1MinusXSqrd / a);\n  let secondSqrt = Math.sqrt(firstSqrt - lnEtcBy2Plus2);\n  return secondSqrt * (x > 0 ? 1 : -1);\n}\n","import {\n  ROOT_2LN2,\n  GAUSSIAN_EXP_FACTOR,\n  ROOT_PI_OVER_LN2,\n} from '../util/constants';\nimport erfinv from '../util/erfinv';\n\nexport class Gaussian {\n  /**\n   * @param {object} [options = {}]\n   * @param {number} [options.height=4*LN2/(PI*FWHM)] Define the height of the peak, by default area=1 (normalized)\n   * @param {number} [options.fwhm = 500] - Full Width at Half Maximum in the number of points in FWHM.\n   * @param {number} [options.sd] - Standard deviation, if it's defined options.fwhm will be ignored and the value will be computed sd * Math.sqrt(8 * Math.LN2);\n   */\n  constructor(options = {}) {\n    this.fwhm = options.sd\n      ? Gaussian.widthToFWHM(2 * options.sd)\n      : options.fwhm\n      ? options.fwhm\n      : 500;\n    this.height =\n      options.height === undefined\n        ? Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI) / this.fwhm\n        : options.height;\n  }\n  /**\n   * Calculate a gaussian shape\n   * @param {object} [options = {}]\n   * @param {number} [options.factor = 6] - Number of time to take fwhm to calculate length. Default covers 99.99 % of area.\n   * @param {number} [options.length = fwhm * factor + 1] - total number of points to calculate\n   * @return {Float64Array} y values\n   */\n\n  getData(options = {}) {\n    let { length, factor = this.getFactor() } = options;\n\n    if (!length) {\n      length = Math.min(Math.ceil(this.fwhm * factor), Math.pow(2, 25) - 1);\n      if (length % 2 === 0) length++;\n    }\n\n    const center = (length - 1) / 2;\n    const data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n      data[i] = this.fct(i - center) * this.height;\n      data[length - 1 - i] = data[i];\n    }\n\n    return data;\n  }\n\n  /**\n   * Return a parameterized function of a gaussian shape (see README for equation).\n   * @param {number} x - x value to calculate.\n   * @returns {number} - the y value of gaussian with the current parameters.\n   */\n  fct(x) {\n    return Gaussian.fct(x, this.fwhm);\n  }\n\n  /**\n   * Calculate the number of times FWHM allows to reach a specific area coverage\n   * @param {number} [area=0.9999]\n   * @returns {number}\n   */\n  getFactor(area = 0.9999) {\n    return Gaussian.getFactor(area);\n  }\n\n  /**\n   * Calculate the area of the shape.\n   * @returns {number} - returns the area.\n   */\n\n  getArea() {\n    return Gaussian.getArea(this.fwhm, { height: this.height });\n  }\n\n  /**\n   * Compute the value of Full Width at Half Maximum (FWHM) from the width between the inflection points.\n   * //https://mathworld.wolfram.com/GaussianFunction.html\n   * @param {number} width - Width between the inflection points\n   * @returns {number} fwhm\n   */\n  widthToFWHM(width) {\n    //https://mathworld.wolfram.com/GaussianFunction.html\n    return Gaussian.widthToFWHM(width);\n  }\n\n  /**\n   * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n   * //https://mathworld.wolfram.com/GaussianFunction.html\n   * @param {number} fwhm - Full Width at Half Maximum.\n   * @returns {number} width\n   */\n  fwhmToWidth(fwhm = this.fwhm) {\n    return Gaussian.fwhmToWidth(fwhm);\n  }\n\n  /**\n   * set a new full width at half maximum\n   * @param {number} fwhm - full width at half maximum\n   */\n  setFWHM(fwhm) {\n    this.fwhm = fwhm;\n  }\n\n  /**\n   * set a new height\n   * @param {number} height - The maximal intensity of the shape.\n   */\n  setHeight(height) {\n    this.height = height;\n  }\n}\n\n/**\n * Return a parameterized function of a gaussian shape (see README for equation).\n * @param {number} x - x value to calculate.\n * @param {number} fwhm - full width half maximum\n * @returns {number} - the y value of gaussian with the current parameters.\n */\nGaussian.fct = function fct(x, fwhm = 500) {\n  return Math.exp(GAUSSIAN_EXP_FACTOR * Math.pow(x / fwhm, 2));\n};\n\n/**\n * Compute the value of Full Width at Half Maximum (FWHM) from the width between the inflection points.\n * //https://mathworld.wolfram.com/GaussianFunction.html\n * @param {number} width - Width between the inflection points\n * @returns {number} fwhm\n */\nGaussian.widthToFWHM = function widthToFWHM(width) {\n  return width * ROOT_2LN2;\n};\n\n/**\n * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n * //https://mathworld.wolfram.com/GaussianFunction.html\n * @param {number} fwhm - Full Width at Half Maximum.\n * @returns {number} width\n */\nGaussian.fwhmToWidth = function fwhmToWidth(fwhm) {\n  return fwhm / ROOT_2LN2;\n};\n\n/**\n * Calculate the area of a specific shape.\n * @param {number} fwhm - Full width at half maximum.\n * @param {object} [options = {}] - options.\n * @param {number} [options.height = 1] - Maximum y value of the shape.\n * @returns {number} - returns the area of the specific shape and parameters.\n */\n\nGaussian.getArea = function getArea(fwhm, options = {}) {\n  let { height = 1 } = options;\n  return (height * ROOT_PI_OVER_LN2 * fwhm) / 2;\n};\n\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage.\n * @param {number} [area=0.9999]\n * @returns {number}\n */\nGaussian.getFactor = function getFactor(area = 0.9999) {\n  return Math.sqrt(2) * erfinv(area);\n};\n","import { ROOT_THREE } from '../util/constants';\n\nexport class Lorentzian {\n  /**\n   * @param {object} [options = {}]\n   * @param {number} [options.height=2/(PI*FWHM)] Define the height of the peak, by default area=1 (normalized)\n   * @param {number} [options.fwhm = 500] - Full Width at Half Maximum in the number of points in FWHM.\n   * @param {number} [options.sd] - Standard deviation, if it's defined options.fwhm will be ignored and the value will be computed sd * Math.sqrt(8 * Math.LN2);\n   */\n  constructor(options = {}) {\n    this.fwhm = options.fwhm === undefined ? 500 : options.fwhm;\n    this.height =\n      options.height === undefined ? 2 / Math.PI / this.fwhm : options.height;\n  }\n  /**\n   * Calculate a lorentzian shape\n   * @param {object} [options = {}]\n   * @param {number} [options.factor = Math.tan(Math.PI * (0.9999 - 0.5))] - Number of time to take fwhm to calculate length. Default covers 99.99 % of area.\n   * @param {number} [options.length = fwhm * factor + 1] - total number of points to calculate\n   * @return {Float64Array} y values\n   */\n  getData(options = {}) {\n    let { length, factor = this.getFactor() } = options;\n\n    if (!length) {\n      length = Math.min(Math.ceil(this.fwhm * factor), Math.pow(2, 25) - 1);\n      if (length % 2 === 0) length++;\n    }\n\n    const center = (length - 1) / 2;\n    const data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n      data[i] = this.fct(i - center) * this.height;\n      data[length - 1 - i] = data[i];\n    }\n    return data;\n  }\n\n  /**\n   * Return a parameterized function of a lorentzian shape (see README for equation).\n   * @param {number} x - x value to calculate.\n   * @returns {number} - the y value of lorentzian with the current parameters.\n   */\n  fct(x) {\n    return Lorentzian.fct(x, this.fwhm);\n  }\n\n  /**\n   * Calculate the number of times FWHM allows to reach a specific area coverage\n   * @param {number} [area=0.9999]\n   * @returns {number}\n   */\n  getFactor(area = 0.9999) {\n    return Lorentzian.getFactor(area);\n  }\n\n  /**\n   * Calculate the area of the shape.\n   * @returns {number} - returns the area.\n   */\n\n  getArea() {\n    return Lorentzian.getArea(this.fwhm, { height: this.height });\n  }\n\n  /**\n   * Compute the value of width between the inflection points of a specific shape from Full Width at Half Maximum (FWHM).\n   * //https://mathworld.wolfram.com/LorentzianFunction.html\n   * @param {number} [fwhm] - Full Width at Half Maximum.\n   * @returns {number} width between the inflection points\n   */\n  fwhmToWidth(fwhm = this.fwhm) {\n    return Lorentzian.fwhmToWidth(fwhm);\n  }\n\n  /**\n   * Compute the value of Full Width at Half Maximum (FWHM) of a specific shape from the width between the inflection points.\n   * //https://mathworld.wolfram.com/LorentzianFunction.html\n   * @param {number} [width] Width between the inflection points\n   * @returns {number} fwhm\n   */\n  widthToFWHM(width) {\n    return Lorentzian.widthToFWHM(width);\n  }\n  /**\n   * set a new full width at half maximum\n   * @param {number} fwhm - full width at half maximum\n   */\n  setFWHM(fwhm) {\n    this.fwhm = fwhm;\n  }\n\n  /**\n   * set a new height\n   * @param {number} height - The maximal intensity of the shape.\n   */\n  setHeight(height) {\n    this.height = height;\n  }\n}\n\n/**\n * Return a parameterized function of a gaussian shape (see README for equation).\n * @param {number} x - x value to calculate.\n * @param {number} fwhm - full width half maximum\n * @returns {number} - the y value of gaussian with the current parameters.\n */\nLorentzian.fct = function fct(x, fwhm) {\n  const squareFWHM = fwhm * fwhm;\n  return squareFWHM / (4 * Math.pow(x, 2) + squareFWHM);\n};\n\n/**\n * Compute the value of width between the inflection points of a specific shape from Full Width at Half Maximum (FWHM).\n * //https://mathworld.wolfram.com/LorentzianFunction.html\n * @param {number} [fwhm] - Full Width at Half Maximum.\n * @returns {number} width between the inflection points\n */\nLorentzian.fwhmToWidth = function fwhmToWidth(fwhm) {\n  return fwhm / ROOT_THREE;\n};\n\n/**\n * Compute the value of Full Width at Half Maximum (FWHM) of a specific shape from the width between the inflection points.\n * //https://mathworld.wolfram.com/LorentzianFunction.html\n * @param {number} [width] Width between the inflection points\n * @returns {number} fwhm\n */\nLorentzian.widthToFWHM = function widthToFWHM(width) {\n  return width * ROOT_THREE;\n};\n\n/**\n * Calculate the area of a specific shape.\n * @param {number} fwhm - Full width at half maximum.\n * @param {*} [options = {}] - options.\n * @param {number} [options.height = 1] - Maximum y value of the shape.\n * @returns {number} - returns the area of the specific shape and parameters.\n */\nLorentzian.getArea = function getArea(fwhm, options = {}) {\n  let { height = 1 } = options;\n\n  return (height * Math.PI * fwhm) / 2;\n};\n\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage\n * @param {number} [area=0.9999]\n * @returns {number}\n */\nLorentzian.getFactor = function getFactor(area = 0.9999) {\n  return 2 * Math.tan(Math.PI * (area - 0.5));\n};\n","import {\n  GAUSSIAN_EXP_FACTOR,\n  ROOT_2LN2_MINUS_ONE,\n  ROOT_PI_OVER_LN2,\n} from '../util/constants';\n\nimport { Gaussian } from './Gaussian';\nimport { Lorentzian } from './Lorentzian';\n\nexport class PseudoVoigt {\n  /**\n   * @param {object} [options={}]\n   * @param {number} [options.height=1/(mu*FWHM/sqrt(4*LN2/PI)+(1-mu)*fwhm*PI*0.5)] Define the height of the peak, by default area=1 (normalized)\n   * @param {number} [options.fwhm=500] - Full Width at Half Maximum in the number of points in FWHM.\n   * @param {number} [options.mu=0.5] - ratio of gaussian contribution.\n   */\n\n  constructor(options = {}) {\n    this.mu = options.mu === undefined ? 0.5 : options.mu;\n    this.fwhm = options.fwhm === undefined ? 500 : options.fwhm;\n    this.height =\n      options.height === undefined\n        ? 1 /\n          ((this.mu / Math.sqrt(-GAUSSIAN_EXP_FACTOR / Math.PI)) * this.fwhm +\n            ((1 - this.mu) * this.fwhm * Math.PI) / 2)\n        : options.height;\n  }\n\n  /**\n   * Calculate a linear combination of gaussian and lorentzian function width an same full width at half maximum\n   * @param { object } [options = {}]\n   * @param { number } [options.factor = 2 * Math.tan(Math.PI * (0.9999 - 0.5))] - Number of time to take fwhm in the calculation of the length.Default covers 99.99 % of area.\n   * @param { number } [options.length = fwhm * factor + 1] - total number of points to calculate\n   * @return { object } - { fwhm, data<Float64Array>} - An with the number of points at half maximum and the array of y values covering the 99.99 % of the area.\n   */\n\n  getData(options = {}) {\n    let { length, factor = this.getFactor() } = options;\n    if (!length) {\n      length = Math.ceil(this.fwhm * factor);\n      if (length % 2 === 0) length++;\n    }\n\n    const center = (length - 1) / 2;\n\n    let data = new Float64Array(length);\n    for (let i = 0; i <= center; i++) {\n      data[i] = this.fct(i - center) * this.height;\n      data[length - 1 - i] = data[i];\n    }\n\n    return data;\n  }\n\n  /**\n   * Return a parameterized function of a linear combination of Gaussian and Lorentzian shapes where the full width at half maximum are the same for both kind of shapes (see README for equation).\n   * @param {number} [x] x value to calculate.\n   * @returns {number} - the y value of a pseudo voigt with the current parameters.\n   */\n\n  fct(x) {\n    return PseudoVoigt.fct(x, this.fwhm, this.mu);\n  }\n\n  /**\n   * Calculate the number of times FWHM allows to reach a specific area coverage\n   * @param {number} [area=0.9999] - required area to be coverage\n   * @param {number} [mu=this.mu] - ratio of gaussian contribution.\n   * @returns {number}\n   */\n  getFactor(area = 0.9999, mu = this.mu) {\n    return PseudoVoigt.getFactor(area, mu);\n  }\n\n  /**\n   * Calculate the area of the shape.\n   * @returns {number} - returns the area.\n   */\n  getArea() {\n    return PseudoVoigt.getArea(this.fwhm, { height: this.height, mu: this.mu });\n  }\n\n  /**\n   * Compute the value of Full Width at Half Maximum (FMHM) from width between the inflection points.\n   * @param {number} width - width between the inflection points\n   * @param {number} [mu = 0.5] - ratio of gaussian contribution.\n   * @returns {number} Full Width at Half Maximum (FMHM).\n   */\n  widthToFWHM(width, mu) {\n    return PseudoVoigt.widthToFWHM(width, mu);\n  }\n  /**\n   * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n   * @param {number} fwhm - Full Width at Half Maximum.\n   * @param {number} [mu] - ratio of gaussian contribution.\n   * @returns {number} width between the inflection points.\n   */\n  fwhmToWidth(fwhm = this.fwhm, mu = this.mu) {\n    return PseudoVoigt.fwhmToWidth(fwhm, mu);\n  }\n\n  /**\n   * set a new full width at half maximum\n   * @param {number} fwhm - full width at half maximum\n   */\n  setFWHM(fwhm) {\n    this.fwhm = fwhm;\n  }\n\n  /**\n   * set a new height\n   * @param {number} height - The maximal intensity of the shape.\n   */\n  setHeight(height) {\n    this.height = height;\n  }\n\n  /**\n   * set a new mu\n   * @param {number} mu - ratio of gaussian contribution.\n   */\n  setMu(mu) {\n    this.mu = mu;\n  }\n}\n\n/**\n * Return a parameterized function of a gaussian shape (see README for equation).\n * @param {number} x - x value to calculate.\n * @param {number} fwhm - full width half maximum\n * @param {number} [mu=0.5] - ratio of gaussian contribution.\n * @returns {number} - the y value of gaussian with the current parameters.\n */\nPseudoVoigt.fct = function fct(x, fwhm, mu = 0.5) {\n  return (1 - mu) * Lorentzian.fct(x, fwhm) + mu * Gaussian.fct(x, fwhm);\n};\n\n/**\n * Compute the value of Full Width at Half Maximum (FMHM) from width between the inflection points.\n * @param {number} width - width between the inflection points\n * @param {number} [mu = 0.5] - ratio of gaussian contribution.\n * @returns {number} Full Width at Half Maximum (FMHM).\n */\nPseudoVoigt.widthToFWHM = function widthToFWHM(width, mu = 0.5) {\n  return width * (mu * ROOT_2LN2_MINUS_ONE + 1);\n};\n/**\n * Compute the value of width between the inflection points from Full Width at Half Maximum (FWHM).\n * @param {number} fwhm - Full Width at Half Maximum.\n * @param {number} [mu = 0.5] - ratio of gaussian contribution.\n * @returns {number} width between the inflection points.\n */\nPseudoVoigt.fwhmToWidth = function fwhmToWidth(fwhm, mu = 0.5) {\n  return fwhm / (mu * ROOT_2LN2_MINUS_ONE + 1);\n};\n\n/**\n * Calculate the area of a specific shape.\n * @param {number} fwhm - Full width at half maximum.\n * @param {*} [options = {}] - options.\n * @param {number} [options.height = 1] - Maximum y value of the shape.\n * @param {number} [options.mu = 0.5] - ratio of gaussian contribution.\n * @returns {number} - returns the area of the specific shape and parameters.\n */\nPseudoVoigt.getArea = function getArea(fwhm, options = {}) {\n  let { height = 1, mu = 0.5 } = options;\n  return (fwhm * height * (mu * ROOT_PI_OVER_LN2 + (1 - mu) * Math.PI)) / 2;\n};\n\n/**\n * Calculate the number of times FWHM allows to reach a specific area coverage\n * @param {number} [area=0.9999] - required area to be coverage\n * @param {number} [mu=this.mu] - ratio of gaussian contribution.\n * @returns {number}\n */\nPseudoVoigt.getFactor = function getFactor(area = 0.9999, mu = 0.5) {\n  return mu < 1 ? Lorentzian.getFactor(area) : Gaussian.getFactor(area);\n};\n","import { PseudoVoigt } from 'ml-peak-shape-generator';\n\n/**\n * This function calculates the spectrum as a sum of linear combination of gaussian and lorentzian functions. The pseudo voigt\n * parameters are divided in 4 batches. 1st: centers; 2nd: heights; 3th: widths; 4th: mu's ;\n * @param t Ordinate value\n * @param p Lorentzian parameters\n * @returns {*}\n */\n\nexport function sumOfGaussianLorentzians(p) {\n  return function (t) {\n    let nL = p.length / 4;\n    let result = 0;\n    for (let i = 0; i < nL; i++) {\n      result +=\n        p[i + nL] * PseudoVoigt.fct(t - p[i], p[i + nL * 2], p[i + nL * 3]);\n    }\n    return result;\n  };\n}\n","import { Gaussian } from 'ml-peak-shape-generator';\n/**\n * This function calculates the spectrum as a sum of gaussian functions. The Gaussian\n * parameters are divided in 3 batches. 1st: centers; 2nd: height; 3th: widths;\n * @param t Ordinate values\n * @param p Gaussian parameters\n * @returns {*}\n */\n\nexport function sumOfGaussians(p) {\n  return function (t) {\n    let nL = p.length / 3;\n    let result = 0;\n    for (let i = 0; i < nL; i++) {\n      result += p[i + nL] * Gaussian.fct(t - p[i], p[i + nL * 2]);\n    }\n    return result;\n  };\n}\n","import { Lorentzian } from 'ml-peak-shape-generator';\n\n/**\n * This function calculates the spectrum as a sum of lorentzian functions. The Lorentzian\n * parameters are divided in 3 batches. 1st: centers; 2nd: heights; 3th: widths;\n * @param t Ordinate values\n * @param p Lorentzian parameters\n * @returns {*}\n */\n\nexport function sumOfLorentzians(p) {\n  return function (t) {\n    let nL = p.length / 3;\n    let result = 0;\n    for (let i = 0; i < nL; i++) {\n      result += p[i + nL] * Lorentzian.fct(t - p[i], p[i + nL * 2]);\n    }\n    return result;\n  };\n}\n","import assignDeep from 'assign-deep';\nimport getMaxValue from 'ml-array-max';\n\nimport { sumOfGaussianLorentzians } from './shapes/sumOfGaussianLorentzians';\nimport { sumOfGaussians } from './shapes/sumOfGaussians';\nimport { sumOfLorentzians } from './shapes/sumOfLorentzians';\n\nexport function checkInput(data, peaks, options) {\n  let {\n    shape = { kind: 'gaussian' },\n    optimization = {\n      kind: 'lm',\n    },\n  } = options;\n\n  if (typeof shape.kind !== 'string') {\n    throw new Error('kind should be a string');\n  }\n\n  let kind = shape.kind.toLowerCase().replace(/[^a-z]/g, '');\n\n  let paramsFunc;\n  let defaultParameters;\n  switch (kind) {\n    case 'gaussian':\n      paramsFunc = sumOfGaussians;\n      defaultParameters = {\n        x: {\n          init: (peak) => peak.x,\n          max: (peak) => peak.x + peak.width * 2,\n          min: (peak) => peak.x - peak.width * 2,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n        y: {\n          init: (peak) => peak.y,\n          max: () => 1.5,\n          min: () => 0,\n          gradientDifference: () => 1e-3,\n        },\n        width: {\n          init: (peak) => peak.width,\n          max: (peak) => peak.width * 4,\n          min: (peak) => peak.width * 0.25,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n      };\n      break;\n    case 'lorentzian':\n      paramsFunc = sumOfLorentzians;\n      defaultParameters = {\n        x: {\n          init: (peak) => peak.x,\n          max: (peak) => peak.x + peak.width * 2,\n          min: (peak) => peak.x - peak.width * 2,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n        y: {\n          init: (peak) => peak.y,\n          max: () => 1.5,\n          min: () => 0,\n          gradientDifference: () => 1e-3,\n        },\n        width: {\n          init: (peak) => peak.width,\n          max: (peak) => peak.width * 4,\n          min: (peak) => peak.width * 0.25,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n      };\n      break;\n    case 'pseudovoigt':\n      paramsFunc = sumOfGaussianLorentzians;\n      defaultParameters = {\n        x: {\n          init: (peak) => peak.x,\n          max: (peak) => peak.x + peak.width * 2,\n          min: (peak) => peak.x - peak.width * 2,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n        y: {\n          init: (peak) => peak.y,\n          max: () => 1.5,\n          min: () => 0,\n          gradientDifference: () => 1e-3,\n        },\n        width: {\n          init: (peak) => peak.width,\n          max: (peak) => peak.width * 4,\n          min: (peak) => peak.width * 0.25,\n          gradientDifference: (peak) => peak.width * 2e-3,\n        },\n        mu: {\n          init: (peak) => (peak.mu !== undefined ? peak.mu : 0.5),\n          min: () => 0,\n          max: () => 1,\n          gradientDifference: () => 0.01,\n        },\n      };\n      break;\n    default:\n      throw new Error('kind of shape is not supported');\n  }\n\n  let x = data.x;\n  let maxY = getMaxValue(data.y);\n  let y = new Array(x.length);\n  for (let i = 0; i < x.length; i++) {\n    y[i] = data.y[i] / maxY;\n  }\n\n  for (let i = 0; i < peaks.length; i++) {\n    peaks[i].y /= maxY;\n  }\n\n  let parameters = assignDeep({}, optimization.parameters, defaultParameters);\n\n  for (let key in parameters) {\n    for (let par in parameters[key]) {\n      if (!Array.isArray(parameters[key][par])) {\n        parameters[key][par] = [parameters[key][par]];\n      }\n      if (\n        parameters[key][par].length !== 1 &&\n        parameters[key][par].length !== peaks.length\n      ) {\n        throw new Error(`The length of ${key}-${par} is not correct`);\n      }\n      for (let index = 0; index < parameters[key][par].length; index++) {\n        if (typeof parameters[key][par][index] === 'number') {\n          let value = parameters[key][par][index];\n          parameters[key][par][index] = () => value;\n        }\n      }\n    }\n  }\n\n  optimization.parameters = parameters;\n\n  return {\n    y,\n    x,\n    maxY,\n    peaks,\n    paramsFunc,\n    optimization,\n  };\n}\n","import isArray from 'is-any-array';\n\nexport default function checkOptions(data, parameterizedFunction, options) {\n  let {\n    timeout,\n    minValues,\n    maxValues,\n    initialValues,\n    weights = 1,\n    damping = 1e-2,\n    dampingStepUp = 11,\n    dampingStepDown = 9,\n    maxIterations = 100,\n    errorTolerance = 1e-7,\n    centralDifference = false,\n    gradientDifference = 10e-2,\n    improvementThreshold = 1e-3,\n  } = options;\n\n  if (damping <= 0) {\n    throw new Error('The damping option must be a positive number');\n  } else if (!data.x || !data.y) {\n    throw new Error('The data parameter must have x and y elements');\n  } else if (\n    !isArray(data.x) ||\n    data.x.length < 2 ||\n    !isArray(data.y) ||\n    data.y.length < 2\n  ) {\n    throw new Error(\n      'The data parameter elements must be an array with more than 2 points',\n    );\n  } else if (data.x.length !== data.y.length) {\n    throw new Error('The data parameter elements must have the same size');\n  }\n\n  let parameters =\n    initialValues || new Array(parameterizedFunction.length).fill(1);\n\n  let nbPoints = data.y.length;\n  let parLen = parameters.length;\n  maxValues = maxValues || new Array(parLen).fill(Number.MAX_SAFE_INTEGER);\n  minValues = minValues || new Array(parLen).fill(Number.MIN_SAFE_INTEGER);\n\n  if (maxValues.length !== minValues.length) {\n    throw new Error('minValues and maxValues must be the same size');\n  }\n\n  if (!isArray(parameters)) {\n    throw new Error('initialValues must be an array');\n  }\n\n  if (typeof gradientDifference === 'number') {\n    gradientDifference = new Array(parameters.length).fill(gradientDifference);\n  } else if (isArray(gradientDifference)) {\n    if (gradientDifference.length !== parLen) {\n      gradientDifference = new Array(parLen).fill(gradientDifference[0]);\n    }\n  } else {\n    throw new Error(\n      'gradientDifference should be a number or array with length equal to the number of parameters',\n    );\n  }\n\n  let filler;\n  if (typeof weights === 'number') {\n    let value = 1 / weights ** 2;\n    filler = () => value;\n  } else if (isArray(weights)) {\n    if (weights.length < data.x.length) {\n      let value = 1 / weights[0] ** 2;\n      filler = () => value;\n    } else {\n      filler = (i) => 1 / weights[i] ** 2;\n    }\n  } else {\n    throw new Error(\n      'weights should be a number or array with length equal to the number of data points',\n    );\n  }\n\n  let checkTimeout;\n  if (timeout !== undefined) {\n    if (typeof timeout !== 'number') {\n      throw new Error('timeout should be a number');\n    }\n    let endTime = Date.now() + timeout * 1000;\n    checkTimeout = () => Date.now() > endTime;\n  } else {\n    checkTimeout = () => false;\n  }\n\n  let weightSquare = new Array(data.x.length);\n  for (let i = 0; i < nbPoints; i++) {\n    weightSquare[i] = filler(i);\n  }\n\n  return {\n    checkTimeout,\n    minValues,\n    maxValues,\n    parameters,\n    weightSquare,\n    damping,\n    dampingStepUp,\n    dampingStepDown,\n    maxIterations,\n    errorTolerance,\n    centralDifference,\n    gradientDifference,\n    improvementThreshold,\n  };\n}\n","/**\n * the sum of the weighted squares of the errors (or weighted residuals) between the data.y\n * and the curve-fit function.\n * @ignore\n * @param {{x:Array<number>, y:Array<number>}} data - Array of points to fit in the format [x1, x2, ... ], [y1, y2, ... ]\n * @param {Array<number>} parameters - Array of current parameter values\n * @param {function} parameterizedFunction - The parameters and returns a function with the independent variable as a parameter\n * @param {Array} weightSquare - Square of weights\n * @return {number}\n */\nexport default function errorCalculation(\n  data,\n  parameters,\n  parameterizedFunction,\n  weightSquare,\n) {\n  let error = 0;\n  const func = parameterizedFunction(parameters);\n  for (let i = 0; i < data.x.length; i++) {\n    error += Math.pow(data.y[i] - func(data.x[i]), 2) / weightSquare[i];\n  }\n\n  return error;\n}\n","import isArray from 'is-any-array';\nimport max from 'ml-array-max';\nimport min from 'ml-array-min';\n\nfunction rescale(input) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  } else if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n\n  var output;\n\n  if (options.output !== undefined) {\n    if (!isArray(options.output)) {\n      throw new TypeError('output option must be an array if specified');\n    }\n\n    output = options.output;\n  } else {\n    output = new Array(input.length);\n  }\n\n  var currentMin = min(input);\n  var currentMax = max(input);\n\n  if (currentMin === currentMax) {\n    throw new RangeError('minimum and maximum input values are equal. Cannot rescale a constant array');\n  }\n\n  var _options$min = options.min,\n      minValue = _options$min === void 0 ? options.autoMinMax ? currentMin : 0 : _options$min,\n      _options$max = options.max,\n      maxValue = _options$max === void 0 ? options.autoMinMax ? currentMax : 1 : _options$max;\n\n  if (minValue >= maxValue) {\n    throw new RangeError('min option must be smaller than max option');\n  }\n\n  var factor = (maxValue - minValue) / (currentMax - currentMin);\n\n  for (var i = 0; i < input.length; i++) {\n    output[i] = (input[i] - currentMin) * factor + minValue;\n  }\n\n  return output;\n}\n\nexport { rescale as default };\n","const indent = ' '.repeat(2);\nconst indentData = ' '.repeat(4);\n\nexport function inspectMatrix() {\n  return inspectMatrixWithOptions(this);\n}\n\nexport function inspectMatrixWithOptions(matrix, options = {}) {\n  const { maxRows = 15, maxColumns = 10, maxNumSize = 8 } = options;\n  return `${matrix.constructor.name} {\n${indent}[\n${indentData}${inspectData(matrix, maxRows, maxColumns, maxNumSize)}\n${indent}]\n${indent}rows: ${matrix.rows}\n${indent}columns: ${matrix.columns}\n}`;\n}\n\nfunction inspectData(matrix, maxRows, maxColumns, maxNumSize) {\n  const { rows, columns } = matrix;\n  const maxI = Math.min(rows, maxRows);\n  const maxJ = Math.min(columns, maxColumns);\n  const result = [];\n  for (let i = 0; i < maxI; i++) {\n    let line = [];\n    for (let j = 0; j < maxJ; j++) {\n      line.push(formatNumber(matrix.get(i, j), maxNumSize));\n    }\n    result.push(`${line.join(' ')}`);\n  }\n  if (maxJ !== columns) {\n    result[result.length - 1] += ` ... ${columns - maxColumns} more columns`;\n  }\n  if (maxI !== rows) {\n    result.push(`... ${rows - maxRows} more rows`);\n  }\n  return result.join(`\\n${indentData}`);\n}\n\nfunction formatNumber(num, maxNumSize) {\n  const numStr = String(num);\n  if (numStr.length <= maxNumSize) {\n    return numStr.padEnd(maxNumSize, ' ');\n  }\n  const precise = num.toPrecision(maxNumSize - 2);\n  if (precise.length <= maxNumSize) {\n    return precise;\n  }\n  const exponential = num.toExponential(maxNumSize - 2);\n  const eIndex = exponential.indexOf('e');\n  const e = exponential.slice(eIndex);\n  return exponential.slice(0, maxNumSize - e.length) + e;\n}\n","/**\n * @private\n * Check that a row index is not out of bounds\n * @param {Matrix} matrix\n * @param {number} index\n * @param {boolean} [outer]\n */\nexport function checkRowIndex(matrix, index, outer) {\n  let max = outer ? matrix.rows : matrix.rows - 1;\n  if (index < 0 || index > max) {\n    throw new RangeError('Row index out of range');\n  }\n}\n\n/**\n * @private\n * Check that a column index is not out of bounds\n * @param {Matrix} matrix\n * @param {number} index\n * @param {boolean} [outer]\n */\nexport function checkColumnIndex(matrix, index, outer) {\n  let max = outer ? matrix.columns : matrix.columns - 1;\n  if (index < 0 || index > max) {\n    throw new RangeError('Column index out of range');\n  }\n}\n\n/**\n * @private\n * Check that the provided vector is an array with the right length\n * @param {Matrix} matrix\n * @param {Array|Matrix} vector\n * @return {Array}\n * @throws {RangeError}\n */\nexport function checkRowVector(matrix, vector) {\n  if (vector.to1DArray) {\n    vector = vector.to1DArray();\n  }\n  if (vector.length !== matrix.columns) {\n    throw new RangeError(\n      'vector size must be the same as the number of columns',\n    );\n  }\n  return vector;\n}\n\n/**\n * @private\n * Check that the provided vector is an array with the right length\n * @param {Matrix} matrix\n * @param {Array|Matrix} vector\n * @return {Array}\n * @throws {RangeError}\n */\nexport function checkColumnVector(matrix, vector) {\n  if (vector.to1DArray) {\n    vector = vector.to1DArray();\n  }\n  if (vector.length !== matrix.rows) {\n    throw new RangeError('vector size must be the same as the number of rows');\n  }\n  return vector;\n}\n\nexport function checkIndices(matrix, rowIndices, columnIndices) {\n  return {\n    row: checkRowIndices(matrix, rowIndices),\n    column: checkColumnIndices(matrix, columnIndices),\n  };\n}\n\nexport function checkRowIndices(matrix, rowIndices) {\n  if (typeof rowIndices !== 'object') {\n    throw new TypeError('unexpected type for row indices');\n  }\n\n  let rowOut = rowIndices.some((r) => {\n    return r < 0 || r >= matrix.rows;\n  });\n\n  if (rowOut) {\n    throw new RangeError('row indices are out of range');\n  }\n\n  if (!Array.isArray(rowIndices)) rowIndices = Array.from(rowIndices);\n\n  return rowIndices;\n}\n\nexport function checkColumnIndices(matrix, columnIndices) {\n  if (typeof columnIndices !== 'object') {\n    throw new TypeError('unexpected type for column indices');\n  }\n\n  let columnOut = columnIndices.some((c) => {\n    return c < 0 || c >= matrix.columns;\n  });\n\n  if (columnOut) {\n    throw new RangeError('column indices are out of range');\n  }\n  if (!Array.isArray(columnIndices)) columnIndices = Array.from(columnIndices);\n\n  return columnIndices;\n}\n\nexport function checkRange(matrix, startRow, endRow, startColumn, endColumn) {\n  if (arguments.length !== 5) {\n    throw new RangeError('expected 4 arguments');\n  }\n  checkNumber('startRow', startRow);\n  checkNumber('endRow', endRow);\n  checkNumber('startColumn', startColumn);\n  checkNumber('endColumn', endColumn);\n  if (\n    startRow > endRow ||\n    startColumn > endColumn ||\n    startRow < 0 ||\n    startRow >= matrix.rows ||\n    endRow < 0 ||\n    endRow >= matrix.rows ||\n    startColumn < 0 ||\n    startColumn >= matrix.columns ||\n    endColumn < 0 ||\n    endColumn >= matrix.columns\n  ) {\n    throw new RangeError('Submatrix indices are out of range');\n  }\n}\n\nexport function newArray(length, value = 0) {\n  let array = [];\n  for (let i = 0; i < length; i++) {\n    array.push(value);\n  }\n  return array;\n}\n\nfunction checkNumber(name, value) {\n  if (typeof value !== 'number') {\n    throw new TypeError(`${name} must be a number`);\n  }\n}\n\nexport function checkNonEmpty(matrix) {\n  if (matrix.isEmpty()) {\n    throw new Error('Empty matrix has no elements to index');\n  }\n}\n","import rescale from 'ml-array-rescale';\n\nimport { inspectMatrix, inspectMatrixWithOptions } from './inspect';\nimport { installMathOperations } from './mathOperations';\nimport {\n  sumByRow,\n  sumByColumn,\n  sumAll,\n  productByRow,\n  productByColumn,\n  productAll,\n  varianceByRow,\n  varianceByColumn,\n  varianceAll,\n  centerByRow,\n  centerByColumn,\n  centerAll,\n  scaleByRow,\n  scaleByColumn,\n  scaleAll,\n  getScaleByRow,\n  getScaleByColumn,\n  getScaleAll,\n} from './stat';\nimport {\n  checkRowVector,\n  checkRowIndex,\n  checkColumnIndex,\n  checkColumnVector,\n  checkRange,\n  checkIndices,\n  checkNonEmpty,\n} from './util';\n\nexport class AbstractMatrix {\n  static from1DArray(newRows, newColumns, newData) {\n    let length = newRows * newColumns;\n    if (length !== newData.length) {\n      throw new RangeError('data length does not match given dimensions');\n    }\n    let newMatrix = new Matrix(newRows, newColumns);\n    for (let row = 0; row < newRows; row++) {\n      for (let column = 0; column < newColumns; column++) {\n        newMatrix.set(row, column, newData[row * newColumns + column]);\n      }\n    }\n    return newMatrix;\n  }\n\n  static rowVector(newData) {\n    let vector = new Matrix(1, newData.length);\n    for (let i = 0; i < newData.length; i++) {\n      vector.set(0, i, newData[i]);\n    }\n    return vector;\n  }\n\n  static columnVector(newData) {\n    let vector = new Matrix(newData.length, 1);\n    for (let i = 0; i < newData.length; i++) {\n      vector.set(i, 0, newData[i]);\n    }\n    return vector;\n  }\n\n  static zeros(rows, columns) {\n    return new Matrix(rows, columns);\n  }\n\n  static ones(rows, columns) {\n    return new Matrix(rows, columns).fill(1);\n  }\n\n  static rand(rows, columns, options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { random = Math.random } = options;\n    let matrix = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        matrix.set(i, j, random());\n      }\n    }\n    return matrix;\n  }\n\n  static randInt(rows, columns, options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1000, random = Math.random } = options;\n    if (!Number.isInteger(min)) throw new TypeError('min must be an integer');\n    if (!Number.isInteger(max)) throw new TypeError('max must be an integer');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let interval = max - min;\n    let matrix = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        let value = min + Math.round(random() * interval);\n        matrix.set(i, j, value);\n      }\n    }\n    return matrix;\n  }\n\n  static eye(rows, columns, value) {\n    if (columns === undefined) columns = rows;\n    if (value === undefined) value = 1;\n    let min = Math.min(rows, columns);\n    let matrix = this.zeros(rows, columns);\n    for (let i = 0; i < min; i++) {\n      matrix.set(i, i, value);\n    }\n    return matrix;\n  }\n\n  static diag(data, rows, columns) {\n    let l = data.length;\n    if (rows === undefined) rows = l;\n    if (columns === undefined) columns = rows;\n    let min = Math.min(l, rows, columns);\n    let matrix = this.zeros(rows, columns);\n    for (let i = 0; i < min; i++) {\n      matrix.set(i, i, data[i]);\n    }\n    return matrix;\n  }\n\n  static min(matrix1, matrix2) {\n    matrix1 = this.checkMatrix(matrix1);\n    matrix2 = this.checkMatrix(matrix2);\n    let rows = matrix1.rows;\n    let columns = matrix1.columns;\n    let result = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        result.set(i, j, Math.min(matrix1.get(i, j), matrix2.get(i, j)));\n      }\n    }\n    return result;\n  }\n\n  static max(matrix1, matrix2) {\n    matrix1 = this.checkMatrix(matrix1);\n    matrix2 = this.checkMatrix(matrix2);\n    let rows = matrix1.rows;\n    let columns = matrix1.columns;\n    let result = new this(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        result.set(i, j, Math.max(matrix1.get(i, j), matrix2.get(i, j)));\n      }\n    }\n    return result;\n  }\n\n  static checkMatrix(value) {\n    return AbstractMatrix.isMatrix(value) ? value : new Matrix(value);\n  }\n\n  static isMatrix(value) {\n    return value != null && value.klass === 'Matrix';\n  }\n\n  get size() {\n    return this.rows * this.columns;\n  }\n\n  apply(callback) {\n    if (typeof callback !== 'function') {\n      throw new TypeError('callback must be a function');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        callback.call(this, i, j);\n      }\n    }\n    return this;\n  }\n\n  to1DArray() {\n    let array = [];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        array.push(this.get(i, j));\n      }\n    }\n    return array;\n  }\n\n  to2DArray() {\n    let copy = [];\n    for (let i = 0; i < this.rows; i++) {\n      copy.push([]);\n      for (let j = 0; j < this.columns; j++) {\n        copy[i].push(this.get(i, j));\n      }\n    }\n    return copy;\n  }\n\n  toJSON() {\n    return this.to2DArray();\n  }\n\n  isRowVector() {\n    return this.rows === 1;\n  }\n\n  isColumnVector() {\n    return this.columns === 1;\n  }\n\n  isVector() {\n    return this.rows === 1 || this.columns === 1;\n  }\n\n  isSquare() {\n    return this.rows === this.columns;\n  }\n\n  isEmpty() {\n    return this.rows === 0 || this.columns === 0;\n  }\n\n  isSymmetric() {\n    if (this.isSquare()) {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j <= i; j++) {\n          if (this.get(i, j) !== this.get(j, i)) {\n            return false;\n          }\n        }\n      }\n      return true;\n    }\n    return false;\n  }\n\n  isEchelonForm() {\n    let i = 0;\n    let j = 0;\n    let previousColumn = -1;\n    let isEchelonForm = true;\n    let checked = false;\n    while (i < this.rows && isEchelonForm) {\n      j = 0;\n      checked = false;\n      while (j < this.columns && checked === false) {\n        if (this.get(i, j) === 0) {\n          j++;\n        } else if (this.get(i, j) === 1 && j > previousColumn) {\n          checked = true;\n          previousColumn = j;\n        } else {\n          isEchelonForm = false;\n          checked = true;\n        }\n      }\n      i++;\n    }\n    return isEchelonForm;\n  }\n\n  isReducedEchelonForm() {\n    let i = 0;\n    let j = 0;\n    let previousColumn = -1;\n    let isReducedEchelonForm = true;\n    let checked = false;\n    while (i < this.rows && isReducedEchelonForm) {\n      j = 0;\n      checked = false;\n      while (j < this.columns && checked === false) {\n        if (this.get(i, j) === 0) {\n          j++;\n        } else if (this.get(i, j) === 1 && j > previousColumn) {\n          checked = true;\n          previousColumn = j;\n        } else {\n          isReducedEchelonForm = false;\n          checked = true;\n        }\n      }\n      for (let k = j + 1; k < this.rows; k++) {\n        if (this.get(i, k) !== 0) {\n          isReducedEchelonForm = false;\n        }\n      }\n      i++;\n    }\n    return isReducedEchelonForm;\n  }\n\n  echelonForm() {\n    let result = this.clone();\n    let h = 0;\n    let k = 0;\n    while (h < result.rows && k < result.columns) {\n      let iMax = h;\n      for (let i = h; i < result.rows; i++) {\n        if (result.get(i, k) > result.get(iMax, k)) {\n          iMax = i;\n        }\n      }\n      if (result.get(iMax, k) === 0) {\n        k++;\n      } else {\n        result.swapRows(h, iMax);\n        let tmp = result.get(h, k);\n        for (let j = k; j < result.columns; j++) {\n          result.set(h, j, result.get(h, j) / tmp);\n        }\n        for (let i = h + 1; i < result.rows; i++) {\n          let factor = result.get(i, k) / result.get(h, k);\n          result.set(i, k, 0);\n          for (let j = k + 1; j < result.columns; j++) {\n            result.set(i, j, result.get(i, j) - result.get(h, j) * factor);\n          }\n        }\n        h++;\n        k++;\n      }\n    }\n    return result;\n  }\n\n  reducedEchelonForm() {\n    let result = this.echelonForm();\n    let m = result.columns;\n    let n = result.rows;\n    let h = n - 1;\n    while (h >= 0) {\n      if (result.maxRow(h) === 0) {\n        h--;\n      } else {\n        let p = 0;\n        let pivot = false;\n        while (p < n && pivot === false) {\n          if (result.get(h, p) === 1) {\n            pivot = true;\n          } else {\n            p++;\n          }\n        }\n        for (let i = 0; i < h; i++) {\n          let factor = result.get(i, p);\n          for (let j = p; j < m; j++) {\n            let tmp = result.get(i, j) - factor * result.get(h, j);\n            result.set(i, j, tmp);\n          }\n        }\n        h--;\n      }\n    }\n    return result;\n  }\n\n  set() {\n    throw new Error('set method is unimplemented');\n  }\n\n  get() {\n    throw new Error('get method is unimplemented');\n  }\n\n  repeat(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { rows = 1, columns = 1 } = options;\n    if (!Number.isInteger(rows) || rows <= 0) {\n      throw new TypeError('rows must be a positive integer');\n    }\n    if (!Number.isInteger(columns) || columns <= 0) {\n      throw new TypeError('columns must be a positive integer');\n    }\n    let matrix = new Matrix(this.rows * rows, this.columns * columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        matrix.setSubMatrix(this, this.rows * i, this.columns * j);\n      }\n    }\n    return matrix;\n  }\n\n  fill(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, value);\n      }\n    }\n    return this;\n  }\n\n  neg() {\n    return this.mulS(-1);\n  }\n\n  getRow(index) {\n    checkRowIndex(this, index);\n    let row = [];\n    for (let i = 0; i < this.columns; i++) {\n      row.push(this.get(index, i));\n    }\n    return row;\n  }\n\n  getRowVector(index) {\n    return Matrix.rowVector(this.getRow(index));\n  }\n\n  setRow(index, array) {\n    checkRowIndex(this, index);\n    array = checkRowVector(this, array);\n    for (let i = 0; i < this.columns; i++) {\n      this.set(index, i, array[i]);\n    }\n    return this;\n  }\n\n  swapRows(row1, row2) {\n    checkRowIndex(this, row1);\n    checkRowIndex(this, row2);\n    for (let i = 0; i < this.columns; i++) {\n      let temp = this.get(row1, i);\n      this.set(row1, i, this.get(row2, i));\n      this.set(row2, i, temp);\n    }\n    return this;\n  }\n\n  getColumn(index) {\n    checkColumnIndex(this, index);\n    let column = [];\n    for (let i = 0; i < this.rows; i++) {\n      column.push(this.get(i, index));\n    }\n    return column;\n  }\n\n  getColumnVector(index) {\n    return Matrix.columnVector(this.getColumn(index));\n  }\n\n  setColumn(index, array) {\n    checkColumnIndex(this, index);\n    array = checkColumnVector(this, array);\n    for (let i = 0; i < this.rows; i++) {\n      this.set(i, index, array[i]);\n    }\n    return this;\n  }\n\n  swapColumns(column1, column2) {\n    checkColumnIndex(this, column1);\n    checkColumnIndex(this, column2);\n    for (let i = 0; i < this.rows; i++) {\n      let temp = this.get(i, column1);\n      this.set(i, column1, this.get(i, column2));\n      this.set(i, column2, temp);\n    }\n    return this;\n  }\n\n  addRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + vector[j]);\n      }\n    }\n    return this;\n  }\n\n  subRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - vector[j]);\n      }\n    }\n    return this;\n  }\n\n  mulRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * vector[j]);\n      }\n    }\n    return this;\n  }\n\n  divRowVector(vector) {\n    vector = checkRowVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / vector[j]);\n      }\n    }\n    return this;\n  }\n\n  addColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + vector[i]);\n      }\n    }\n    return this;\n  }\n\n  subColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - vector[i]);\n      }\n    }\n    return this;\n  }\n\n  mulColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * vector[i]);\n      }\n    }\n    return this;\n  }\n\n  divColumnVector(vector) {\n    vector = checkColumnVector(this, vector);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / vector[i]);\n      }\n    }\n    return this;\n  }\n\n  mulRow(index, value) {\n    checkRowIndex(this, index);\n    for (let i = 0; i < this.columns; i++) {\n      this.set(index, i, this.get(index, i) * value);\n    }\n    return this;\n  }\n\n  mulColumn(index, value) {\n    checkColumnIndex(this, index);\n    for (let i = 0; i < this.rows; i++) {\n      this.set(i, index, this.get(i, index) * value);\n    }\n    return this;\n  }\n\n  max() {\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, 0);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) > v) {\n          v = this.get(i, j);\n        }\n      }\n    }\n    return v;\n  }\n\n  maxIndex() {\n    checkNonEmpty(this);\n    let v = this.get(0, 0);\n    let idx = [0, 0];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) > v) {\n          v = this.get(i, j);\n          idx[0] = i;\n          idx[1] = j;\n        }\n      }\n    }\n    return idx;\n  }\n\n  min() {\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, 0);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) < v) {\n          v = this.get(i, j);\n        }\n      }\n    }\n    return v;\n  }\n\n  minIndex() {\n    checkNonEmpty(this);\n    let v = this.get(0, 0);\n    let idx = [0, 0];\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        if (this.get(i, j) < v) {\n          v = this.get(i, j);\n          idx[0] = i;\n          idx[1] = j;\n        }\n      }\n    }\n    return idx;\n  }\n\n  maxRow(row) {\n    checkRowIndex(this, row);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(row, 0);\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) > v) {\n        v = this.get(row, i);\n      }\n    }\n    return v;\n  }\n\n  maxRowIndex(row) {\n    checkRowIndex(this, row);\n    checkNonEmpty(this);\n    let v = this.get(row, 0);\n    let idx = [row, 0];\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) > v) {\n        v = this.get(row, i);\n        idx[1] = i;\n      }\n    }\n    return idx;\n  }\n\n  minRow(row) {\n    checkRowIndex(this, row);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(row, 0);\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) < v) {\n        v = this.get(row, i);\n      }\n    }\n    return v;\n  }\n\n  minRowIndex(row) {\n    checkRowIndex(this, row);\n    checkNonEmpty(this);\n    let v = this.get(row, 0);\n    let idx = [row, 0];\n    for (let i = 1; i < this.columns; i++) {\n      if (this.get(row, i) < v) {\n        v = this.get(row, i);\n        idx[1] = i;\n      }\n    }\n    return idx;\n  }\n\n  maxColumn(column) {\n    checkColumnIndex(this, column);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, column);\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) > v) {\n        v = this.get(i, column);\n      }\n    }\n    return v;\n  }\n\n  maxColumnIndex(column) {\n    checkColumnIndex(this, column);\n    checkNonEmpty(this);\n    let v = this.get(0, column);\n    let idx = [0, column];\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) > v) {\n        v = this.get(i, column);\n        idx[0] = i;\n      }\n    }\n    return idx;\n  }\n\n  minColumn(column) {\n    checkColumnIndex(this, column);\n    if (this.isEmpty()) {\n      return NaN;\n    }\n    let v = this.get(0, column);\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) < v) {\n        v = this.get(i, column);\n      }\n    }\n    return v;\n  }\n\n  minColumnIndex(column) {\n    checkColumnIndex(this, column);\n    checkNonEmpty(this);\n    let v = this.get(0, column);\n    let idx = [0, column];\n    for (let i = 1; i < this.rows; i++) {\n      if (this.get(i, column) < v) {\n        v = this.get(i, column);\n        idx[0] = i;\n      }\n    }\n    return idx;\n  }\n\n  diag() {\n    let min = Math.min(this.rows, this.columns);\n    let diag = [];\n    for (let i = 0; i < min; i++) {\n      diag.push(this.get(i, i));\n    }\n    return diag;\n  }\n\n  norm(type = 'frobenius') {\n    let result = 0;\n    if (type === 'max') {\n      return this.max();\n    } else if (type === 'frobenius') {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j < this.columns; j++) {\n          result = result + this.get(i, j) * this.get(i, j);\n        }\n      }\n      return Math.sqrt(result);\n    } else {\n      throw new RangeError(`unknown norm type: ${type}`);\n    }\n  }\n\n  cumulativeSum() {\n    let sum = 0;\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        sum += this.get(i, j);\n        this.set(i, j, sum);\n      }\n    }\n    return this;\n  }\n\n  dot(vector2) {\n    if (AbstractMatrix.isMatrix(vector2)) vector2 = vector2.to1DArray();\n    let vector1 = this.to1DArray();\n    if (vector1.length !== vector2.length) {\n      throw new RangeError('vectors do not have the same size');\n    }\n    let dot = 0;\n    for (let i = 0; i < vector1.length; i++) {\n      dot += vector1[i] * vector2[i];\n    }\n    return dot;\n  }\n\n  mmul(other) {\n    other = Matrix.checkMatrix(other);\n\n    let m = this.rows;\n    let n = this.columns;\n    let p = other.columns;\n\n    let result = new Matrix(m, p);\n\n    let Bcolj = new Float64Array(n);\n    for (let j = 0; j < p; j++) {\n      for (let k = 0; k < n; k++) {\n        Bcolj[k] = other.get(k, j);\n      }\n\n      for (let i = 0; i < m; i++) {\n        let s = 0;\n        for (let k = 0; k < n; k++) {\n          s += this.get(i, k) * Bcolj[k];\n        }\n\n        result.set(i, j, s);\n      }\n    }\n    return result;\n  }\n\n  strassen2x2(other) {\n    other = Matrix.checkMatrix(other);\n    let result = new Matrix(2, 2);\n    const a11 = this.get(0, 0);\n    const b11 = other.get(0, 0);\n    const a12 = this.get(0, 1);\n    const b12 = other.get(0, 1);\n    const a21 = this.get(1, 0);\n    const b21 = other.get(1, 0);\n    const a22 = this.get(1, 1);\n    const b22 = other.get(1, 1);\n\n    // Compute intermediate values.\n    const m1 = (a11 + a22) * (b11 + b22);\n    const m2 = (a21 + a22) * b11;\n    const m3 = a11 * (b12 - b22);\n    const m4 = a22 * (b21 - b11);\n    const m5 = (a11 + a12) * b22;\n    const m6 = (a21 - a11) * (b11 + b12);\n    const m7 = (a12 - a22) * (b21 + b22);\n\n    // Combine intermediate values into the output.\n    const c00 = m1 + m4 - m5 + m7;\n    const c01 = m3 + m5;\n    const c10 = m2 + m4;\n    const c11 = m1 - m2 + m3 + m6;\n\n    result.set(0, 0, c00);\n    result.set(0, 1, c01);\n    result.set(1, 0, c10);\n    result.set(1, 1, c11);\n    return result;\n  }\n\n  strassen3x3(other) {\n    other = Matrix.checkMatrix(other);\n    let result = new Matrix(3, 3);\n\n    const a00 = this.get(0, 0);\n    const a01 = this.get(0, 1);\n    const a02 = this.get(0, 2);\n    const a10 = this.get(1, 0);\n    const a11 = this.get(1, 1);\n    const a12 = this.get(1, 2);\n    const a20 = this.get(2, 0);\n    const a21 = this.get(2, 1);\n    const a22 = this.get(2, 2);\n\n    const b00 = other.get(0, 0);\n    const b01 = other.get(0, 1);\n    const b02 = other.get(0, 2);\n    const b10 = other.get(1, 0);\n    const b11 = other.get(1, 1);\n    const b12 = other.get(1, 2);\n    const b20 = other.get(2, 0);\n    const b21 = other.get(2, 1);\n    const b22 = other.get(2, 2);\n\n    const m1 = (a00 + a01 + a02 - a10 - a11 - a21 - a22) * b11;\n    const m2 = (a00 - a10) * (-b01 + b11);\n    const m3 = a11 * (-b00 + b01 + b10 - b11 - b12 - b20 + b22);\n    const m4 = (-a00 + a10 + a11) * (b00 - b01 + b11);\n    const m5 = (a10 + a11) * (-b00 + b01);\n    const m6 = a00 * b00;\n    const m7 = (-a00 + a20 + a21) * (b00 - b02 + b12);\n    const m8 = (-a00 + a20) * (b02 - b12);\n    const m9 = (a20 + a21) * (-b00 + b02);\n    const m10 = (a00 + a01 + a02 - a11 - a12 - a20 - a21) * b12;\n    const m11 = a21 * (-b00 + b02 + b10 - b11 - b12 - b20 + b21);\n    const m12 = (-a02 + a21 + a22) * (b11 + b20 - b21);\n    const m13 = (a02 - a22) * (b11 - b21);\n    const m14 = a02 * b20;\n    const m15 = (a21 + a22) * (-b20 + b21);\n    const m16 = (-a02 + a11 + a12) * (b12 + b20 - b22);\n    const m17 = (a02 - a12) * (b12 - b22);\n    const m18 = (a11 + a12) * (-b20 + b22);\n    const m19 = a01 * b10;\n    const m20 = a12 * b21;\n    const m21 = a10 * b02;\n    const m22 = a20 * b01;\n    const m23 = a22 * b22;\n\n    const c00 = m6 + m14 + m19;\n    const c01 = m1 + m4 + m5 + m6 + m12 + m14 + m15;\n    const c02 = m6 + m7 + m9 + m10 + m14 + m16 + m18;\n    const c10 = m2 + m3 + m4 + m6 + m14 + m16 + m17;\n    const c11 = m2 + m4 + m5 + m6 + m20;\n    const c12 = m14 + m16 + m17 + m18 + m21;\n    const c20 = m6 + m7 + m8 + m11 + m12 + m13 + m14;\n    const c21 = m12 + m13 + m14 + m15 + m22;\n    const c22 = m6 + m7 + m8 + m9 + m23;\n\n    result.set(0, 0, c00);\n    result.set(0, 1, c01);\n    result.set(0, 2, c02);\n    result.set(1, 0, c10);\n    result.set(1, 1, c11);\n    result.set(1, 2, c12);\n    result.set(2, 0, c20);\n    result.set(2, 1, c21);\n    result.set(2, 2, c22);\n    return result;\n  }\n\n  mmulStrassen(y) {\n    y = Matrix.checkMatrix(y);\n    let x = this.clone();\n    let r1 = x.rows;\n    let c1 = x.columns;\n    let r2 = y.rows;\n    let c2 = y.columns;\n    if (c1 !== r2) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Multiplying ${r1} x ${c1} and ${r2} x ${c2} matrix: dimensions do not match.`,\n      );\n    }\n\n    // Put a matrix into the top left of a matrix of zeros.\n    // `rows` and `cols` are the dimensions of the output matrix.\n    function embed(mat, rows, cols) {\n      let r = mat.rows;\n      let c = mat.columns;\n      if (r === rows && c === cols) {\n        return mat;\n      } else {\n        let resultat = AbstractMatrix.zeros(rows, cols);\n        resultat = resultat.setSubMatrix(mat, 0, 0);\n        return resultat;\n      }\n    }\n\n    // Make sure both matrices are the same size.\n    // This is exclusively for simplicity:\n    // this algorithm can be implemented with matrices of different sizes.\n\n    let r = Math.max(r1, r2);\n    let c = Math.max(c1, c2);\n    x = embed(x, r, c);\n    y = embed(y, r, c);\n\n    // Our recursive multiplication function.\n    function blockMult(a, b, rows, cols) {\n      // For small matrices, resort to naive multiplication.\n      if (rows <= 512 || cols <= 512) {\n        return a.mmul(b); // a is equivalent to this\n      }\n\n      // Apply dynamic padding.\n      if (rows % 2 === 1 && cols % 2 === 1) {\n        a = embed(a, rows + 1, cols + 1);\n        b = embed(b, rows + 1, cols + 1);\n      } else if (rows % 2 === 1) {\n        a = embed(a, rows + 1, cols);\n        b = embed(b, rows + 1, cols);\n      } else if (cols % 2 === 1) {\n        a = embed(a, rows, cols + 1);\n        b = embed(b, rows, cols + 1);\n      }\n\n      let halfRows = parseInt(a.rows / 2, 10);\n      let halfCols = parseInt(a.columns / 2, 10);\n      // Subdivide input matrices.\n      let a11 = a.subMatrix(0, halfRows - 1, 0, halfCols - 1);\n      let b11 = b.subMatrix(0, halfRows - 1, 0, halfCols - 1);\n\n      let a12 = a.subMatrix(0, halfRows - 1, halfCols, a.columns - 1);\n      let b12 = b.subMatrix(0, halfRows - 1, halfCols, b.columns - 1);\n\n      let a21 = a.subMatrix(halfRows, a.rows - 1, 0, halfCols - 1);\n      let b21 = b.subMatrix(halfRows, b.rows - 1, 0, halfCols - 1);\n\n      let a22 = a.subMatrix(halfRows, a.rows - 1, halfCols, a.columns - 1);\n      let b22 = b.subMatrix(halfRows, b.rows - 1, halfCols, b.columns - 1);\n\n      // Compute intermediate values.\n      let m1 = blockMult(\n        AbstractMatrix.add(a11, a22),\n        AbstractMatrix.add(b11, b22),\n        halfRows,\n        halfCols,\n      );\n      let m2 = blockMult(AbstractMatrix.add(a21, a22), b11, halfRows, halfCols);\n      let m3 = blockMult(a11, AbstractMatrix.sub(b12, b22), halfRows, halfCols);\n      let m4 = blockMult(a22, AbstractMatrix.sub(b21, b11), halfRows, halfCols);\n      let m5 = blockMult(AbstractMatrix.add(a11, a12), b22, halfRows, halfCols);\n      let m6 = blockMult(\n        AbstractMatrix.sub(a21, a11),\n        AbstractMatrix.add(b11, b12),\n        halfRows,\n        halfCols,\n      );\n      let m7 = blockMult(\n        AbstractMatrix.sub(a12, a22),\n        AbstractMatrix.add(b21, b22),\n        halfRows,\n        halfCols,\n      );\n\n      // Combine intermediate values into the output.\n      let c11 = AbstractMatrix.add(m1, m4);\n      c11.sub(m5);\n      c11.add(m7);\n      let c12 = AbstractMatrix.add(m3, m5);\n      let c21 = AbstractMatrix.add(m2, m4);\n      let c22 = AbstractMatrix.sub(m1, m2);\n      c22.add(m3);\n      c22.add(m6);\n\n      // Crop output to the desired size (undo dynamic padding).\n      let resultat = AbstractMatrix.zeros(2 * c11.rows, 2 * c11.columns);\n      resultat = resultat.setSubMatrix(c11, 0, 0);\n      resultat = resultat.setSubMatrix(c12, c11.rows, 0);\n      resultat = resultat.setSubMatrix(c21, 0, c11.columns);\n      resultat = resultat.setSubMatrix(c22, c11.rows, c11.columns);\n      return resultat.subMatrix(0, rows - 1, 0, cols - 1);\n    }\n\n    return blockMult(x, y, r, c);\n  }\n\n  scaleRows(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1 } = options;\n    if (!Number.isFinite(min)) throw new TypeError('min must be a number');\n    if (!Number.isFinite(max)) throw new TypeError('max must be a number');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let newMatrix = new Matrix(this.rows, this.columns);\n    for (let i = 0; i < this.rows; i++) {\n      const row = this.getRow(i);\n      if (row.length > 0) {\n        rescale(row, { min, max, output: row });\n      }\n      newMatrix.setRow(i, row);\n    }\n    return newMatrix;\n  }\n\n  scaleColumns(options = {}) {\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { min = 0, max = 1 } = options;\n    if (!Number.isFinite(min)) throw new TypeError('min must be a number');\n    if (!Number.isFinite(max)) throw new TypeError('max must be a number');\n    if (min >= max) throw new RangeError('min must be smaller than max');\n    let newMatrix = new Matrix(this.rows, this.columns);\n    for (let i = 0; i < this.columns; i++) {\n      const column = this.getColumn(i);\n      if (column.length) {\n        rescale(column, {\n          min: min,\n          max: max,\n          output: column,\n        });\n      }\n      newMatrix.setColumn(i, column);\n    }\n    return newMatrix;\n  }\n\n  flipRows() {\n    const middle = Math.ceil(this.columns / 2);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < middle; j++) {\n        let first = this.get(i, j);\n        let last = this.get(i, this.columns - 1 - j);\n        this.set(i, j, last);\n        this.set(i, this.columns - 1 - j, first);\n      }\n    }\n    return this;\n  }\n\n  flipColumns() {\n    const middle = Math.ceil(this.rows / 2);\n    for (let j = 0; j < this.columns; j++) {\n      for (let i = 0; i < middle; i++) {\n        let first = this.get(i, j);\n        let last = this.get(this.rows - 1 - i, j);\n        this.set(i, j, last);\n        this.set(this.rows - 1 - i, j, first);\n      }\n    }\n    return this;\n  }\n\n  kroneckerProduct(other) {\n    other = Matrix.checkMatrix(other);\n\n    let m = this.rows;\n    let n = this.columns;\n    let p = other.rows;\n    let q = other.columns;\n\n    let result = new Matrix(m * p, n * q);\n    for (let i = 0; i < m; i++) {\n      for (let j = 0; j < n; j++) {\n        for (let k = 0; k < p; k++) {\n          for (let l = 0; l < q; l++) {\n            result.set(p * i + k, q * j + l, this.get(i, j) * other.get(k, l));\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  kroneckerSum(other) {\n    other = Matrix.checkMatrix(other);\n    if (!this.isSquare() || !other.isSquare()) {\n      throw new Error('Kronecker Sum needs two Square Matrices');\n    }\n    let m = this.rows;\n    let n = other.rows;\n    let AxI = this.kroneckerProduct(Matrix.eye(n, n));\n    let IxB = Matrix.eye(m, m).kroneckerProduct(other);\n    return AxI.add(IxB);\n  }\n\n  transpose() {\n    let result = new Matrix(this.columns, this.rows);\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        result.set(j, i, this.get(i, j));\n      }\n    }\n    return result;\n  }\n\n  sortRows(compareFunction = compareNumbers) {\n    for (let i = 0; i < this.rows; i++) {\n      this.setRow(i, this.getRow(i).sort(compareFunction));\n    }\n    return this;\n  }\n\n  sortColumns(compareFunction = compareNumbers) {\n    for (let i = 0; i < this.columns; i++) {\n      this.setColumn(i, this.getColumn(i).sort(compareFunction));\n    }\n    return this;\n  }\n\n  subMatrix(startRow, endRow, startColumn, endColumn) {\n    checkRange(this, startRow, endRow, startColumn, endColumn);\n    let newMatrix = new Matrix(\n      endRow - startRow + 1,\n      endColumn - startColumn + 1,\n    );\n    for (let i = startRow; i <= endRow; i++) {\n      for (let j = startColumn; j <= endColumn; j++) {\n        newMatrix.set(i - startRow, j - startColumn, this.get(i, j));\n      }\n    }\n    return newMatrix;\n  }\n\n  subMatrixRow(indices, startColumn, endColumn) {\n    if (startColumn === undefined) startColumn = 0;\n    if (endColumn === undefined) endColumn = this.columns - 1;\n    if (\n      startColumn > endColumn ||\n      startColumn < 0 ||\n      startColumn >= this.columns ||\n      endColumn < 0 ||\n      endColumn >= this.columns\n    ) {\n      throw new RangeError('Argument out of range');\n    }\n\n    let newMatrix = new Matrix(indices.length, endColumn - startColumn + 1);\n    for (let i = 0; i < indices.length; i++) {\n      for (let j = startColumn; j <= endColumn; j++) {\n        if (indices[i] < 0 || indices[i] >= this.rows) {\n          throw new RangeError(`Row index out of range: ${indices[i]}`);\n        }\n        newMatrix.set(i, j - startColumn, this.get(indices[i], j));\n      }\n    }\n    return newMatrix;\n  }\n\n  subMatrixColumn(indices, startRow, endRow) {\n    if (startRow === undefined) startRow = 0;\n    if (endRow === undefined) endRow = this.rows - 1;\n    if (\n      startRow > endRow ||\n      startRow < 0 ||\n      startRow >= this.rows ||\n      endRow < 0 ||\n      endRow >= this.rows\n    ) {\n      throw new RangeError('Argument out of range');\n    }\n\n    let newMatrix = new Matrix(endRow - startRow + 1, indices.length);\n    for (let i = 0; i < indices.length; i++) {\n      for (let j = startRow; j <= endRow; j++) {\n        if (indices[i] < 0 || indices[i] >= this.columns) {\n          throw new RangeError(`Column index out of range: ${indices[i]}`);\n        }\n        newMatrix.set(j - startRow, i, this.get(j, indices[i]));\n      }\n    }\n    return newMatrix;\n  }\n\n  setSubMatrix(matrix, startRow, startColumn) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (matrix.isEmpty()) {\n      return this;\n    }\n    let endRow = startRow + matrix.rows - 1;\n    let endColumn = startColumn + matrix.columns - 1;\n    checkRange(this, startRow, endRow, startColumn, endColumn);\n    for (let i = 0; i < matrix.rows; i++) {\n      for (let j = 0; j < matrix.columns; j++) {\n        this.set(startRow + i, startColumn + j, matrix.get(i, j));\n      }\n    }\n    return this;\n  }\n\n  selection(rowIndices, columnIndices) {\n    let indices = checkIndices(this, rowIndices, columnIndices);\n    let newMatrix = new Matrix(rowIndices.length, columnIndices.length);\n    for (let i = 0; i < indices.row.length; i++) {\n      let rowIndex = indices.row[i];\n      for (let j = 0; j < indices.column.length; j++) {\n        let columnIndex = indices.column[j];\n        newMatrix.set(i, j, this.get(rowIndex, columnIndex));\n      }\n    }\n    return newMatrix;\n  }\n\n  trace() {\n    let min = Math.min(this.rows, this.columns);\n    let trace = 0;\n    for (let i = 0; i < min; i++) {\n      trace += this.get(i, i);\n    }\n    return trace;\n  }\n\n  clone() {\n    let newMatrix = new Matrix(this.rows, this.columns);\n    for (let row = 0; row < this.rows; row++) {\n      for (let column = 0; column < this.columns; column++) {\n        newMatrix.set(row, column, this.get(row, column));\n      }\n    }\n    return newMatrix;\n  }\n\n  sum(by) {\n    switch (by) {\n      case 'row':\n        return sumByRow(this);\n      case 'column':\n        return sumByColumn(this);\n      case undefined:\n        return sumAll(this);\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  product(by) {\n    switch (by) {\n      case 'row':\n        return productByRow(this);\n      case 'column':\n        return productByColumn(this);\n      case undefined:\n        return productAll(this);\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  mean(by) {\n    const sum = this.sum(by);\n    switch (by) {\n      case 'row': {\n        for (let i = 0; i < this.rows; i++) {\n          sum[i] /= this.columns;\n        }\n        return sum;\n      }\n      case 'column': {\n        for (let i = 0; i < this.columns; i++) {\n          sum[i] /= this.rows;\n        }\n        return sum;\n      }\n      case undefined:\n        return sum / this.size;\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  variance(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { unbiased = true, mean = this.mean(by) } = options;\n    if (typeof unbiased !== 'boolean') {\n      throw new TypeError('unbiased must be a boolean');\n    }\n    switch (by) {\n      case 'row': {\n        if (!Array.isArray(mean)) {\n          throw new TypeError('mean must be an array');\n        }\n        return varianceByRow(this, unbiased, mean);\n      }\n      case 'column': {\n        if (!Array.isArray(mean)) {\n          throw new TypeError('mean must be an array');\n        }\n        return varianceByColumn(this, unbiased, mean);\n      }\n      case undefined: {\n        if (typeof mean !== 'number') {\n          throw new TypeError('mean must be a number');\n        }\n        return varianceAll(this, unbiased, mean);\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  standardDeviation(by, options) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    const variance = this.variance(by, options);\n    if (by === undefined) {\n      return Math.sqrt(variance);\n    } else {\n      for (let i = 0; i < variance.length; i++) {\n        variance[i] = Math.sqrt(variance[i]);\n      }\n      return variance;\n    }\n  }\n\n  center(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    const { center = this.mean(by) } = options;\n    switch (by) {\n      case 'row': {\n        if (!Array.isArray(center)) {\n          throw new TypeError('center must be an array');\n        }\n        centerByRow(this, center);\n        return this;\n      }\n      case 'column': {\n        if (!Array.isArray(center)) {\n          throw new TypeError('center must be an array');\n        }\n        centerByColumn(this, center);\n        return this;\n      }\n      case undefined: {\n        if (typeof center !== 'number') {\n          throw new TypeError('center must be a number');\n        }\n        centerAll(this, center);\n        return this;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  scale(by, options = {}) {\n    if (typeof by === 'object') {\n      options = by;\n      by = undefined;\n    }\n    if (typeof options !== 'object') {\n      throw new TypeError('options must be an object');\n    }\n    let scale = options.scale;\n    switch (by) {\n      case 'row': {\n        if (scale === undefined) {\n          scale = getScaleByRow(this);\n        } else if (!Array.isArray(scale)) {\n          throw new TypeError('scale must be an array');\n        }\n        scaleByRow(this, scale);\n        return this;\n      }\n      case 'column': {\n        if (scale === undefined) {\n          scale = getScaleByColumn(this);\n        } else if (!Array.isArray(scale)) {\n          throw new TypeError('scale must be an array');\n        }\n        scaleByColumn(this, scale);\n        return this;\n      }\n      case undefined: {\n        if (scale === undefined) {\n          scale = getScaleAll(this);\n        } else if (typeof scale !== 'number') {\n          throw new TypeError('scale must be a number');\n        }\n        scaleAll(this, scale);\n        return this;\n      }\n      default:\n        throw new Error(`invalid option: ${by}`);\n    }\n  }\n\n  toString(options) {\n    return inspectMatrixWithOptions(this, options);\n  }\n}\n\nAbstractMatrix.prototype.klass = 'Matrix';\nif (typeof Symbol !== 'undefined') {\n  AbstractMatrix.prototype[Symbol.for('nodejs.util.inspect.custom')] =\n    inspectMatrix;\n}\n\nfunction compareNumbers(a, b) {\n  return a - b;\n}\n\n// Synonyms\nAbstractMatrix.random = AbstractMatrix.rand;\nAbstractMatrix.randomInt = AbstractMatrix.randInt;\nAbstractMatrix.diagonal = AbstractMatrix.diag;\nAbstractMatrix.prototype.diagonal = AbstractMatrix.prototype.diag;\nAbstractMatrix.identity = AbstractMatrix.eye;\nAbstractMatrix.prototype.negate = AbstractMatrix.prototype.neg;\nAbstractMatrix.prototype.tensorProduct =\n  AbstractMatrix.prototype.kroneckerProduct;\n\nexport default class Matrix extends AbstractMatrix {\n  constructor(nRows, nColumns) {\n    super();\n    if (Matrix.isMatrix(nRows)) {\n      // eslint-disable-next-line no-constructor-return\n      return nRows.clone();\n    } else if (Number.isInteger(nRows) && nRows >= 0) {\n      // Create an empty matrix\n      this.data = [];\n      if (Number.isInteger(nColumns) && nColumns >= 0) {\n        for (let i = 0; i < nRows; i++) {\n          this.data.push(new Float64Array(nColumns));\n        }\n      } else {\n        throw new TypeError('nColumns must be a positive integer');\n      }\n    } else if (Array.isArray(nRows)) {\n      // Copy the values from the 2D array\n      const arrayData = nRows;\n      nRows = arrayData.length;\n      nColumns = nRows ? arrayData[0].length : 0;\n      if (typeof nColumns !== 'number') {\n        throw new TypeError(\n          'Data must be a 2D array with at least one element',\n        );\n      }\n      this.data = [];\n      for (let i = 0; i < nRows; i++) {\n        if (arrayData[i].length !== nColumns) {\n          throw new RangeError('Inconsistent array dimensions');\n        }\n        this.data.push(Float64Array.from(arrayData[i]));\n      }\n    } else {\n      throw new TypeError(\n        'First argument must be a positive number or an array',\n      );\n    }\n    this.rows = nRows;\n    this.columns = nColumns;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.data[rowIndex][columnIndex] = value;\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.data[rowIndex][columnIndex];\n  }\n\n  removeRow(index) {\n    checkRowIndex(this, index);\n    this.data.splice(index, 1);\n    this.rows -= 1;\n    return this;\n  }\n\n  addRow(index, array) {\n    if (array === undefined) {\n      array = index;\n      index = this.rows;\n    }\n    checkRowIndex(this, index, true);\n    array = Float64Array.from(checkRowVector(this, array));\n    this.data.splice(index, 0, array);\n    this.rows += 1;\n    return this;\n  }\n\n  removeColumn(index) {\n    checkColumnIndex(this, index);\n    for (let i = 0; i < this.rows; i++) {\n      const newRow = new Float64Array(this.columns - 1);\n      for (let j = 0; j < index; j++) {\n        newRow[j] = this.data[i][j];\n      }\n      for (let j = index + 1; j < this.columns; j++) {\n        newRow[j - 1] = this.data[i][j];\n      }\n      this.data[i] = newRow;\n    }\n    this.columns -= 1;\n    return this;\n  }\n\n  addColumn(index, array) {\n    if (typeof array === 'undefined') {\n      array = index;\n      index = this.columns;\n    }\n    checkColumnIndex(this, index, true);\n    array = checkColumnVector(this, array);\n    for (let i = 0; i < this.rows; i++) {\n      const newRow = new Float64Array(this.columns + 1);\n      let j = 0;\n      for (; j < index; j++) {\n        newRow[j] = this.data[i][j];\n      }\n      newRow[j++] = array[i];\n      for (; j < this.columns + 1; j++) {\n        newRow[j] = this.data[i][j - 1];\n      }\n      this.data[i] = newRow;\n    }\n    this.columns += 1;\n    return this;\n  }\n}\n\ninstallMathOperations(AbstractMatrix, Matrix);\n","import { newArray } from './util';\n\nexport function sumByRow(matrix) {\n  let sum = newArray(matrix.rows);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[i] += matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nexport function sumByColumn(matrix) {\n  let sum = newArray(matrix.columns);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[j] += matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nexport function sumAll(matrix) {\n  let v = 0;\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      v += matrix.get(i, j);\n    }\n  }\n  return v;\n}\n\nexport function productByRow(matrix) {\n  let sum = newArray(matrix.rows, 1);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[i] *= matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nexport function productByColumn(matrix) {\n  let sum = newArray(matrix.columns, 1);\n  for (let i = 0; i < matrix.rows; ++i) {\n    for (let j = 0; j < matrix.columns; ++j) {\n      sum[j] *= matrix.get(i, j);\n    }\n  }\n  return sum;\n}\n\nexport function productAll(matrix) {\n  let v = 1;\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      v *= matrix.get(i, j);\n    }\n  }\n  return v;\n}\n\nexport function varianceByRow(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const variance = [];\n\n  for (let i = 0; i < rows; i++) {\n    let sum1 = 0;\n    let sum2 = 0;\n    let x = 0;\n    for (let j = 0; j < cols; j++) {\n      x = matrix.get(i, j) - mean[i];\n      sum1 += x;\n      sum2 += x * x;\n    }\n    if (unbiased) {\n      variance.push((sum2 - (sum1 * sum1) / cols) / (cols - 1));\n    } else {\n      variance.push((sum2 - (sum1 * sum1) / cols) / cols);\n    }\n  }\n  return variance;\n}\n\nexport function varianceByColumn(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const variance = [];\n\n  for (let j = 0; j < cols; j++) {\n    let sum1 = 0;\n    let sum2 = 0;\n    let x = 0;\n    for (let i = 0; i < rows; i++) {\n      x = matrix.get(i, j) - mean[j];\n      sum1 += x;\n      sum2 += x * x;\n    }\n    if (unbiased) {\n      variance.push((sum2 - (sum1 * sum1) / rows) / (rows - 1));\n    } else {\n      variance.push((sum2 - (sum1 * sum1) / rows) / rows);\n    }\n  }\n  return variance;\n}\n\nexport function varianceAll(matrix, unbiased, mean) {\n  const rows = matrix.rows;\n  const cols = matrix.columns;\n  const size = rows * cols;\n\n  let sum1 = 0;\n  let sum2 = 0;\n  let x = 0;\n  for (let i = 0; i < rows; i++) {\n    for (let j = 0; j < cols; j++) {\n      x = matrix.get(i, j) - mean;\n      sum1 += x;\n      sum2 += x * x;\n    }\n  }\n  if (unbiased) {\n    return (sum2 - (sum1 * sum1) / size) / (size - 1);\n  } else {\n    return (sum2 - (sum1 * sum1) / size) / size;\n  }\n}\n\nexport function centerByRow(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean[i]);\n    }\n  }\n}\n\nexport function centerByColumn(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean[j]);\n    }\n  }\n}\n\nexport function centerAll(matrix, mean) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) - mean);\n    }\n  }\n}\n\nexport function getScaleByRow(matrix) {\n  const scale = [];\n  for (let i = 0; i < matrix.rows; i++) {\n    let sum = 0;\n    for (let j = 0; j < matrix.columns; j++) {\n      sum += Math.pow(matrix.get(i, j), 2) / (matrix.columns - 1);\n    }\n    scale.push(Math.sqrt(sum));\n  }\n  return scale;\n}\n\nexport function scaleByRow(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale[i]);\n    }\n  }\n}\n\nexport function getScaleByColumn(matrix) {\n  const scale = [];\n  for (let j = 0; j < matrix.columns; j++) {\n    let sum = 0;\n    for (let i = 0; i < matrix.rows; i++) {\n      sum += Math.pow(matrix.get(i, j), 2) / (matrix.rows - 1);\n    }\n    scale.push(Math.sqrt(sum));\n  }\n  return scale;\n}\n\nexport function scaleByColumn(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale[j]);\n    }\n  }\n}\n\nexport function getScaleAll(matrix) {\n  const divider = matrix.size - 1;\n  let sum = 0;\n  for (let j = 0; j < matrix.columns; j++) {\n    for (let i = 0; i < matrix.rows; i++) {\n      sum += Math.pow(matrix.get(i, j), 2) / divider;\n    }\n  }\n  return Math.sqrt(sum);\n}\n\nexport function scaleAll(matrix, scale) {\n  for (let i = 0; i < matrix.rows; i++) {\n    for (let j = 0; j < matrix.columns; j++) {\n      matrix.set(i, j, matrix.get(i, j) / scale);\n    }\n  }\n}\n","export function installMathOperations(AbstractMatrix, Matrix) {\n  AbstractMatrix.prototype.add = function add(value) {\n    if (typeof value === 'number') return this.addS(value);\n    return this.addM(value);\n  };\n\n  AbstractMatrix.prototype.addS = function addS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.addM = function addM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) + matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.add = function add(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.add(value);\n  };\n\n  AbstractMatrix.prototype.sub = function sub(value) {\n    if (typeof value === 'number') return this.subS(value);\n    return this.subM(value);\n  };\n\n  AbstractMatrix.prototype.subS = function subS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.subM = function subM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) - matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sub = function sub(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sub(value);\n  };\n  AbstractMatrix.prototype.subtract = AbstractMatrix.prototype.sub;\n  AbstractMatrix.prototype.subtractS = AbstractMatrix.prototype.subS;\n  AbstractMatrix.prototype.subtractM = AbstractMatrix.prototype.subM;\n  AbstractMatrix.subtract = AbstractMatrix.sub;\n\n  AbstractMatrix.prototype.mul = function mul(value) {\n    if (typeof value === 'number') return this.mulS(value);\n    return this.mulM(value);\n  };\n\n  AbstractMatrix.prototype.mulS = function mulS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.mulM = function mulM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) * matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.mul = function mul(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.mul(value);\n  };\n  AbstractMatrix.prototype.multiply = AbstractMatrix.prototype.mul;\n  AbstractMatrix.prototype.multiplyS = AbstractMatrix.prototype.mulS;\n  AbstractMatrix.prototype.multiplyM = AbstractMatrix.prototype.mulM;\n  AbstractMatrix.multiply = AbstractMatrix.mul;\n\n  AbstractMatrix.prototype.div = function div(value) {\n    if (typeof value === 'number') return this.divS(value);\n    return this.divM(value);\n  };\n\n  AbstractMatrix.prototype.divS = function divS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.divM = function divM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) / matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.div = function div(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.div(value);\n  };\n  AbstractMatrix.prototype.divide = AbstractMatrix.prototype.div;\n  AbstractMatrix.prototype.divideS = AbstractMatrix.prototype.divS;\n  AbstractMatrix.prototype.divideM = AbstractMatrix.prototype.divM;\n  AbstractMatrix.divide = AbstractMatrix.div;\n\n  AbstractMatrix.prototype.mod = function mod(value) {\n    if (typeof value === 'number') return this.modS(value);\n    return this.modM(value);\n  };\n\n  AbstractMatrix.prototype.modS = function modS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) % value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.modM = function modM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) % matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.mod = function mod(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.mod(value);\n  };\n  AbstractMatrix.prototype.modulus = AbstractMatrix.prototype.mod;\n  AbstractMatrix.prototype.modulusS = AbstractMatrix.prototype.modS;\n  AbstractMatrix.prototype.modulusM = AbstractMatrix.prototype.modM;\n  AbstractMatrix.modulus = AbstractMatrix.mod;\n\n  AbstractMatrix.prototype.and = function and(value) {\n    if (typeof value === 'number') return this.andS(value);\n    return this.andM(value);\n  };\n\n  AbstractMatrix.prototype.andS = function andS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) & value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.andM = function andM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) & matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.and = function and(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.and(value);\n  };\n\n  AbstractMatrix.prototype.or = function or(value) {\n    if (typeof value === 'number') return this.orS(value);\n    return this.orM(value);\n  };\n\n  AbstractMatrix.prototype.orS = function orS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) | value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.orM = function orM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) | matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.or = function or(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.or(value);\n  };\n\n  AbstractMatrix.prototype.xor = function xor(value) {\n    if (typeof value === 'number') return this.xorS(value);\n    return this.xorM(value);\n  };\n\n  AbstractMatrix.prototype.xorS = function xorS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ^ value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.xorM = function xorM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) ^ matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.xor = function xor(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.xor(value);\n  };\n\n  AbstractMatrix.prototype.leftShift = function leftShift(value) {\n    if (typeof value === 'number') return this.leftShiftS(value);\n    return this.leftShiftM(value);\n  };\n\n  AbstractMatrix.prototype.leftShiftS = function leftShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) << value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.leftShiftM = function leftShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) << matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.leftShift = function leftShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.leftShift(value);\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShift = function signPropagatingRightShift(value) {\n    if (typeof value === 'number') return this.signPropagatingRightShiftS(value);\n    return this.signPropagatingRightShiftM(value);\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShiftS = function signPropagatingRightShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >> value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.signPropagatingRightShiftM = function signPropagatingRightShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >> matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.signPropagatingRightShift = function signPropagatingRightShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.signPropagatingRightShift(value);\n  };\n\n  AbstractMatrix.prototype.rightShift = function rightShift(value) {\n    if (typeof value === 'number') return this.rightShiftS(value);\n    return this.rightShiftM(value);\n  };\n\n  AbstractMatrix.prototype.rightShiftS = function rightShiftS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >>> value);\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.rightShiftM = function rightShiftM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, this.get(i, j) >>> matrix.get(i, j));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.rightShift = function rightShift(matrix, value) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.rightShift(value);\n  };\n  AbstractMatrix.prototype.zeroFillRightShift = AbstractMatrix.prototype.rightShift;\n  AbstractMatrix.prototype.zeroFillRightShiftS = AbstractMatrix.prototype.rightShiftS;\n  AbstractMatrix.prototype.zeroFillRightShiftM = AbstractMatrix.prototype.rightShiftM;\n  AbstractMatrix.zeroFillRightShift = AbstractMatrix.rightShift;\n\n  AbstractMatrix.prototype.not = function not() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, ~(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.not = function not(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.not();\n  };\n\n  AbstractMatrix.prototype.abs = function abs() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.abs(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.abs = function abs(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.abs();\n  };\n\n  AbstractMatrix.prototype.acos = function acos() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.acos(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.acos = function acos(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.acos();\n  };\n\n  AbstractMatrix.prototype.acosh = function acosh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.acosh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.acosh = function acosh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.acosh();\n  };\n\n  AbstractMatrix.prototype.asin = function asin() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.asin(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.asin = function asin(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.asin();\n  };\n\n  AbstractMatrix.prototype.asinh = function asinh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.asinh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.asinh = function asinh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.asinh();\n  };\n\n  AbstractMatrix.prototype.atan = function atan() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.atan(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.atan = function atan(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.atan();\n  };\n\n  AbstractMatrix.prototype.atanh = function atanh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.atanh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.atanh = function atanh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.atanh();\n  };\n\n  AbstractMatrix.prototype.cbrt = function cbrt() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cbrt(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cbrt = function cbrt(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cbrt();\n  };\n\n  AbstractMatrix.prototype.ceil = function ceil() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.ceil(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.ceil = function ceil(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.ceil();\n  };\n\n  AbstractMatrix.prototype.clz32 = function clz32() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.clz32(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.clz32 = function clz32(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.clz32();\n  };\n\n  AbstractMatrix.prototype.cos = function cos() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cos(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cos = function cos(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cos();\n  };\n\n  AbstractMatrix.prototype.cosh = function cosh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.cosh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.cosh = function cosh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.cosh();\n  };\n\n  AbstractMatrix.prototype.exp = function exp() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.exp(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.exp = function exp(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.exp();\n  };\n\n  AbstractMatrix.prototype.expm1 = function expm1() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.expm1(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.expm1 = function expm1(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.expm1();\n  };\n\n  AbstractMatrix.prototype.floor = function floor() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.floor(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.floor = function floor(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.floor();\n  };\n\n  AbstractMatrix.prototype.fround = function fround() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.fround(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.fround = function fround(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.fround();\n  };\n\n  AbstractMatrix.prototype.log = function log() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log = function log(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log();\n  };\n\n  AbstractMatrix.prototype.log1p = function log1p() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log1p(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log1p = function log1p(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log1p();\n  };\n\n  AbstractMatrix.prototype.log10 = function log10() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log10(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log10 = function log10(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log10();\n  };\n\n  AbstractMatrix.prototype.log2 = function log2() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.log2(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.log2 = function log2(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.log2();\n  };\n\n  AbstractMatrix.prototype.round = function round() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.round(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.round = function round(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.round();\n  };\n\n  AbstractMatrix.prototype.sign = function sign() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sign(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sign = function sign(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sign();\n  };\n\n  AbstractMatrix.prototype.sin = function sin() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sin(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sin = function sin(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sin();\n  };\n\n  AbstractMatrix.prototype.sinh = function sinh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sinh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sinh = function sinh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sinh();\n  };\n\n  AbstractMatrix.prototype.sqrt = function sqrt() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.sqrt(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.sqrt = function sqrt(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.sqrt();\n  };\n\n  AbstractMatrix.prototype.tan = function tan() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.tan(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.tan = function tan(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.tan();\n  };\n\n  AbstractMatrix.prototype.tanh = function tanh() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.tanh(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.tanh = function tanh(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.tanh();\n  };\n\n  AbstractMatrix.prototype.trunc = function trunc() {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.trunc(this.get(i, j)));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.trunc = function trunc(matrix) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.trunc();\n  };\n\n  AbstractMatrix.pow = function pow(matrix, arg0) {\n    const newMatrix = new Matrix(matrix);\n    return newMatrix.pow(arg0);\n  };\n\n  AbstractMatrix.prototype.pow = function pow(value) {\n    if (typeof value === 'number') return this.powS(value);\n    return this.powM(value);\n  };\n\n  AbstractMatrix.prototype.powS = function powS(value) {\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.pow(this.get(i, j), value));\n      }\n    }\n    return this;\n  };\n\n  AbstractMatrix.prototype.powM = function powM(matrix) {\n    matrix = Matrix.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n      this.columns !== matrix.columns) {\n      throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.columns; j++) {\n        this.set(i, j, Math.pow(this.get(i, j), matrix.get(i, j)));\n      }\n    }\n    return this;\n  };\n}\n","import { AbstractMatrix } from '../matrix';\n\nexport default class BaseView extends AbstractMatrix {\n  constructor(matrix, rows, columns) {\n    super();\n    this.matrix = matrix;\n    this.rows = rows;\n    this.columns = columns;\n  }\n}\n","import BaseView from './base';\n\nexport default class MatrixTransposeView extends BaseView {\n  constructor(matrix) {\n    super(matrix, matrix.columns, matrix.rows);\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.matrix.set(columnIndex, rowIndex, value);\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.matrix.get(columnIndex, rowIndex);\n  }\n}\n","import { AbstractMatrix } from '../matrix';\n\nexport default class WrapperMatrix2D extends AbstractMatrix {\n  constructor(data) {\n    super();\n    this.data = data;\n    this.rows = data.length;\n    this.columns = data[0].length;\n  }\n\n  set(rowIndex, columnIndex, value) {\n    this.data[rowIndex][columnIndex] = value;\n    return this;\n  }\n\n  get(rowIndex, columnIndex) {\n    return this.data[rowIndex][columnIndex];\n  }\n}\n","import Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\n\nexport default class LuDecomposition {\n  constructor(matrix) {\n    matrix = WrapperMatrix2D.checkMatrix(matrix);\n\n    let lu = matrix.clone();\n    let rows = lu.rows;\n    let columns = lu.columns;\n    let pivotVector = new Float64Array(rows);\n    let pivotSign = 1;\n    let i, j, k, p, s, t, v;\n    let LUcolj, kmax;\n\n    for (i = 0; i < rows; i++) {\n      pivotVector[i] = i;\n    }\n\n    LUcolj = new Float64Array(rows);\n\n    for (j = 0; j < columns; j++) {\n      for (i = 0; i < rows; i++) {\n        LUcolj[i] = lu.get(i, j);\n      }\n\n      for (i = 0; i < rows; i++) {\n        kmax = Math.min(i, j);\n        s = 0;\n        for (k = 0; k < kmax; k++) {\n          s += lu.get(i, k) * LUcolj[k];\n        }\n        LUcolj[i] -= s;\n        lu.set(i, j, LUcolj[i]);\n      }\n\n      p = j;\n      for (i = j + 1; i < rows; i++) {\n        if (Math.abs(LUcolj[i]) > Math.abs(LUcolj[p])) {\n          p = i;\n        }\n      }\n\n      if (p !== j) {\n        for (k = 0; k < columns; k++) {\n          t = lu.get(p, k);\n          lu.set(p, k, lu.get(j, k));\n          lu.set(j, k, t);\n        }\n\n        v = pivotVector[p];\n        pivotVector[p] = pivotVector[j];\n        pivotVector[j] = v;\n\n        pivotSign = -pivotSign;\n      }\n\n      if (j < rows && lu.get(j, j) !== 0) {\n        for (i = j + 1; i < rows; i++) {\n          lu.set(i, j, lu.get(i, j) / lu.get(j, j));\n        }\n      }\n    }\n\n    this.LU = lu;\n    this.pivotVector = pivotVector;\n    this.pivotSign = pivotSign;\n  }\n\n  isSingular() {\n    let data = this.LU;\n    let col = data.columns;\n    for (let j = 0; j < col; j++) {\n      if (data.get(j, j) === 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  solve(value) {\n    value = Matrix.checkMatrix(value);\n\n    let lu = this.LU;\n    let rows = lu.rows;\n\n    if (rows !== value.rows) {\n      throw new Error('Invalid matrix dimensions');\n    }\n    if (this.isSingular()) {\n      throw new Error('LU matrix is singular');\n    }\n\n    let count = value.columns;\n    let X = value.subMatrixRow(this.pivotVector, 0, count - 1);\n    let columns = lu.columns;\n    let i, j, k;\n\n    for (k = 0; k < columns; k++) {\n      for (i = k + 1; i < columns; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * lu.get(i, k));\n        }\n      }\n    }\n    for (k = columns - 1; k >= 0; k--) {\n      for (j = 0; j < count; j++) {\n        X.set(k, j, X.get(k, j) / lu.get(k, k));\n      }\n      for (i = 0; i < k; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * lu.get(i, k));\n        }\n      }\n    }\n    return X;\n  }\n\n  get determinant() {\n    let data = this.LU;\n    if (!data.isSquare()) {\n      throw new Error('Matrix must be square');\n    }\n    let determinant = this.pivotSign;\n    let col = data.columns;\n    for (let j = 0; j < col; j++) {\n      determinant *= data.get(j, j);\n    }\n    return determinant;\n  }\n\n  get lowerTriangularMatrix() {\n    let data = this.LU;\n    let rows = data.rows;\n    let columns = data.columns;\n    let X = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        if (i > j) {\n          X.set(i, j, data.get(i, j));\n        } else if (i === j) {\n          X.set(i, j, 1);\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get upperTriangularMatrix() {\n    let data = this.LU;\n    let rows = data.rows;\n    let columns = data.columns;\n    let X = new Matrix(rows, columns);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < columns; j++) {\n        if (i <= j) {\n          X.set(i, j, data.get(i, j));\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get pivotPermutationVector() {\n    return Array.from(this.pivotVector);\n  }\n}\n","export function hypotenuse(a, b) {\n  let r = 0;\n  if (Math.abs(a) > Math.abs(b)) {\n    r = b / a;\n    return Math.abs(a) * Math.sqrt(1 + r * r);\n  }\n  if (b !== 0) {\n    r = a / b;\n    return Math.abs(b) * Math.sqrt(1 + r * r);\n  }\n  return 0;\n}\n","import Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\n\nimport { hypotenuse } from './util';\n\nexport default class QrDecomposition {\n  constructor(value) {\n    value = WrapperMatrix2D.checkMatrix(value);\n\n    let qr = value.clone();\n    let m = value.rows;\n    let n = value.columns;\n    let rdiag = new Float64Array(n);\n    let i, j, k, s;\n\n    for (k = 0; k < n; k++) {\n      let nrm = 0;\n      for (i = k; i < m; i++) {\n        nrm = hypotenuse(nrm, qr.get(i, k));\n      }\n      if (nrm !== 0) {\n        if (qr.get(k, k) < 0) {\n          nrm = -nrm;\n        }\n        for (i = k; i < m; i++) {\n          qr.set(i, k, qr.get(i, k) / nrm);\n        }\n        qr.set(k, k, qr.get(k, k) + 1);\n        for (j = k + 1; j < n; j++) {\n          s = 0;\n          for (i = k; i < m; i++) {\n            s += qr.get(i, k) * qr.get(i, j);\n          }\n          s = -s / qr.get(k, k);\n          for (i = k; i < m; i++) {\n            qr.set(i, j, qr.get(i, j) + s * qr.get(i, k));\n          }\n        }\n      }\n      rdiag[k] = -nrm;\n    }\n\n    this.QR = qr;\n    this.Rdiag = rdiag;\n  }\n\n  solve(value) {\n    value = Matrix.checkMatrix(value);\n\n    let qr = this.QR;\n    let m = qr.rows;\n\n    if (value.rows !== m) {\n      throw new Error('Matrix row dimensions must agree');\n    }\n    if (!this.isFullRank()) {\n      throw new Error('Matrix is rank deficient');\n    }\n\n    let count = value.columns;\n    let X = value.clone();\n    let n = qr.columns;\n    let i, j, k, s;\n\n    for (k = 0; k < n; k++) {\n      for (j = 0; j < count; j++) {\n        s = 0;\n        for (i = k; i < m; i++) {\n          s += qr.get(i, k) * X.get(i, j);\n        }\n        s = -s / qr.get(k, k);\n        for (i = k; i < m; i++) {\n          X.set(i, j, X.get(i, j) + s * qr.get(i, k));\n        }\n      }\n    }\n    for (k = n - 1; k >= 0; k--) {\n      for (j = 0; j < count; j++) {\n        X.set(k, j, X.get(k, j) / this.Rdiag[k]);\n      }\n      for (i = 0; i < k; i++) {\n        for (j = 0; j < count; j++) {\n          X.set(i, j, X.get(i, j) - X.get(k, j) * qr.get(i, k));\n        }\n      }\n    }\n\n    return X.subMatrix(0, n - 1, 0, count - 1);\n  }\n\n  isFullRank() {\n    let columns = this.QR.columns;\n    for (let i = 0; i < columns; i++) {\n      if (this.Rdiag[i] === 0) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get upperTriangularMatrix() {\n    let qr = this.QR;\n    let n = qr.columns;\n    let X = new Matrix(n, n);\n    let i, j;\n    for (i = 0; i < n; i++) {\n      for (j = 0; j < n; j++) {\n        if (i < j) {\n          X.set(i, j, qr.get(i, j));\n        } else if (i === j) {\n          X.set(i, j, this.Rdiag[i]);\n        } else {\n          X.set(i, j, 0);\n        }\n      }\n    }\n    return X;\n  }\n\n  get orthogonalMatrix() {\n    let qr = this.QR;\n    let rows = qr.rows;\n    let columns = qr.columns;\n    let X = new Matrix(rows, columns);\n    let i, j, k, s;\n\n    for (k = columns - 1; k >= 0; k--) {\n      for (i = 0; i < rows; i++) {\n        X.set(i, k, 0);\n      }\n      X.set(k, k, 1);\n      for (j = k; j < columns; j++) {\n        if (qr.get(k, k) !== 0) {\n          s = 0;\n          for (i = k; i < rows; i++) {\n            s += qr.get(i, k) * X.get(i, j);\n          }\n\n          s = -s / qr.get(k, k);\n\n          for (i = k; i < rows; i++) {\n            X.set(i, j, X.get(i, j) + s * qr.get(i, k));\n          }\n        }\n      }\n    }\n    return X;\n  }\n}\n","import Matrix from '../matrix';\nimport WrapperMatrix2D from '../wrap/WrapperMatrix2D';\n\nimport { hypotenuse } from './util';\n\nexport default class SingularValueDecomposition {\n  constructor(value, options = {}) {\n    value = WrapperMatrix2D.checkMatrix(value);\n\n    if (value.isEmpty()) {\n      throw new Error('Matrix must be non-empty');\n    }\n\n    let m = value.rows;\n    let n = value.columns;\n\n    const {\n      computeLeftSingularVectors = true,\n      computeRightSingularVectors = true,\n      autoTranspose = false,\n    } = options;\n\n    let wantu = Boolean(computeLeftSingularVectors);\n    let wantv = Boolean(computeRightSingularVectors);\n\n    let swapped = false;\n    let a;\n    if (m < n) {\n      if (!autoTranspose) {\n        a = value.clone();\n        // eslint-disable-next-line no-console\n        console.warn(\n          'Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose',\n        );\n      } else {\n        a = value.transpose();\n        m = a.rows;\n        n = a.columns;\n        swapped = true;\n        let aux = wantu;\n        wantu = wantv;\n        wantv = aux;\n      }\n    } else {\n      a = value.clone();\n    }\n\n    let nu = Math.min(m, n);\n    let ni = Math.min(m + 1, n);\n    let s = new Float64Array(ni);\n    let U = new Matrix(m, nu);\n    let V = new Matrix(n, n);\n\n    let e = new Float64Array(n);\n    let work = new Float64Array(m);\n\n    let si = new Float64Array(ni);\n    for (let i = 0; i < ni; i++) si[i] = i;\n\n    let nct = Math.min(m - 1, n);\n    let nrt = Math.max(0, Math.min(n - 2, m));\n    let mrc = Math.max(nct, nrt);\n\n    for (let k = 0; k < mrc; k++) {\n      if (k < nct) {\n        s[k] = 0;\n        for (let i = k; i < m; i++) {\n          s[k] = hypotenuse(s[k], a.get(i, k));\n        }\n        if (s[k] !== 0) {\n          if (a.get(k, k) < 0) {\n            s[k] = -s[k];\n          }\n          for (let i = k; i < m; i++) {\n            a.set(i, k, a.get(i, k) / s[k]);\n          }\n          a.set(k, k, a.get(k, k) + 1);\n        }\n        s[k] = -s[k];\n      }\n\n      for (let j = k + 1; j < n; j++) {\n        if (k < nct && s[k] !== 0) {\n          let t = 0;\n          for (let i = k; i < m; i++) {\n            t += a.get(i, k) * a.get(i, j);\n          }\n          t = -t / a.get(k, k);\n          for (let i = k; i < m; i++) {\n            a.set(i, j, a.get(i, j) + t * a.get(i, k));\n          }\n        }\n        e[j] = a.get(k, j);\n      }\n\n      if (wantu && k < nct) {\n        for (let i = k; i < m; i++) {\n          U.set(i, k, a.get(i, k));\n        }\n      }\n\n      if (k < nrt) {\n        e[k] = 0;\n        for (let i = k + 1; i < n; i++) {\n          e[k] = hypotenuse(e[k], e[i]);\n        }\n        if (e[k] !== 0) {\n          if (e[k + 1] < 0) {\n            e[k] = 0 - e[k];\n          }\n          for (let i = k + 1; i < n; i++) {\n            e[i] /= e[k];\n          }\n          e[k + 1] += 1;\n        }\n        e[k] = -e[k];\n        if (k + 1 < m && e[k] !== 0) {\n          for (let i = k + 1; i < m; i++) {\n            work[i] = 0;\n          }\n          for (let i = k + 1; i < m; i++) {\n            for (let j = k + 1; j < n; j++) {\n              work[i] += e[j] * a.get(i, j);\n            }\n          }\n          for (let j = k + 1; j < n; j++) {\n            let t = -e[j] / e[k + 1];\n            for (let i = k + 1; i < m; i++) {\n              a.set(i, j, a.get(i, j) + t * work[i]);\n            }\n          }\n        }\n        if (wantv) {\n          for (let i = k + 1; i < n; i++) {\n            V.set(i, k, e[i]);\n          }\n        }\n      }\n    }\n\n    let p = Math.min(n, m + 1);\n    if (nct < n) {\n      s[nct] = a.get(nct, nct);\n    }\n    if (m < p) {\n      s[p - 1] = 0;\n    }\n    if (nrt + 1 < p) {\n      e[nrt] = a.get(nrt, p - 1);\n    }\n    e[p - 1] = 0;\n\n    if (wantu) {\n      for (let j = nct; j < nu; j++) {\n        for (let i = 0; i < m; i++) {\n          U.set(i, j, 0);\n        }\n        U.set(j, j, 1);\n      }\n      for (let k = nct - 1; k >= 0; k--) {\n        if (s[k] !== 0) {\n          for (let j = k + 1; j < nu; j++) {\n            let t = 0;\n            for (let i = k; i < m; i++) {\n              t += U.get(i, k) * U.get(i, j);\n            }\n            t = -t / U.get(k, k);\n            for (let i = k; i < m; i++) {\n              U.set(i, j, U.get(i, j) + t * U.get(i, k));\n            }\n          }\n          for (let i = k; i < m; i++) {\n            U.set(i, k, -U.get(i, k));\n          }\n          U.set(k, k, 1 + U.get(k, k));\n          for (let i = 0; i < k - 1; i++) {\n            U.set(i, k, 0);\n          }\n        } else {\n          for (let i = 0; i < m; i++) {\n            U.set(i, k, 0);\n          }\n          U.set(k, k, 1);\n        }\n      }\n    }\n\n    if (wantv) {\n      for (let k = n - 1; k >= 0; k--) {\n        if (k < nrt && e[k] !== 0) {\n          for (let j = k + 1; j < n; j++) {\n            let t = 0;\n            for (let i = k + 1; i < n; i++) {\n              t += V.get(i, k) * V.get(i, j);\n            }\n            t = -t / V.get(k + 1, k);\n            for (let i = k + 1; i < n; i++) {\n              V.set(i, j, V.get(i, j) + t * V.get(i, k));\n            }\n          }\n        }\n        for (let i = 0; i < n; i++) {\n          V.set(i, k, 0);\n        }\n        V.set(k, k, 1);\n      }\n    }\n\n    let pp = p - 1;\n    let iter = 0;\n    let eps = Number.EPSILON;\n    while (p > 0) {\n      let k, kase;\n      for (k = p - 2; k >= -1; k--) {\n        if (k === -1) {\n          break;\n        }\n        const alpha =\n          Number.MIN_VALUE + eps * Math.abs(s[k] + Math.abs(s[k + 1]));\n        if (Math.abs(e[k]) <= alpha || Number.isNaN(e[k])) {\n          e[k] = 0;\n          break;\n        }\n      }\n      if (k === p - 2) {\n        kase = 4;\n      } else {\n        let ks;\n        for (ks = p - 1; ks >= k; ks--) {\n          if (ks === k) {\n            break;\n          }\n          let t =\n            (ks !== p ? Math.abs(e[ks]) : 0) +\n            (ks !== k + 1 ? Math.abs(e[ks - 1]) : 0);\n          if (Math.abs(s[ks]) <= eps * t) {\n            s[ks] = 0;\n            break;\n          }\n        }\n        if (ks === k) {\n          kase = 3;\n        } else if (ks === p - 1) {\n          kase = 1;\n        } else {\n          kase = 2;\n          k = ks;\n        }\n      }\n\n      k++;\n\n      switch (kase) {\n        case 1: {\n          let f = e[p - 2];\n          e[p - 2] = 0;\n          for (let j = p - 2; j >= k; j--) {\n            let t = hypotenuse(s[j], f);\n            let cs = s[j] / t;\n            let sn = f / t;\n            s[j] = t;\n            if (j !== k) {\n              f = -sn * e[j - 1];\n              e[j - 1] = cs * e[j - 1];\n            }\n            if (wantv) {\n              for (let i = 0; i < n; i++) {\n                t = cs * V.get(i, j) + sn * V.get(i, p - 1);\n                V.set(i, p - 1, -sn * V.get(i, j) + cs * V.get(i, p - 1));\n                V.set(i, j, t);\n              }\n            }\n          }\n          break;\n        }\n        case 2: {\n          let f = e[k - 1];\n          e[k - 1] = 0;\n          for (let j = k; j < p; j++) {\n            let t = hypotenuse(s[j], f);\n            let cs = s[j] / t;\n            let sn = f / t;\n            s[j] = t;\n            f = -sn * e[j];\n            e[j] = cs * e[j];\n            if (wantu) {\n              for (let i = 0; i < m; i++) {\n                t = cs * U.get(i, j) + sn * U.get(i, k - 1);\n                U.set(i, k - 1, -sn * U.get(i, j) + cs * U.get(i, k - 1));\n                U.set(i, j, t);\n              }\n            }\n          }\n          break;\n        }\n        case 3: {\n          const scale = Math.max(\n            Math.abs(s[p - 1]),\n            Math.abs(s[p - 2]),\n            Math.abs(e[p - 2]),\n            Math.abs(s[k]),\n            Math.abs(e[k]),\n          );\n          const sp = s[p - 1] / scale;\n          const spm1 = s[p - 2] / scale;\n          const epm1 = e[p - 2] / scale;\n          const sk = s[k] / scale;\n          const ek = e[k] / scale;\n          const b = ((spm1 + sp) * (spm1 - sp) + epm1 * epm1) / 2;\n          const c = sp * epm1 * (sp * epm1);\n          let shift = 0;\n          if (b !== 0 || c !== 0) {\n            if (b < 0) {\n              shift = 0 - Math.sqrt(b * b + c);\n            } else {\n              shift = Math.sqrt(b * b + c);\n            }\n            shift = c / (b + shift);\n          }\n          let f = (sk + sp) * (sk - sp) + shift;\n          let g = sk * ek;\n          for (let j = k; j < p - 1; j++) {\n            let t = hypotenuse(f, g);\n            if (t === 0) t = Number.MIN_VALUE;\n            let cs = f / t;\n            let sn = g / t;\n            if (j !== k) {\n              e[j - 1] = t;\n            }\n            f = cs * s[j] + sn * e[j];\n            e[j] = cs * e[j] - sn * s[j];\n            g = sn * s[j + 1];\n            s[j + 1] = cs * s[j + 1];\n            if (wantv) {\n              for (let i = 0; i < n; i++) {\n                t = cs * V.get(i, j) + sn * V.get(i, j + 1);\n                V.set(i, j + 1, -sn * V.get(i, j) + cs * V.get(i, j + 1));\n                V.set(i, j, t);\n              }\n            }\n            t = hypotenuse(f, g);\n            if (t === 0) t = Number.MIN_VALUE;\n            cs = f / t;\n            sn = g / t;\n            s[j] = t;\n            f = cs * e[j] + sn * s[j + 1];\n            s[j + 1] = -sn * e[j] + cs * s[j + 1];\n            g = sn * e[j + 1];\n            e[j + 1] = cs * e[j + 1];\n            if (wantu && j < m - 1) {\n              for (let i = 0; i < m; i++) {\n                t = cs * U.get(i, j) + sn * U.get(i, j + 1);\n                U.set(i, j + 1, -sn * U.get(i, j) + cs * U.get(i, j + 1));\n                U.set(i, j, t);\n              }\n            }\n          }\n          e[p - 2] = f;\n          iter = iter + 1;\n          break;\n        }\n        case 4: {\n          if (s[k] <= 0) {\n            s[k] = s[k] < 0 ? -s[k] : 0;\n            if (wantv) {\n              for (let i = 0; i <= pp; i++) {\n                V.set(i, k, -V.get(i, k));\n              }\n            }\n          }\n          while (k < pp) {\n            if (s[k] >= s[k + 1]) {\n              break;\n            }\n            let t = s[k];\n            s[k] = s[k + 1];\n            s[k + 1] = t;\n            if (wantv && k < n - 1) {\n              for (let i = 0; i < n; i++) {\n                t = V.get(i, k + 1);\n                V.set(i, k + 1, V.get(i, k));\n                V.set(i, k, t);\n              }\n            }\n            if (wantu && k < m - 1) {\n              for (let i = 0; i < m; i++) {\n                t = U.get(i, k + 1);\n                U.set(i, k + 1, U.get(i, k));\n                U.set(i, k, t);\n              }\n            }\n            k++;\n          }\n          iter = 0;\n          p--;\n          break;\n        }\n        // no default\n      }\n    }\n\n    if (swapped) {\n      let tmp = V;\n      V = U;\n      U = tmp;\n    }\n\n    this.m = m;\n    this.n = n;\n    this.s = s;\n    this.U = U;\n    this.V = V;\n  }\n\n  solve(value) {\n    let Y = value;\n    let e = this.threshold;\n    let scols = this.s.length;\n    let Ls = Matrix.zeros(scols, scols);\n\n    for (let i = 0; i < scols; i++) {\n      if (Math.abs(this.s[i]) <= e) {\n        Ls.set(i, i, 0);\n      } else {\n        Ls.set(i, i, 1 / this.s[i]);\n      }\n    }\n\n    let U = this.U;\n    let V = this.rightSingularVectors;\n\n    let VL = V.mmul(Ls);\n    let vrows = V.rows;\n    let urows = U.rows;\n    let VLU = Matrix.zeros(vrows, urows);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < urows; j++) {\n        let sum = 0;\n        for (let k = 0; k < scols; k++) {\n          sum += VL.get(i, k) * U.get(j, k);\n        }\n        VLU.set(i, j, sum);\n      }\n    }\n\n    return VLU.mmul(Y);\n  }\n\n  solveForDiagonal(value) {\n    return this.solve(Matrix.diag(value));\n  }\n\n  inverse() {\n    let V = this.V;\n    let e = this.threshold;\n    let vrows = V.rows;\n    let vcols = V.columns;\n    let X = new Matrix(vrows, this.s.length);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < vcols; j++) {\n        if (Math.abs(this.s[j]) > e) {\n          X.set(i, j, V.get(i, j) / this.s[j]);\n        }\n      }\n    }\n\n    let U = this.U;\n\n    let urows = U.rows;\n    let ucols = U.columns;\n    let Y = new Matrix(vrows, urows);\n\n    for (let i = 0; i < vrows; i++) {\n      for (let j = 0; j < urows; j++) {\n        let sum = 0;\n        for (let k = 0; k < ucols; k++) {\n          sum += X.get(i, k) * U.get(j, k);\n        }\n        Y.set(i, j, sum);\n      }\n    }\n\n    return Y;\n  }\n\n  get condition() {\n    return this.s[0] / this.s[Math.min(this.m, this.n) - 1];\n  }\n\n  get norm2() {\n    return this.s[0];\n  }\n\n  get rank() {\n    let tol = Math.max(this.m, this.n) * this.s[0] * Number.EPSILON;\n    let r = 0;\n    let s = this.s;\n    for (let i = 0, ii = s.length; i < ii; i++) {\n      if (s[i] > tol) {\n        r++;\n      }\n    }\n    return r;\n  }\n\n  get diagonal() {\n    return Array.from(this.s);\n  }\n\n  get threshold() {\n    return (Number.EPSILON / 2) * Math.max(this.m, this.n) * this.s[0];\n  }\n\n  get leftSingularVectors() {\n    return this.U;\n  }\n\n  get rightSingularVectors() {\n    return this.V;\n  }\n\n  get diagonalMatrix() {\n    return Matrix.diag(this.s);\n  }\n}\n","import LuDecomposition from './dc/lu';\nimport QrDecomposition from './dc/qr';\nimport SingularValueDecomposition from './dc/svd';\nimport Matrix from './matrix';\nimport WrapperMatrix2D from './wrap/WrapperMatrix2D';\n\nexport function inverse(matrix, useSVD = false) {\n  matrix = WrapperMatrix2D.checkMatrix(matrix);\n  if (useSVD) {\n    return new SingularValueDecomposition(matrix).inverse();\n  } else {\n    return solve(matrix, Matrix.eye(matrix.rows));\n  }\n}\n\nexport function solve(leftHandSide, rightHandSide, useSVD = false) {\n  leftHandSide = WrapperMatrix2D.checkMatrix(leftHandSide);\n  rightHandSide = WrapperMatrix2D.checkMatrix(rightHandSide);\n  if (useSVD) {\n    return new SingularValueDecomposition(leftHandSide).solve(rightHandSide);\n  } else {\n    return leftHandSide.isSquare()\n      ? new LuDecomposition(leftHandSide).solve(rightHandSide)\n      : new QrDecomposition(leftHandSide).solve(rightHandSide);\n  }\n}\n","import { inverse, Matrix } from 'ml-matrix';\n\nimport gradientFunction from './gradientFunction';\n\n/**\n * Matrix function over the samples\n * @ignore\n * @param {{x:Array<number>, y:Array<number>}} data - Array of points to fit in the format [x1, x2, ... ], [y1, y2, ... ]\n * @param {Array<number>} evaluatedData - Array of previous evaluated function values\n * @return {Matrix}\n */\nfunction matrixFunction(data, evaluatedData) {\n  const m = data.x.length;\n\n  let ans = new Matrix(m, 1);\n\n  for (let point = 0; point < m; point++) {\n    ans.set(point, 0, data.y[point] - evaluatedData[point]);\n  }\n  return ans;\n}\n\n/**\n * Iteration for Levenberg-Marquardt\n * @ignore\n * @param {{x:Array<number>, y:Array<number>}} data - Array of points to fit in the format [x1, x2, ... ], [y1, y2, ... ]\n * @param {Array<number>} params - Array of previous parameter values\n * @param {number} damping - Levenberg-Marquardt parameter\n * @param {number|array} gradientDifference - The step size to approximate the jacobian matrix\n * @param {boolean} centralDifference - If true the jacobian matrix is approximated by central differences otherwise by forward differences\n * @param {function} parameterizedFunction - The parameters and returns a function with the independent variable as a parameter\n * @return {Array<number>}\n */\nexport default function step(\n  data,\n  params,\n  damping,\n  gradientDifference,\n  parameterizedFunction,\n  centralDifference,\n  weights,\n) {\n  let value = damping;\n  let identity = Matrix.eye(params.length, params.length, value);\n\n  const func = parameterizedFunction(params);\n\n  let evaluatedData = new Float64Array(data.x.length);\n  for (let i = 0; i < data.x.length; i++) {\n    evaluatedData[i] = func(data.x[i]);\n  }\n\n  let gradientFunc = gradientFunction(\n    data,\n    evaluatedData,\n    params,\n    gradientDifference,\n    parameterizedFunction,\n    centralDifference,\n  );\n  let residualError = matrixFunction(data, evaluatedData);\n\n  let inverseMatrix = inverse(\n    identity.add(\n      gradientFunc.mmul(\n        gradientFunc.transpose().scale('row', { scale: weights }),\n      ),\n    ),\n  );\n\n  let jacobianWeigthResidualError = gradientFunc.mmul(\n    residualError.scale('row', { scale: weights }),\n  );\n\n  let perturbations = inverseMatrix.mmul(jacobianWeigthResidualError);\n\n  return {\n    perturbations,\n    jacobianWeigthResidualError,\n  };\n}\n","import { Matrix } from 'ml-matrix';\n/**\n * Difference of the matrix function over the parameters\n * @ignore\n * @param {{x:Array<number>, y:Array<number>}} data - Array of points to fit in the format [x1, x2, ... ], [y1, y2, ... ]\n * @param {Array<number>} evaluatedData - Array of previous evaluated function values\n * @param {Array<number>} params - Array of previous parameter values\n * @param {number|array} gradientDifference - The step size to approximate the jacobian matrix\n * @param {boolean} centralDifference - If true the jacobian matrix is approximated by central differences otherwise by forward differences\n * @param {function} paramFunction - The parameters and returns a function with the independent variable as a parameter\n * @return {Matrix}\n */\n\nexport default function gradientFunction(\n  data,\n  evaluatedData,\n  params,\n  gradientDifference,\n  paramFunction,\n  centralDifference,\n) {\n  const nbParams = params.length;\n  const nbPoints = data.x.length;\n  let ans = Matrix.zeros(nbParams, nbPoints);\n\n  let rowIndex = 0;\n  for (let param = 0; param < nbParams; param++) {\n    if (gradientDifference[param] === 0) continue;\n    let delta = gradientDifference[param];\n    let auxParams = params.slice();\n    auxParams[param] += delta;\n    let funcParam = paramFunction(auxParams);\n    if (!centralDifference) {\n      for (let point = 0; point < nbPoints; point++) {\n        ans.set(\n          rowIndex,\n          point,\n          (evaluatedData[point] - funcParam(data.x[point])) / delta,\n        );\n      }\n    } else {\n      auxParams = params.slice();\n      auxParams[param] -= delta;\n      delta *= 2;\n      let funcParam2 = paramFunction(auxParams);\n      for (let point = 0; point < nbPoints; point++) {\n        ans.set(\n          rowIndex,\n          point,\n          (funcParam2(data.x[point]) - funcParam(data.x[point])) / delta,\n        );\n      }\n    }\n    rowIndex++;\n  }\n\n  return ans;\n}\n","import checkOptions from './checkOptions';\nimport errorCalculation from './errorCalculation';\nimport step from './step';\n\n/**\n * Curve fitting algorithm\n * @param {{x:Array<number>, y:Array<number>}} data - Array of points to fit in the format [x1, x2, ... ], [y1, y2, ... ]\n * @param {function} parameterizedFunction - The parameters and returns a function with the independent variable as a parameter\n * @param {object} [options] - Options object\n * @param {number|array} [options.weights = 1] - weighting vector, if the length does not match with the number of data points, the vector is reconstructed with first value.\n * @param {number} [options.damping = 1e-2] - Levenberg-Marquardt parameter, small values of the damping parameter  result in a Gauss-Newton update and large\nvalues of  result in a gradient descent update\n * @param {number} [options.dampingStepDown = 9] - factor to reduce the damping (Levenberg-Marquardt parameter) when there is not an improvement when updating parameters.\n * @param {number} [options.dampingStepUp = 11] - factor to increase the damping (Levenberg-Marquardt parameter) when there is an improvement when updating parameters.\n * @param {number} [options.improvementThreshold = 1e-3] - the threshold to define an improvement through an update of parameters\n * @param {number|array} [options.gradientDifference = 10e-2] - The step size to approximate the jacobian matrix\n * @param {boolean} [options.centralDifference = false] - If true the jacobian matrix is approximated by central differences otherwise by forward differences\n * @param {Array<number>} [options.minValues] - Minimum allowed values for parameters\n * @param {Array<number>} [options.maxValues] - Maximum allowed values for parameters\n * @param {Array<number>} [options.initialValues] - Array of initial parameter values\n * @param {number} [options.maxIterations = 100] - Maximum of allowed iterations\n * @param {number} [options.errorTolerance = 10e-3] - Minimum uncertainty allowed for each point.\n * @param {number} [options.timeout] - maximum time running before throw in seconds.\n * @return {{parameterValues: Array<number>, parameterError: number, iterations: number}}\n */\nexport default function levenbergMarquardt(\n  data,\n  parameterizedFunction,\n  options = {},\n) {\n  let {\n    checkTimeout,\n    minValues,\n    maxValues,\n    parameters,\n    weightSquare,\n    damping,\n    dampingStepUp,\n    dampingStepDown,\n    maxIterations,\n    errorTolerance,\n    centralDifference,\n    gradientDifference,\n    improvementThreshold,\n  } = checkOptions(data, parameterizedFunction, options);\n\n  let error = errorCalculation(\n    data,\n    parameters,\n    parameterizedFunction,\n    weightSquare,\n  );\n\n  let converged = error <= errorTolerance;\n\n  let iteration = 0;\n  for (; iteration < maxIterations && !converged; iteration++) {\n    let previousError = error;\n\n    let { perturbations, jacobianWeigthResidualError } = step(\n      data,\n      parameters,\n      damping,\n      gradientDifference,\n      parameterizedFunction,\n      centralDifference,\n      weightSquare,\n    );\n\n    for (let k = 0; k < parameters.length; k++) {\n      parameters[k] = Math.min(\n        Math.max(minValues[k], parameters[k] - perturbations.get(k, 0)),\n        maxValues[k],\n      );\n    }\n\n    error = errorCalculation(\n      data,\n      parameters,\n      parameterizedFunction,\n      weightSquare,\n    );\n\n    if (isNaN(error)) break;\n\n    let improvementMetric =\n      (previousError - error) /\n      perturbations\n        .transpose()\n        .mmul(perturbations.mulS(damping).add(jacobianWeigthResidualError))\n        .get(0, 0);\n\n    if (improvementMetric > improvementThreshold) {\n      damping = Math.max(damping / dampingStepDown, 1e-7);\n    } else {\n      error = previousError;\n      damping = Math.min(damping * dampingStepUp, 1e7);\n    }\n\n    if (checkTimeout()) {\n      throw new Error(\n        `The execution time is over to ${options.timeout} seconds`,\n      );\n    }\n\n    converged = error <= errorTolerance;\n  }\n\n  return {\n    parameterValues: parameters,\n    parameterError: error,\n    iterations: iteration,\n  };\n}\n","import LM from 'ml-levenberg-marquardt';\n\nconst LEVENBERG_MARQUARDT = 1;\n\nexport function selectMethod(optimizationOptions = {}) {\n  let { kind, options } = optimizationOptions;\n  kind = getKind(kind);\n  switch (kind) {\n    case LEVENBERG_MARQUARDT:\n      return {\n        algorithm: LM,\n        optimizationOptions: checkOptions(kind, options),\n      };\n    default:\n      throw new Error(`Unknown kind algorithm`);\n  }\n}\n\nfunction checkOptions(kind, options = {}) {\n  // eslint-disable-next-line default-case\n  switch (kind) {\n    case LEVENBERG_MARQUARDT:\n      return Object.assign({}, lmOptions, options);\n  }\n}\n\nfunction getKind(kind) {\n  if (typeof kind !== 'string') return kind;\n  switch (kind.toLowerCase().replace(/[^a-z]/g, '')) {\n    case 'lm':\n    case 'levenbergmarquardt':\n      return LEVENBERG_MARQUARDT;\n    default:\n      throw new Error(`Unknown kind algorithm`);\n  }\n}\n\nconst lmOptions = {\n  damping: 1.5,\n  maxIterations: 100,\n  errorTolerance: 1e-8,\n};\n","import { checkInput } from './checkInput';\nimport { selectMethod } from './selectMethod';\n\n// const STATE_INIT = 0;\n// const STATE_MIN = 1;\n// const STATE_MAX = 2;\n// const STATE_GRADIENT_DIFFERENCE = 3;\n\n// const X = 0;\n// const Y = 1;\n// const WIDTH = 2;\n// const MU = 3;\n\n// const keys = ['x', 'y', 'width', 'mu'];\n/**\n * Fits a set of points to the sum of a set of bell functions.\n * @param {object} data - An object containing the x and y data to be fitted.\n * @param {array} peaks - A list of initial parameters to be optimized. e.g. coming from a peak picking [{x, y, width}].\n * @param {object} [options = {}]\n * @param {object} [options.shape={}] - it's specify the kind of shape used to fitting.\n * @param {string} [options.shape.kind = 'gaussian'] - kind of shape; lorentzian, gaussian and pseudovoigt are supported.\n * @param {object} [options.optimization = {}] - it's specify the kind and options of the algorithm use to optimize parameters.\n * @param {object} [options.optimization.kind = 'lm'] - kind of algorithm. By default it's levenberg-marquardt.\n * @param {object} [options.optimization.parameters] - options of each parameter to be optimized e.g. For a gaussian shape\n *  it could have x, y and with properties, each of which could contain init, min, max and gradientDifference, those options will define the guess,\n *  the min and max value of the parameter (search space) and the step size to approximate the jacobian matrix respectively. Those options could be a number,\n *  array of numbers, callback, or array of callbacks. Each kind of shape has default parameters so it could be undefined.\n * @param {object} [options.optimization.parameters.x] - options for x parameter.\n * @param {number|callback|array<number|callback>} [options.optimization.parameters.x.init] - definition of the starting point of the parameter (the guess),\n *  if it is a callback the method pass the peak as the unique input, if it is an array the first element define the guess of the first peak and so on.\n * @param {number|callback|array<number|callback>} [options.optimization.parameters.x.min] - definition of the lower limit of the parameter,\n *  if it is a callback the method pass the peak as the unique input, if it is an array the first element define the min of the first peak and so on.\n * @param {number|callback|array<number|callback>} [options.optimization.parameters.x.max] - definition of the upper limit of the parameter,\n *  if it is a callback the method pass the peak as the unique input, if it is an array the first element define the max of the first peak and so on.\n * @param {number|callback|array<number|callback>} [options.optimization.parameters.x.gradientDifference] - definition of  the step size to approximate the jacobian matrix of the parameter,\n *  if it is a callback the method pass the peak as the unique input, if it is an array the first element define the gradientDifference of the first peak and so on.\n * @param {object} [options.optimization.options = {}] - options for the specific kind of algorithm.\n * @param {number} [options.optimization.options.timeout] - maximum time running before break in seconds.\n * @param {number} [options.optimization.options.damping=1.5]\n * @param {number} [options.optimization.options.maxIterations=100]\n * @param {number} [options.optimization.options.errorTolerance=1e-8]\n * @returns {object} - A object with fitting error and the list of optimized parameters { parameters: [ {x, y, width} ], error } if the kind of shape is pseudoVoigt mu parameter is optimized.\n */\nexport function optimize(data, peakList, options = {}) {\n  const { y, x, maxY, peaks, paramsFunc, optimization } = checkInput(\n    data,\n    peakList,\n    options,\n  );\n\n  let parameters = optimization.parameters;\n\n  let nbShapes = peaks.length;\n  let parameterKey = Object.keys(parameters);\n  let nbParams = nbShapes * parameterKey.length;\n  let pMin = new Float64Array(nbParams);\n  let pMax = new Float64Array(nbParams);\n  let pInit = new Float64Array(nbParams);\n  let gradientDifference = new Float64Array(nbParams);\n\n  for (let i = 0; i < nbShapes; i++) {\n    let peak = peaks[i];\n    for (let k = 0; k < parameterKey.length; k++) {\n      let key = parameterKey[k];\n      let init = parameters[key].init;\n      let min = parameters[key].min;\n      let max = parameters[key].max;\n      let gradientDifferenceValue = parameters[key].gradientDifference;\n      pInit[i + k * nbShapes] = init[i % init.length](peak);\n      pMin[i + k * nbShapes] = min[i % min.length](peak);\n      pMax[i + k * nbShapes] = max[i % max.length](peak);\n      gradientDifference[i + k * nbShapes] = gradientDifferenceValue[\n        i % gradientDifferenceValue.length\n      ](peak);\n    }\n  }\n\n  let { algorithm, optimizationOptions } = selectMethod(optimization);\n\n  optimizationOptions.minValues = pMin;\n  optimizationOptions.maxValues = pMax;\n  optimizationOptions.initialValues = pInit;\n  optimizationOptions.gradientDifference = gradientDifference;\n\n  let pFit = algorithm({ x, y }, paramsFunc, optimizationOptions);\n\n  let { parameterError: error, iterations } = pFit;\n  let result = { error, iterations, peaks };\n  for (let i = 0; i < nbShapes; i++) {\n    pFit.parameterValues[i + nbShapes] *= maxY;\n    for (let k = 0; k < parameterKey.length; k++) {\n      // we modify the optimized parameters\n      peaks[i][parameterKey[k]] = pFit.parameterValues[i + k * nbShapes];\n    }\n  }\n\n  return result;\n}\n","export function addStyle(serie, spectrum, options = {}) {\r\n    let { color = '#A9A9A9', opacity = 1, lineWidth = 1 } = options;\r\n    // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\r\n    if (color.match(/#[0-9A-F]{6}$/i)) {\r\n        color = (color + ((opacity * 255) >> 0).toString(16)).toUpperCase();\r\n    }\r\n    else {\r\n        color = color.replace(/rgb ?\\((.*)\\)/, `rgba($1,${opacity})`);\r\n    }\r\n    serie.style = [\r\n        {\r\n            name: 'unselected',\r\n            style: {\r\n                line: {\r\n                    color,\r\n                    width: lineWidth,\r\n                    dash: 1,\r\n                },\r\n            },\r\n        },\r\n        {\r\n            name: 'selected',\r\n            style: {\r\n                line: {\r\n                    color,\r\n                    width: lineWidth + 2,\r\n                    dash: 1,\r\n                },\r\n            },\r\n        },\r\n    ];\r\n    serie.name = spectrum.label || spectrum.id;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkU3R5bGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvanNncmFwaC9hZGRTdHlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFPQSxNQUFNLFVBQVUsUUFBUSxDQUN0QixLQUE4QixFQUM5QixRQUFrQixFQUNsQixVQUF3QixFQUFFO0lBRTFCLElBQUksRUFBRSxLQUFLLEdBQUcsU0FBUyxFQUFFLE9BQU8sR0FBRyxDQUFDLEVBQUUsU0FBUyxHQUFHLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQztJQUNoRSxpRUFBaUU7SUFDakUsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7UUFDakMsS0FBSyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7S0FDckU7U0FBTTtRQUNMLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxXQUFXLE9BQU8sR0FBRyxDQUFDLENBQUM7S0FDL0Q7SUFDRCxLQUFLLENBQUMsS0FBSyxHQUFHO1FBQ1o7WUFDRSxJQUFJLEVBQUUsWUFBWTtZQUNsQixLQUFLLEVBQUU7Z0JBQ0wsSUFBSSxFQUFFO29CQUNKLEtBQUs7b0JBQ0wsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLElBQUksRUFBRSxDQUFDO2lCQUNSO2FBQ0Y7U0FDRjtRQUNEO1lBQ0UsSUFBSSxFQUFFLFVBQVU7WUFDaEIsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRTtvQkFDSixLQUFLO29CQUNMLEtBQUssRUFBRSxTQUFTLEdBQUcsQ0FBQztvQkFDcEIsSUFBSSxFQUFFLENBQUM7aUJBQ1I7YUFDRjtTQUNGO0tBQ0YsQ0FBQztJQUNGLEtBQUssQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsRUFBRSxDQUFDO0FBQzdDLENBQUMifQ==","export const COLORS = [\r\n    '#FFB300',\r\n    '#803E75',\r\n    '#FF6800',\r\n    '#A6BDD7',\r\n    '#C10020',\r\n    '#CEA262',\r\n    '#817066',\r\n    '#007D34',\r\n    '#F6768E',\r\n    '#00538A',\r\n    '#FF7A5C',\r\n    '#53377A',\r\n    '#FF8E00',\r\n    '#B32851',\r\n    '#F4C800',\r\n    '#7F180D',\r\n    '#93AA00',\r\n    '#593315',\r\n    '#F13A13',\r\n    '#232C16',\r\n];\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzZ3JhcGgvY29sb3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRztJQUNwQixTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztDQUNWLENBQUMifQ==","export function appendDistinctParameter(values, key, value) {\r\n    if (!values[key]) {\r\n        values[key] = {\r\n            key,\r\n            values: [],\r\n            count: 0,\r\n        };\r\n    }\r\n    if (!values[key].values.includes(value)) {\r\n        values[key].values.push(value);\r\n    }\r\n    values[key].count++;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwZW5kRGlzdGluY3RQYXJhbWV0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC9hcHBlbmREaXN0aW5jdFBhcmFtZXRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLFVBQVUsdUJBQXVCLENBQ3JDLE1BQXFDLEVBQ3JDLEdBQVcsRUFDWCxLQUFhO0lBRWIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNoQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUc7WUFDWixHQUFHO1lBQ0gsTUFBTSxFQUFFLEVBQUU7WUFDVixLQUFLLEVBQUUsQ0FBQztTQUNULENBQUM7S0FDSDtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN2QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNoQztJQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUN0QixDQUFDIn0=","export function appendDistinctValue(values, key) {\r\n    if (!values[key]) {\r\n        values[key] = {\r\n            key,\r\n            count: 0,\r\n        };\r\n    }\r\n    values[key].count++;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwZW5kRGlzdGluY3RWYWx1ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2FwcGVuZERpc3RpbmN0VmFsdWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsTUFBTSxVQUFVLG1CQUFtQixDQUNqQyxNQUFtQyxFQUNuQyxHQUFXO0lBRVgsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNoQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUc7WUFDWixHQUFHO1lBQ0gsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDO0tBQ0g7SUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDdEIsQ0FBQyJ9","// Based on https://github.com/scijs/cholesky-solve\r\n\r\n/*\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2013 Eric Arnebck\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\nfunction ldlSymbolic(\r\n  n /* A and L are n-by-n, where n >= 0 */,\r\n  Ap /* input of size n + 1, not modified */,\r\n  Ai /* input of size nz=Ap[n], not modified */,\r\n  Lp /* output of size n + 1, not defined on input */,\r\n  Parent /* output of size n, not defined on input */,\r\n  Lnz /* output of size n, not defined on input */,\r\n  Flag /* workspace of size n, not defn. on input or output */,\r\n) {\r\n  let i, k, p, kk, p2;\r\n\r\n  for (k = 0; k < n; k++) {\r\n    /* L(k,:) pattern: all nodes reachable in etree from nz in A(0:k-1,k) */\r\n    Parent[k] = -1; /* parent of k is not yet known */\r\n    Flag[k] = k; /* mark node k as visited */\r\n    Lnz[k] = 0; /* count of nonzeros in column k of L */\r\n    kk = k; /* kth original, or permuted, column */\r\n    p2 = Ap[kk + 1];\r\n    for (p = Ap[kk]; p < p2; p++) {\r\n      /* A (i,k) is nonzero (original or permuted A) */\r\n      i = Ai[p];\r\n\r\n      if (i < k) {\r\n        /* follow path from i to root of etree, stop at flagged node */\r\n        for (; Flag[i] !== k; i = Parent[i]) {\r\n          /* find parent of i if not yet determined */\r\n          if (Parent[i] === -1) Parent[i] = k;\r\n          Lnz[i]++; /* L (k,i) is nonzero */\r\n          Flag[i] = k; /* mark i as visited */\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /* construct Lp index array from Lnz column counts */\r\n  Lp[0] = 0;\r\n  for (k = 0; k < n; k++) {\r\n    Lp[k + 1] = Lp[k] + Lnz[k];\r\n  }\r\n}\r\n\r\nfunction ldlNumeric(\r\n  n /* A and L are n-by-n, where n >= 0 */,\r\n  Ap /* input of size n+1, not modified */,\r\n  Ai /* input of size nz=Ap[n], not modified */,\r\n  Ax /* input of size nz=Ap[n], not modified */,\r\n  Lp /* input of size n+1, not modified */,\r\n  Parent /* input of size n, not modified */,\r\n  Lnz /* output of size n, not defn. on input */,\r\n  Li /* output of size lnz=Lp[n], not defined on input */,\r\n  Lx /* output of size lnz=Lp[n], not defined on input */,\r\n  D /* output of size n, not defined on input */,\r\n  Y /* workspace of size n, not defn. on input or output */,\r\n  Pattern /* workspace of size n, not defn. on input or output */,\r\n  Flag /* workspace of size n, not defn. on input or output */,\r\n) {\r\n  let yi, lKi;\r\n  let i, k, p, kk, p2, len, top;\r\n  for (k = 0; k < n; k++) {\r\n    /* compute nonzero Pattern of kth row of L, in topological order */\r\n    Y[k] = 0.0; /* Y(0:k) is now all zero */\r\n    top = n; /* stack for pattern is empty */\r\n    Flag[k] = k; /* mark node k as visited */\r\n    Lnz[k] = 0; /* count of nonzeros in column k of L */\r\n    kk = k; /* kth original, or permuted, column */\r\n    p2 = Ap[kk + 1];\r\n    for (p = Ap[kk]; p < p2; p++) {\r\n      i = Ai[p]; /* get A(i,k) */\r\n      if (i <= k) {\r\n        Y[i] += Ax[p]; /* scatter A(i,k) into Y (sum duplicates) */\r\n        for (len = 0; Flag[i] !== k; i = Parent[i]) {\r\n          Pattern[len++] = i; /* L(k,i) is nonzero */\r\n          Flag[i] = k; /* mark i as visited */\r\n        }\r\n        while (len > 0) Pattern[--top] = Pattern[--len];\r\n      }\r\n    }\r\n    /* compute numerical values kth row of L (a sparse triangular solve) */\r\n    D[k] = Y[k]; /* get D(k,k) and clear Y(k) */\r\n    Y[k] = 0.0;\r\n    for (; top < n; top++) {\r\n      i = Pattern[top]; /* Pattern[top:n-1] is pattern of L(:,k) */\r\n      yi = Y[i]; /* get and clear Y(i) */\r\n      Y[i] = 0.0;\r\n      p2 = Lp[i] + Lnz[i];\r\n      for (p = Lp[i]; p < p2; p++) {\r\n        Y[Li[p]] -= Lx[p] * yi;\r\n      }\r\n      lKi = yi / D[i]; /* the nonzero entry L(k,i) */\r\n      D[k] -= lKi * yi;\r\n      Li[p] = k; /* store L(k,i) in column form of L */\r\n      Lx[p] = lKi;\r\n      Lnz[i]++; /* increment count of nonzeros in col i */\r\n    }\r\n\r\n    if (D[k] === 0.0) return k; /* failure, D(k,k) is zero */\r\n  }\r\n\r\n  return n; /* success, diagonal of D is all nonzero */\r\n}\r\n\r\nfunction ldlLsolve(\r\n  n /* L is n-by-n, where n >= 0 */,\r\n  X /* size n. right-hand-side on input, soln. on output */,\r\n  Lp /* input of size n+1, not modified */,\r\n  Li /* input of size lnz=Lp[n], not modified */,\r\n  Lx /* input of size lnz=Lp[n], not modified */,\r\n) {\r\n  let j, p, p2;\r\n  for (j = 0; j < n; j++) {\r\n    p2 = Lp[j + 1];\r\n    for (p = Lp[j]; p < p2; p++) {\r\n      X[Li[p]] -= Lx[p] * X[j];\r\n    }\r\n  }\r\n}\r\nfunction ldlDsolve(\r\n  n /* D is n-by-n, where n >= 0 */,\r\n  X /* size n. right-hand-side on input, soln. on output */,\r\n  D /* input of size n, not modified */,\r\n) {\r\n  let j;\r\n  for (j = 0; j < n; j++) {\r\n    X[j] /= D[j];\r\n  }\r\n}\r\nfunction ldlLTsolve(\r\n  n /* L is n-by-n, where n >= 0 */,\r\n  X /* size n. right-hand-side on input, soln. on output */,\r\n  Lp /* input of size n+1, not modified */,\r\n  Li /* input of size lnz=Lp[n], not modified */,\r\n  Lx /* input of size lnz=Lp[n], not modified */,\r\n) {\r\n  let j, p, p2;\r\n  for (j = n - 1; j >= 0; j--) {\r\n    p2 = Lp[j + 1];\r\n    for (p = Lp[j]; p < p2; p++) {\r\n      X[j] -= Lx[p] * X[Li[p]];\r\n    }\r\n  }\r\n}\r\n\r\nfunction ldlPerm(\r\n  n /* size of X, B, and P */,\r\n  X /* output of size n. */,\r\n  B /* input of size n. */,\r\n  P /* input permutation array of size n. */,\r\n) {\r\n  let j;\r\n  for (j = 0; j < n; j++) {\r\n    X[j] = B[P[j]];\r\n  }\r\n}\r\n\r\nfunction ldlPermt(\r\n  n /* size of X, B, and P */,\r\n  X /* output of size n. */,\r\n  B /* input of size n. */,\r\n  P /* input permutation array of size n. */,\r\n) {\r\n  let j;\r\n  for (j = 0; j < n; j++) {\r\n    X[P[j]] = B[j];\r\n  }\r\n}\r\n\r\nfunction prepare(M, n, P) {\r\n  // if a permutation was specified, apply it.\r\n  if (P) {\r\n    let Pinv = new Array(n);\r\n\r\n    for (let k = 0; k < n; k++) {\r\n      Pinv[P[k]] = k;\r\n    }\r\n\r\n    let Mt = []; // scratch memory\r\n    // Apply permutation. We make M into P*M*P^T\r\n    for (let a = 0; a < M.length; ++a) {\r\n      let ar = Pinv[M[a][0]];\r\n      let ac = Pinv[M[a][1]];\r\n\r\n      // we only store the upper-diagonal elements(since we assume matrix is symmetric, we only need to store these)\r\n      // if permuted element is below diagonal, we simply transpose it.\r\n      if (ac < ar) {\r\n        let t = ac;\r\n        ac = ar;\r\n        ar = t;\r\n      }\r\n\r\n      Mt[a] = [];\r\n      Mt[a][0] = ar;\r\n      Mt[a][1] = ac;\r\n      Mt[a][2] = M[a][2];\r\n    }\r\n\r\n    M = Mt; // copy scratch memory.\r\n  } else {\r\n    // if P argument is null, we just use an identity permutation.\r\n    P = [];\r\n    for (let i = 0; i < n; ++i) {\r\n      P[i] = i;\r\n    }\r\n  }\r\n\r\n  // The sparse matrix we are decomposing is A.\r\n  // Now we shall create A from M.\r\n  let Ap = new Array(n + 1);\r\n  let Ai = new Array(M.length);\r\n  let Ax = new Array(M.length);\r\n\r\n  // count number of non-zero elements in columns.\r\n  let LNZ = [];\r\n  for (let i = 0; i < n; ++i) {\r\n    LNZ[i] = 0;\r\n  }\r\n  for (let a = 0; a < M.length; ++a) {\r\n    LNZ[M[a][1]]++;\r\n  }\r\n\r\n  Ap[0] = 0;\r\n  for (let i = 0; i < n; ++i) {\r\n    Ap[i + 1] = Ap[i] + LNZ[i];\r\n  }\r\n\r\n  let coloffset = [];\r\n  for (let a = 0; a < n; ++a) {\r\n    coloffset[a] = 0;\r\n  }\r\n\r\n  // go through all elements in M, and add them to sparse matrix A.\r\n  for (let i = 0; i < M.length; ++i) {\r\n    let e = M[i];\r\n    let col = e[1];\r\n\r\n    let adr = Ap[col] + coloffset[col];\r\n    Ai[adr] = e[0];\r\n    Ax[adr] = e[2];\r\n\r\n    coloffset[col]++;\r\n  }\r\n\r\n  let D = new Array(n);\r\n  let Y = new Array(n);\r\n  let Lp = new Array(n + 1);\r\n  let Parent = new Array(n);\r\n  let Lnz = new Array(n);\r\n  let Flag = new Array(n);\r\n  let Pattern = new Array(n);\r\n  let bp1 = new Array(n);\r\n  let x = new Array(n);\r\n  let d;\r\n\r\n  ldlSymbolic(n, Ap, Ai, Lp, Parent, Lnz, Flag);\r\n\r\n  let Lx = new Array(Lp[n]);\r\n  let Li = new Array(Lp[n]);\r\n\r\n  d = ldlNumeric(n, Ap, Ai, Ax, Lp, Parent, Lnz, Li, Lx, D, Y, Pattern, Flag);\r\n\r\n  if (d === n) {\r\n    return function (b) {\r\n      ldlPerm(n, bp1, b, P);\r\n      ldlLsolve(n, bp1, Lp, Li, Lx);\r\n      ldlDsolve(n, bp1, D);\r\n      ldlLTsolve(n, bp1, Lp, Li, Lx);\r\n      ldlPermt(n, x, bp1, P);\r\n\r\n      return x;\r\n    };\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport { prepare as default };\r\n","'use strict'\n\nmodule.exports = cuthillMckee\n\nfunction compareNum(a, b) { return a - b }\n\nfunction cuthillMckee(list, n) {\n  var adj = new Array(n)\n  var visited = new Array(n)\n  for(var i=0; i<n; ++i) {\n    adj[i]     = []\n    visited[i] = false\n  }\n\n  for(var i=0; i<list.length; ++i) {\n    var l = list[i]\n    adj[l[0]].push(l[1])\n  }\n\n  var toVisit = new Array(n)\n  var eol = 0\n  var ptr = 0\n  for(var i=0; i<n; ++i) {\n    if(visited[i]) {\n      continue\n    }\n    toVisit[eol++] = i\n    visited[i] = true\n    while(ptr < eol) {\n      var v = toVisit[ptr++]\n      var nbhd = adj[v]\n      nbhd.sort(compareNum)\n      for(var j=0; j<nbhd.length; ++j) {\n        var u = nbhd[j]\n        if(visited[u]) {\n          continue\n        }\n        visited[u] = true\n        toVisit[eol++] = u\n      }\n    }\n  }\n\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[toVisit[i]] = i\n  }\n\n  return result\n}\n","import cuthillMckee from 'cuthill-mckee';\r\n\r\nconst getClosestNumber = (array = [], goal = 0) => {\r\n  const closest = array.reduce((prev, curr) => {\r\n    return Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev;\r\n  });\r\n  return closest;\r\n};\r\n\r\nconst getCloseIndex = (array = [], goal = 0) => {\r\n  const closest = getClosestNumber(array, goal);\r\n  return array.indexOf(closest);\r\n};\r\n\r\nconst updateSystem = (matrix, y, weights) => {\r\n  let nbPoints = y.length;\r\n  let l = nbPoints - 1;\r\n  let newMatrix = new Array(matrix.length);\r\n  let newVector = new Float64Array(nbPoints);\r\n  for (let i = 0; i < l; i++) {\r\n    let w = weights[i];\r\n    let diag = i * 2;\r\n    let next = diag + 1;\r\n    newMatrix[diag] = matrix[diag].slice();\r\n    newMatrix[next] = matrix[next].slice();\r\n    if (w === 0) {\r\n      newVector[i] = 0;\r\n    } else {\r\n      newVector[i] = y[i] * w;\r\n      newMatrix[diag][2] += w;\r\n    }\r\n  }\r\n  newVector[l] = y[l] * weights[l];\r\n  newMatrix[l * 2] = matrix[l * 2].slice();\r\n  newMatrix[l * 2][2] += weights[l];\r\n\r\n  return [newMatrix, newVector];\r\n};\r\n\r\nconst getDeltaMatrix = (nbPoints, lambda) => {\r\n  let matrix = [];\r\n  let last = nbPoints - 1;\r\n  for (let i = 0; i < last; i++) {\r\n    matrix.push([i, i, lambda * 2]);\r\n    matrix.push([i + 1, i, -1 * lambda]);\r\n  }\r\n  matrix[0][2] = lambda;\r\n  matrix.push([last, last, lambda]);\r\n  return {\r\n    lowerTriangularNonZeros: matrix,\r\n    permutationEncodedArray: cuthillMckee(matrix, nbPoints),\r\n  };\r\n};\r\n\r\nexport { updateSystem, getDeltaMatrix, getCloseIndex, getClosestNumber };\r\n","import Cholesky from './choleskySolver';\r\nimport { updateSystem, getDeltaMatrix, getCloseIndex } from './utils';\r\n\r\n/**\r\n * Fit the baseline drift by iteratively changing weights of sum square error between the fitted baseline and original signals,\r\n * for further information about the parameters you can get the [paper of airPLS](https://github.com/zmzhang/airPLS/blob/master/airPLS_manuscript.pdf)\r\n * @param {Array<number>} x - x axis data useful when control points or zones are submitted\r\n * @param {Array<number>} y - Original data\r\n * @param {object} [options={}] - Options object\r\n * @param {number} [options.maxIterations = 100] - Maximal number of iterations if the method does not reach the stop criterion\r\n * @param {number} [options.factorCriterion = 0.001] - Factor of the sum of absolute value of original data, to compute stop criterion\r\n * @param {Array<number>} [options.weights = [1,1,...]] - Initial weights vector, default each point has the same weight\r\n * @param {number} [options.lambda = 100] - Factor of weights matrix in -> [I + lambda D'D]z = x\r\n * @param {Array<number>} [options.controlPoints = []] - Array of x axis values to force that baseline cross those points.\r\n * @param {Array<number>} [options.baseLineZones = []] - Array of x axis values (as from - to), to force that baseline cross those zones.\r\n * @returns {{corrected: Array<number>, error: number, iteration: number, baseline: Array<number>}}\r\n */\r\nfunction airPLS(x, y, options = {}) {\r\n  let {\r\n    maxIterations = 100,\r\n    lambda = 100,\r\n    factorCriterion = 0.001,\r\n    weights = new Array(y.length).fill(1),\r\n    controlPoints = [],\r\n    baseLineZones = [],\r\n  } = options;\r\n\r\n  if (controlPoints.length > 0) {\r\n    controlPoints.forEach((e, i, arr) => (arr[i] = getCloseIndex(x, e)));\r\n  }\r\n  if (baseLineZones.length > 0) {\r\n    baseLineZones.forEach((range) => {\r\n      let indexFrom = getCloseIndex(x, range.from);\r\n      let indexTo = getCloseIndex(x, range.to);\r\n      if (indexFrom > indexTo) [indexFrom, indexTo] = [indexTo, indexFrom];\r\n      for (let i = indexFrom; i < indexTo; i++) {\r\n        controlPoints.push(i);\r\n      }\r\n    });\r\n  }\r\n\r\n  let baseline, iteration;\r\n  let nbPoints = y.length;\r\n  let l = nbPoints - 1;\r\n  let sumNegDifferences = Number.MAX_SAFE_INTEGER;\r\n  let stopCriterion =\r\n    factorCriterion * y.reduce((sum, e) => Math.abs(e) + sum, 0);\r\n\r\n  let { lowerTriangularNonZeros, permutationEncodedArray } = getDeltaMatrix(\r\n    nbPoints,\r\n    lambda,\r\n  );\r\n\r\n  for (\r\n    iteration = 0;\r\n    iteration < maxIterations && Math.abs(sumNegDifferences) > stopCriterion;\r\n    iteration++\r\n  ) {\r\n    let [leftHandSide, rightHandSide] = updateSystem(\r\n      lowerTriangularNonZeros,\r\n      y,\r\n      weights,\r\n    );\r\n\r\n    let cho = Cholesky(leftHandSide, nbPoints, permutationEncodedArray);\r\n\r\n    baseline = cho(rightHandSide);\r\n\r\n    sumNegDifferences = 0;\r\n\r\n    let difference = y.map(calculateError);\r\n\r\n    let maxNegativeDiff = -1 * Number.MAX_SAFE_INTEGER;\r\n    for (let i = 1; i < l; i++) {\r\n      let diff = difference[i];\r\n      if (diff >= 0) {\r\n        weights[i] = 0;\r\n      } else {\r\n        weights[i] = Math.exp((iteration * diff) / sumNegDifferences);\r\n        if (maxNegativeDiff < diff) maxNegativeDiff = diff;\r\n      }\r\n    }\r\n\r\n    let value = Math.exp((iteration * maxNegativeDiff) / sumNegDifferences);\r\n    weights[0] = value;\r\n    weights[l] = value;\r\n    controlPoints.forEach((i) => (weights[i] = value));\r\n  }\r\n\r\n  return {\r\n    corrected: y.map((e, i) => e - baseline[i]),\r\n    baseline,\r\n    iteration,\r\n    error: sumNegDifferences,\r\n  };\r\n\r\n  function calculateError(e, i) {\r\n    let diff = e - baseline[i];\r\n    if (diff < 0) sumNegDifferences += diff;\r\n    return diff;\r\n  }\r\n}\r\n\r\nexport { airPLS as default };\r\n","import airpls from 'ml-airpls';\nimport sequentialFill from 'ml-array-sequential-fill';\n/**\n * Adaptive iteratively reweighted penalized least squares [1]\n *\n * This function calls ml-airpls\n *\n * References:\n * [1] Zhang, Z.-M.; Chen, S.; Liang, Y.-Z.\n * Baseline Correction Using Adaptive Iteratively Reweighted Penalized Least Squares.\n * Analyst 2010, 135 (5), 11381146. https://doi.org/10.1039/B922045C.\n * @export\n * @param {Array<number>} ys\n * @param {object} [options] - Options object\n * @param {Array<number>} [options.x] Optional, Independent axis variable. If not specified, we use a linear grid\n * @param {object} [options.regression] - Options for the regression\n * @param {number} [options.regression.maxIterations = 100] - Maximum number of allowed iterations\n * @param {function} [options.regression.Regression = PolynomialRegression] - Regression class with a predict method\n * @param {*} [options.regression.regressionOptions] - Options for regressionFunction\n * @param {number} [options.regression.tolerance = 0.001] - Convergence error tolerance\n * @returns {BaselineOutput}\n */\nexport function airPLSBaseline(ys, options = {}) {\n  const numberPoints = ys.length;\n  let { x, regressionOptions } = options;\n  if (!x) {\n    x = sequentialFill({ from: 0, to: numberPoints - 1, size: numberPoints });\n  }\n  let output = airpls(x, ys, regressionOptions);\n\n  return { baseline: output.baseline, correctedSpectrum: output.corrected };\n}\n","export default function maybeToPrecision(value, digits) {\n  if (value < 0) {\n    value = 0 - value;\n    if (typeof digits === 'number') {\n      return `- ${value.toPrecision(digits)}`;\n    } else {\n      return `- ${value.toString()}`;\n    }\n  } else {\n    if (typeof digits === 'number') {\n      return value.toPrecision(digits);\n    } else {\n      return value.toString();\n    }\n  }\n}\n","import isAnyArray from 'is-any-array';\n\nexport { default as maybeToPrecision } from './maybeToPrecision';\nexport { default as checkArrayLength } from './checkArrayLength';\n\nexport default class BaseRegression {\n  constructor() {\n    if (new.target === BaseRegression) {\n      throw new Error('BaseRegression must be subclassed');\n    }\n  }\n\n  predict(x) {\n    if (typeof x === 'number') {\n      return this._predict(x);\n    } else if (isAnyArray(x)) {\n      const y = [];\n      for (let i = 0; i < x.length; i++) {\n        y.push(this._predict(x[i]));\n      }\n      return y;\n    } else {\n      throw new TypeError('x must be a number or array');\n    }\n  }\n\n  _predict() {\n    throw new Error('_predict must be implemented');\n  }\n\n  train() {\n    // Do nothing for this package\n  }\n\n  toString() {\n    return '';\n  }\n\n  toLaTeX() {\n    return '';\n  }\n\n  /**\n   * Return the correlation coefficient of determination (r) and chi-square.\n   * @param {Array<number>} x\n   * @param {Array<number>} y\n   * @return {object}\n   */\n  score(x, y) {\n    if (!isAnyArray(x) || !isAnyArray(y) || x.length !== y.length) {\n      throw new Error('x and y must be arrays of the same length');\n    }\n\n    const n = x.length;\n    const y2 = new Array(n);\n    for (let i = 0; i < n; i++) {\n      y2[i] = this._predict(x[i]);\n    }\n\n    let xSum = 0;\n    let ySum = 0;\n    let chi2 = 0;\n    let rmsd = 0;\n    let xSquared = 0;\n    let ySquared = 0;\n    let xY = 0;\n    for (let i = 0; i < n; i++) {\n      xSum += y2[i];\n      ySum += y[i];\n      xSquared += y2[i] * y2[i];\n      ySquared += y[i] * y[i];\n      xY += y2[i] * y[i];\n      if (y[i] !== 0) {\n        chi2 += ((y[i] - y2[i]) * (y[i] - y2[i])) / y[i];\n      }\n      rmsd += (y[i] - y2[i]) * (y[i] - y2[i]);\n    }\n\n    const r =\n      (n * xY - xSum * ySum) /\n      Math.sqrt((n * xSquared - xSum * xSum) * (n * ySquared - ySum * ySum));\n\n    return {\n      r: r,\n      r2: r * r,\n      chi2: chi2,\n      rmsd: Math.sqrt(rmsd / n),\n    };\n  }\n}\n","import { Matrix, MatrixTransposeView, solve } from 'ml-matrix';\nimport BaseRegression, {\n  checkArrayLength,\n  maybeToPrecision,\n} from 'ml-regression-base';\n\nexport default class PolynomialRegression extends BaseRegression {\n  constructor(x, y, degree) {\n    super();\n    if (x === true) {\n      this.degree = y.degree;\n      this.powers = y.powers;\n      this.coefficients = y.coefficients;\n    } else {\n      checkArrayLength(x, y);\n      regress(this, x, y, degree);\n    }\n  }\n\n  _predict(x) {\n    let y = 0;\n    for (let k = 0; k < this.powers.length; k++) {\n      y += this.coefficients[k] * Math.pow(x, this.powers[k]);\n    }\n    return y;\n  }\n\n  toJSON() {\n    return {\n      name: 'polynomialRegression',\n      degree: this.degree,\n      powers: this.powers,\n      coefficients: this.coefficients,\n    };\n  }\n\n  toString(precision) {\n    return this._toFormula(precision, false);\n  }\n\n  toLaTeX(precision) {\n    return this._toFormula(precision, true);\n  }\n\n  _toFormula(precision, isLaTeX) {\n    let sup = '^';\n    let closeSup = '';\n    let times = ' * ';\n    if (isLaTeX) {\n      sup = '^{';\n      closeSup = '}';\n      times = '';\n    }\n\n    let fn = '';\n    let str = '';\n    for (let k = 0; k < this.coefficients.length; k++) {\n      str = '';\n      if (this.coefficients[k] !== 0) {\n        if (this.powers[k] === 0) {\n          str = maybeToPrecision(this.coefficients[k], precision);\n        } else {\n          if (this.powers[k] === 1) {\n            str = `${maybeToPrecision(this.coefficients[k], precision) +\n              times}x`;\n          } else {\n            str = `${maybeToPrecision(this.coefficients[k], precision) +\n              times}x${sup}${this.powers[k]}${closeSup}`;\n          }\n        }\n\n        if (this.coefficients[k] > 0 && k !== this.coefficients.length - 1) {\n          str = ` + ${str}`;\n        } else if (k !== this.coefficients.length - 1) {\n          str = ` ${str}`;\n        }\n      }\n      fn = str + fn;\n    }\n    if (fn.charAt(0) === '+') {\n      fn = fn.slice(1);\n    }\n\n    return `f(x) = ${fn}`;\n  }\n\n  static load(json) {\n    if (json.name !== 'polynomialRegression') {\n      throw new TypeError('not a polynomial regression model');\n    }\n    return new PolynomialRegression(true, json);\n  }\n}\n\nfunction regress(pr, x, y, degree) {\n  const n = x.length;\n  let powers;\n  if (Array.isArray(degree)) {\n    powers = degree;\n    degree = powers.length;\n  } else {\n    degree++;\n    powers = new Array(degree);\n    for (let k = 0; k < degree; k++) {\n      powers[k] = k;\n    }\n  }\n  const F = new Matrix(n, degree);\n  const Y = new Matrix([y]);\n  for (let k = 0; k < degree; k++) {\n    for (let i = 0; i < n; i++) {\n      if (powers[k] === 0) {\n        F.set(i, k, 1);\n      } else {\n        F.set(i, k, Math.pow(x[i], powers[k]));\n      }\n    }\n  }\n\n  const FT = new MatrixTransposeView(F);\n  const A = FT.mmul(F);\n  const B = FT.mmul(new MatrixTransposeView(Y));\n\n  pr.degree = degree - 1;\n  pr.powers = powers;\n  pr.coefficients = solve(A, B).to1DArray();\n}\n","import isAnyArray from 'is-any-array';\n\nexport default function checkArraySize(x, y) {\n  if (!isAnyArray(x) || !isAnyArray(y)) {\n    throw new TypeError('x and y must be arrays');\n  }\n  if (x.length !== y.length) {\n    throw new RangeError('x and y arrays must have the same length');\n  }\n}\n","import PolynomialRegression from 'ml-regression-polynomial';\r\n\r\n/**\r\n * Iterative regression-based baseline correction\r\n * @param {Array<number>} x - Independent axis variable\r\n * @param {Array<number>} y - Dependent axis variable\r\n * @param {object} [options] - Options object\r\n * @param {number} [options.maxIterations = 100] - Maximum number of allowed iterations\r\n * @param {function} [options.Regression = PolynomialRegression] - Regression class with a predict method\r\n * @param {*} [options.regressionOptions] - Options for regressionFunction\r\n * @param {number} [options.tolerance = 0.001] - Convergence error tolerance\r\n * @return {{corrected: Array<number>, delta: number, iteration: number, baseline: Array<number>}}\r\n */\r\nexport default function baselineCorrectionRegression(x, y, options = {}) {\r\n  let {\r\n    maxIterations = 100,\r\n    Regression = PolynomialRegression,\r\n    regressionOptions,\r\n    tolerance = 0.001,\r\n  } = options;\r\n\r\n  if (!regressionOptions && Regression === PolynomialRegression) {\r\n    regressionOptions = 3;\r\n  }\r\n\r\n  let baseline = y.slice();\r\n  let fitting = y.slice();\r\n  let oldFitting = y;\r\n  let iteration = 0;\r\n  let delta;\r\n  let regression;\r\n  while (iteration < maxIterations) {\r\n    // Calculate the fitting result\r\n    regression = new Regression(x, baseline, regressionOptions);\r\n\r\n    delta = 0;\r\n    for (let i = 0; i < baseline.length; i++) {\r\n      fitting[i] = regression.predict(x[i]);\r\n      if (baseline[i] > fitting[i]) {\r\n        baseline[i] = fitting[i];\r\n      }\r\n\r\n      delta += Math.abs((fitting[i] - oldFitting[i]) / oldFitting[i]);\r\n    }\r\n\r\n    // Stop criterion\r\n    if (delta < tolerance) {\r\n      break;\r\n    } else {\r\n      oldFitting = fitting.slice();\r\n      iteration++;\r\n    }\r\n  }\r\n\r\n  // removes baseline\r\n  let corrected = new Array(baseline.length);\r\n  for (let j = 0; j < baseline.length; j++) {\r\n    corrected[j] = y[j] - baseline[j];\r\n  }\r\n\r\n  return {\r\n    corrected,\r\n    delta,\r\n    iteration,\r\n    baseline,\r\n    regression: regression,\r\n  };\r\n}\r\n","import sequentialFill from 'ml-array-sequential-fill';\nimport baselineCorrection from 'ml-baseline-correction-regression';\n\n/**\n * Iterative polynomial fitting [1]\n *\n * Implementation based on ml-baseline-correction-regression\n *\n * References:\n * [1] Gan, F.; Ruan, G.; Mo, J.\n * Baseline Correction by Improved Iterative Polynomial Fitting with Automatic Threshold.\n *  Chemometrics and Intelligent Laboratory Systems 2006, 82 (1), 5965.\n * https://doi.org/10.1016/j.chemolab.2005.08.009.\n * @export\n * @param {Array<number>} ys\n * @param {object} [options] - Options object\n * @param {Array<number>} [options.x] Optional, Independent axis variable. If not specified, we use a linear grid\n * @param {Object} [options.regression]\n * @param {number} [options.regression.maxIterations = 100] - Maximum number of allowed iterations\n * @param {Object} [options.regression]\n * @param {function} [options.regression.Regression = PolynomialRegression] - Regression class with a predict method\n * @param {Object} [options.regression.regressionOptions] - Options for regressionFunction\n * @param {number} [options.regression.tolerance = 0.001] - Convergence error tolerance\n * @returns {BaselineOutput}\n */\nexport function iterativePolynomialBaseline(ys, options = {}) {\n  const numberPoints = ys.length;\n  let { x, regressionOptions } = options;\n  if (!x) {\n    x = sequentialFill({ from: 0, to: numberPoints - 1, size: numberPoints });\n  }\n\n  let output = baselineCorrection(x, ys, regressionOptions);\n\n  return { baseline: output.baseline, correctedSpectrum: output.corrected };\n}\n","import isArray from 'is-any-array';\n\n/**\n * Checks if input is valdi\n * @param {Array<number>} input\n\n */\nexport function xCheck(input) {\n  if (!isArray(input)) {\n    throw new TypeError('input must be an array');\n  }\n\n  if (input.length === 0) {\n    throw new TypeError('input must not be empty');\n  }\n}\n\nexport function xCheckLengths(array1, array2) {\n  if (array1.length !== array2.length) {\n    throw new TypeError('Length of array1 and array2 must be identical');\n  }\n}\n","import { xCheck } from './xCheck';\n\n/**\n * This function pads an array\n * @param {Array} array - the array that will be padded\n * @param {object} [options={}]\n * @param {string} [options.algorithm=''] '', value, circular, duplicate\n * @param {number} [options.size=0] padding size before first element and after last element\n * @param {number} [options.value=0] value to use for padding (if algorithm='value')\n * @return {Array}\n */\nexport function xPadding(array, options = {}) {\n  const { size = 0, value = 0, algorithm = '' } = options;\n  xCheck(array);\n\n  if (!algorithm) {\n    if (array instanceof Float64Array) {\n      return array.slice();\n    } else {\n      return Float64Array.from(array);\n    }\n  }\n\n  let result = new Float64Array(array.length + size * 2);\n\n  for (let i = 0; i < array.length; i++) {\n    result[i + size] = array[i];\n  }\n\n  let fromEnd = size + array.length;\n  let toEnd = 2 * size + array.length;\n\n  switch (algorithm.toLowerCase()) {\n    case 'value':\n      for (let i = 0; i < size; i++) {\n        result[i] = value;\n      }\n      for (let i = fromEnd; i < toEnd; i++) {\n        result[i] = value;\n      }\n      break;\n    case 'duplicate':\n      for (let i = 0; i < size; i++) {\n        result[i] = array[0];\n      }\n      for (let i = fromEnd; i < toEnd; i++) {\n        result[i] = array[array.length - 1];\n      }\n      break;\n    case 'circular':\n      for (let i = 0; i < size; i++) {\n        result[i] =\n          array[(array.length - (size % array.length) + i) % array.length];\n      }\n      for (let i = 0; i < size; i++) {\n        result[i + fromEnd] = array[i % array.length];\n      }\n      break;\n    default:\n      throw Error('xPadding: unknown algorithm');\n  }\n\n  return result;\n}\n","import { xCheck } from './xCheck';\nimport { xPadding } from './xPadding';\n/**\n * This function calculates a rolling average\n * @param {Array<Number>} array - the array that will be rotated\n * @param {function} fct callback function that from an array returns a value.\n * @param {object} [options={}]\n * @param {number} [options.window=5] rolling window\n * @param {string} [options.padding.size=0] none, value, circular, duplicate\n * @param {string} [options.padding.algorithm='value'] none, value, circular, duplicate\n * @param {number} [options.padding.value=0] value to use for padding (if algorithm='value')\n * @return {Array<Number>}\n */\nexport function xRolling(array, fct, options = {}) {\n  xCheck(array);\n  if (typeof fct !== 'function') throw Error('fct has to be a function');\n\n  const { window = 5, padding = {} } = options;\n  const { size = window - 1, algorithm, value } = padding;\n\n  array = xPadding(array, { size, algorithm, value }); // ensure we get a copy and it is float64\n\n  const newArray = [];\n  for (let i = 0; i < array.length - window + 1; i++) {\n    let subArray = new Float64Array(array.buffer, i * 8, window);\n    // we will send a view to the original buffer\n    newArray.push(fct(subArray));\n  }\n\n  return newArray;\n}\n","import mean from 'ml-array-mean';\n\nimport { xRolling } from './xRolling';\n\n/**\n * This function calculates a rolling average\n * @param {Array<Number>} array - the array that will be rotated\n * @param {object} [options={}]\n * @param {number} [options.window=5] rolling window\n * @param {string} [options.padding.size=window-1] none, value, circular, duplicate\n * @param {string} [options.padding.algorithm=''] none, value, circular, duplicate\n * @param {number} [options.padding.value=0] value to use for padding (if algorithm='value')\n * @return {Array<Number>}\n */\nexport function xRollingAverage(array, options = {}) {\n  return xRolling(array, mean, options);\n}\n","import median from 'ml-array-median';\n\nimport { xRolling } from './xRolling';\n\n/**\n * This function calculates a rolling average\n * @param {Array<Number>} array - the array that will be rotated\n * @param {object} [options={}]\n * @param {number} [options.window=5] rolling window\n * @param {string} [options.padding.size=window-1] none, value, circular, duplicate\n * @param {string} [options.padding.algorithm=''] none, value, circular, duplicate\n * @param {number} [options.padding.value=0] value to use for padding (if algorithm='value')\n * @return {Array<Number>}\n */\nexport function xRollingMedian(array, options = {}) {\n  return xRolling(array, median, options);\n}\n","import { xRollingAverage } from 'ml-spectra-processing';\n\n/**\n\n *\n * @export\n * @param {Array<number>} ys\n * @param {Object} [options={}]\n * @param {number} [options.window] rolling window size, defaults to 10% of the length of the spectrum\n * @param {string} [options.padding.size=window-1] none, value, circular, duplicate\n * @param {string} [options.padding.algorithm='duplicate'] none, value, circular, duplicate\n * @param {number} [options.padding.value=0] value to use for padding (if algorithm='value')\n * @returns {BaselineOutput}\n */\nexport function rollingAverageBaseline(ys, options = {}) {\n  let window = Math.max(Math.round(ys.length * 0.1), 2);\n  let defaults = {\n    window: window,\n    padding: {\n      size: window - 1,\n      algorithm: 'duplicate',\n      value: 0,\n    },\n  };\n  let actualOptions = Object.assign({}, defaults, options);\n  let baseline = xRollingAverage(ys, actualOptions);\n  let corrected = new Float64Array(ys.length);\n  for (let i = 0; i < corrected.length; i++) {\n    corrected[i] = ys[i] - baseline[i];\n  }\n\n  return { baseline: baseline, correctedSpectrum: corrected };\n}\n","import isAnyArray from 'is-any-array';\nimport max from 'ml-array-max';\nimport mean from 'ml-array-mean';\nimport min from 'ml-array-min';\n\n/**\n * Rolling ball baseline correction algorithm.\n * From the abstract of (1):\n * \"This algorithm behaves equivalently to traditional polynomial backgrounds in simple spectra,\n * [...] and is considerably more robust for multiple overlapping peaks, rapidly varying background [...]\n *\n * The baseline is the trace one gets by rolling a ball below a spectrum. Algorithm has three steps:\n * Finding the minima in each window, find maxima among minima and then smooth over them by averaging.\n *\n * Reference:\n * (1) Kneen, M. A.; Annegarn, H. J.\n *     Algorithm for Fitting XRF, SEM and PIXE X-Ray Spectra Backgrounds.\n *     Nuclear Instruments and Methods in Physics Research Section B: Beam Interactions with Materials and Atoms 1996, 109110, 209213.\n *     https://doi.org/10.1016/0168-583X(95)00908-6.\n * (2) Kristian Hovde Liland, Bjrn-Helge Mevik, Roberto Canteri: baseline.\n *     https://cran.r-project.org/web/packages/baseline/index.html\n * @export\n * @param {Array} spectrum\n * @param {Object} [options={}]\n * @param {Number} [options.windowM] - width of local window for minimization/maximization, defaults to 4% of the spectrum length\n * @param {Number} [options.windowS] - width of local window for smoothing, defaults to 8% of the specturm length\n */\nexport function rollingBall(spectrum, options = {}) {\n  if (!isAnyArray(spectrum)) {\n    throw new Error('Spectrum must be an array');\n  }\n\n  if (spectrum.length === 0) {\n    throw new TypeError('Spectrum must not be empty');\n  }\n\n  const numberPoints = spectrum.length;\n  const maxima = new Float64Array(numberPoints);\n  const minima = new Float64Array(numberPoints);\n  const baseline = new Float64Array(numberPoints);\n\n  // windowM 4 percent of spectrum length\n  // windowS 8 percent of spectrum length\n  const {\n    windowM = Math.round(numberPoints * 0.04),\n    windowS = Math.round(numberPoints * 0.08),\n  } = options;\n\n  // fi(1) in original paper\n  for (let i = 0; i < spectrum.length; i++) {\n    let windowLeft = max([0, i - windowM]);\n    let windowRight = min([i + windowM + 1, spectrum.length]);\n    minima[i] = min(spectrum.slice(windowLeft, windowRight));\n  }\n\n  // fi in original paper\n  for (let i = 0; i < minima.length; i++) {\n    let windowLeft = max([0, i - windowM]);\n    let windowRight = min([i + windowM + 1, minima.length]);\n    maxima[i] = max(minima.slice(windowLeft, windowRight));\n  }\n\n  for (let i = 0; i < minima.length; i++) {\n    let windowLeft = max([0, i - windowS]);\n    let windowRight = min([i + windowS + 1, maxima.length]);\n    baseline[i] = mean(maxima.slice(windowLeft, windowRight));\n  }\n\n  return baseline;\n}\n","import { rollingBall } from 'ml-rolling-ball-baseline';\n\n/**\n * Rolling ball baseline correction algorithm.\n * From the abstract of (1):\n * \"This algorithm behaves equivalently to traditional polynomial backgrounds in simple spectra,\n * [...] and is considerably more robust for multiple overlapping peaks, rapidly varying background [...]\n *\n * The baseline is the trace one gets by rolling a ball below a spectrum. Algorithm has three steps:\n * Finding the minima in each window, find maxima among minima and then smooth over them by averaging.\n *\n * Algorithm described in (1), but in the implementation here the window width does not change.\n *\n * Reference:\n * (1) Kneen, M. A.; Annegarn, H. J.\n *     Algorithm for Fitting XRF, SEM and PIXE X-Ray Spectra Backgrounds.\n *     Nuclear Instruments and Methods in Physics Research Section B: Beam Interactions with Materials and Atoms 1996, 109110, 209213.\n *     https://doi.org/10.1016/0168-583X(95)00908-6.\n * (2) Kristian Hovde Liland, Bjrn-Helge Mevik, Roberto Canteri: baseline.\n *     https://cran.r-project.org/web/packages/baseline/index.html\n *\n * @export\n * @param {Array<number>} ys\n * @param {Object} [options={}]\n * @param {Number} [options.windowM] - width of local window for minimization/maximization, defaults to 4% of the spectrum length\n * @param {Number} [options.windowS] - width of local window for smoothing, defaults to 8% of the specturm length\n * @returns {BaselineOutput}\n */\nexport function rollingBallBaseline(ys, options = {}) {\n  const baseline = rollingBall(ys, options);\n  let corrected = new Float64Array(ys.length);\n  for (let i = 0; i < corrected.length; i++) {\n    corrected[i] = ys[i] - baseline[i];\n  }\n\n  return { baseline: baseline, correctedSpectrum: corrected };\n}\n","import { xRollingMedian } from 'ml-spectra-processing';\n\n/**\n\n *\n * @export\n * @param {Array<number>} ys\n * @param {Object} [options={}]\n * @param {number} [options.window] rolling window size, defaults to 10% of the length of the spectrum\n * @param {string} [options.padding.size=window-1] none, value, circular, duplicate\n * @param {string} [options.padding.algorithm='duplicate'] none, value, circular, duplicate\n * @param {number} [options.padding.value=0] value to use for padding (if algorithm='value')\n * @returns {BaselineOutput}\n */\nexport function rollingMedianBaseline(ys, options = {}) {\n  let window = Math.max(Math.round(ys.length * 0.1), 2);\n  let defaults = {\n    window: window,\n    padding: {\n      size: window - 1,\n      algorithm: 'duplicate',\n      value: 0,\n    },\n  };\n  let actualOptions = Object.assign({}, defaults, options);\n  let baseline = xRollingMedian(ys, actualOptions);\n  let corrected = new Float64Array(ys.length);\n  for (let i = 0; i < corrected.length; i++) {\n    corrected[i] = ys[i] - baseline[i];\n  }\n\n  return { baseline: baseline, correctedSpectrum: corrected };\n}\n","import isArray from 'is-any-array';\nimport max from 'ml-array-max';\nimport sum from 'ml-array-sum';\n\nfunction norm(input) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var _options$algorithm = options.algorithm,\n      algorithm = _options$algorithm === void 0 ? 'absolute' : _options$algorithm,\n      _options$sumValue = options.sumValue,\n      sumValue = _options$sumValue === void 0 ? 1 : _options$sumValue,\n      _options$maxValue = options.maxValue,\n      maxValue = _options$maxValue === void 0 ? 1 : _options$maxValue;\n\n  if (!isArray(input)) {\n    throw new Error('input must be an array');\n  }\n\n  var output;\n\n  if (options.output !== undefined) {\n    if (!isArray(options.output)) {\n      throw new TypeError('output option must be an array if specified');\n    }\n\n    output = options.output;\n  } else {\n    output = new Array(input.length);\n  }\n\n  if (input.length === 0) {\n    throw new Error('input must not be empty');\n  }\n\n  switch (algorithm.toLowerCase()) {\n    case 'absolute':\n      {\n        var absoluteSumValue = absoluteSum(input) / sumValue;\n        if (absoluteSumValue === 0) return input.slice(0);\n\n        for (var i = 0; i < input.length; i++) {\n          output[i] = input[i] / absoluteSumValue;\n        }\n\n        return output;\n      }\n\n    case 'max':\n      {\n        var currentMaxValue = max(input);\n        if (currentMaxValue === 0) return input.slice(0);\n        var factor = maxValue / currentMaxValue;\n\n        for (var _i = 0; _i < input.length; _i++) {\n          output[_i] = input[_i] * factor;\n        }\n\n        return output;\n      }\n\n    case 'sum':\n      {\n        var sumFactor = sum(input) / sumValue;\n        if (sumFactor === 0) return input.slice(0);\n\n        for (var _i2 = 0; _i2 < input.length; _i2++) {\n          output[_i2] = input[_i2] / sumFactor;\n        }\n\n        return output;\n      }\n\n    default:\n      throw new Error(\"norm: unknown algorithm: \".concat(algorithm));\n  }\n}\n\nfunction absoluteSum(input) {\n  var sumValue = 0;\n\n  for (var i = 0; i < input.length; i++) {\n    sumValue += Math.abs(input[i]);\n  }\n\n  return sumValue;\n}\n\nexport default norm;\n","/**\n * Normalize an array of zones:\n * - ensure than from < to\n * - merge overlapping zones\n *\n * The method will always check if from if lower than to and will swap if required.\n * @param {Array} [zones=[]]\n * @param {object} [options={}]\n * @param {number} [options.from=Number.NEGATIVE_INFINITY] Specify min value of a zone\n * @param {number} [options.to=Number.POSITIVE_INFINITY] Specify max value of a zone\n */\n\nexport function normalize(zones = [], options = {}) {\n  if (zones.length === 0) return [];\n  let {\n    from = Number.NEGATIVE_INFINITY,\n    to = Number.POSITIVE_INFINITY,\n  } = options;\n  if (from > to) [from, to] = [to, from];\n\n  zones = JSON.parse(JSON.stringify(zones)).map((zone) =>\n    zone.from > zone.to ? { from: zone.to, to: zone.from } : zone,\n  );\n  zones = zones.sort((a, b) => {\n    if (a.from !== b.from) return a.from - b.from;\n    return a.to - b.to;\n  });\n\n  zones.forEach((zone) => {\n    if (from > zone.from) zone.from = from;\n    if (to < zone.to) zone.to = to;\n  });\n\n  zones = zones.filter((zone) => zone.from <= zone.to);\n  if (zones.length === 0) return [];\n\n  let currentZone = zones[0];\n  let result = [currentZone];\n  for (let i = 1; i < zones.length; i++) {\n    let zone = zones[i];\n    if (zone.from <= currentZone.to) {\n      currentZone.to = zone.to;\n    } else {\n      currentZone = zone;\n      result.push(currentZone);\n    }\n  }\n  return result;\n}\n","import { normalize } from './normalize';\n\n/**\n * Convert an array of exclusions and keep only from / to\n *\n * The method will always check if from if lower than to and will swap if required.\n * @param {Array} [exclusions=[]]\n * @param {object} [options={}]\n * @param {number} [options.from=Number.NEGATIVE_INFINITY] Specify min value of zones (after inversion)\n * @param {number} [options.to=Number.POSITIVE_INFINITY] Specify max value of zones (after inversion)\n */\n\nexport function invert(exclusions = [], options = {}) {\n  let {\n    from = Number.NEGATIVE_INFINITY,\n    to = Number.POSITIVE_INFINITY,\n  } = options;\n  if (from > to) [from, to] = [to, from];\n\n  exclusions = normalize(exclusions, { from, to });\n  if (exclusions.length === 0) return [{ from, to }];\n\n  let zones = [];\n  for (let i = 0; i < exclusions.length; i++) {\n    let exclusion = exclusions[i];\n    let nextExclusion = exclusions[i + 1];\n    if (i === 0) {\n      if (exclusion.from > from) {\n        zones.push({ from, to: exclusion.from });\n      }\n    }\n    if (i === exclusions.length - 1) {\n      if (exclusion.to < to) {\n        zones.push({ from: exclusion.to, to });\n      }\n    } else {\n      zones.push({ from: exclusion.to, to: nextExclusion.from });\n    }\n  }\n\n  return zones;\n}\n","import { normalize } from './normalize';\n\n/**\n * Add the number of points per zone to reach a specified total\n * @param {Array} [zones=[]]\n * @param {number} [numberOfPoints] Total number of points to distribute between zones\n * @param {object} [options={}]\n * @param {number} [options.from=Number.NEGATIVE_INFINITY] Specify min value of a zone\n * @param {number} [options.to=Number.POSITIVE_INFINITY] Specify max value of a zone\n */\n\nexport function zonesWithPoints(zones, numberOfPoints, options = {}) {\n  if (zones.length === 0) return zones;\n  zones = normalize(zones, options);\n\n  const totalSize = zones.reduce((previous, current) => {\n    return previous + (current.to - current.from);\n  }, 0);\n\n  let unitsPerPoint = totalSize / numberOfPoints;\n  let currentTotal = 0;\n  for (let i = 0; i < zones.length - 1; i++) {\n    let zone = zones[i];\n    zone.numberOfPoints = Math.min(\n      Math.round((zone.to - zone.from) / unitsPerPoint),\n      numberOfPoints - currentTotal,\n    );\n    currentTotal += zone.numberOfPoints;\n  }\n\n  zones[zones.length - 1].numberOfPoints = numberOfPoints - currentTotal;\n\n  return zones;\n}\n","/**\n * Function that calculates the integral of the line between two\n * x-coordinates, given the slope and intercept of the line.\n * @param {number} x0\n * @param {number} x1\n * @param {number} slope\n * @param {number} intercept\n * @return {number} integral value.\n */\nexport default function integral(x0, x1, slope, intercept) {\n  return (\n    0.5 * slope * x1 * x1 +\n    intercept * x1 -\n    (0.5 * slope * x0 * x0 + intercept * x0)\n  );\n}\n","import sequentialFill from 'ml-array-sequential-fill';\nimport { zonesWithPoints, invert } from 'ml-zones';\n\nimport equallySpacedSlot from './equallySpacedSlot';\nimport equallySpacedSmooth from './equallySpacedSmooth';\n\n/**\n * Function that returns a Number array of equally spaced numberOfPoints\n * containing a representation of intensities of the spectra arguments x\n * and y.\n *\n * The options parameter contains an object in the following form:\n * from: starting point\n * to: last point\n * numberOfPoints: number of points between from and to\n * variant: \"slot\" or \"smooth\" - smooth is the default option\n *\n * The slot variant consist that each point in the new array is calculated\n * averaging the existing points between the slot that belongs to the current\n * value. The smooth variant is the same but takes the integral of the range\n * of the slot and divide by the step size between two points in the new array.\n *\n * If exclusions zone are present, zones are ignored !\n * @param {object} [arrayXY={}] - object containing 2 properties x and y (both an array)\n * @param {object} [options={}]\n * @param {number} [options.from=x[0]]\n * @param {number} [options.to=x[x.length-1]]\n * @param {string} [options.variant='smooth']\n * @param {number} [options.numberOfPoints=100]\n * @param {Array} [options.exclusions=[]] array of from / to that should be skipped for the generation of the points\n * @param {Array} [options.zones=[]] array of from / to that should be kept\n * @return {object<x: Array, y:Array>} new object with x / y array with the equally spaced data.\n */\n\nexport default function equallySpaced(arrayXY = {}, options = {}) {\n  let { x, y } = arrayXY;\n  let xLength = x.length;\n  let reverse = false;\n  if (x.length > 1 && x[0] > x[1]) {\n    x = x.slice().reverse();\n    y = y.slice().reverse();\n    reverse = true;\n  }\n\n  let {\n    from = x[0],\n    to = x[xLength - 1],\n    variant = 'smooth',\n    numberOfPoints = 100,\n    exclusions = [],\n    zones = [],\n  } = options;\n\n  if (xLength !== y.length) {\n    throw new RangeError(\"the x and y vector doesn't have the same size.\");\n  }\n\n  if (typeof from !== 'number' || isNaN(from)) {\n    throw new RangeError(\"'from' option must be a number\");\n  }\n\n  if (typeof to !== 'number' || isNaN(to)) {\n    throw new RangeError(\"'to' option must be a number\");\n  }\n\n  if (typeof numberOfPoints !== 'number' || isNaN(numberOfPoints)) {\n    throw new RangeError(\"'numberOfPoints' option must be a number\");\n  }\n\n  if (numberOfPoints < 2) {\n    throw new RangeError(\"'numberOfPoints' option must be greater than 1\");\n  }\n\n  if (zones.length === 0) {\n    zones = invert(exclusions, { from, to });\n  }\n\n  zones = zonesWithPoints(zones, numberOfPoints, { from, to });\n\n  let xResult = [];\n  let yResult = [];\n  for (let zone of zones) {\n    let zoneResult = processZone(\n      x,\n      y,\n      zone.from,\n      zone.to,\n      zone.numberOfPoints,\n      variant,\n      reverse,\n    );\n\n    xResult = xResult.concat(zoneResult.x);\n    yResult = yResult.concat(zoneResult.y);\n  }\n  if (reverse) {\n    if (from < to) {\n      return { x: xResult.reverse(), y: yResult.reverse() };\n    } else {\n      return { x: xResult, y: yResult };\n    }\n  } else {\n    if (from < to) {\n      return { x: xResult, y: yResult };\n    } else {\n      return { x: xResult.reverse(), y: yResult.reverse() };\n    }\n  }\n}\n\nfunction processZone(x, y, from, to, numberOfPoints, variant) {\n  if (numberOfPoints < 1) {\n    throw new RangeError('the number of points must be at least 1');\n  }\n  let output =\n    variant === 'slot'\n      ? equallySpacedSlot(x, y, from, to, numberOfPoints)\n      : equallySpacedSmooth(x, y, from, to, numberOfPoints);\n\n  return {\n    x: sequentialFill({\n      from,\n      to,\n      size: numberOfPoints,\n    }),\n    y: output,\n  };\n}\n","/**\n * function that retrieves the getEquallySpacedData with the variant \"slot\"\n *\n * @param {Array<number>} x\n * @param {Array<number>} y\n * @param {number} from - Initial point\n * @param {number} to - Final point\n * @param {number} numberOfPoints\n * @return {Array} - Array of y's equally spaced with the variant \"slot\"\n */\nexport default function equallySpacedSlot(x, y, from, to, numberOfPoints) {\n  let xLength = x.length;\n\n  let step = (to - from) / (numberOfPoints > 1 ? numberOfPoints - 1 : 1);\n  let halfStep = step / 2;\n  let lastStep = x[x.length - 1] - x[x.length - 2];\n\n  let start = from - halfStep;\n  let output = new Array(numberOfPoints);\n\n  // Init main variables\n  let min = start;\n  let max = start + step;\n\n  let previousX = -Number.MAX_VALUE;\n  let previousY = 0;\n  let nextX = x[0];\n  let nextY = y[0];\n  let frontOutsideSpectra = 0;\n  let backOutsideSpectra = true;\n\n  let currentValue = 0;\n\n  // for slot algorithm\n  let currentPoints = 0;\n\n  let i = 1; // index of input\n  let j = 0; // index of output\n\n  main: while (true) {\n    if (previousX >= nextX) throw new Error('x must be a growing series');\n    while (previousX - max > 0) {\n      // no overlap with original point, just consume current value\n      if (backOutsideSpectra) {\n        currentPoints++;\n        backOutsideSpectra = false;\n      }\n\n      output[j] = currentPoints <= 0 ? 0 : currentValue / currentPoints;\n      j++;\n\n      if (j === numberOfPoints) {\n        break main;\n      }\n\n      min = max;\n      max += step;\n      currentValue = 0;\n      currentPoints = 0;\n    }\n\n    if (previousX > min) {\n      currentValue += previousY;\n      currentPoints++;\n    }\n\n    if (previousX === -Number.MAX_VALUE || frontOutsideSpectra > 1) {\n      currentPoints--;\n    }\n\n    previousX = nextX;\n    previousY = nextY;\n\n    if (i < xLength) {\n      nextX = x[i];\n      nextY = y[i];\n      i++;\n    } else {\n      nextX += lastStep;\n      nextY = 0;\n      frontOutsideSpectra++;\n    }\n  }\n\n  return output;\n}\n","import integral from './integral';\n\n/**\n * function that retrieves the getEquallySpacedData with the variant \"smooth\"\n *\n * @param {Array<number>} x\n * @param {Array<number>} y\n * @param {number} from - Initial point\n * @param {number} to - Final point\n * @param {number} numberOfPoints\n * @return {Array} - Array of y's equally spaced with the variant \"smooth\"\n */\nexport default function equallySpacedSmooth(x, y, from, to, numberOfPoints) {\n  let xLength = x.length;\n\n  let step = (to - from) / (numberOfPoints > 1 ? numberOfPoints - 1 : 1);\n  let halfStep = step / 2;\n\n  let output = new Array(numberOfPoints);\n\n  let initialOriginalStep = x[1] - x[0];\n  let lastOriginalStep = x[xLength - 1] - x[xLength - 2];\n\n  // Init main variables\n  let min = from - halfStep;\n  let max = from + halfStep;\n\n  let previousX = Number.MIN_SAFE_INTEGER;\n  let previousY = 0;\n  let nextX = x[0] - initialOriginalStep;\n  let nextY = 0;\n\n  let currentValue = 0;\n  let slope = 0;\n  let intercept = 0;\n  let sumAtMin = 0;\n  let sumAtMax = 0;\n\n  let i = 0; // index of input\n  let j = 0; // index of output\n\n  function getSlope(x0, y0, x1, y1) {\n    return (y1 - y0) / (x1 - x0);\n  }\n\n  let add = 0;\n  main: while (true) {\n    if (previousX >= nextX) throw new Error('x must be a growing series');\n    if (previousX <= min && min <= nextX) {\n      add = integral(0, min - previousX, slope, previousY);\n      sumAtMin = currentValue + add;\n    }\n    while (nextX - max >= 0) {\n      // no overlap with original point, just consume current value\n      add = integral(0, max - previousX, slope, previousY);\n      sumAtMax = currentValue + add;\n\n      output[j++] = (sumAtMax - sumAtMin) / step;\n\n      if (j === numberOfPoints) {\n        break main;\n      }\n\n      min = max;\n      max += step;\n      sumAtMin = sumAtMax;\n    }\n\n    currentValue += integral(previousX, nextX, slope, intercept);\n\n    previousX = nextX;\n    previousY = nextY;\n\n    if (i < xLength) {\n      nextX = x[i];\n      nextY = y[i];\n      i++;\n    } else if (i === xLength) {\n      nextX += lastOriginalStep;\n      nextY = 0;\n    }\n\n    slope = getSlope(previousX, previousY, nextX, nextY);\n    intercept = -slope * previousX + previousY;\n  }\n\n  return output;\n}\n","export default function getZones(from, to, exclusions = []) {\n  if (from > to) {\n    [from, to] = [to, from];\n  }\n\n  // in exclusions from and to have to be defined\n  exclusions = exclusions.filter(\n    (exclusion) => exclusion.from !== undefined && exclusion.to !== undefined,\n  );\n\n  exclusions = JSON.parse(JSON.stringify(exclusions));\n  // we ensure that from before to\n  exclusions.forEach((exclusion) => {\n    if (exclusion.from > exclusion.to) {\n      [exclusion.to, exclusion.from] = [exclusion.from, exclusion.to];\n    }\n  });\n\n  exclusions.sort((a, b) => a.from - b.from);\n\n  // we will rework the exclusions in order to remove overlap and outside range (from / to)\n  exclusions.forEach((exclusion) => {\n    if (exclusion.from < from) exclusion.from = from;\n    if (exclusion.to > to) exclusion.to = to;\n  });\n  for (let i = 0; i < exclusions.length - 1; i++) {\n    if (exclusions[i].to > exclusions[i + 1].from) {\n      exclusions[i].to = exclusions[i + 1].from;\n    }\n  }\n  exclusions = exclusions.filter((exclusion) => exclusion.from < exclusion.to);\n\n  if (!exclusions || exclusions.length === 0) {\n    return [{ from, to }];\n  }\n\n  let zones = [];\n  let currentFrom = from;\n  for (let exclusion of exclusions) {\n    if (currentFrom < exclusion.from) {\n      zones.push({\n        from: currentFrom,\n        to: exclusion.from,\n      });\n    }\n\n    currentFrom = exclusion.to;\n  }\n  if (currentFrom < to) {\n    zones.push({\n      from: currentFrom,\n      to: to,\n    });\n  }\n\n  return zones;\n}\n","import getZones from './getZones';\n\n/**\n * Filter an array x/y based on various criteria\n * x points are expected to be sorted\n *\n * @param {object} points\n * @param {object} [options={}]\n * @param {array} [options.from]\n * @param {array} [options.to]\n * @param {array} [options.exclusions=[]]\n * @return {{x: Array<number>, y: Array<number>}}\n */\n\nexport default function filterX(points, options = {}) {\n  const { x, y } = points;\n  const { from = x[0], to = x[x.length - 1], exclusions = [] } = options;\n\n  let zones = getZones(from, to, exclusions);\n\n  let currentZoneIndex = 0;\n  let newX = [];\n  let newY = [];\n  let position = 0;\n  while (position < x.length) {\n    if (\n      x[position] <= zones[currentZoneIndex].to &&\n      x[position] >= zones[currentZoneIndex].from\n    ) {\n      newX.push(x[position]);\n      newY.push(y[position]);\n    } else {\n      if (x[position] > zones[currentZoneIndex].to) {\n        currentZoneIndex++;\n        if (!zones[currentZoneIndex]) break;\n      }\n    }\n    position++;\n  }\n\n  return {\n    x: newX,\n    y: newY,\n  };\n}\n","'use strict';\n\nvar defaultOptions = {\n  size: 1,\n  value: 0\n};\n\n/**\n * Case when the entry is an array\n * @param data\n * @param options\n * @returns {Array}\n */\nfunction arrayCase(data, options) {\n  var len = data.length;\n  if (typeof options.size === 'number') {\n    options.size = [options.size, options.size];\n  }\n\n  var cond = len + options.size[0] + options.size[1];\n\n  var output;\n  if (options.output) {\n    if (options.output.length !== cond) {\n      throw new RangeError('Wrong output size');\n    }\n    output = options.output;\n  } else {\n    output = new Array(cond);\n  }\n\n  var i;\n  if (options.value === 'circular') {\n    for (i = 0; i < cond; i++) {\n      if (i < options.size[0]) {\n        output[i] = data[(len - (options.size[0] % len) + i) % len];\n      } else if (i < options.size[0] + len) {\n        output[i] = data[i - options.size[0]];\n      } else {\n        output[i] = data[(i - options.size[0]) % len];\n      }\n    }\n  } else if (options.value === 'replicate') {\n    for (i = 0; i < cond; i++) {\n      if (i < options.size[0]) output[i] = data[0];\n      else if (i < options.size[0] + len) output[i] = data[i - options.size[0]];\n      else output[i] = data[len - 1];\n    }\n  } else if (options.value === 'symmetric') {\n    if (options.size[0] > len || options.size[1] > len) {\n      throw new RangeError(\n        'expanded value should not be bigger than the data length'\n      );\n    }\n    for (i = 0; i < cond; i++) {\n      if (i < options.size[0]) output[i] = data[options.size[0] - 1 - i];\n      else if (i < options.size[0] + len) output[i] = data[i - options.size[0]];\n      else output[i] = data[2 * len + options.size[0] - i - 1];\n    }\n  } else {\n    for (i = 0; i < cond; i++) {\n      if (i < options.size[0]) output[i] = options.value;\n      else if (i < options.size[0] + len) output[i] = data[i - options.size[0]];\n      else output[i] = options.value;\n    }\n  }\n\n  return output;\n}\n\n/**\n * Case when the entry is a matrix\n * @param data\n * @param options\n * @returns {Array}\n */\nfunction matrixCase(data, options) {\n  // var row = data.length;\n  // var col = data[0].length;\n  if (options.size[0] === undefined) {\n    options.size = [options.size, options.size, options.size, options.size];\n  }\n  throw new Error('matrix not supported yet, sorry');\n}\n\n/**\n * Pads and array\n * @param {Array <number>} data\n * @param {object} options\n */\nfunction padArray(data, options) {\n  options = Object.assign({}, defaultOptions, options);\n  if (Array.isArray(data)) {\n    if (Array.isArray(data[0])) return matrixCase(data, options);\n    else return arrayCase(data, options);\n  } else {\n    throw new TypeError('data should be an array');\n  }\n}\n\nmodule.exports = padArray;\n","import { Matrix, MatrixTransposeView, inverse } from 'ml-matrix';\nimport padArray from 'ml-pad-array';\nfunction factorial(n) {\n    let r = 1;\n    while (n > 0)\n        r *= n--;\n    return r;\n}\nexport default function savitzkyGolay(data, h, options = {}) {\n    const { windowSize = 5, derivative = 1, polynomial = 2, pad = 'none', padValue = 'replicate', } = options;\n    if (windowSize % 2 === 0 || windowSize < 5 || !Number.isInteger(windowSize)) {\n        throw new RangeError('Invalid window size (should be odd and at least 5 integer number)');\n    }\n    if (derivative < 0 || !Number.isInteger(derivative)) {\n        throw new RangeError('Derivative should be a positive integer');\n    }\n    if (polynomial < 1 || !Number.isInteger(polynomial)) {\n        throw new RangeError('Polynomial should be a positive integer');\n    }\n    let C, norm;\n    let step = Math.floor(windowSize / 2);\n    if (pad === 'pre') {\n        data = padArray(data, { size: step, value: padValue });\n    }\n    let ans = new Array(data.length - 2 * step);\n    if (windowSize === 5 &&\n        polynomial === 2 &&\n        (derivative === 1 || derivative === 2)) {\n        if (derivative === 1) {\n            C = [-2, -1, 0, 1, 2];\n            norm = 10;\n        }\n        else {\n            C = [2, -1, -2, -1, 2];\n            norm = 7;\n        }\n    }\n    else {\n        let J = Matrix.ones(windowSize, polynomial + 1);\n        let inic = -(windowSize - 1) / 2;\n        for (let i = 0; i < J.rows; i++) {\n            for (let j = 0; j < J.columns; j++) {\n                if (inic + 1 !== 0 || j !== 0)\n                    J.set(i, j, Math.pow(inic + i, j));\n            }\n        }\n        let Jtranspose = new MatrixTransposeView(J);\n        let Jinv = inverse(Jtranspose.mmul(J));\n        C = Jinv.mmul(Jtranspose);\n        C = C.getRow(derivative);\n        norm = 1 / factorial(derivative);\n    }\n    let det = norm * Math.pow(h, derivative);\n    for (let k = 0; k < data.length - 2 * step; k++) {\n        let d = 0;\n        for (let l = 0; l < C.length; l++)\n            d += (C[l] * data[l + k]) / det;\n        ans[k] = d;\n    }\n    if (pad === 'post') {\n        ans = padArray(ans, { size: step, value: padValue });\n    }\n    return ans;\n}\n//# sourceMappingURL=index.js.map","'use strict';\n\nfunction compareNumbers(a, b) {\n    return a - b;\n}\n\n/**\n * Computes the sum of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.sum = function sum(values) {\n    var sum = 0;\n    for (var i = 0; i < values.length; i++) {\n        sum += values[i];\n    }\n    return sum;\n};\n\n/**\n * Computes the maximum of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.max = function max(values) {\n    var max = values[0];\n    var l = values.length;\n    for (var i = 1; i < l; i++) {\n        if (values[i] > max) max = values[i];\n    }\n    return max;\n};\n\n/**\n * Computes the minimum of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.min = function min(values) {\n    var min = values[0];\n    var l = values.length;\n    for (var i = 1; i < l; i++) {\n        if (values[i] < min) min = values[i];\n    }\n    return min;\n};\n\n/**\n * Computes the min and max of the given values\n * @param {Array} values\n * @returns {{min: number, max: number}}\n */\nexports.minMax = function minMax(values) {\n    var min = values[0];\n    var max = values[0];\n    var l = values.length;\n    for (var i = 1; i < l; i++) {\n        if (values[i] < min) min = values[i];\n        if (values[i] > max) max = values[i];\n    }\n    return {\n        min: min,\n        max: max\n    };\n};\n\n/**\n * Computes the arithmetic mean of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.arithmeticMean = function arithmeticMean(values) {\n    var sum = 0;\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n        sum += values[i];\n    }\n    return sum / l;\n};\n\n/**\n * {@link arithmeticMean}\n */\nexports.mean = exports.arithmeticMean;\n\n/**\n * Computes the geometric mean of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.geometricMean = function geometricMean(values) {\n    var mul = 1;\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n        mul *= values[i];\n    }\n    return Math.pow(mul, 1 / l);\n};\n\n/**\n * Computes the mean of the log of the given values\n * If the return value is exponentiated, it gives the same result as the\n * geometric mean.\n * @param {Array} values\n * @returns {number}\n */\nexports.logMean = function logMean(values) {\n    var lnsum = 0;\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n        lnsum += Math.log(values[i]);\n    }\n    return lnsum / l;\n};\n\n/**\n * Computes the weighted grand mean for a list of means and sample sizes\n * @param {Array} means - Mean values for each set of samples\n * @param {Array} samples - Number of original values for each set of samples\n * @returns {number}\n */\nexports.grandMean = function grandMean(means, samples) {\n    var sum = 0;\n    var n = 0;\n    var l = means.length;\n    for (var i = 0; i < l; i++) {\n        sum += samples[i] * means[i];\n        n += samples[i];\n    }\n    return sum / n;\n};\n\n/**\n * Computes the truncated mean of the given values using a given percentage\n * @param {Array} values\n * @param {number} percent - The percentage of values to keep (range: [0,1])\n * @param {boolean} [alreadySorted=false]\n * @returns {number}\n */\nexports.truncatedMean = function truncatedMean(values, percent, alreadySorted) {\n    if (alreadySorted === undefined) alreadySorted = false;\n    if (!alreadySorted) {\n        values = [].concat(values).sort(compareNumbers);\n    }\n    var l = values.length;\n    var k = Math.floor(l * percent);\n    var sum = 0;\n    for (var i = k; i < (l - k); i++) {\n        sum += values[i];\n    }\n    return sum / (l - 2 * k);\n};\n\n/**\n * Computes the harmonic mean of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.harmonicMean = function harmonicMean(values) {\n    var sum = 0;\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n        if (values[i] === 0) {\n            throw new RangeError('value at index ' + i + 'is zero');\n        }\n        sum += 1 / values[i];\n    }\n    return l / sum;\n};\n\n/**\n * Computes the contraharmonic mean of the given values\n * @param {Array} values\n * @returns {number}\n */\nexports.contraHarmonicMean = function contraHarmonicMean(values) {\n    var r1 = 0;\n    var r2 = 0;\n    var l = values.length;\n    for (var i = 0; i < l; i++) {\n        r1 += values[i] * values[i];\n        r2 += values[i];\n    }\n    if (r2 < 0) {\n        throw new RangeError('sum of values is negative');\n    }\n    return r1 / r2;\n};\n\n/**\n * Computes the median of the given values\n * @param {Array} values\n * @param {boolean} [alreadySorted=false]\n * @returns {number}\n */\nexports.median = function median(values, alreadySorted) {\n    if (alreadySorted === undefined) alreadySorted = false;\n    if (!alreadySorted) {\n        values = [].concat(values).sort(compareNumbers);\n    }\n    var l = values.length;\n    var half = Math.floor(l / 2);\n    if (l % 2 === 0) {\n        return (values[half - 1] + values[half]) * 0.5;\n    } else {\n        return values[half];\n    }\n};\n\n/**\n * Computes the variance of the given values\n * @param {Array} values\n * @param {boolean} [unbiased=true] - if true, divide by (n-1); if false, divide by n.\n * @returns {number}\n */\nexports.variance = function variance(values, unbiased) {\n    if (unbiased === undefined) unbiased = true;\n    var theMean = exports.mean(values);\n    var theVariance = 0;\n    var l = values.length;\n\n    for (var i = 0; i < l; i++) {\n        var x = values[i] - theMean;\n        theVariance += x * x;\n    }\n\n    if (unbiased) {\n        return theVariance / (l - 1);\n    } else {\n        return theVariance / l;\n    }\n};\n\n/**\n * Computes the standard deviation of the given values\n * @param {Array} values\n * @param {boolean} [unbiased=true] - if true, divide by (n-1); if false, divide by n.\n * @returns {number}\n */\nexports.standardDeviation = function standardDeviation(values, unbiased) {\n    return Math.sqrt(exports.variance(values, unbiased));\n};\n\nexports.standardError = function standardError(values) {\n    return exports.standardDeviation(values) / Math.sqrt(values.length);\n};\n\n/**\n * IEEE Transactions on biomedical engineering, vol. 52, no. 1, january 2005, p. 76-\n * Calculate the standard deviation via the Median of the absolute deviation\n *  The formula for the standard deviation only holds for Gaussian random variables.\n * @returns {{mean: number, stdev: number}}\n */\nexports.robustMeanAndStdev = function robustMeanAndStdev(y) {\n    var mean = 0, stdev = 0;\n    var length = y.length, i = 0;\n    for (i = 0; i < length; i++) {\n        mean += y[i];\n    }\n    mean /= length;\n    var averageDeviations = new Array(length);\n    for (i = 0; i < length; i++)\n        averageDeviations[i] = Math.abs(y[i] - mean);\n    averageDeviations.sort(compareNumbers);\n    if (length % 2 === 1) {\n        stdev = averageDeviations[(length - 1) / 2] / 0.6745;\n    } else {\n        stdev = 0.5 * (averageDeviations[length / 2] + averageDeviations[length / 2 - 1]) / 0.6745;\n    }\n\n    return {\n        mean: mean,\n        stdev: stdev\n    };\n};\n\nexports.quartiles = function quartiles(values, alreadySorted) {\n    if (typeof (alreadySorted) === 'undefined') alreadySorted = false;\n    if (!alreadySorted) {\n        values = [].concat(values).sort(compareNumbers);\n    }\n\n    var quart = values.length / 4;\n    var q1 = values[Math.ceil(quart) - 1];\n    var q2 = exports.median(values, true);\n    var q3 = values[Math.ceil(quart * 3) - 1];\n\n    return {q1: q1, q2: q2, q3: q3};\n};\n\nexports.pooledStandardDeviation = function pooledStandardDeviation(samples, unbiased) {\n    return Math.sqrt(exports.pooledVariance(samples, unbiased));\n};\n\nexports.pooledVariance = function pooledVariance(samples, unbiased) {\n    if (typeof (unbiased) === 'undefined') unbiased = true;\n    var sum = 0;\n    var length = 0, l = samples.length;\n    for (var i = 0; i < l; i++) {\n        var values = samples[i];\n        var vari = exports.variance(values);\n\n        sum += (values.length - 1) * vari;\n\n        if (unbiased)\n            length += values.length - 1;\n        else\n            length += values.length;\n    }\n    return sum / length;\n};\n\nexports.mode = function mode(values) {\n    var l = values.length,\n        itemCount = new Array(l),\n        i;\n    for (i = 0; i < l; i++) {\n        itemCount[i] = 0;\n    }\n    var itemArray = new Array(l);\n    var count = 0;\n\n    for (i = 0; i < l; i++) {\n        var index = itemArray.indexOf(values[i]);\n        if (index >= 0)\n            itemCount[index]++;\n        else {\n            itemArray[count] = values[i];\n            itemCount[count] = 1;\n            count++;\n        }\n    }\n\n    var maxValue = 0, maxIndex = 0;\n    for (i = 0; i < count; i++) {\n        if (itemCount[i] > maxValue) {\n            maxValue = itemCount[i];\n            maxIndex = i;\n        }\n    }\n\n    return itemArray[maxIndex];\n};\n\nexports.covariance = function covariance(vector1, vector2, unbiased) {\n    if (typeof (unbiased) === 'undefined') unbiased = true;\n    var mean1 = exports.mean(vector1);\n    var mean2 = exports.mean(vector2);\n\n    if (vector1.length !== vector2.length)\n        throw 'Vectors do not have the same dimensions';\n\n    var cov = 0, l = vector1.length;\n    for (var i = 0; i < l; i++) {\n        var x = vector1[i] - mean1;\n        var y = vector2[i] - mean2;\n        cov += x * y;\n    }\n\n    if (unbiased)\n        return cov / (l - 1);\n    else\n        return cov / l;\n};\n\nexports.skewness = function skewness(values, unbiased) {\n    if (typeof (unbiased) === 'undefined') unbiased = true;\n    var theMean = exports.mean(values);\n\n    var s2 = 0, s3 = 0, l = values.length;\n    for (var i = 0; i < l; i++) {\n        var dev = values[i] - theMean;\n        s2 += dev * dev;\n        s3 += dev * dev * dev;\n    }\n    var m2 = s2 / l;\n    var m3 = s3 / l;\n\n    var g = m3 / (Math.pow(m2, 3 / 2.0));\n    if (unbiased) {\n        var a = Math.sqrt(l * (l - 1));\n        var b = l - 2;\n        return (a / b) * g;\n    } else {\n        return g;\n    }\n};\n\nexports.kurtosis = function kurtosis(values, unbiased) {\n    if (typeof (unbiased) === 'undefined') unbiased = true;\n    var theMean = exports.mean(values);\n    var n = values.length, s2 = 0, s4 = 0;\n\n    for (var i = 0; i < n; i++) {\n        var dev = values[i] - theMean;\n        s2 += dev * dev;\n        s4 += dev * dev * dev * dev;\n    }\n    var m2 = s2 / n;\n    var m4 = s4 / n;\n\n    if (unbiased) {\n        var v = s2 / (n - 1);\n        var a = (n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3));\n        var b = s4 / (v * v);\n        var c = ((n - 1) * (n - 1)) / ((n - 2) * (n - 3));\n\n        return a * b - 3 * c;\n    } else {\n        return m4 / (m2 * m2) - 3;\n    }\n};\n\nexports.entropy = function entropy(values, eps) {\n    if (typeof (eps) === 'undefined') eps = 0;\n    var sum = 0, l = values.length;\n    for (var i = 0; i < l; i++)\n        sum += values[i] * Math.log(values[i] + eps);\n    return -sum;\n};\n\nexports.weightedMean = function weightedMean(values, weights) {\n    var sum = 0, l = values.length;\n    for (var i = 0; i < l; i++)\n        sum += values[i] * weights[i];\n    return sum;\n};\n\nexports.weightedStandardDeviation = function weightedStandardDeviation(values, weights) {\n    return Math.sqrt(exports.weightedVariance(values, weights));\n};\n\nexports.weightedVariance = function weightedVariance(values, weights) {\n    var theMean = exports.weightedMean(values, weights);\n    var vari = 0, l = values.length;\n    var a = 0, b = 0;\n\n    for (var i = 0; i < l; i++) {\n        var z = values[i] - theMean;\n        var w = weights[i];\n\n        vari += w * (z * z);\n        b += w;\n        a += w * w;\n    }\n\n    return vari * (b / (b * b - a));\n};\n\nexports.center = function center(values, inPlace) {\n    if (typeof (inPlace) === 'undefined') inPlace = false;\n\n    var result = values;\n    if (!inPlace)\n        result = [].concat(values);\n\n    var theMean = exports.mean(result), l = result.length;\n    for (var i = 0; i < l; i++)\n        result[i] -= theMean;\n};\n\nexports.standardize = function standardize(values, standardDev, inPlace) {\n    if (typeof (standardDev) === 'undefined') standardDev = exports.standardDeviation(values);\n    if (typeof (inPlace) === 'undefined') inPlace = false;\n    var l = values.length;\n    var result = inPlace ? values : new Array(l);\n    for (var i = 0; i < l; i++)\n        result[i] = values[i] / standardDev;\n    return result;\n};\n\nexports.cumulativeSum = function cumulativeSum(array) {\n    var l = array.length;\n    var result = new Array(l);\n    result[0] = array[0];\n    for (var i = 1; i < l; i++)\n        result[i] = result[i - 1] + array[i];\n    return result;\n};\n","import { airPLSBaseline, rollingAverageBaseline, iterativePolynomialBaseline, rollingBallBaseline, rollingMedianBaseline, } from 'baselines';\r\nimport max from 'ml-array-max';\r\nimport min from 'ml-array-min';\r\nimport normed from 'ml-array-normed';\r\nimport rescale from 'ml-array-rescale';\r\nimport equallySpaced from 'ml-array-xy-equally-spaced';\r\nimport filterX from 'ml-array-xy-filter-x';\r\nimport savitzkyGolay from 'ml-savitzky-golay';\r\nimport { xDivide, xSubtract, xMultiply, xAdd, xIsMonotone, xyEnsureGrowingX, } from 'ml-spectra-processing';\r\nimport Stat from 'ml-stat/array';\r\nexport function getNormalizedSpectrum(spectrum, options = {}) {\r\n    var _a;\r\n    let data = {\r\n        x: spectrum.variables.x.data,\r\n        y: spectrum.variables.y.data,\r\n    };\r\n    let newSpectrum = {\r\n        variables: {\r\n            x: {\r\n                data: spectrum.variables.x.data,\r\n                units: spectrum.variables.x.units,\r\n                label: spectrum.variables.x.label,\r\n            },\r\n            y: {\r\n                data: spectrum.variables.y.data,\r\n                units: spectrum.variables.y.units,\r\n                label: spectrum.variables.y.label,\r\n            },\r\n        },\r\n    };\r\n    if (spectrum.title)\r\n        newSpectrum.title = spectrum.title;\r\n    if (spectrum.dataType)\r\n        newSpectrum.dataType = spectrum.dataType;\r\n    if (spectrum.meta)\r\n        newSpectrum.meta = spectrum.meta;\r\n    let { from = spectrum.variables.x.min, to = spectrum.variables.x.max, numberOfPoints, filters = [], exclusions = [], processing = '', keepYUnits = false, } = options;\r\n    let { x, y } = filterX(data, { from, to });\r\n    switch (processing) {\r\n        case 'Smoothing':\r\n            if (options.processing) {\r\n                y = savitzkyGolay(y, 1, {\r\n                    derivative: 0,\r\n                    polynomial: 3,\r\n                    windowSize: 5,\r\n                    pad: 'post',\r\n                    padValue: 'replicate'\r\n                });\r\n                x = x.slice(2, x.length - 2);\r\n            }\r\n            break;\r\n        case 'firstDerivative':\r\n            if (options.processing) {\r\n                newSpectrum.variables.y.units = '';\r\n                newSpectrum.variables.y.label =\r\n                    newSpectrum.variables.y.label &&\r\n                        `1st derivative of ${newSpectrum.variables.y.label.replace(/\\s*\\[.*\\]/, '')}`;\r\n                y = savitzkyGolay(y, 1, {\r\n                    derivative: 1,\r\n                    polynomial: 2,\r\n                    windowSize: 5,\r\n                });\r\n                x = x.slice(2, x.length - 2);\r\n            }\r\n            break;\r\n        case 'secondDerivative':\r\n            if (options.processing) {\r\n                newSpectrum.variables.y.units = '';\r\n                newSpectrum.variables.y.label =\r\n                    newSpectrum.variables.y.label &&\r\n                        `2nd derivative of ${newSpectrum.variables.y.label.replace(/\\s*\\[.*\\]/, '')}`;\r\n                y = savitzkyGolay(y, 1, {\r\n                    derivative: 2,\r\n                    polynomial: 2,\r\n                    windowSize: 5,\r\n                });\r\n                x = x.slice(2, x.length - 2);\r\n            }\r\n            break;\r\n        case 'thirdDerivative':\r\n            if (options.processing) {\r\n                newSpectrum.variables.y.units = '';\r\n                newSpectrum.variables.y.label =\r\n                    newSpectrum.variables.y.label &&\r\n                        `3rd derivative of ${newSpectrum.variables.y.label.replace(/\\s*\\[.*\\]/, '')}`;\r\n                y = savitzkyGolay(y, 1, {\r\n                    derivative: 3,\r\n                    polynomial: 2,\r\n                    windowSize: 5,\r\n                });\r\n                x = x.slice(2, x.length - 2);\r\n            }\r\n            break;\r\n        default:\r\n    }\r\n    if (!keepYUnits && filters.length) {\r\n        // filters change the y axis, we get rid of the units\r\n        newSpectrum.variables.y.units = '';\r\n        newSpectrum.variables.y.label = (_a = newSpectrum.variables.y.label) === null || _a === void 0 ? void 0 : _a.replace(/\\s*\\[.*\\]/, '');\r\n    }\r\n    for (let filter of filters) {\r\n        let filterOptions = filter.options || {};\r\n        switch (filter.name.toLowerCase()) {\r\n            case 'centermean': {\r\n                let mean = Stat.mean(y);\r\n                y = xSubtract(y, mean);\r\n                break;\r\n            }\r\n            case 'dividebysd': {\r\n                let std = Stat.standardDeviation(y);\r\n                y = xDivide(y, std);\r\n                break;\r\n            }\r\n            case 'normalize': {\r\n                y = normed(y, {\r\n                    sumValue: filterOptions.value ? Number(filterOptions.value) : 1,\r\n                    algorithm: 'absolute',\r\n                });\r\n                break;\r\n            }\r\n            case 'rescale': {\r\n                y = rescale(y, {\r\n                    min: filterOptions.min ? Number(filterOptions.min) : 0,\r\n                    max: filterOptions.max ? Number(filterOptions.max) : 1,\r\n                });\r\n                break;\r\n            }\r\n            case 'dividebymax': {\r\n                let maxValue = max(y);\r\n                y = xDivide(y, maxValue);\r\n                break;\r\n            }\r\n            case 'multiply': {\r\n                y = xMultiply(y, filterOptions.value ? Number(filterOptions.value) : 1);\r\n                break;\r\n            }\r\n            case 'add': {\r\n                y = xAdd(y, filterOptions.value ? Number(filterOptions.value) : 0);\r\n                break;\r\n            }\r\n            case 'airplsbaseline': {\r\n                y = airPLSBaseline(y, filterOptions).correctedSpectrum;\r\n                break;\r\n            }\r\n            case 'rollingaveragebaseline': {\r\n                y = rollingAverageBaseline(y, filterOptions).correctedSpectrum;\r\n                break;\r\n            }\r\n            case 'iterativepolynomialbaseline': {\r\n                y = iterativePolynomialBaseline(y, undefined, filterOptions).correctedSpectrum;\r\n                break;\r\n            }\r\n            case 'rollingballbaseline': {\r\n                y = rollingBallBaseline(y, filterOptions).correctedSpectrum;\r\n                break;\r\n            }\r\n            case 'rollingmedianbaseline': {\r\n                y = rollingMedianBaseline(y, filterOptions).correctedSpectrum;\r\n                break;\r\n            }\r\n            case 'ensuregrowing': {\r\n                const ans = xyEnsureGrowingX({ x, y });\r\n                x = ans.x;\r\n                y = ans.y;\r\n                break;\r\n            }\r\n            case '':\r\n            case undefined:\r\n                break;\r\n            default:\r\n                throw new Error(`Unknown process kind: ${filter.name}`);\r\n        }\r\n    }\r\n    if (!numberOfPoints) {\r\n        data = filterX({ x, y }, { from, to, exclusions });\r\n    }\r\n    else {\r\n        data = equallySpaced({ x, y }, { from, to, numberOfPoints, exclusions });\r\n    }\r\n    newSpectrum.variables.x.data = x;\r\n    newSpectrum.variables.x.min = min(x);\r\n    newSpectrum.variables.x.max = max(x);\r\n    newSpectrum.variables.x.isMonotone = xIsMonotone(x);\r\n    newSpectrum.variables.y.data = y;\r\n    newSpectrum.variables.y.min = min(y);\r\n    newSpectrum.variables.y.max = max(y);\r\n    newSpectrum.variables.y.isMonotone = xIsMonotone(y);\r\n    return newSpectrum;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0Tm9ybWFsaXplZFNwZWN0cnVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvZ2V0Tm9ybWFsaXplZFNwZWN0cnVtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxjQUFjLEVBQ2Qsc0JBQXNCLEVBQ3RCLDJCQUEyQixFQUMzQixtQkFBbUIsRUFDbkIscUJBQXFCLEdBQ3RCLE1BQU0sV0FBVyxDQUFDO0FBRW5CLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQztBQUMvQixPQUFPLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDL0IsT0FBTyxNQUFNLE1BQU0saUJBQWlCLENBQUM7QUFDckMsT0FBTyxPQUFPLE1BQU0sa0JBQWtCLENBQUM7QUFDdkMsT0FBTyxhQUFhLE1BQU0sNEJBQTRCLENBQUM7QUFDdkQsT0FBTyxPQUFPLE1BQU0sc0JBQXNCLENBQUM7QUFDM0MsT0FBTyxhQUFhLE1BQU0sbUJBQW1CLENBQUM7QUFDOUMsT0FBTyxFQUNMLE9BQU8sRUFDUCxTQUFTLEVBQ1QsU0FBUyxFQUNULElBQUksRUFDSixXQUFXLEVBQ1gsZ0JBQWdCLEdBQ2pCLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFDO0FBSWpDLE1BQU0sVUFBVSxxQkFBcUIsQ0FDbkMsUUFBa0IsRUFDbEIsVUFBcUMsRUFBRTs7SUFFdkMsSUFBSSxJQUFJLEdBQUc7UUFDVCxDQUFDLEVBQUUsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSTtRQUM1QixDQUFDLEVBQUUsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSTtLQUM3QixDQUFDO0lBQ0YsSUFBSSxXQUFXLEdBQWE7UUFDMUIsU0FBUyxFQUFFO1lBQ1QsQ0FBQyxFQUFFO2dCQUNELElBQUksRUFBRSxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUMvQixLQUFLLEVBQUUsUUFBUSxDQUFD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LElBQUksRUFBRSxFQUFFLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7S0FDMUU7SUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQ2pDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxVQUFVLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7SUFDakMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFcEQsT0FBTyxXQUFXLENBQUM7QUFDckIsQ0FBQyJ9","/*\nThe MIT License (MIT)\nCopyright  2006-2007 Kevin C. Olbrich\nCopyright  2010-2016 LIM SAS (http://lim.eu) - Julien Sanchez\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\nof the Software, and to permit persons to whom the Software is furnished to do\nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.Qty = factory());\n}(this, (function () { 'use strict';\n\n  /**\n   * Tests if a value is a string\n   *\n   * @param {*} value - Value to test\n   *\n   * @returns {boolean} true if value is a string, false otherwise\n   */\n  function isString(value) {\n    return typeof value === \"string\" || value instanceof String;\n  }\n\n  /*\n   * Prefer stricter Number.isFinite if currently supported.\n   * To be dropped when ES6 is finalized. Obsolete browsers will\n   * have to use ES6 polyfills.\n   */\n  var isFiniteImpl = Number.isFinite || window.isFinite;\n  /**\n   * Tests if a value is a number\n   *\n   * @param {*} value - Value to test\n   *\n   * @returns {boolean} true if value is a number, false otherwise\n   */\n  function isNumber(value) {\n    // Number.isFinite allows not to consider NaN or '1' as numbers\n    return isFiniteImpl(value);\n  }\n\n  /*\n   * Identity function\n   */\n  function identity(value) {\n    return value;\n  }\n\n  /**\n   * Returns unique strings from list\n   *\n   * @param {string[]} strings - array of strings\n   *\n   *\n   * @returns {string[]} a new array of strings without duplicates\n   */\n  function uniq(strings) {\n    var seen = {};\n    return strings.filter(function(item) {\n      return seen.hasOwnProperty(item) ? false : (seen[item] = true);\n    });\n  }\n\n  function compareArray(array1, array2) {\n    if (array2.length !== array1.length) {\n      return false;\n    }\n    for (var i = 0; i < array1.length; i++) {\n      if (array2[i].compareArray) {\n        if (!array2[i].compareArray(array1[i])) {\n          return false;\n        }\n      }\n      if (array2[i] !== array1[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  function assign(target, properties) {\n    Object.keys(properties).forEach(function(key) {\n      target[key] = properties[key];\n    });\n  }\n\n  /**\n   * Safely multiplies numbers while avoiding floating errors\n   * like 0.1 * 0.1 => 0.010000000000000002\n   *\n   * @param {...number} numbers - numbers to multiply\n   *\n   * @returns {number} result\n   */\n  function mulSafe() {\n    var result = 1, decimals = 0;\n    for (var i = 0; i < arguments.length; i++) {\n      var arg = arguments[i];\n      decimals = decimals + getFractional(arg);\n      result *= arg;\n    }\n\n    return decimals !== 0 ? round(result, decimals) : result;\n  }\n\n  /**\n   * Safely divides two numbers while avoiding floating errors\n   * like 0.3 / 0.05 => 5.999999999999999\n   *\n   * @returns {number} result\n   * @param {number} num Numerator\n   * @param {number} den Denominator\n   */\n  function divSafe(num, den) {\n    if (den === 0) {\n      throw new Error(\"Divide by zero\");\n    }\n\n    var factor = Math.pow(10, getFractional(den));\n    var invDen = factor / (factor * den);\n\n    return mulSafe(num, invDen);\n  }\n\n  /**\n   * Rounds value at the specified number of decimals\n   *\n   * @param {number} val - value to round\n   * @param {number} decimals - number of decimals\n   *\n   * @returns {number} rounded number\n   */\n  function round(val, decimals) {\n    return Math.round(val * Math.pow(10, decimals)) / Math.pow(10, decimals);\n  }\n\n  function getFractional(num) {\n    // Check for NaNs or Infinities\n    if (!isFinite(num)) {\n      return 0;\n    }\n\n    // Faster than parsing strings\n    // http://jsperf.com/count-decimals/2\n    var count = 0;\n    while (num % 1 !== 0) {\n      num *= 10;\n      count++;\n    }\n    return count;\n  }\n\n  /**\n   * Custom error type definition\n   * @constructor\n   */\n  function QtyError() {\n    var err;\n    if (!this) { // Allows to instantiate QtyError without new()\n      err = Object.create(QtyError.prototype);\n      QtyError.apply(err, arguments);\n      return err;\n    }\n    err = Error.apply(this, arguments);\n    this.name = \"QtyError\";\n    this.message = err.message;\n    this.stack = err.stack;\n  }\n  QtyError.prototype = Object.create(Error.prototype, {constructor: { value: QtyError }});\n\n  /*\n   * Throws incompatible units error\n   * @param {string} left - units\n   * @param {string} right - units incompatible with first argument\n   * @throws \"Incompatible units\" error\n   */\n  function throwIncompatibleUnits(left, right) {\n    throw new QtyError(\"Incompatible units: \" + left + \" and \" + right);\n  }\n\n  var UNITS = {\n    /* prefixes */\n    \"<googol>\" : [[\"googol\"], 1e100, \"prefix\"],\n    \"<kibi>\"  :  [[\"Ki\",\"Kibi\",\"kibi\"], Math.pow(2,10), \"prefix\"],\n    \"<mebi>\"  :  [[\"Mi\",\"Mebi\",\"mebi\"], Math.pow(2,20), \"prefix\"],\n    \"<gibi>\"  :  [[\"Gi\",\"Gibi\",\"gibi\"], Math.pow(2,30), \"prefix\"],\n    \"<tebi>\"  :  [[\"Ti\",\"Tebi\",\"tebi\"], Math.pow(2,40), \"prefix\"],\n    \"<pebi>\"  :  [[\"Pi\",\"Pebi\",\"pebi\"], Math.pow(2,50), \"prefix\"],\n    \"<exi>\"   :  [[\"Ei\",\"Exi\",\"exi\"], Math.pow(2,60), \"prefix\"],\n    \"<zebi>\"  :  [[\"Zi\",\"Zebi\",\"zebi\"], Math.pow(2,70), \"prefix\"],\n    \"<yebi>\"  :  [[\"Yi\",\"Yebi\",\"yebi\"], Math.pow(2,80), \"prefix\"],\n    \"<yotta>\" :  [[\"Y\",\"Yotta\",\"yotta\"], 1e24, \"prefix\"],\n    \"<zetta>\" :  [[\"Z\",\"Zetta\",\"zetta\"], 1e21, \"prefix\"],\n    \"<exa>\"   :  [[\"E\",\"Exa\",\"exa\"], 1e18, \"prefix\"],\n    \"<peta>\"  :  [[\"P\",\"Peta\",\"peta\"], 1e15, \"prefix\"],\n    \"<tera>\"  :  [[\"T\",\"Tera\",\"tera\"], 1e12, \"prefix\"],\n    \"<giga>\"  :  [[\"G\",\"Giga\",\"giga\"], 1e9, \"prefix\"],\n    \"<mega>\"  :  [[\"M\",\"Mega\",\"mega\"], 1e6, \"prefix\"],\n    \"<kilo>\"  :  [[\"k\",\"kilo\"], 1e3, \"prefix\"],\n    \"<hecto>\" :  [[\"h\",\"Hecto\",\"hecto\"], 1e2, \"prefix\"],\n    \"<deca>\"  :  [[\"da\",\"Deca\",\"deca\",\"deka\"], 1e1, \"prefix\"],\n    \"<deci>\"  :  [[\"d\",\"Deci\",\"deci\"], 1e-1, \"prefix\"],\n    \"<centi>\"  : [[\"c\",\"Centi\",\"centi\"], 1e-2, \"prefix\"],\n    \"<milli>\" :  [[\"m\",\"Milli\",\"milli\"], 1e-3, \"prefix\"],\n    \"<micro>\"  : [\n      [\"u\",\"\\u03BC\"/* as greek letter*/,\"\\u00B5\"/* as micro sign*/,\"Micro\",\"mc\",\"micro\"],\n      1e-6,\n      \"prefix\"\n    ],\n    \"<nano>\"  :  [[\"n\",\"Nano\",\"nano\"], 1e-9, \"prefix\"],\n    \"<pico>\"  :  [[\"p\",\"Pico\",\"pico\"], 1e-12, \"prefix\"],\n    \"<femto>\" :  [[\"f\",\"Femto\",\"femto\"], 1e-15, \"prefix\"],\n    \"<atto>\"  :  [[\"a\",\"Atto\",\"atto\"], 1e-18, \"prefix\"],\n    \"<zepto>\" :  [[\"z\",\"Zepto\",\"zepto\"], 1e-21, \"prefix\"],\n    \"<yocto>\" :  [[\"y\",\"Yocto\",\"yocto\"], 1e-24, \"prefix\"],\n\n    \"<1>\"     :  [[\"1\", \"<1>\"], 1, \"\"],\n    /* length units */\n    \"<meter>\" :  [[\"m\",\"meter\",\"meters\",\"metre\",\"metres\"], 1.0, \"length\", [\"<meter>\"] ],\n    \"<inch>\"  :  [[\"in\",\"inch\",\"inches\",\"\\\"\"], 0.0254, \"length\", [\"<meter>\"]],\n    \"<foot>\"  :  [[\"ft\",\"foot\",\"feet\",\"'\"], 0.3048, \"length\", [\"<meter>\"]],\n    \"<yard>\"  :  [[\"yd\",\"yard\",\"yards\"], 0.9144, \"length\", [\"<meter>\"]],\n    \"<mile>\"  :  [[\"mi\",\"mile\",\"miles\"], 1609.344, \"length\", [\"<meter>\"]],\n    \"<naut-mile>\" : [[\"nmi\",\"naut-mile\"], 1852, \"length\", [\"<meter>\"]],\n    \"<league>\":  [[\"league\",\"leagues\"], 4828, \"length\", [\"<meter>\"]],\n    \"<furlong>\": [[\"furlong\",\"furlongs\"], 201.2, \"length\", [\"<meter>\"]],\n    \"<rod>\"   :  [[\"rd\",\"rod\",\"rods\"], 5.029, \"length\", [\"<meter>\"]],\n    \"<mil>\"   :  [[\"mil\",\"mils\"], 0.0000254, \"length\", [\"<meter>\"]],\n    \"<angstrom>\"  :[[\"ang\",\"angstrom\",\"angstroms\"], 1e-10, \"length\", [\"<meter>\"]],\n    \"<fathom>\" : [[\"fathom\",\"fathoms\"], 1.829, \"length\", [\"<meter>\"]],\n    \"<pica>\"  : [[\"pica\",\"picas\"], 0.00423333333, \"length\", [\"<meter>\"]],\n    \"<point>\" : [[\"pt\",\"point\",\"points\"], 0.000352777778, \"length\", [\"<meter>\"]],\n    \"<redshift>\" : [[\"z\",\"red-shift\", \"redshift\"], 1.302773e26, \"length\", [\"<meter>\"]],\n    \"<AU>\"    : [[\"AU\",\"astronomical-unit\"], 149597900000, \"length\", [\"<meter>\"]],\n    \"<light-second>\":[[\"ls\",\"light-second\"], 299792500, \"length\", [\"<meter>\"]],\n    \"<light-minute>\":[[\"lmin\",\"light-minute\"], 17987550000, \"length\", [\"<meter>\"]],\n    \"<light-year>\" : [[\"ly\",\"light-year\"], 9460528000000000, \"length\", [\"<meter>\"]],\n    \"<parsec>\"  : [[\"pc\",\"parsec\",\"parsecs\"], 30856780000000000, \"length\", [\"<meter>\"]],\n    \"<datamile>\"  :  [[\"DM\",\"datamile\"], 1828.8, \"length\", [\"<meter>\"]],\n\n    /* mass */\n    \"<kilogram>\" : [[\"kg\",\"kilogram\",\"kilograms\"], 1.0, \"mass\", [\"<kilogram>\"]],\n    \"<AMU>\" : [[\"u\",\"AMU\",\"amu\"], 1.660538921e-27, \"mass\", [\"<kilogram>\"]],\n    \"<dalton>\" : [[\"Da\",\"Dalton\",\"Daltons\",\"dalton\",\"daltons\"], 1.660538921e-27, \"mass\", [\"<kilogram>\"]],\n    \"<slug>\" : [[\"slug\",\"slugs\"], 14.5939029, \"mass\", [\"<kilogram>\"]],\n    \"<short-ton>\" : [[\"tn\",\"ton\",\"short-ton\"], 907.18474, \"mass\", [\"<kilogram>\"]],\n    \"<metric-ton>\":[[\"tonne\",\"metric-ton\"], 1000, \"mass\", [\"<kilogram>\"]],\n    \"<carat>\" : [[\"ct\",\"carat\",\"carats\"], 0.0002, \"mass\", [\"<kilogram>\"]],\n    \"<pound>\" : [[\"lbs\",\"lb\",\"pound\",\"pounds\",\"#\"], 0.45359237, \"mass\", [\"<kilogram>\"]],\n    \"<ounce>\" : [[\"oz\",\"ounce\",\"ounces\"], 0.0283495231, \"mass\", [\"<kilogram>\"]],\n    \"<gram>\"    :  [[\"g\",\"gram\",\"grams\",\"gramme\",\"grammes\"], 1e-3, \"mass\", [\"<kilogram>\"]],\n    \"<grain>\" : [[\"grain\",\"grains\",\"gr\"], 6.479891e-5, \"mass\", [\"<kilogram>\"]],\n    \"<dram>\"  : [[\"dram\",\"drams\",\"dr\"], 0.0017718452, \"mass\",[\"<kilogram>\"]],\n    \"<stone>\" : [[\"stone\",\"stones\",\"st\"],6.35029318, \"mass\",[\"<kilogram>\"]],\n\n    /* area */\n    \"<hectare>\":[[\"hectare\"], 10000, \"area\", [\"<meter>\",\"<meter>\"]],\n    \"<acre>\":[[\"acre\",\"acres\"], 4046.85642, \"area\", [\"<meter>\",\"<meter>\"]],\n    \"<sqft>\":[[\"sqft\"], 1, \"area\", [\"<foot>\",\"<foot>\"]],\n\n    /* volume */\n    \"<liter>\" : [[\"l\",\"L\",\"liter\",\"liters\",\"litre\",\"litres\"], 0.001, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<gallon>\":  [[\"gal\",\"gallon\",\"gallons\"], 0.0037854118, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<gallon-imp>\":  [[\"galimp\",\"gallon-imp\",\"gallons-imp\"], 0.0045460900, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<quart>\":  [[\"qt\",\"quart\",\"quarts\"], 0.00094635295, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<pint>\":  [[\"pt\",\"pint\",\"pints\"], 0.000473176475, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<pint-imp>\":  [[\"ptimp\",\"pint-imp\",\"pints-imp\"], 5.6826125e-4, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<cup>\":  [[\"cu\",\"cup\",\"cups\"], 0.000236588238, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<fluid-ounce>\":  [[\"floz\",\"fluid-ounce\",\"fluid-ounces\"], 2.95735297e-5, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<fluid-ounce-imp>\":  [[\"flozimp\", \"floz-imp\",\"fluid-ounce-imp\",\"fluid-ounces-imp\"], 2.84130625e-5, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<tablespoon>\":  [[\"tb\",\"tbsp\",\"tbs\",\"tablespoon\",\"tablespoons\"], 1.47867648e-5, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<teaspoon>\":  [[\"tsp\",\"teaspoon\",\"teaspoons\"], 4.92892161e-6, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<bushel>\":  [[\"bu\",\"bsh\",\"bushel\",\"bushels\"], 0.035239072, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<oilbarrel>\":  [[\"bbl\",\"oilbarrel\", \"oilbarrels\", \"oil-barrel\",\"oil-barrels\"], 0.158987294928, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<beerbarrel>\":  [[\"bl\",\"bl-us\",\"beerbarrel\", \"beerbarrels\", \"beer-barrel\",\"beer-barrels\"], 0.1173477658, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<beerbarrel-imp>\":  [[\"blimp\",\"bl-imp\",\"beerbarrel-imp\", \"beerbarrels-imp\", \"beer-barrel-imp\",\"beer-barrels-imp\"], 0.16365924, \"volume\", [\"<meter>\",\"<meter>\",\"<meter>\"]],\n\n    /* speed */\n    \"<kph>\" : [[\"kph\"], 0.277777778, \"speed\", [\"<meter>\"], [\"<second>\"]],\n    \"<mph>\" : [[\"mph\"], 0.44704, \"speed\", [\"<meter>\"], [\"<second>\"]],\n    \"<knot>\" : [[\"kt\",\"kn\",\"kts\",\"knot\",\"knots\"], 0.514444444, \"speed\", [\"<meter>\"], [\"<second>\"]],\n    \"<fps>\"  : [[\"fps\"], 0.3048, \"speed\", [\"<meter>\"], [\"<second>\"]],\n\n    /* acceleration */\n    \"<gee>\" : [[\"gee\"], 9.80665, \"acceleration\", [\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<Gal>\" : [[\"Gal\"], 1e-2, \"acceleration\", [\"<meter>\"], [\"<second>\",\"<second>\"]],\n\n    /* temperature_difference */\n    \"<kelvin>\" : [[\"degK\",\"kelvin\"], 1.0, \"temperature\", [\"<kelvin>\"]],\n    \"<celsius>\" : [[\"degC\",\"celsius\",\"celsius\",\"centigrade\"], 1.0, \"temperature\", [\"<kelvin>\"]],\n    \"<fahrenheit>\" : [[\"degF\",\"fahrenheit\"], 5 / 9, \"temperature\", [\"<kelvin>\"]],\n    \"<rankine>\" : [[\"degR\",\"rankine\"], 5 / 9, \"temperature\", [\"<kelvin>\"]],\n    \"<temp-K>\"  : [[\"tempK\",\"temp-K\"], 1.0, \"temperature\", [\"<temp-K>\"]],\n    \"<temp-C>\"  : [[\"tempC\",\"temp-C\"], 1.0, \"temperature\", [\"<temp-K>\"]],\n    \"<temp-F>\"  : [[\"tempF\",\"temp-F\"], 5 / 9, \"temperature\", [\"<temp-K>\"]],\n    \"<temp-R>\"  : [[\"tempR\",\"temp-R\"], 5 / 9, \"temperature\", [\"<temp-K>\"]],\n\n    /* time */\n    \"<second>\":  [[\"s\",\"sec\",\"secs\",\"second\",\"seconds\"], 1.0, \"time\", [\"<second>\"]],\n    \"<minute>\":  [[\"min\",\"mins\",\"minute\",\"minutes\"], 60.0, \"time\", [\"<second>\"]],\n    \"<hour>\":  [[\"h\",\"hr\",\"hrs\",\"hour\",\"hours\"], 3600.0, \"time\", [\"<second>\"]],\n    \"<day>\":  [[\"d\",\"day\",\"days\"], 3600 * 24, \"time\", [\"<second>\"]],\n    \"<week>\":  [[\"wk\",\"week\",\"weeks\"], 7 * 3600 * 24, \"time\", [\"<second>\"]],\n    \"<fortnight>\": [[\"fortnight\",\"fortnights\"], 1209600, \"time\", [\"<second>\"]],\n    \"<year>\":  [[\"y\",\"yr\",\"year\",\"years\",\"annum\"], 31556926, \"time\", [\"<second>\"]],\n    \"<decade>\":[[\"decade\",\"decades\"], 315569260, \"time\", [\"<second>\"]],\n    \"<century>\":[[\"century\",\"centuries\"], 3155692600, \"time\", [\"<second>\"]],\n\n    /* pressure */\n    \"<pascal>\" : [[\"Pa\",\"pascal\",\"Pascal\"], 1.0, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<bar>\" : [[\"bar\",\"bars\"], 100000, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<mmHg>\" : [[\"mmHg\"], 133.322368, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<inHg>\" : [[\"inHg\"], 3386.3881472, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<torr>\" : [[\"torr\"], 133.322368, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<atm>\" : [[\"atm\",\"ATM\",\"atmosphere\",\"atmospheres\"], 101325, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<psi>\" : [[\"psi\"], 6894.76, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<cmh2o>\" : [[\"cmH2O\",\"cmh2o\"], 98.0638, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n    \"<inh2o>\" : [[\"inH2O\",\"inh2o\"], 249.082052, \"pressure\", [\"<kilogram>\"],[\"<meter>\",\"<second>\",\"<second>\"]],\n\n    /* viscosity */\n    \"<poise>\"  : [[\"P\",\"poise\"], 0.1, \"viscosity\", [\"<kilogram>\"],[\"<meter>\",\"<second>\"] ],\n    \"<stokes>\" : [[\"St\",\"stokes\"], 1e-4, \"viscosity\", [\"<meter>\",\"<meter>\"], [\"<second>\"]],\n\n    /* substance */\n    \"<mole>\"  :  [[\"mol\",\"mole\"], 1.0, \"substance\", [\"<mole>\"]],\n\n    /* concentration */\n    \"<molar>\" : [[\"M\",\"molar\"], 1000, \"concentration\", [\"<mole>\"], [\"<meter>\",\"<meter>\",\"<meter>\"]],\n    \"<wtpercent>\"  : [[\"wt%\",\"wtpercent\"], 10, \"concentration\", [\"<kilogram>\"], [\"<meter>\",\"<meter>\",\"<meter>\"]],\n\n    /* activity */\n    \"<katal>\" :  [[\"kat\",\"katal\",\"Katal\"], 1.0, \"activity\", [\"<mole>\"], [\"<second>\"]],\n    \"<unit>\"  :  [[\"U\",\"enzUnit\",\"unit\"], 16.667e-16, \"activity\", [\"<mole>\"], [\"<second>\"]],\n\n    /* capacitance */\n    \"<farad>\" :  [[\"F\",\"farad\",\"Farad\"], 1.0, \"capacitance\", [\"<second>\",\"<second>\",\"<second>\",\"<second>\",\"<ampere>\",\"<ampere>\"], [\"<meter>\", \"<meter>\", \"<kilogram>\"]],\n\n    /* charge */\n    \"<coulomb>\" :  [[\"C\",\"coulomb\",\"Coulomb\"], 1.0, \"charge\", [\"<ampere>\",\"<second>\"]],\n    \"<Ah>\" :  [[\"Ah\"], 3600, \"charge\", [\"<ampere>\",\"<second>\"]],\n\n    /* current */\n    \"<ampere>\"  :  [[\"A\",\"Ampere\",\"ampere\",\"amp\",\"amps\"], 1.0, \"current\", [\"<ampere>\"]],\n\n    /* conductance */\n    \"<siemens>\" : [[\"S\",\"Siemens\",\"siemens\"], 1.0, \"conductance\", [\"<second>\",\"<second>\",\"<second>\",\"<ampere>\",\"<ampere>\"], [\"<kilogram>\",\"<meter>\",\"<meter>\"]],\n\n    /* inductance */\n    \"<henry>\" :  [[\"H\",\"Henry\",\"henry\"], 1.0, \"inductance\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\",\"<ampere>\",\"<ampere>\"]],\n\n    /* potential */\n    \"<volt>\"  :  [[\"V\",\"Volt\",\"volt\",\"volts\"], 1.0, \"potential\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\",\"<second>\",\"<ampere>\"]],\n\n    /* resistance */\n    \"<ohm>\" :  [\n      [\"Ohm\",\"ohm\",\"\\u03A9\"/* as greek letter*/,\"\\u2126\"/* as ohm sign*/],\n      1.0,\n      \"resistance\",\n      [\"<meter>\",\"<meter>\",\"<kilogram>\"],[\"<second>\",\"<second>\",\"<second>\",\"<ampere>\",\"<ampere>\"]\n    ],\n    /* magnetism */\n    \"<weber>\" : [[\"Wb\",\"weber\",\"webers\"], 1.0, \"magnetism\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\",\"<ampere>\"]],\n    \"<tesla>\"  : [[\"T\",\"tesla\",\"teslas\"], 1.0, \"magnetism\", [\"<kilogram>\"], [\"<second>\",\"<second>\",\"<ampere>\"]],\n    \"<gauss>\" : [[\"G\",\"gauss\"], 1e-4, \"magnetism\",  [\"<kilogram>\"], [\"<second>\",\"<second>\",\"<ampere>\"]],\n    \"<maxwell>\" : [[\"Mx\",\"maxwell\",\"maxwells\"], 1e-8, \"magnetism\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\",\"<ampere>\"]],\n    \"<oersted>\"  : [[\"Oe\",\"oersted\",\"oersteds\"], 250.0 / Math.PI, \"magnetism\", [\"<ampere>\"], [\"<meter>\"]],\n\n    /* energy */\n    \"<joule>\" :  [[\"J\",\"joule\",\"Joule\",\"joules\"], 1.0, \"energy\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<erg>\"   :  [[\"erg\",\"ergs\"], 1e-7, \"energy\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<btu>\"   :  [[\"BTU\",\"btu\",\"BTUs\"], 1055.056, \"energy\", [\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<calorie>\" :  [[\"cal\",\"calorie\",\"calories\"], 4.18400, \"energy\",[\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<Calorie>\" :  [[\"Cal\",\"Calorie\",\"Calories\"], 4184.00, \"energy\",[\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<therm-US>\" : [[\"th\",\"therm\",\"therms\",\"Therm\",\"therm-US\"], 105480400, \"energy\",[\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n    \"<Wh>\" : [[\"Wh\"], 3600, \"energy\",[\"<meter>\",\"<meter>\",\"<kilogram>\"], [\"<second>\",\"<second>\"]],\n\n    /* force */\n    \"<newton>\"  : [[\"N\",\"Newton\",\"newton\"], 1.0, \"force\", [\"<kilogram>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<dyne>\"  : [[\"dyn\",\"dyne\"], 1e-5, \"force\", [\"<kilogram>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<pound-force>\"  : [[\"lbf\",\"pound-force\"], 4.448222, \"force\", [\"<kilogram>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n\n    /* frequency */\n    \"<hertz>\" : [[\"Hz\",\"hertz\",\"Hertz\"], 1.0, \"frequency\", [\"<1>\"], [\"<second>\"]],\n\n    /* angle */\n    \"<radian>\" :[[\"rad\",\"radian\",\"radians\"], 1.0, \"angle\", [\"<radian>\"]],\n    \"<degree>\" :[[\"deg\",\"degree\",\"degrees\"], Math.PI / 180.0, \"angle\", [\"<radian>\"]],\n    \"<gradian>\"   :[[\"gon\",\"grad\",\"gradian\",\"grads\"], Math.PI / 200.0, \"angle\", [\"<radian>\"]],\n    \"<steradian>\"  : [[\"sr\",\"steradian\",\"steradians\"], 1.0, \"solid_angle\", [\"<steradian>\"]],\n\n    /* rotation */\n    \"<rotation>\" : [[\"rotation\"], 2.0 * Math.PI, \"angle\", [\"<radian>\"]],\n    \"<rpm>\"   :[[\"rpm\"], 2.0 * Math.PI / 60.0, \"angular_velocity\", [\"<radian>\"], [\"<second>\"]],\n\n    /* information */\n    \"<byte>\"  :[[\"B\",\"byte\",\"bytes\"], 1.0, \"information\", [\"<byte>\"]],\n    \"<bit>\"  :[[\"b\",\"bit\",\"bits\"], 0.125, \"information\", [\"<byte>\"]],\n\n    /* information rate */\n    \"<Bps>\" : [[\"Bps\"], 1.0, \"information_rate\", [\"<byte>\"], [\"<second>\"]],\n    \"<bps>\" : [[\"bps\"], 0.125, \"information_rate\", [\"<byte>\"], [\"<second>\"]],\n\n    /* currency */\n    \"<dollar>\":[[\"USD\",\"dollar\"], 1.0, \"currency\", [\"<dollar>\"]],\n    \"<cents>\" :[[\"cents\"], 0.01, \"currency\", [\"<dollar>\"]],\n\n    /* luminosity */\n    \"<candela>\" : [[\"cd\",\"candela\"], 1.0, \"luminosity\", [\"<candela>\"]],\n    \"<lumen>\" : [[\"lm\",\"lumen\"], 1.0, \"luminous_power\", [\"<candela>\",\"<steradian>\"]],\n    \"<lux>\" :[[\"lux\"], 1.0, \"illuminance\", [\"<candela>\",\"<steradian>\"], [\"<meter>\",\"<meter>\"]],\n\n    /* power */\n    \"<watt>\"  : [[\"W\",\"watt\",\"watts\"], 1.0, \"power\", [\"<kilogram>\",\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\",\"<second>\"]],\n    \"<volt-ampere>\"  : [[\"VA\",\"volt-ampere\"], 1.0, \"power\", [\"<kilogram>\",\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\",\"<second>\"]],\n    \"<volt-ampere-reactive>\"  : [[\"var\",\"Var\",\"VAr\",\"VAR\",\"volt-ampere-reactive\"], 1.0, \"power\", [\"<kilogram>\",\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\",\"<second>\"]],\n    \"<horsepower>\"  :  [[\"hp\",\"horsepower\"], 745.699872, \"power\", [\"<kilogram>\",\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\",\"<second>\"]],\n\n    /* radiation */\n    \"<gray>\" : [[\"Gy\",\"gray\",\"grays\"], 1.0, \"radiation\", [\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<roentgen>\" : [[\"R\",\"roentgen\"], 0.009330, \"radiation\", [\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<sievert>\" : [[\"Sv\",\"sievert\",\"sieverts\"], 1.0, \"radiation\", [\"<meter>\",\"<meter>\"], [\"<second>\",\"<second>\"]],\n    \"<becquerel>\" : [[\"Bq\",\"becquerel\",\"becquerels\"], 1.0, \"radiation\", [\"<1>\"],[\"<second>\"]],\n    \"<curie>\" : [[\"Ci\",\"curie\",\"curies\"], 3.7e10, \"radiation\", [\"<1>\"],[\"<second>\"]],\n\n    /* rate */\n    \"<cpm>\" : [[\"cpm\"], 1.0 / 60.0, \"rate\", [\"<count>\"],[\"<second>\"]],\n    \"<dpm>\" : [[\"dpm\"], 1.0 / 60.0, \"rate\", [\"<count>\"],[\"<second>\"]],\n    \"<bpm>\" : [[\"bpm\"], 1.0 / 60.0, \"rate\", [\"<count>\"],[\"<second>\"]],\n\n    /* resolution / typography */\n    \"<dot>\" : [[\"dot\",\"dots\"], 1, \"resolution\", [\"<each>\"]],\n    \"<pixel>\" : [[\"pixel\",\"px\"], 1, \"resolution\", [\"<each>\"]],\n    \"<ppi>\" : [[\"ppi\"], 1, \"resolution\", [\"<pixel>\"], [\"<inch>\"]],\n    \"<dpi>\" : [[\"dpi\"], 1, \"typography\", [\"<dot>\"], [\"<inch>\"]],\n\n    /* other */\n    \"<cell>\" : [[\"cells\",\"cell\"], 1, \"counting\", [\"<each>\"]],\n    \"<each>\" : [[\"each\"], 1.0, \"counting\", [\"<each>\"]],\n    \"<count>\" : [[\"count\"], 1.0, \"counting\", [\"<each>\"]],\n    \"<base-pair>\"  : [[\"bp\",\"base-pair\"], 1.0, \"counting\", [\"<each>\"]],\n    \"<nucleotide>\" : [[\"nt\",\"nucleotide\"], 1.0, \"counting\", [\"<each>\"]],\n    \"<molecule>\" : [[\"molecule\",\"molecules\"], 1.0, \"counting\", [\"<1>\"]],\n    \"<dozen>\" :  [[\"doz\",\"dz\",\"dozen\"],12.0,\"prefix_only\", [\"<each>\"]],\n    \"<percent>\": [[\"%\",\"percent\"], 0.01, \"prefix_only\", [\"<1>\"]],\n    \"<ppm>\" :  [[\"ppm\"],1e-6, \"prefix_only\", [\"<1>\"]],\n    \"<ppt>\" :  [[\"ppt\"],1e-9, \"prefix_only\", [\"<1>\"]],\n    \"<gross>\" :  [[\"gr\",\"gross\"],144.0, \"prefix_only\", [\"<dozen>\",\"<dozen>\"]],\n    \"<decibel>\"  : [[\"dB\",\"decibel\",\"decibels\"], 1.0, \"logarithmic\", [\"<decibel>\"]]\n  };\n\n  var BASE_UNITS = [\"<meter>\",\"<kilogram>\",\"<second>\",\"<mole>\", \"<ampere>\",\"<radian>\",\"<kelvin>\",\"<temp-K>\",\"<byte>\",\"<dollar>\",\"<candela>\",\"<each>\",\"<steradian>\",\"<decibel>\"];\n\n  var UNITY = \"<1>\";\n  var UNITY_ARRAY = [UNITY];\n\n  // Setup\n\n  /**\n   * Asserts unit definition is valid\n   *\n   * @param {string} unitDef - Name of unit to test\n   * @param {Object} definition - Definition of unit to test\n   *\n   * @returns {void}\n   * @throws {QtyError} if unit definition is not valid\n   */\n  function validateUnitDefinition(unitDef, definition) {\n    var scalar = definition[1];\n    var numerator = definition[3] || [];\n    var denominator = definition[4] || [];\n    if (!isNumber(scalar)) {\n      throw new QtyError(unitDef + \": Invalid unit definition. \" +\n                         \"'scalar' must be a number\");\n    }\n\n    numerator.forEach(function(unit) {\n      if (UNITS[unit] === undefined) {\n        throw new QtyError(unitDef + \": Invalid unit definition. \" +\n                           \"Unit \" + unit + \" in 'numerator' is not recognized\");\n      }\n    });\n\n    denominator.forEach(function(unit) {\n      if (UNITS[unit] === undefined) {\n        throw new QtyError(unitDef + \": Invalid unit definition. \" +\n                           \"Unit \" + unit + \" in 'denominator' is not recognized\");\n      }\n    });\n  }\n\n  var PREFIX_VALUES = {};\n  var PREFIX_MAP = {};\n  var UNIT_VALUES = {};\n  var UNIT_MAP = {};\n  var OUTPUT_MAP = {};\n  for (var unitDef in UNITS) {\n    if (UNITS.hasOwnProperty(unitDef)) {\n      var definition = UNITS[unitDef];\n      if (definition[2] === \"prefix\") {\n        PREFIX_VALUES[unitDef] = definition[1];\n        for (var i = 0; i < definition[0].length; i++) {\n          PREFIX_MAP[definition[0][i]] = unitDef;\n        }\n      }\n      else {\n        validateUnitDefinition(unitDef, definition);\n        UNIT_VALUES[unitDef] = {\n          scalar: definition[1],\n          numerator: definition[3],\n          denominator: definition[4]\n        };\n        for (var j = 0; j < definition[0].length; j++) {\n          UNIT_MAP[definition[0][j]] = unitDef;\n        }\n      }\n      OUTPUT_MAP[unitDef] = definition[0][0];\n    }\n  }\n\n  /**\n   * Returns a list of available units of kind\n   *\n   * @param {string} [kind] - kind of units\n   * @returns {array} names of units\n   * @throws {QtyError} if kind is unknown\n   */\n  function getUnits(kind) {\n    var i;\n    var units = [];\n    var unitKeys = Object.keys(UNITS);\n    if (typeof kind === \"undefined\") {\n      for (i = 0; i < unitKeys.length; i++) {\n        if ([\"\", \"prefix\"].indexOf(UNITS[unitKeys[i]][2]) === -1) {\n          units.push(unitKeys[i].substr(1, unitKeys[i].length - 2));\n        }\n      }\n    }\n    else if (this.getKinds().indexOf(kind) === -1) {\n      throw new QtyError(\"Kind not recognized\");\n    }\n    else {\n      for (i = 0; i < unitKeys.length; i++) {\n        if (UNITS[unitKeys[i]][2] === kind) {\n          units.push(unitKeys[i].substr(1, unitKeys[i].length - 2));\n        }\n      }\n    }\n\n    return units.sort(function(a, b) {\n      if (a.toLowerCase() < b.toLowerCase()) {\n        return -1;\n      }\n      if (a.toLowerCase() > b.toLowerCase()) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  /**\n   * Returns a list of alternative names for a unit\n   *\n   * @param {string} unitName - name of unit\n   * @returns {string[]} aliases for unit\n   * @throws {QtyError} if unit is unknown\n   */\n  function getAliases(unitName) {\n    if (!UNIT_MAP[unitName]) {\n      throw new QtyError(\"Unit not recognized\");\n    }\n    return UNITS[UNIT_MAP[unitName]][0];\n  }\n\n  var SIGNATURE_VECTOR = [\"length\", \"time\", \"temperature\", \"mass\", \"current\", \"substance\", \"luminosity\", \"currency\", \"information\", \"angle\"];\n\n  /*\n  calculates the unit signature id for use in comparing compatible units and simplification\n  the signature is based on a simple classification of units and is based on the following publication\n\n  Novak, G.S., Jr. \"Conversion of units of measurement\", IEEE Transactions on Software Engineering,\n  21(8), Aug 1995, pp.651-661\n  doi://10.1109/32.403789\n  http://ieeexplore.ieee.org/Xplore/login.jsp?url=/iel1/32/9079/00403789.pdf?isnumber=9079&prod=JNL&arnumber=403789&arSt=651&ared=661&arAuthor=Novak%2C+G.S.%2C+Jr.\n  */\n  function unitSignature() {\n    if (this.signature) {\n      return this.signature;\n    }\n    var vector = unitSignatureVector.call(this);\n    for (var i = 0; i < vector.length; i++) {\n      vector[i] *= Math.pow(20, i);\n    }\n\n    return vector.reduce(\n      function(previous, current) {\n        return previous + current;\n      },\n      0\n    );\n  }\n\n  // calculates the unit signature vector used by unit_signature\n  function unitSignatureVector() {\n    if (!this.isBase()) {\n      return unitSignatureVector.call(this.toBase());\n    }\n\n    var vector = new Array(SIGNATURE_VECTOR.length);\n    for (var i = 0; i < vector.length; i++) {\n      vector[i] = 0;\n    }\n    var r, n;\n    for (var j = 0; j < this.numerator.length; j++) {\n      if ((r = UNITS[this.numerator[j]])) {\n        n = SIGNATURE_VECTOR.indexOf(r[2]);\n        if (n >= 0) {\n          vector[n] = vector[n] + 1;\n        }\n      }\n    }\n\n    for (var k = 0; k < this.denominator.length; k++) {\n      if ((r = UNITS[this.denominator[k]])) {\n        n = SIGNATURE_VECTOR.indexOf(r[2]);\n        if (n >= 0) {\n          vector[n] = vector[n] - 1;\n        }\n      }\n    }\n    return vector;\n  }\n\n  var SIGN = \"[+-]\";\n  var INTEGER = \"\\\\d+\";\n  var SIGNED_INTEGER = SIGN + \"?\" + INTEGER;\n  var FRACTION = \"\\\\.\" + INTEGER;\n  var FLOAT = \"(?:\" + INTEGER + \"(?:\" + FRACTION + \")?\" + \")\" +\n              \"|\" +\n              \"(?:\" + FRACTION + \")\";\n  var EXPONENT = \"[Ee]\" + SIGNED_INTEGER;\n  var SCI_NUMBER = \"(?:\" + FLOAT + \")(?:\" + EXPONENT + \")?\";\n  var SIGNED_NUMBER = SIGN + \"?\\\\s*\" + SCI_NUMBER;\n  var QTY_STRING = \"(\" + SIGNED_NUMBER + \")?\" + \"\\\\s*([^/]*)(?:\\/(.+))?\";\n  var QTY_STRING_REGEX = new RegExp(\"^\" + QTY_STRING + \"$\");\n\n  var POWER_OP = \"\\\\^|\\\\*{2}\";\n  // Allow unit powers representing scalar, length, area, volume; 4 is for some\n  // special case representations in SI base units.\n  var SAFE_POWER = \"[01234]\";\n  var TOP_REGEX = new RegExp (\"([^ \\\\*\\\\d]+?)(?:\" + POWER_OP + \")?(-?\" + SAFE_POWER + \"(?![a-zA-Z]))\");\n  var BOTTOM_REGEX = new RegExp(\"([^ \\\\*\\\\d]+?)(?:\" + POWER_OP + \")?(\" + SAFE_POWER + \"(?![a-zA-Z]))\");\n\n  /* parse a string into a unit object.\n   * Typical formats like :\n   * \"5.6 kg*m/s^2\"\n   * \"5.6 kg*m*s^-2\"\n   * \"5.6 kilogram*meter*second^-2\"\n   * \"2.2 kPa\"\n   * \"37 degC\"\n   * \"1\"  -- creates a unitless constant with value 1\n   * \"GPa\"  -- creates a unit with scalar 1 with units 'GPa'\n   * 6'4\"  -- recognized as 6 feet + 4 inches\n   * 8 lbs 8 oz -- recognized as 8 lbs + 8 ounces\n   */\n  function parse(val) {\n    if (!isString(val)) {\n      val = val.toString();\n    }\n    val = val.trim();\n\n    var result = QTY_STRING_REGEX.exec(val);\n    if (!result) {\n      throw new QtyError(val + \": Quantity not recognized\");\n    }\n\n    var scalarMatch = result[1];\n    if (scalarMatch) {\n      // Allow whitespaces between sign and scalar for loose parsing\n      scalarMatch = scalarMatch.replace(/\\s/g, \"\");\n      this.scalar = parseFloat(scalarMatch);\n    }\n    else {\n      this.scalar = 1;\n    }\n    var top = result[2];\n    var bottom = result[3];\n\n    var n, x, nx;\n    // TODO DRY me\n    while ((result = TOP_REGEX.exec(top))) {\n      n = parseFloat(result[2]);\n      if (isNaN(n)) {\n        // Prevents infinite loops\n        throw new QtyError(\"Unit exponent is not a number\");\n      }\n      // Disallow unrecognized unit even if exponent is 0\n      if (n === 0 && !UNIT_TEST_REGEX.test(result[1])) {\n        throw new QtyError(\"Unit not recognized\");\n      }\n      x = result[1] + \" \";\n      nx = \"\";\n      for (var i = 0; i < Math.abs(n) ; i++) {\n        nx += x;\n      }\n      if (n >= 0) {\n        top = top.replace(result[0], nx);\n      }\n      else {\n        bottom = bottom ? bottom + nx : nx;\n        top = top.replace(result[0], \"\");\n      }\n    }\n\n    while ((result = BOTTOM_REGEX.exec(bottom))) {\n      n = parseFloat(result[2]);\n      if (isNaN(n)) {\n        // Prevents infinite loops\n        throw new QtyError(\"Unit exponent is not a number\");\n      }\n      // Disallow unrecognized unit even if exponent is 0\n      if (n === 0 && !UNIT_TEST_REGEX.test(result[1])) {\n        throw new QtyError(\"Unit not recognized\");\n      }\n      x = result[1] + \" \";\n      nx = \"\";\n      for (var j = 0; j < n ; j++) {\n        nx += x;\n      }\n\n      bottom = bottom.replace(result[0], nx);\n    }\n\n    if (top) {\n      this.numerator = parseUnits(top.trim());\n    }\n    if (bottom) {\n      this.denominator = parseUnits(bottom.trim());\n    }\n  }\n\n  var PREFIX_REGEX = Object.keys(PREFIX_MAP).sort(function(a, b) {\n    return b.length - a.length;\n  }).join(\"|\");\n  var UNIT_REGEX = Object.keys(UNIT_MAP).sort(function(a, b) {\n    return b.length - a.length;\n  }).join(\"|\");\n  /*\n   * Minimal boundary regex to support units with Unicode characters\n   * \\b only works for ASCII\n   */\n  var BOUNDARY_REGEX = \"\\\\b|$\";\n  var UNIT_MATCH = \"(\" + PREFIX_REGEX + \")??(\" +\n                   UNIT_REGEX +\n                   \")(?:\" + BOUNDARY_REGEX + \")\";\n  var UNIT_TEST_REGEX = new RegExp(\"^\\\\s*(\" + UNIT_MATCH + \"[\\\\s\\\\*]*)+$\");\n  var UNIT_MATCH_REGEX = new RegExp(UNIT_MATCH, \"g\"); // g flag for multiple occurences\n  var parsedUnitsCache = {};\n  /**\n   * Parses and converts units string to normalized unit array.\n   * Result is cached to speed up next calls.\n   *\n   * @param {string} units Units string\n   * @returns {string[]} Array of normalized units\n   *\n   * @example\n   * // Returns [\"<second>\", \"<meter>\", \"<second>\"]\n   * parseUnits(\"s m s\");\n   *\n   */\n  function parseUnits(units) {\n    var cached = parsedUnitsCache[units];\n    if (cached) {\n      return cached;\n    }\n\n    var unitMatch, normalizedUnits = [];\n\n    // Scan\n    if (!UNIT_TEST_REGEX.test(units)) {\n      throw new QtyError(\"Unit not recognized\");\n    }\n\n    while ((unitMatch = UNIT_MATCH_REGEX.exec(units))) {\n      normalizedUnits.push(unitMatch.slice(1));\n    }\n\n    normalizedUnits = normalizedUnits.map(function(item) {\n      return PREFIX_MAP[item[0]] ? [PREFIX_MAP[item[0]], UNIT_MAP[item[1]]] : [UNIT_MAP[item[1]]];\n    });\n\n    // Flatten and remove null elements\n    normalizedUnits = normalizedUnits.reduce(function(a,b) {\n      return a.concat(b);\n    }, []);\n    normalizedUnits = normalizedUnits.filter(function(item) {\n      return item;\n    });\n\n    parsedUnitsCache[units] = normalizedUnits;\n\n    return normalizedUnits;\n  }\n\n  /**\n   * Parses a string as a quantity\n   * @param {string} value - quantity as text\n   * @throws if value is not a string\n   * @returns {Qty|null} Parsed quantity or null if unrecognized\n   */\n  function globalParse(value) {\n    if (!isString(value)) {\n      throw new QtyError(\"Argument should be a string\");\n    }\n\n    try {\n      return this(value);\n    }\n    catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * Tests if a value is a Qty instance\n   *\n   * @param {*} value - Value to test\n   *\n   * @returns {boolean} true if value is a Qty instance, false otherwise\n   */\n  function isQty(value) {\n    return value instanceof Qty;\n  }\n\n  function Qty(initValue, initUnits) {\n    assertValidConstructorArgs.apply(null, arguments);\n\n    if (!(isQty(this))) {\n      return new Qty(initValue, initUnits);\n    }\n\n    this.scalar = null;\n    this.baseScalar = null;\n    this.signature = null;\n    this._conversionCache = {};\n    this.numerator = UNITY_ARRAY;\n    this.denominator = UNITY_ARRAY;\n\n    if (isDefinitionObject(initValue)) {\n      this.scalar = initValue.scalar;\n      this.numerator = (initValue.numerator && initValue.numerator.length !== 0) ? initValue.numerator : UNITY_ARRAY;\n      this.denominator = (initValue.denominator && initValue.denominator.length !== 0) ? initValue.denominator : UNITY_ARRAY;\n    }\n    else if (initUnits) {\n      parse.call(this, initUnits);\n      this.scalar = initValue;\n    }\n    else {\n      parse.call(this, initValue);\n    }\n\n    // math with temperatures is very limited\n    if (this.denominator.join(\"*\").indexOf(\"temp\") >= 0) {\n      throw new QtyError(\"Cannot divide with temperatures\");\n    }\n    if (this.numerator.join(\"*\").indexOf(\"temp\") >= 0) {\n      if (this.numerator.length > 1) {\n        throw new QtyError(\"Cannot multiply by temperatures\");\n      }\n      if (!compareArray(this.denominator, UNITY_ARRAY)) {\n        throw new QtyError(\"Cannot divide with temperatures\");\n      }\n    }\n\n    this.initValue = initValue;\n    updateBaseScalar.call(this);\n\n    if (this.isTemperature() && this.baseScalar < 0) {\n      throw new QtyError(\"Temperatures must not be less than absolute zero\");\n    }\n  }\n\n  Qty.prototype = {\n    // Properly set up constructor\n    constructor: Qty,\n  };\n\n  /**\n   * Asserts constructor arguments are valid\n   *\n   * @param {*} value - Value to test\n   * @param {string} [units] - Optional units when value is passed as a number\n   *\n   * @returns {void}\n   * @throws {QtyError} if constructor arguments are invalid\n   */\n  function assertValidConstructorArgs(value, units) {\n    if (units) {\n      if (!(isNumber(value) && isString(units))) {\n        throw new QtyError(\"Only number accepted as initialization value \" +\n                           \"when units are explicitly provided\");\n      }\n    }\n    else {\n      if (!(isString(value) ||\n            isNumber(value) ||\n            isQty(value)    ||\n            isDefinitionObject(value))) {\n        throw new QtyError(\"Only string, number or quantity accepted as \" +\n                           \"single initialization value\");\n      }\n    }\n  }\n\n  /**\n   * Tests if a value is a Qty definition object\n   *\n   * @param {*} value - Value to test\n   *\n   * @returns {boolean} true if value is a definition object, false otherwise\n   */\n  function isDefinitionObject(value) {\n    return value && typeof value === \"object\" && value.hasOwnProperty(\"scalar\");\n  }\n\n  function updateBaseScalar() {\n    if (this.baseScalar) {\n      return this.baseScalar;\n    }\n    if (this.isBase()) {\n      this.baseScalar = this.scalar;\n      this.signature = unitSignature.call(this);\n    }\n    else {\n      var base = this.toBase();\n      this.baseScalar = base.scalar;\n      this.signature = base.signature;\n    }\n  }\n\n  var KINDS = {\n    \"-312078\": \"elastance\",\n    \"-312058\": \"resistance\",\n    \"-312038\": \"inductance\",\n    \"-152058\": \"potential\",\n    \"-152040\": \"magnetism\",\n    \"-152038\": \"magnetism\",\n    \"-7997\": \"specific_volume\",\n    \"-79\": \"snap\",\n    \"-59\": \"jolt\",\n    \"-39\": \"acceleration\",\n    \"-38\": \"radiation\",\n    \"-20\": \"frequency\",\n    \"-19\": \"speed\",\n    \"-18\": \"viscosity\",\n    \"-17\": \"volumetric_flow\",\n    \"-1\": \"wavenumber\",\n    \"0\": \"unitless\",\n    \"1\": \"length\",\n    \"2\": \"area\",\n    \"3\": \"volume\",\n    \"20\": \"time\",\n    \"400\": \"temperature\",\n    \"7941\": \"yank\",\n    \"7942\": \"power\",\n    \"7959\": \"pressure\",\n    \"7961\": \"force\",\n    \"7962\": \"energy\",\n    \"7979\": \"viscosity\",\n    \"7981\": \"momentum\",\n    \"7982\": \"angular_momentum\",\n    \"7997\": \"density\",\n    \"7998\": \"area_density\",\n    \"8000\": \"mass\",\n    \"152020\": \"radiation_exposure\",\n    \"159999\": \"magnetism\",\n    \"160000\": \"current\",\n    \"160020\": \"charge\",\n    \"312058\": \"conductance\",\n    \"312078\": \"capacitance\",\n    \"3199980\": \"activity\",\n    \"3199997\": \"molar_concentration\",\n    \"3200000\": \"substance\",\n    \"63999998\": \"illuminance\",\n    \"64000000\": \"luminous_power\",\n    \"1280000000\": \"currency\",\n    \"25599999980\": \"information_rate\",\n    \"25600000000\": \"information\",\n    \"511999999980\": \"angular_velocity\",\n    \"512000000000\": \"angle\"\n  };\n\n  /**\n   * Returns the list of available well-known kinds of units, e.g.\n   * \"radiation\" or \"length\".\n   *\n   * @returns {string[]} names of kinds of units\n   */\n  function getKinds() {\n    return uniq(Object.keys(KINDS).map(function(knownSignature) {\n      return KINDS[knownSignature];\n    }));\n  }\n\n  Qty.prototype.kind = function() {\n    return KINDS[this.signature.toString()];\n  };\n\n  assign(Qty.prototype, {\n    isDegrees: function() {\n      // signature may not have been calculated yet\n      return (this.signature === null || this.signature === 400) &&\n        this.numerator.length === 1 &&\n        compareArray(this.denominator, UNITY_ARRAY) &&\n        (this.numerator[0].match(/<temp-[CFRK]>/) || this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/));\n    },\n\n    isTemperature: function() {\n      return this.isDegrees() && this.numerator[0].match(/<temp-[CFRK]>/);\n    }\n  });\n\n  function subtractTemperatures(lhs,rhs) {\n    var lhsUnits = lhs.units();\n    var rhsConverted = rhs.to(lhsUnits);\n    var dstDegrees = Qty(getDegreeUnits(lhsUnits));\n    return Qty({\"scalar\": lhs.scalar - rhsConverted.scalar, \"numerator\": dstDegrees.numerator, \"denominator\": dstDegrees.denominator});\n  }\n\n  function subtractTempDegrees(temp,deg) {\n    var tempDegrees = deg.to(getDegreeUnits(temp.units()));\n    return Qty({\"scalar\": temp.scalar - tempDegrees.scalar, \"numerator\": temp.numerator, \"denominator\": temp.denominator});\n  }\n\n  function addTempDegrees(temp,deg) {\n    var tempDegrees = deg.to(getDegreeUnits(temp.units()));\n    return Qty({\"scalar\": temp.scalar + tempDegrees.scalar, \"numerator\": temp.numerator, \"denominator\": temp.denominator});\n  }\n\n  function getDegreeUnits(units) {\n    if (units === \"tempK\") {\n      return \"degK\";\n    }\n    else if (units === \"tempC\") {\n      return \"degC\";\n    }\n    else if (units === \"tempF\") {\n      return \"degF\";\n    }\n    else if (units === \"tempR\") {\n      return \"degR\";\n    }\n    else {\n      throw new QtyError(\"Unknown type for temp conversion from: \" + units);\n    }\n  }\n\n  function toDegrees(src,dst) {\n    var srcDegK = toDegK(src);\n    var dstUnits = dst.units();\n    var dstScalar;\n\n    if (dstUnits === \"degK\") {\n      dstScalar = srcDegK.scalar;\n    }\n    else if (dstUnits === \"degC\") {\n      dstScalar = srcDegK.scalar ;\n    }\n    else if (dstUnits === \"degF\") {\n      dstScalar = srcDegK.scalar * 9 / 5;\n    }\n    else if (dstUnits === \"degR\") {\n      dstScalar = srcDegK.scalar * 9 / 5;\n    }\n    else {\n      throw new QtyError(\"Unknown type for degree conversion to: \" + dstUnits);\n    }\n\n    return Qty({\"scalar\": dstScalar, \"numerator\": dst.numerator, \"denominator\": dst.denominator});\n  }\n\n  function toDegK(qty) {\n    var units = qty.units();\n    var q;\n    if (units.match(/(deg)[CFRK]/)) {\n      q = qty.baseScalar;\n    }\n    else if (units === \"tempK\") {\n      q = qty.scalar;\n    }\n    else if (units === \"tempC\") {\n      q = qty.scalar;\n    }\n    else if (units === \"tempF\") {\n      q = qty.scalar * 5 / 9;\n    }\n    else if (units === \"tempR\") {\n      q = qty.scalar * 5 / 9;\n    }\n    else {\n      throw new QtyError(\"Unknown type for temp conversion from: \" + units);\n    }\n\n    return Qty({\"scalar\": q, \"numerator\": [\"<kelvin>\"], \"denominator\": UNITY_ARRAY});\n  }\n\n  function toTemp(src,dst) {\n    var dstUnits = dst.units();\n    var dstScalar;\n\n    if (dstUnits === \"tempK\") {\n      dstScalar = src.baseScalar;\n    }\n    else if (dstUnits === \"tempC\") {\n      dstScalar = src.baseScalar - 273.15;\n    }\n    else if (dstUnits === \"tempF\") {\n      dstScalar = (src.baseScalar * 9 / 5) - 459.67;\n    }\n    else if (dstUnits === \"tempR\") {\n      dstScalar = src.baseScalar * 9 / 5;\n    }\n    else {\n      throw new QtyError(\"Unknown type for temp conversion to: \" + dstUnits);\n    }\n\n    return Qty({\"scalar\": dstScalar, \"numerator\": dst.numerator, \"denominator\": dst.denominator});\n  }\n\n  function toTempK(qty) {\n    var units = qty.units();\n    var q;\n    if (units.match(/(deg)[CFRK]/)) {\n      q = qty.baseScalar;\n    }\n    else if (units === \"tempK\") {\n      q = qty.scalar;\n    }\n    else if (units === \"tempC\") {\n      q = qty.scalar + 273.15;\n    }\n    else if (units === \"tempF\") {\n      q = (qty.scalar + 459.67) * 5 / 9;\n    }\n    else if (units === \"tempR\") {\n      q = qty.scalar * 5 / 9;\n    }\n    else {\n      throw new QtyError(\"Unknown type for temp conversion from: \" + units);\n    }\n\n    return Qty({\"scalar\": q, \"numerator\": [\"<temp-K>\"], \"denominator\": UNITY_ARRAY});\n  }\n\n  assign(Qty.prototype, {\n    /**\n     * Converts to other compatible units.\n     * Instance's converted quantities are cached for faster subsequent calls.\n     *\n     * @param {(string|Qty)} other - Target units as string or retrieved from\n     *                               other Qty instance (scalar is ignored)\n     *\n     * @returns {Qty} New converted Qty instance with target units\n     *\n     * @throws {QtyError} if target units are incompatible\n     *\n     * @example\n     * var weight = Qty(\"25 kg\");\n     * weight.to(\"lb\"); // => Qty(\"55.11556554621939 lbs\");\n     * weight.to(Qty(\"3 g\")); // => Qty(\"25000 g\"); // scalar of passed Qty is ignored\n     */\n    to: function(other) {\n      var cached, target;\n\n      if (other === undefined || other === null) {\n        return this;\n      }\n\n      if (!isString(other)) {\n        return this.to(other.units());\n      }\n\n      cached = this._conversionCache[other];\n      if (cached) {\n        return cached;\n      }\n\n      // Instantiating target to normalize units\n      target = Qty(other);\n      if (target.units() === this.units()) {\n        return this;\n      }\n\n      if (!this.isCompatible(target)) {\n        if (this.isInverse(target)) {\n          target = this.inverse().to(other);\n        }\n        else {\n          throwIncompatibleUnits(this.units(), target.units());\n        }\n      }\n      else {\n        if (target.isTemperature()) {\n          target = toTemp(this,target);\n        }\n        else if (target.isDegrees()) {\n          target = toDegrees(this,target);\n        }\n        else {\n          var q = divSafe(this.baseScalar, target.baseScalar);\n          target = Qty({\"scalar\": q, \"numerator\": target.numerator, \"denominator\": target.denominator});\n        }\n      }\n\n      this._conversionCache[other] = target;\n      return target;\n    },\n\n    // convert to base SI units\n    // results of the conversion are cached so subsequent calls to this will be fast\n    toBase: function() {\n      if (this.isBase()) {\n        return this;\n      }\n\n      if (this.isTemperature()) {\n        return toTempK(this);\n      }\n\n      var cached = baseUnitCache[this.units()];\n      if (!cached) {\n        cached = toBaseUnits(this.numerator,this.denominator);\n        baseUnitCache[this.units()] = cached;\n      }\n      return cached.mul(this.scalar);\n    },\n\n    // Converts the unit back to a float if it is unitless.  Otherwise raises an exception\n    toFloat: function() {\n      if (this.isUnitless()) {\n        return this.scalar;\n      }\n      throw new QtyError(\"Can't convert to Float unless unitless.  Use Unit#scalar\");\n    },\n\n    /**\n     * Returns the nearest multiple of quantity passed as\n     * precision\n     *\n     * @param {(Qty|string|number)} precQuantity - Quantity, string formated\n     *   quantity or number as expected precision\n     *\n     * @returns {Qty} Nearest multiple of precQuantity\n     *\n     * @example\n     * Qty('5.5 ft').toPrec('2 ft'); // returns 6 ft\n     * Qty('0.8 cu').toPrec('0.25 cu'); // returns 0.75 cu\n     * Qty('6.3782 m').toPrec('cm'); // returns 6.38 m\n     * Qty('1.146 MPa').toPrec('0.1 bar'); // returns 1.15 MPa\n     *\n     */\n    toPrec: function(precQuantity) {\n      if (isString(precQuantity)) {\n        precQuantity = Qty(precQuantity);\n      }\n      if (isNumber(precQuantity)) {\n        precQuantity = Qty(precQuantity + \" \" + this.units());\n      }\n\n      if (!this.isUnitless()) {\n        precQuantity = precQuantity.to(this.units());\n      }\n      else if (!precQuantity.isUnitless()) {\n        throwIncompatibleUnits(this.units(), precQuantity.units());\n      }\n\n      if (precQuantity.scalar === 0) {\n        throw new QtyError(\"Divide by zero\");\n      }\n\n      var precRoundedResult = mulSafe(\n        Math.round(this.scalar / precQuantity.scalar),\n        precQuantity.scalar\n      );\n\n      return Qty(precRoundedResult + this.units());\n    }\n  });\n\n  /**\n   * Configures and returns a fast function to convert\n   * Number values from units to others.\n   * Useful to efficiently convert large array of values\n   * with same units into others with iterative methods.\n   * Does not take care of rounding issues.\n   *\n   * @param {string} srcUnits Units of values to convert\n   * @param {string} dstUnits Units to convert to\n   *\n   * @returns {Function} Converting function accepting Number value\n   *   and returning converted value\n   *\n   * @throws \"Incompatible units\" if units are incompatible\n   *\n   * @example\n   * // Converting large array of numbers with the same units\n   * // into other units\n   * var converter = Qty.swiftConverter(\"m/h\", \"ft/s\");\n   * var convertedSerie = largeSerie.map(converter);\n   *\n   */\n  function swiftConverter(srcUnits, dstUnits) {\n    var srcQty = Qty(srcUnits);\n    var dstQty = Qty(dstUnits);\n\n    if (srcQty.eq(dstQty)) {\n      return identity;\n    }\n\n    var convert;\n    if (!srcQty.isTemperature()) {\n      convert = function(value) {\n        return value * srcQty.baseScalar / dstQty.baseScalar;\n      };\n    }\n    else {\n      convert = function(value) {\n        // TODO Not optimized\n        return srcQty.mul(value).to(dstQty).scalar;\n      };\n    }\n\n    return function converter(value) {\n      var i, length, result;\n      if (!Array.isArray(value)) {\n        return convert(value);\n      }\n      else {\n        length = value.length;\n        result = [];\n        for (i = 0; i < length; i++) {\n          result.push(convert(value[i]));\n        }\n        return result;\n      }\n    };\n  }\n\n  var baseUnitCache = {};\n\n  function toBaseUnits(numerator,denominator) {\n    var num = [];\n    var den = [];\n    var q = 1;\n    var unit;\n    for (var i = 0; i < numerator.length; i++) {\n      unit = numerator[i];\n      if (PREFIX_VALUES[unit]) {\n        // workaround to fix\n        // 0.1 * 0.1 => 0.010000000000000002\n        q = mulSafe(q, PREFIX_VALUES[unit]);\n      }\n      else {\n        if (UNIT_VALUES[unit]) {\n          q *= UNIT_VALUES[unit].scalar;\n\n          if (UNIT_VALUES[unit].numerator) {\n            num.push(UNIT_VALUES[unit].numerator);\n          }\n          if (UNIT_VALUES[unit].denominator) {\n            den.push(UNIT_VALUES[unit].denominator);\n          }\n        }\n      }\n    }\n    for (var j = 0; j < denominator.length; j++) {\n      unit = denominator[j];\n      if (PREFIX_VALUES[unit]) {\n        q /= PREFIX_VALUES[unit];\n      }\n      else {\n        if (UNIT_VALUES[unit]) {\n          q /= UNIT_VALUES[unit].scalar;\n\n          if (UNIT_VALUES[unit].numerator) {\n            den.push(UNIT_VALUES[unit].numerator);\n          }\n          if (UNIT_VALUES[unit].denominator) {\n            num.push(UNIT_VALUES[unit].denominator);\n          }\n        }\n      }\n    }\n\n    // Flatten\n    num = num.reduce(function(a,b) {\n      return a.concat(b);\n    }, []);\n    den = den.reduce(function(a,b) {\n      return a.concat(b);\n    }, []);\n\n    return Qty({\"scalar\": q, \"numerator\": num, \"denominator\": den});\n  }\n\n  Qty.parse = globalParse;\n\n  Qty.getUnits = getUnits;\n  Qty.getAliases = getAliases;\n\n  Qty.mulSafe = mulSafe;\n  Qty.divSafe = divSafe;\n\n  Qty.getKinds = getKinds;\n\n  Qty.swiftConverter = swiftConverter;\n\n  Qty.Error = QtyError;\n\n  assign(Qty.prototype, {\n    // Returns new instance with units of this\n    add: function(other) {\n      if (isString(other)) {\n        other = Qty(other);\n      }\n\n      if (!this.isCompatible(other)) {\n        throwIncompatibleUnits(this.units(), other.units());\n      }\n\n      if (this.isTemperature() && other.isTemperature()) {\n        throw new QtyError(\"Cannot add two temperatures\");\n      }\n      else if (this.isTemperature()) {\n        return addTempDegrees(this, other);\n      }\n      else if (other.isTemperature()) {\n        return addTempDegrees(other, this);\n      }\n\n      return Qty({\"scalar\": this.scalar + other.to(this).scalar, \"numerator\": this.numerator, \"denominator\": this.denominator});\n    },\n\n    sub: function(other) {\n      if (isString(other)) {\n        other = Qty(other);\n      }\n\n      if (!this.isCompatible(other)) {\n        throwIncompatibleUnits(this.units(), other.units());\n      }\n\n      if (this.isTemperature() && other.isTemperature()) {\n        return subtractTemperatures(this,other);\n      }\n      else if (this.isTemperature()) {\n        return subtractTempDegrees(this,other);\n      }\n      else if (other.isTemperature()) {\n        throw new QtyError(\"Cannot subtract a temperature from a differential degree unit\");\n      }\n\n      return Qty({\"scalar\": this.scalar - other.to(this).scalar, \"numerator\": this.numerator, \"denominator\": this.denominator});\n    },\n\n    mul: function(other) {\n      if (isNumber(other)) {\n        return Qty({\"scalar\": mulSafe(this.scalar, other), \"numerator\": this.numerator, \"denominator\": this.denominator});\n      }\n      else if (isString(other)) {\n        other = Qty(other);\n      }\n\n      if ((this.isTemperature() || other.isTemperature()) && !(this.isUnitless() || other.isUnitless())) {\n        throw new QtyError(\"Cannot multiply by temperatures\");\n      }\n\n      // Quantities should be multiplied with same units if compatible, with base units else\n      var op1 = this;\n      var op2 = other;\n\n      // so as not to confuse results, multiplication and division between temperature degrees will maintain original unit info in num/den\n      // multiplication and division between deg[CFRK] can never factor each other out, only themselves: \"degK*degC/degC^2\" == \"degK/degC\"\n      if (op1.isCompatible(op2) && op1.signature !== 400) {\n        op2 = op2.to(op1);\n      }\n      var numdenscale = cleanTerms(op1.numerator, op1.denominator, op2.numerator, op2.denominator);\n\n      return Qty({\"scalar\": mulSafe(op1.scalar, op2.scalar, numdenscale[2]), \"numerator\": numdenscale[0], \"denominator\": numdenscale[1]});\n    },\n\n    div: function(other) {\n      if (isNumber(other)) {\n        if (other === 0) {\n          throw new QtyError(\"Divide by zero\");\n        }\n        return Qty({\"scalar\": this.scalar / other, \"numerator\": this.numerator, \"denominator\": this.denominator});\n      }\n      else if (isString(other)) {\n        other = Qty(other);\n      }\n\n      if (other.scalar === 0) {\n        throw new QtyError(\"Divide by zero\");\n      }\n\n      if (other.isTemperature()) {\n        throw new QtyError(\"Cannot divide with temperatures\");\n      }\n      else if (this.isTemperature() && !other.isUnitless()) {\n        throw new QtyError(\"Cannot divide with temperatures\");\n      }\n\n      // Quantities should be multiplied with same units if compatible, with base units else\n      var op1 = this;\n      var op2 = other;\n\n      // so as not to confuse results, multiplication and division between temperature degrees will maintain original unit info in num/den\n      // multiplication and division between deg[CFRK] can never factor each other out, only themselves: \"degK*degC/degC^2\" == \"degK/degC\"\n      if (op1.isCompatible(op2) && op1.signature !== 400) {\n        op2 = op2.to(op1);\n      }\n      var numdenscale = cleanTerms(op1.numerator, op1.denominator, op2.denominator, op2.numerator);\n\n      return Qty({\"scalar\": mulSafe(op1.scalar, numdenscale[2]) / op2.scalar, \"numerator\": numdenscale[0], \"denominator\": numdenscale[1]});\n    },\n\n    // Returns a Qty that is the inverse of this Qty,\n    inverse: function() {\n      if (this.isTemperature()) {\n        throw new QtyError(\"Cannot divide with temperatures\");\n      }\n      if (this.scalar === 0) {\n        throw new QtyError(\"Divide by zero\");\n      }\n      return Qty({\"scalar\": 1 / this.scalar, \"numerator\": this.denominator, \"denominator\": this.numerator});\n    }\n  });\n\n  function cleanTerms(num1, den1, num2, den2) {\n    function notUnity(val) {\n      return val !== UNITY;\n    }\n\n    num1 = num1.filter(notUnity);\n    num2 = num2.filter(notUnity);\n    den1 = den1.filter(notUnity);\n    den2 = den2.filter(notUnity);\n\n    var combined = {};\n\n    function combineTerms(terms, direction) {\n      var k;\n      var prefix;\n      var prefixValue;\n      for (var i = 0; i < terms.length; i++) {\n        if (PREFIX_VALUES[terms[i]]) {\n          k = terms[i + 1];\n          prefix = terms[i];\n          prefixValue = PREFIX_VALUES[prefix];\n          i++;\n        }\n        else {\n          k = terms[i];\n          prefix = null;\n          prefixValue = 1;\n        }\n        if (k && k !== UNITY) {\n          if (combined[k]) {\n            combined[k][0] += direction;\n            var combinedPrefixValue = combined[k][2] ? PREFIX_VALUES[combined[k][2]] : 1;\n            combined[k][direction === 1 ? 3 : 4] *= divSafe(prefixValue, combinedPrefixValue);\n          }\n          else {\n            combined[k] = [direction, k, prefix, 1, 1];\n          }\n        }\n      }\n    }\n\n    combineTerms(num1, 1);\n    combineTerms(den1, -1);\n    combineTerms(num2, 1);\n    combineTerms(den2, -1);\n\n    var num = [];\n    var den = [];\n    var scale = 1;\n\n    for (var prop in combined) {\n      if (combined.hasOwnProperty(prop)) {\n        var item = combined[prop];\n        var n;\n        if (item[0] > 0) {\n          for (n = 0; n < item[0]; n++) {\n            num.push(item[2] === null ? item[1] : [item[2], item[1]]);\n          }\n        }\n        else if (item[0] < 0) {\n          for (n = 0; n < -item[0]; n++) {\n            den.push(item[2] === null ? item[1] : [item[2], item[1]]);\n          }\n        }\n        scale *= divSafe(item[3], item[4]);\n      }\n    }\n\n    if (num.length === 0) {\n      num = UNITY_ARRAY;\n    }\n    if (den.length === 0) {\n      den = UNITY_ARRAY;\n    }\n\n    // Flatten\n    num = num.reduce(function(a,b) {\n      return a.concat(b);\n    }, []);\n    den = den.reduce(function(a,b) {\n      return a.concat(b);\n    }, []);\n\n    return [num, den, scale];\n  }\n\n  assign(Qty.prototype, {\n    eq: function(other) {\n      return this.compareTo(other) === 0;\n    },\n\n    lt: function(other) {\n      return this.compareTo(other) === -1;\n    },\n\n    lte: function(other) {\n      return this.eq(other) || this.lt(other);\n    },\n\n    gt: function(other) {\n      return this.compareTo(other) === 1;\n    },\n\n    gte: function(other) {\n      return this.eq(other) || this.gt(other);\n    },\n\n    // Compare two Qty objects. Throws an exception if they are not of compatible types.\n    // Comparisons are done based on the value of the quantity in base SI units.\n    //\n    // NOTE: We cannot compare inverses as that breaks the general compareTo contract:\n    //   if a.compareTo(b) < 0 then b.compareTo(a) > 0\n    //   if a.compareTo(b) == 0 then b.compareTo(a) == 0\n    //\n    //   Since \"10S\" == \".1ohm\" (10 > .1) and \"10ohm\" == \".1S\" (10 > .1)\n    //     Qty(\"10S\").inverse().compareTo(\"10ohm\") == -1\n    //     Qty(\"10ohm\").inverse().compareTo(\"10S\") == -1\n    //\n    //   If including inverses in the sort is needed, I suggest writing: Qty.sort(qtyArray,units)\n    compareTo: function(other) {\n      if (isString(other)) {\n        return this.compareTo(Qty(other));\n      }\n      if (!this.isCompatible(other)) {\n        throwIncompatibleUnits(this.units(), other.units());\n      }\n      if (this.baseScalar < other.baseScalar) {\n        return -1;\n      }\n      else if (this.baseScalar === other.baseScalar) {\n        return 0;\n      }\n      else if (this.baseScalar > other.baseScalar) {\n        return 1;\n      }\n    },\n\n    // Return true if quantities and units match\n    // Unit(\"100 cm\").same(Unit(\"100 cm\"))  # => true\n    // Unit(\"100 cm\").same(Unit(\"1 m\"))     # => false\n    same: function(other) {\n      return (this.scalar === other.scalar) && (this.units() === other.units());\n    }\n  });\n\n  assign(Qty.prototype, {\n    // returns true if no associated units\n    // false, even if the units are \"unitless\" like 'radians, each, etc'\n    isUnitless: function() {\n      return [this.numerator, this.denominator].every(function(item) {\n        return compareArray(item, UNITY_ARRAY);\n      });\n    },\n\n    /*\n    check to see if units are compatible, but not the scalar part\n    this check is done by comparing signatures for performance reasons\n    if passed a string, it will create a unit object with the string and then do the comparison\n    this permits a syntax like:\n    unit =~ \"mm\"\n    if you want to do a regexp on the unit string do this ...\n    unit.units =~ /regexp/\n    */\n    isCompatible: function(other) {\n      if (isString(other)) {\n        return this.isCompatible(Qty(other));\n      }\n\n      if (!(isQty(other))) {\n        return false;\n      }\n\n      if (other.signature !== undefined) {\n        return this.signature === other.signature;\n      }\n      else {\n        return false;\n      }\n    },\n\n    /*\n    check to see if units are inverse of each other, but not the scalar part\n    this check is done by comparing signatures for performance reasons\n    if passed a string, it will create a unit object with the string and then do the comparison\n    this permits a syntax like:\n    unit =~ \"mm\"\n    if you want to do a regexp on the unit string do this ...\n    unit.units =~ /regexp/\n    */\n    isInverse: function(other) {\n      return this.inverse().isCompatible(other);\n    },\n\n    // Returns 'true' if the Unit is represented in base units\n    isBase: function() {\n      if (this._isBase !== undefined) {\n        return this._isBase;\n      }\n      if (this.isDegrees() && this.numerator[0].match(/<(kelvin|temp-K)>/)) {\n        this._isBase = true;\n        return this._isBase;\n      }\n\n      this.numerator.concat(this.denominator).forEach(function(item) {\n        if (item !== UNITY && BASE_UNITS.indexOf(item) === -1 ) {\n          this._isBase = false;\n        }\n      }, this);\n      if (this._isBase === false) {\n        return this._isBase;\n      }\n      this._isBase = true;\n      return this._isBase;\n    }\n  });\n\n  function NestedMap() {}\n\n  NestedMap.prototype.get = function(keys) {\n\n    // Allows to pass key1, key2, ... instead of [key1, key2, ...]\n    if (arguments.length > 1) {\n      // Slower with Firefox but faster with Chrome than\n      // Array.prototype.slice.call(arguments)\n      // See http://jsperf.com/array-apply-versus-array-prototype-slice-call\n      keys = Array.apply(null, arguments);\n    }\n\n    return keys.reduce(function(map, key, index) {\n      if (map) {\n\n        var childMap = map[key];\n\n        if (index === keys.length - 1) {\n          return childMap ? childMap.data : undefined;\n        }\n        else {\n          return childMap;\n        }\n      }\n    },\n    this);\n  };\n\n  NestedMap.prototype.set = function(keys, value) {\n\n    if (arguments.length > 2) {\n      keys = Array.prototype.slice.call(arguments, 0, -1);\n      value = arguments[arguments.length - 1];\n    }\n\n    return keys.reduce(function(map, key, index) {\n\n      var childMap = map[key];\n      if (childMap === undefined) {\n        childMap = map[key] = {};\n      }\n\n      if (index === keys.length - 1) {\n        childMap.data = value;\n        return value;\n      }\n      else {\n        return childMap;\n      }\n    }, this);\n  };\n\n  /**\n   * Default formatter\n   *\n   * @param {number} scalar - scalar value\n   * @param {string} units - units as string\n   *\n   * @returns {string} formatted result\n   */\n  function defaultFormatter(scalar, units) {\n    return (scalar + \" \" + units).trim();\n  }\n\n  /**\n   *\n   * Configurable Qty default formatter\n   *\n   * @type {function}\n   *\n   * @param {number} scalar\n   * @param {string} units\n   *\n   * @returns {string} formatted result\n   */\n  Qty.formatter = defaultFormatter;\n\n  assign(Qty.prototype, {\n\n    // returns the 'unit' part of the Unit object without the scalar\n    units: function() {\n      if (this._units !== undefined) {\n        return this._units;\n      }\n\n      var numIsUnity = compareArray(this.numerator, UNITY_ARRAY);\n      var denIsUnity = compareArray(this.denominator, UNITY_ARRAY);\n      if (numIsUnity && denIsUnity) {\n        this._units = \"\";\n        return this._units;\n      }\n\n      var numUnits = stringifyUnits(this.numerator);\n      var denUnits = stringifyUnits(this.denominator);\n      this._units = numUnits + (denIsUnity ? \"\" : (\"/\" + denUnits));\n      return this._units;\n    },\n\n    /**\n     * Stringifies the quantity\n     * Deprecation notice: only units parameter is supported.\n     *\n     * @param {(number|string|Qty)} targetUnitsOrMaxDecimalsOrPrec -\n     *                              target units if string,\n     *                              max number of decimals if number,\n     *                              passed to #toPrec before converting if Qty\n     *\n     * @param {number=} maxDecimals - Maximum number of decimals of\n     *                                formatted output\n     *\n     * @returns {string} reparseable quantity as string\n     */\n    toString: function(targetUnitsOrMaxDecimalsOrPrec, maxDecimals) {\n      var targetUnits;\n      if (isNumber(targetUnitsOrMaxDecimalsOrPrec)) {\n        targetUnits = this.units();\n        maxDecimals = targetUnitsOrMaxDecimalsOrPrec;\n      }\n      else if (isString(targetUnitsOrMaxDecimalsOrPrec)) {\n        targetUnits = targetUnitsOrMaxDecimalsOrPrec;\n      }\n      else if (isQty(targetUnitsOrMaxDecimalsOrPrec)) {\n        return this.toPrec(targetUnitsOrMaxDecimalsOrPrec).toString(maxDecimals);\n      }\n\n      var out = this.to(targetUnits);\n\n      var outScalar = maxDecimals !== undefined ? round(out.scalar, maxDecimals) : out.scalar;\n      out = (outScalar + \" \" + out.units()).trim();\n      return out;\n    },\n\n    /**\n     * Format the quantity according to optional passed target units\n     * and formatter\n     *\n     * @param {string} [targetUnits=current units] -\n     *                 optional units to convert to before formatting\n     *\n     * @param {function} [formatter=Qty.formatter] -\n     *                   delegates formatting to formatter callback.\n     *                   formatter is called back with two parameters (scalar, units)\n     *                   and should return formatted result.\n     *                   If unspecified, formatting is delegated to default formatter\n     *                   set to Qty.formatter\n     *\n     * @example\n     * var roundingAndLocalizingFormatter = function(scalar, units) {\n     *   // localize or limit scalar to n max decimals for instance\n     *   // return formatted result\n     * };\n     * var qty = Qty('1.1234 m');\n     * qty.format(); // same units, default formatter => \"1.234 m\"\n     * qty.format(\"cm\"); // converted to \"cm\", default formatter => \"123.45 cm\"\n     * qty.format(roundingAndLocalizingFormatter); // same units, custom formatter => \"1,2 m\"\n     * qty.format(\"cm\", roundingAndLocalizingFormatter); // convert to \"cm\", custom formatter => \"123,4 cm\"\n     *\n     * @returns {string} quantity as string\n     */\n    format: function(targetUnits, formatter) {\n      if (arguments.length === 1) {\n        if (typeof targetUnits === \"function\") {\n          formatter = targetUnits;\n          targetUnits = undefined;\n        }\n      }\n\n      formatter = formatter || Qty.formatter;\n      var targetQty = this.to(targetUnits);\n      return formatter.call(this, targetQty.scalar, targetQty.units());\n    }\n  });\n\n  var stringifiedUnitsCache = new NestedMap();\n  /**\n   * Returns a string representing a normalized unit array\n   *\n   * @param {string[]} units Normalized unit array\n   * @returns {string} String representing passed normalized unit array and\n   *   suitable for output\n   *\n   */\n  function stringifyUnits(units) {\n\n    var stringified = stringifiedUnitsCache.get(units);\n    if (stringified) {\n      return stringified;\n    }\n\n    var isUnity = compareArray(units, UNITY_ARRAY);\n    if (isUnity) {\n      stringified = \"1\";\n    }\n    else {\n      stringified = simplify(getOutputNames(units)).join(\"*\");\n    }\n\n    // Cache result\n    stringifiedUnitsCache.set(units, stringified);\n\n    return stringified;\n  }\n\n  function getOutputNames(units) {\n    var unitNames = [], token, tokenNext;\n    for (var i = 0; i < units.length; i++) {\n      token = units[i];\n      tokenNext = units[i + 1];\n      if (PREFIX_VALUES[token]) {\n        unitNames.push(OUTPUT_MAP[token] + OUTPUT_MAP[tokenNext]);\n        i++;\n      }\n      else {\n        unitNames.push(OUTPUT_MAP[token]);\n      }\n    }\n    return unitNames;\n  }\n\n  function simplify(units) {\n    // this turns ['s','m','s'] into ['s2','m']\n\n    var unitCounts = units.reduce(function(acc, unit) {\n      var unitCounter = acc[unit];\n      if (!unitCounter) {\n        acc.push(unitCounter = acc[unit] = [unit, 0]);\n      }\n\n      unitCounter[1]++;\n\n      return acc;\n    }, []);\n\n    return unitCounts.map(function(unitCount) {\n      return unitCount[0] + (unitCount[1] > 1 ? unitCount[1] : \"\");\n    });\n  }\n\n  Qty.version = \"1.7.6\";\n\n  return Qty;\n\n})));\n","import Qty from 'js-quantities';\r\nexport function convertUnit(array, fromUnit, toUnit) {\r\n    fromUnit = normalize(fromUnit);\r\n    toUnit = normalize(toUnit);\r\n    if (fromUnit === toUnit)\r\n        return array;\r\n    try {\r\n        const convert = Qty.swiftConverter(fromUnit, toUnit); // Configures converter\r\n        return convert(array);\r\n    }\r\n    catch (e) {\r\n        return undefined;\r\n    }\r\n}\r\nfunction normalize(unit) {\r\n    unit = unit.replace(/C/g, 'tempC');\r\n    unit = unit.replace(/F/g, 'tempF');\r\n    unit = unit.replace(/(^|\\W)K(\\W|$)/g, '$1tempK$2');\r\n    return unit;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydFVuaXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC9jb252ZXJ0VW5pdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEdBQUcsTUFBTSxlQUFlLENBQUM7QUFjaEMsTUFBTSxVQUFVLFdBQVcsQ0FDekIsS0FBVSxFQUNWLFFBQWdCLEVBQ2hCLE1BQWM7SUFFZCxRQUFRLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFM0IsSUFBSSxRQUFRLEtBQUssTUFBTTtRQUFFLE9BQU8sS0FBSyxDQUFDO0lBRXRDLElBQUk7UUFDRixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLHVCQUF1QjtRQUM3RSxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN2QjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxTQUFTLENBQUM7S0FDbEI7QUFDSCxDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUMsSUFBWTtJQUM3QixJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDcEMsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BDLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ25ELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyJ9","const testRegExp = /^\\/((?:\\\\\\/|[^/])+)\\/([migyu]{0,5})?$/;\r\nexport function ensureRegexp(string) {\r\n    if (typeof string !== 'string')\r\n        return string;\r\n    const parts = testRegExp.exec(string);\r\n    if (parts) {\r\n        try {\r\n            return new RegExp(parts[1], parts[2]);\r\n        }\r\n        catch (err) {\r\n            return stringToRegexp(string);\r\n        }\r\n    }\r\n    else {\r\n        return stringToRegexp(string);\r\n    }\r\n}\r\nfunction stringToRegexp(string, flags = 'i') {\r\n    return new RegExp(string.replace(/[[\\]\\\\{}()+*?.$^|]/g, (match) => `\\\\${match}`), flags);\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5zdXJlUmVnZXhwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvZW5zdXJlUmVnZXhwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sVUFBVSxHQUFHLHVDQUF1QyxDQUFDO0FBRTNELE1BQU0sVUFBVSxZQUFZLENBQUMsTUFBdUI7SUFDbEQsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRO1FBQUUsT0FBTyxNQUFNLENBQUM7SUFDOUMsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QyxJQUFJLEtBQUssRUFBRTtRQUNULElBQUk7WUFDRixPQUFPLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN2QztRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osT0FBTyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDL0I7S0FDRjtTQUFNO1FBQ0wsT0FBTyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDL0I7QUFDSCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsTUFBYyxFQUFFLEtBQUssR0FBRyxHQUFHO0lBQ2pELE9BQU8sSUFBSSxNQUFNLENBQ2YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEtBQWEsRUFBRSxFQUFFLENBQUMsS0FBSyxLQUFLLEVBQUUsQ0FBQyxFQUN0RSxLQUFLLENBQ04sQ0FBQztBQUNKLENBQUMifQ==","import max from 'ml-array-max';\r\nimport min from 'ml-array-min';\r\nimport { xIsMonotone } from 'ml-spectra-processing';\r\nimport { convertUnit } from './convertUnit';\r\nexport function getConvertedVariable(variable, newUnits) {\r\n    const data = variable.units !== undefined && variable.units !== newUnits // would be nice if convertUnit would allow typedArray\r\n        ? convertUnit(Array.from(variable.data), variable.units, newUnits)\r\n        : variable.data;\r\n    return {\r\n        units: newUnits,\r\n        label: variable.label.replace(`[${variable.units || ''}]`, `[${newUnits}]`),\r\n        data: data || [],\r\n        min: data ? min(data) : undefined,\r\n        max: data ? max(data) : undefined,\r\n        isMonotone: xIsMonotone(data),\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0Q29udmVydGVkVmFyaWFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC9nZXRDb252ZXJ0ZWRWYXJpYWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDL0IsT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTVDLE1BQU0sVUFBVSxvQkFBb0IsQ0FDbEMsUUFBMEIsRUFDMUIsUUFBZ0I7SUFFaEIsTUFBTSxJQUFJLEdBQ1IsUUFBUSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksUUFBUSxDQUFDLEtBQUssS0FBSyxRQUFRLENBQUMsc0RBQXNEO1FBQ2hILENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUM7UUFDbEUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFDcEIsT0FBTztRQUNMLEtBQUssRUFBRSxRQUFRO1FBQ2YsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLFFBQVEsR0FBRyxDQUFDO1FBQzNFLElBQUksRUFBRSxJQUFJLElBQUksRUFBRTtRQUNoQixHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7UUFDakMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO1FBQ2pDLFVBQVUsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDO0tBQzlCLENBQUM7QUFDSixDQUFDIn0=","import { convertUnit } from './convertUnit';\r\nimport { ensureRegexp } from './ensureRegexp';\r\nimport { getConvertedVariable } from './getConvertedVariable';\r\n/**\r\n * Retrieve the spectrum with only X/Y data that match all the selectors\r\n * If more than one variable match the selector the 'x' or 'y' variable will be\r\n * taken\r\n */\r\nexport function getXYSpectrum(spectra = [], selector = {}) {\r\n    if (spectra.length < 1)\r\n        return;\r\n    let { dataType, title, xUnits, yUnits, variables, xVariable = 'x', yVariable = 'y', units, labels, xLabel, yLabel, meta, index, } = selector;\r\n    if (index !== undefined) {\r\n        return spectra[index];\r\n    }\r\n    if (dataType) {\r\n        dataType = ensureRegexp(dataType);\r\n    }\r\n    if (title) {\r\n        title = ensureRegexp(title);\r\n    }\r\n    if (units && !xUnits && !yUnits)\r\n        [yUnits, xUnits] = units.split(/\\s*vs\\s*/);\r\n    if (labels && !xLabel && !yLabel) {\r\n        [yLabel, xLabel] = labels.split(/\\s*vs\\s*/);\r\n    }\r\n    if (variables) {\r\n        const parts = variables.split(/\\s*vs\\s*/);\r\n        if (parts.length === 2) {\r\n            xVariable = parts[1];\r\n            yVariable = parts[0];\r\n        }\r\n    }\r\n    if (xLabel)\r\n        xLabel = ensureRegexp(xLabel);\r\n    if (yLabel)\r\n        yLabel = ensureRegexp(yLabel);\r\n    for (let spectrum of spectra) {\r\n        let variableNames = Object.keys(spectrum.variables);\r\n        if (!(variableNames.length > 1))\r\n            continue;\r\n        // we filter on general spectrum information\r\n        if (dataType) {\r\n            if (!spectrum.dataType || !dataType.exec(spectrum.dataType)) {\r\n                continue;\r\n            }\r\n        }\r\n        if (title) {\r\n            if (!spectrum.title || !title.exec(spectrum.title)) {\r\n                continue;\r\n            }\r\n        }\r\n        if (meta && typeof meta === 'object') {\r\n            if (!spectrum.meta)\r\n                continue;\r\n            for (let key in spectrum.meta) {\r\n                if (!spectrum.meta[key])\r\n                    continue;\r\n                let value = ensureRegexp(spectrum.meta[key]);\r\n                if (!value.exec(spectrum.meta[key]))\r\n                    continue;\r\n            }\r\n        }\r\n        let x = getPossibleVariable(spectrum.variables, {\r\n            units: xUnits,\r\n            label: xLabel,\r\n            variableName: xVariable,\r\n        });\r\n        let y = getPossibleVariable(spectrum.variables, {\r\n            units: yUnits,\r\n            label: yLabel,\r\n            variableName: yVariable,\r\n        });\r\n        if (x && y) {\r\n            return {\r\n                title: spectrum.title,\r\n                dataType: spectrum.dataType,\r\n                meta: spectrum.meta,\r\n                variables: { x, y },\r\n            };\r\n        }\r\n    }\r\n    return;\r\n}\r\nfunction getPossibleVariable(variables, selector = {}) {\r\n    var _a, _b;\r\n    const { units, label, variableName } = selector;\r\n    let possible = { ...variables };\r\n    let key;\r\n    if (units !== undefined) {\r\n        for (key in possible) {\r\n            const variable = variables[key];\r\n            let converted = convertUnit(1, (variable === null || variable === void 0 ? void 0 : variable.units) || '', units);\r\n            if (converted && variable) {\r\n                possible[key] = getConvertedVariable(variable, units);\r\n            }\r\n            else {\r\n                delete possible[key];\r\n            }\r\n        }\r\n    }\r\n    if (label !== undefined) {\r\n        const regexpLabel = ensureRegexp(label);\r\n        for (key in possible) {\r\n            if (!regexpLabel.exec((_b = (_a = variables[key]) === null || _a === void 0 ? void 0 : _a.label) !== null && _b !== void 0 ? _b : '')) {\r\n                delete possible[key];\r\n            }\r\n        }\r\n    }\r\n    if (variableName !== undefined) {\r\n        if (possible[variableName])\r\n            return possible[variableName];\r\n        const upper = variableName.toUpperCase();\r\n        if (Object.prototype.hasOwnProperty.call(possible, upper)) {\r\n            return possible[upper];\r\n        }\r\n        const lower = variableName.toLowerCase();\r\n        if (Object.prototype.hasOwnProperty.call(possible, lower)) {\r\n            return possible[lower];\r\n        }\r\n    }\r\n    const possibleFiltered = Object.values(possible).filter((val) => val !== undefined);\r\n    if (possibleFiltered.length > 0) {\r\n        return possibleFiltered[0];\r\n    }\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0WFlTcGVjdHJ1bS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2dldFhZU3BlY3RydW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBU0EsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFOUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxhQUFhLENBQzNCLFVBQTJCLEVBQUUsRUFDN0IsV0FBNkIsRUFBRTtJQUUvQixJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUFFLE9BQU87SUFFL0IsSUFBSSxFQUNGLFFBQVEsRUFDUixLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxHQUFHLEdBQUcsRUFDZixTQUFTLEdBQUcsR0FBRyxFQUNmLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLE1BQU0sRUFDTixJQUFJLEVBQ0osS0FBSyxHQUNOLEdBQUcsUUFBUSxDQUFDO0lBRWIsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1FBQ3ZCLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ3ZCO0lBRUQsSUFBSSxRQUFRLEVBQUU7UUFDWixRQUFRLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ25DO0lBRUQsSUFBSSxLQUFLLEVBQUU7UUFDVCxLQUFLLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzdCO0lBRUQsSUFBSSxLQUFLLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNO1FBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM1RSxJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sSUFB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","import isAnyArray from 'is-any-array';\r\nimport max from 'ml-array-max';\r\nimport min from 'ml-array-min';\r\nimport { xIsMonotone } from 'ml-spectra-processing';\r\nimport { getNormalizedSpectrum } from './util/getNormalizedSpectrum';\r\nimport { getXYSpectrum } from './util/getXYSpectrum';\r\n/**\r\n * Class allowing to store and manipulate an analysis.\r\n * An analysis may contain one or more spectra that can be selected\r\n * based on their units\r\n */\r\nexport class Analysis {\r\n    constructor(options = {}) {\r\n        this.id = options.id || Math.random().toString(36).substring(2, 10);\r\n        this.label = options.label || this.id;\r\n        this.spectrumCallback = options.spectrumCallback;\r\n        this.spectra = [];\r\n        this.cache = {};\r\n    }\r\n    /**\r\n     * Add a spectrum in the internal spectra variable\r\n     */\r\n    pushSpectrum(variables, options = {}) {\r\n        this.spectra.push(standardizeData(variables, options, {\r\n            spectrumCallback: this.spectrumCallback,\r\n        }));\r\n        this.cache = {};\r\n    }\r\n    /**\r\n     * Retrieve a Spectrum based on x/y units\r\n     */\r\n    getXYSpectrum(selector = {}) {\r\n        let id = JSON.stringify(selector);\r\n        if (!this.cache[id]) {\r\n            this.cache[id] = getXYSpectrum(this.spectra, selector);\r\n        }\r\n        return this.cache[id];\r\n    }\r\n    /**\r\n     * Retrieve a xy object\r\n     * @param selector.units Units separated by vs like for example \"g vs C\"\r\n     * @param selector.xUnits if undefined takes the first variable\r\n     * @param selector.yUnits if undefined takes the second variable\r\n     */\r\n    getXY(selector = {}) {\r\n        let spectrum = this.getXYSpectrum(selector);\r\n        if (!spectrum)\r\n            return undefined;\r\n        return {\r\n            x: spectrum.variables.x.data,\r\n            y: spectrum.variables.y.data,\r\n        };\r\n    }\r\n    /**\r\n     * Return the data object for specific x/y units with possibly some\r\n     * normalization options\r\n     * @param options.selector.xUnits // if undefined takes the first variable\r\n     * @param options.selector.yUnits // if undefined takes the second variable\r\n     */\r\n    getNormalizedSpectrum(options = {}) {\r\n        const { normalization, selector } = options;\r\n        const spectrum = this.getXYSpectrum(selector);\r\n        if (!spectrum)\r\n            return undefined;\r\n        return getNormalizedSpectrum(spectrum, normalization);\r\n    }\r\n    /**\r\n     * Returns the first spectrum. This method could be improved in the future\r\n     * @returns\r\n     */\r\n    getSpectrum() {\r\n        return this.spectra[0];\r\n    }\r\n    /**\r\n     * Returns the xLabel\r\n     * @param selector.xUnits // if undefined takes the first variable\r\n     * @param selector.yUnits // if undefined takes the second variable\r\n     */\r\n    getXLabel(selector) {\r\n        var _a;\r\n        return (_a = this.getXYSpectrum(selector)) === null || _a === void 0 ? void 0 : _a.variables.x.label;\r\n    }\r\n    /**\r\n     * Returns the yLabel\r\n     * @param selector.xUnits // if undefined takes the first variable\r\n     * @param selector.yUnits // if undefined takes the second variable\r\n     */\r\n    getYLabel(selector) {\r\n        var _a;\r\n        return (_a = this.getXYSpectrum(selector)) === null || _a === void 0 ? void 0 : _a.variables.y.label;\r\n    }\r\n}\r\n/**\r\n * Internal function that ensure the order of x / y array\r\n */\r\nfunction standardizeData(variables, options, analysisOptions) {\r\n    let { meta = {}, dataType = '', title = '' } = options;\r\n    const { spectrumCallback } = analysisOptions;\r\n    if (spectrumCallback) {\r\n        spectrumCallback(variables);\r\n    }\r\n    let xVariable = variables.x;\r\n    let yVariable = variables.y;\r\n    if (!xVariable || !yVariable) {\r\n        throw Error('A spectrum must contain at least x and y variables');\r\n    }\r\n    if (!isAnyArray(xVariable.data) || !isAnyArray(yVariable.data)) {\r\n        throw Error('x and y variables must contain an array data');\r\n    }\r\n    let x = xVariable.data;\r\n    let reverse = x && x.length > 1 && x[0] > x[x.length - 1];\r\n    for (let [key, variable] of Object.entries(variables)) {\r\n        if (reverse)\r\n            variable.data = variable.data.reverse();\r\n        variable.label = variable.label || key;\r\n        if (variable.label.match(/^.*[([](?<units>.*)[)\\]].*$/)) {\r\n            const units = variable.label.replace(/^.*[([](?<units>.*)[)\\]].*$/, '$<units>');\r\n            if (!variable.units || variable.units === units) {\r\n                variable.units = units;\r\n                variable.label = variable.label.replace(/[([].*[)\\]]/, '').trim();\r\n            }\r\n        }\r\n        variable.min = min(variable.data);\r\n        variable.max = max(variable.data);\r\n        variable.isMonotone = xIsMonotone(variable.data);\r\n    }\r\n    return {\r\n        variables,\r\n        title,\r\n        dataType,\r\n        meta,\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5hbHlzaXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvQW5hbHlzaXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxVQUFVLE1BQU0sY0FBYyxDQUFDO0FBQ3RDLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQztBQUMvQixPQUFPLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDL0IsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBSXBELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQWNyRDs7OztHQUlHO0FBQ0gsTUFBTSxPQUFPLFFBQVE7SUFPbkIsWUFBbUIsVUFBMkIsRUFBRTtRQUM5QyxJQUFJLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUM7UUFDakQsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksWUFBWSxDQUNqQixTQUE0QixFQUM1QixVQUF1QyxFQUFFO1FBRXpDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUNmLGVBQWUsQ0FBQyxTQUFTLEVBQUUsT0FBTyxFQUFFO1lBQ2xDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxnQkFBZ0I7U0FDeEMsQ0FBQyxDQUNILENBQUM7UUFDRixJQUFJLENB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","/**\n * Ensure that the data is string. If it is an ArrayBuffer it will be converted to string using TextDecoder.\n * @param blob\n * @param options\n * @returns\n */\nexport function ensureString(blob, options = {}) {\n    if (typeof blob === 'string') {\n        return blob;\n    }\n    if (ArrayBuffer.isView(blob) || blob instanceof ArrayBuffer) {\n        const { encoding = guessEncoding(blob) } = options;\n        const decoder = new TextDecoder(encoding);\n        return decoder.decode(blob);\n    }\n    throw new TypeError(`blob must be a string, ArrayBuffer or ArrayBufferView`);\n}\nfunction guessEncoding(blob) {\n    const uint8 = ArrayBuffer.isView(blob)\n        ? new Uint8Array(blob.buffer, blob.byteOffset, blob.byteLength)\n        : new Uint8Array(blob);\n    if (uint8.length >= 2) {\n        if (uint8[0] === 0xfe && uint8[1] === 0xff) {\n            return 'utf-16be';\n        }\n        if (uint8[0] === 0xff && uint8[1] === 0xfe) {\n            return 'utf-16le';\n        }\n    }\n    return 'utf-8';\n}\n//# sourceMappingURL=index.js.map","/**\n * Dynamically type a string\n * @param {string} value String to dynamically type\n * @returns {boolean|string|number}\n */\nexport function parseString(value) {\n  if (value.length === 4 || value.length === 5) {\n    let lowercase = value.toLowerCase();\n\n    if (lowercase === 'true') return true;\n    if (lowercase === 'false') return false;\n  }\n  let number = Number(value);\n  if (number === 0 && !value.includes('0')) {\n    return value;\n  }\n  if (!Number.isNaN(number)) return number;\n  return value;\n}\n","const GC_MS_FIELDS = ['TIC', '.RIC', 'SCANNUMBER'];\n\nexport function complexChromatogram(result) {\n  let spectra = result.spectra;\n  let length = spectra.length;\n  let chromatogram = {\n    times: new Array(length),\n    series: {\n      ms: {\n        dimension: 2,\n        data: new Array(length),\n      },\n    },\n  };\n\n  let existingGCMSFields = [];\n  for (let i = 0; i < GC_MS_FIELDS.length; i++) {\n    let label = convertMSFieldToLabel(GC_MS_FIELDS[i]);\n    if (spectra[0][label]) {\n      existingGCMSFields.push(label);\n      chromatogram.series[label] = {\n        dimension: 1,\n        data: new Array(length),\n      };\n    }\n  }\n\n  for (let i = 0; i < length; i++) {\n    let spectrum = spectra[i];\n    chromatogram.times[i] = spectrum.pageValue;\n    for (let j = 0; j < existingGCMSFields.length; j++) {\n      chromatogram.series[existingGCMSFields[j]].data[i] = Number(\n        spectrum[existingGCMSFields[j]],\n      );\n    }\n    if (spectrum.data) {\n      chromatogram.series.ms.data[i] = [spectrum.data.x, spectrum.data.y];\n    }\n  }\n  result.chromatogram = chromatogram;\n}\n\nexport function isMSField(canonicDataLabel) {\n  return GC_MS_FIELDS.indexOf(canonicDataLabel) !== -1;\n}\n\nexport function convertMSFieldToLabel(value) {\n  return value.toLowerCase().replace(/[^a-z0-9]/g, '');\n}\n","export default function convertToFloatArray(stringArray) {\n  let floatArray = [];\n  for (let i = 0; i < stringArray.length; i++) {\n    floatArray.push(Number(stringArray[i]));\n  }\n  return floatArray;\n}\n","export default function fastParseXYData(spectrum, value) {\n  // TODO need to deal with result\n  //  console.log(value);\n  // we check if deltaX is defined otherwise we calculate it\n\n  let yFactor = spectrum.yFactor;\n  let deltaX = spectrum.deltaX;\n\n  spectrum.isXYdata = true;\n  let currentData = { x: [], y: [] };\n  spectrum.data = currentData;\n\n  let currentX = spectrum.firstX;\n  let currentY = spectrum.firstY;\n\n  // we skip the first line\n  //\n  let endLine = false;\n  let ascii;\n  let i = 0;\n  for (; i < value.length; i++) {\n    ascii = value.charCodeAt(i);\n    if (ascii === 13 || ascii === 10) {\n      endLine = true;\n    } else {\n      if (endLine) break;\n    }\n  }\n\n  // we proceed taking the i after the first line\n  let newLine = true;\n  let isDifference = false;\n  let isLastDifference = false;\n  let lastDifference = 0;\n  let isDuplicate = false;\n  let inComment = false;\n  let currentValue = 0; // can be a difference or a duplicate\n  let lastValue = 0; // must be the real last value\n  let isNegative = false;\n  let inValue = false;\n  let skipFirstValue = false;\n  let decimalPosition = 0;\n  for (; i <= value.length; i++) {\n    if (i === value.length) ascii = 13;\n    else ascii = value.charCodeAt(i);\n    if (inComment) {\n      // we should ignore the text if we are after $$\n      if (ascii === 13 || ascii === 10) {\n        newLine = true;\n        inComment = false;\n      }\n    } else {\n      // when is it a new value ?\n      // when it is not a digit, . or comma\n      // it is a number that is either new or we continue\n      if (ascii <= 57 && ascii >= 48) {\n        // a number\n        inValue = true;\n        if (decimalPosition > 0) {\n          currentValue += (ascii - 48) / Math.pow(10, decimalPosition++);\n        } else {\n          currentValue *= 10;\n          currentValue += ascii - 48;\n        }\n      } else if (ascii === 44 || ascii === 46) {\n        // a \",\" or \".\"\n        inValue = true;\n        decimalPosition++;\n      } else {\n        if (inValue) {\n          // need to process the previous value\n          if (newLine) {\n            newLine = false; // we don't check the X value\n            // console.log(\"NEW LINE\",isDifference, lastDifference);\n            // if new line and lastDifference, the first value is just a check !\n            // that we don't check ...\n            if (isLastDifference) skipFirstValue = true;\n          } else {\n            // need to deal with duplicate and differences\n            if (skipFirstValue) {\n              skipFirstValue = false;\n            } else {\n              if (isDifference) {\n                lastDifference = isNegative ? 0 - currentValue : currentValue;\n                isLastDifference = true;\n                isDifference = false;\n              } else if (!isDuplicate) {\n                lastValue = isNegative ? 0 - currentValue : currentValue;\n              }\n              let duplicate = isDuplicate ? currentValue - 1 : 1;\n              for (let j = 0; j < duplicate; j++) {\n                if (isLastDifference) {\n                  currentY += lastDifference;\n                } else {\n                  currentY = lastValue;\n                }\n                currentData.x.push(currentX);\n                currentData.y.push(currentY * yFactor);\n                currentX += deltaX;\n              }\n            }\n          }\n          isNegative = false;\n          currentValue = 0;\n          decimalPosition = 0;\n          inValue = false;\n          isDuplicate = false;\n        }\n\n        // positive SQZ digits @ A B C D E F G H I (ascii 64-73)\n        if (ascii < 74 && ascii > 63) {\n          inValue = true;\n          isLastDifference = false;\n          currentValue = ascii - 64;\n        } else if (ascii > 96 && ascii < 106) {\n          // negative SQZ digits a b c d e f g h i (ascii 97-105)\n          inValue = true;\n          isLastDifference = false;\n          currentValue = ascii - 96;\n          isNegative = true;\n        } else if (ascii === 115) {\n          // DUP digits S T U V W X Y Z s (ascii 83-90, 115)\n          inValue = true;\n          isDuplicate = true;\n          currentValue = 9;\n        } else if (ascii > 82 && ascii < 91) {\n          inValue = true;\n          isDuplicate = true;\n          currentValue = ascii - 82;\n        } else if (ascii > 73 && ascii < 83) {\n          // positive DIF digits % J K L M N O P Q R (ascii 37, 74-82)\n          inValue = true;\n          isDifference = true;\n          currentValue = ascii - 73;\n        } else if (ascii > 105 && ascii < 115) {\n          // negative DIF digits j k l m n o p q r (ascii 106-114)\n          inValue = true;\n          isDifference = true;\n          currentValue = ascii - 105;\n          isNegative = true;\n        } else if (ascii === 36 && value.charCodeAt(i + 1) === 36) {\n          // $ sign, we need to check the next one\n          inValue = true;\n          inComment = true;\n        } else if (ascii === 37) {\n          // positive DIF digits % J K L M N O P Q R (ascii 37, 74-82)\n          inValue = true;\n          isDifference = true;\n          currentValue = 0;\n          isNegative = false;\n        } else if (ascii === 45) {\n          // a \"-\"\n          // check if after there is a number, decimal or comma\n          let ascii2 = value.charCodeAt(i + 1);\n          if (\n            (ascii2 >= 48 && ascii2 <= 57) ||\n            ascii2 === 44 ||\n            ascii2 === 46\n          ) {\n            inValue = true;\n            if (!newLine) isLastDifference = false;\n            isNegative = true;\n          }\n        } else if (ascii === 13 || ascii === 10) {\n          newLine = true;\n          inComment = false;\n        }\n        // and now analyse the details ... space or tabulation\n        // if \"+\" we just don't care\n      }\n    }\n  }\n}\n","const removeCommentRegExp = /\\$\\$.*/;\nconst peakTableSplitRegExp = /[,\\t ]+/;\n\nexport default function parsePeakTable(spectrum, value, result) {\n  spectrum.isPeaktable = true;\n\n  if (!spectrum.variables || Object.keys(spectrum.variables) === 2) {\n    parseXY(spectrum, value, result);\n  } else {\n    parseXYZ(spectrum, value, result);\n  }\n\n  // we will add the data in the variables\n  if (spectrum.variables) {\n    for (let key in spectrum.variables) {\n      spectrum.variables[key].data = spectrum.data[key];\n    }\n  }\n}\n\nfunction parseXY(spectrum, value, result) {\n  let currentData = { x: [], y: [] };\n  spectrum.data = currentData;\n\n  // counts for around 20% of the time\n  let lines = value.split(/,? *,?[;\\r\\n]+ */);\n\n  for (let i = 1; i < lines.length; i++) {\n    let values = lines[i]\n      .trim()\n      .replace(removeCommentRegExp, '')\n      .split(peakTableSplitRegExp);\n    if (values.length % 2 === 0) {\n      for (let j = 0; j < values.length; j = j + 2) {\n        // takes around 40% of the time to add and parse the 2 values nearly exclusively because of Number\n        currentData.x.push(Number(values[j]) * spectrum.xFactor);\n        currentData.y.push(Number(values[j + 1]) * spectrum.yFactor);\n      }\n    } else {\n      result.logs.push(`Format error: ${values}`);\n    }\n  }\n}\n\nfunction parseXYZ(spectrum, value, result) {\n  let currentData = {};\n  let variables = Object.keys(spectrum.variables);\n  let numberOfVariables = variables.length;\n  variables.forEach((variable) => (currentData[variable] = []));\n  spectrum.data = currentData;\n\n  // counts for around 20% of the time\n  let lines = value.split(/,? *,?[;\\r\\n]+ */);\n\n  for (let i = 1; i < lines.length; i++) {\n    let values = lines[i]\n      .trim()\n      .replace(removeCommentRegExp, '')\n      .split(peakTableSplitRegExp);\n    if (values.length % numberOfVariables === 0) {\n      for (let j = 0; j < values.length; j++) {\n        // todo should try to find a xFactor (y, ...)\n        currentData[variables[j % numberOfVariables]].push(Number(values[j]));\n      }\n    } else {\n      result.logs.push(`Format error: ${values}`);\n    }\n  }\n}\n","export default function parseXYA(spectrum, value) {\n  let removeSymbolRegExp = /(\\(+|\\)+|<+|>+|\\s+)/g;\n\n  spectrum.isXYAdata = true;\n  let values;\n  let currentData = { x: [], y: [] };\n  spectrum.data = currentData;\n\n  let lines = value.split(/,? *,?[;\\r\\n]+ */);\n\n  for (let i = 1; i < lines.length; i++) {\n    values = lines[i].trim().replace(removeSymbolRegExp, '').split(',');\n    currentData.x.push(Number(values[0]));\n    currentData.y.push(Number(values[1]));\n  }\n}\n","import convertTo3DZ from './convertTo3DZ';\nimport generateContourLines from './generateContourLines';\n\nexport default function add2D(result, options) {\n  let zData = convertTo3DZ(result.spectra);\n  if (!options.noContour) {\n    result.contourLines = generateContourLines(zData, options);\n    delete zData.z;\n  }\n  result.minMax = zData;\n}\n","import getMedian from 'ml-array-median';\n\nexport default function convertTo3DZ(spectra) {\n  let minZ = spectra[0].data.y[0];\n  let maxZ = minZ;\n  let ySize = spectra.length;\n  let xSize = spectra[0].data.x.length;\n\n  let z = new Array(ySize);\n  for (let i = 0; i < ySize; i++) {\n    z[i] = spectra[i].data.y;\n    for (let j = 0; j < xSize; j++) {\n      let value = z[i][j];\n      if (value < minZ) minZ = value;\n      if (value > maxZ) maxZ = value;\n    }\n  }\n\n  const firstX = spectra[0].data.x[0];\n  const lastX = spectra[0].data.x[spectra[0].data.x.length - 1]; // has to be -2 because it is a 1D array [x,y,x,y,...]\n  const firstY = spectra[0].pageValue;\n  const lastY = spectra[ySize - 1].pageValue;\n\n  // Because the min / max value are the only information about the matrix if we invert\n  // min and max we need to invert the array\n  if (firstX > lastX) {\n    for (let spectrum of z) {\n      spectrum.reverse();\n    }\n  }\n  if (firstY > lastY) {\n    z.reverse();\n  }\n\n  const medians = [];\n  for (let i = 0; i < z.length; i++) {\n    const row = Float64Array.from(z[i]);\n    for (let i = 0; i < row.length; i++) {\n      if (row[i] < 0) row[i] = -row[i];\n    }\n    medians.push(getMedian(row));\n  }\n  const median = getMedian(medians);\n\n  return {\n    z: z,\n    minX: Math.min(firstX, lastX),\n    maxX: Math.max(firstX, lastX),\n    minY: Math.min(firstY, lastY),\n    maxY: Math.max(firstY, lastY),\n    minZ: minZ,\n    maxZ: maxZ,\n    noise: median,\n  };\n}\n","export default function generateContourLines(zData, options) {\n  let noise = zData.noise;\n  let z = zData.z;\n  let povarHeight0, povarHeight1, povarHeight2, povarHeight3;\n  let isOver0, isOver1, isOver2, isOver3;\n  let nbSubSpectra = z.length;\n  let nbPovars = z[0].length;\n  let pAx, pAy, pBx, pBy;\n\n  let x0 = zData.minX;\n  let xN = zData.maxX;\n  let dx = (xN - x0) / (nbPovars - 1);\n  let y0 = zData.minY;\n  let yN = zData.maxY;\n  let dy = (yN - y0) / (nbSubSpectra - 1);\n  let minZ = zData.minZ;\n  let maxZ = zData.maxZ;\n\n  // System.out.prvarln('y0 '+y0+' yN '+yN);\n  // -------------------------\n  // Povars attribution\n  //\n  // 0----1\n  // |  / |\n  // | /  |\n  // 2----3\n  //\n  // ---------------------d------\n\n  let iter = options.nbContourLevels * 2;\n  let contourLevels = new Array(iter);\n  let lineZValue;\n  for (let level = 0; level < iter; level++) {\n    // multiply by 2 for positif and negatif\n    let contourLevel = {};\n    contourLevels[level] = contourLevel;\n    let side = level % 2;\n    let factor =\n      (maxZ - options.noiseMultiplier * noise) *\n      Math.exp((level >> 1) - options.nbContourLevels);\n    if (side === 0) {\n      lineZValue = factor + options.noiseMultiplier * noise;\n    } else {\n      lineZValue = 0 - factor - options.noiseMultiplier * noise;\n    }\n    let lines = [];\n    contourLevel.zValue = lineZValue;\n    contourLevel.lines = lines;\n\n    if (lineZValue <= minZ || lineZValue >= maxZ) continue;\n\n    for (let iSubSpectra = 0; iSubSpectra < nbSubSpectra - 1; iSubSpectra++) {\n      let subSpectra = z[iSubSpectra];\n      let subSpectraAfter = z[iSubSpectra + 1];\n      for (let povar = 0; povar < nbPovars - 1; povar++) {\n        povarHeight0 = subSpectra[povar];\n        povarHeight1 = subSpectra[povar + 1];\n        povarHeight2 = subSpectraAfter[povar];\n        povarHeight3 = subSpectraAfter[povar + 1];\n\n        isOver0 = povarHeight0 > lineZValue;\n        isOver1 = povarHeight1 > lineZValue;\n        isOver2 = povarHeight2 > lineZValue;\n        isOver3 = povarHeight3 > lineZValue;\n\n        // Example povar0 is over the plane and povar1 and\n        // povar2 are below, we find the varersections and add\n        // the segment\n        if (isOver0 !== isOver1 && isOver0 !== isOver2) {\n          pAx =\n            povar + (lineZValue - povarHeight0) / (povarHeight1 - povarHeight0);\n          pAy = iSubSpectra;\n          pBx = povar;\n          pBy =\n            iSubSpectra +\n            (lineZValue - povarHeight0) / (povarHeight2 - povarHeight0);\n          lines.push(pAx * dx + x0);\n          lines.push(pAy * dy + y0);\n          lines.push(pBx * dx + x0);\n          lines.push(pBy * dy + y0);\n        }\n        // remove push does not help !!!!\n        if (isOver3 !== isOver1 && isOver3 !== isOver2) {\n          pAx = povar + 1;\n          pAy =\n            iSubSpectra +\n            1 -\n            (lineZValue - povarHeight3) / (povarHeight1 - povarHeight3);\n          pBx =\n            povar +\n            1 -\n            (lineZValue - povarHeight3) / (povarHeight2 - povarHeight3);\n          pBy = iSubSpectra + 1;\n          lines.push(pAx * dx + x0);\n          lines.push(pAy * dy + y0);\n          lines.push(pBx * dx + x0);\n          lines.push(pBy * dy + y0);\n        }\n        // test around the diagonal\n        if (isOver1 !== isOver2) {\n          pAx =\n            (povar +\n              1 -\n              (lineZValue - povarHeight1) / (povarHeight2 - povarHeight1)) *\n              dx +\n            x0;\n          pAy =\n            (iSubSpectra +\n              (lineZValue - povarHeight1) / (povarHeight2 - povarHeight1)) *\n              dy +\n            y0;\n          if (isOver1 !== isOver0) {\n            pBx =\n              povar +\n              1 -\n              (lineZValue - povarHeight1) / (povarHeight0 - povarHeight1);\n            pBy = iSubSpectra;\n            lines.push(pAx);\n            lines.push(pAy);\n            lines.push(pBx * dx + x0);\n            lines.push(pBy * dy + y0);\n          }\n          if (isOver2 !== isOver0) {\n            pBx = povar;\n            pBy =\n              iSubSpectra +\n              1 -\n              (lineZValue - povarHeight2) / (povarHeight0 - povarHeight2);\n            lines.push(pAx);\n            lines.push(pAy);\n            lines.push(pBx * dx + x0);\n            lines.push(pBy * dy + y0);\n          }\n          if (isOver1 !== isOver3) {\n            pBx = povar + 1;\n            pBy =\n              iSubSpectra +\n              (lineZValue - povarHeight1) / (povarHeight3 - povarHeight1);\n            lines.push(pAx);\n            lines.push(pAy);\n            lines.push(pBx * dx + x0);\n            lines.push(pBy * dy + y0);\n          }\n          if (isOver2 !== isOver3) {\n            pBx =\n              povar +\n              (lineZValue - povarHeight2) / (povarHeight3 - povarHeight2);\n            pBy = iSubSpectra + 1;\n            lines.push(pAx);\n            lines.push(pAy);\n            lines.push(pBx * dx + x0);\n            lines.push(pBy * dy + y0);\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    minX: zData.minX,\n    maxX: zData.maxX,\n    minY: zData.minY,\n    maxY: zData.maxY,\n    segments: contourLevels,\n  };\n}\n","// sources:\n// https://en.wikipedia.org/wiki/Gyromagnetic_ratio\n// TODO: #13 can we have a better source and more digits ? @jwist\nexport const gyromagneticRatio = {\n    '1H': 267.52218744e6,\n    '2H': 41.065e6,\n    '3H': 285.3508e6,\n    '3He': -203.789e6,\n    '7Li': 103.962e6,\n    '13C': 67.28284e6,\n    '14N': 19.331e6,\n    '15N': -27.116e6,\n    '17O': -36.264e6,\n    '19F': 251.662e6,\n    '23Na': 70.761e6,\n    '27Al': 69.763e6,\n    '29Si': -53.19e6,\n    '31P': 108.291e6,\n    '57Fe': 8.681e6,\n    '63Cu': 71.118e6,\n    '67Zn': 16.767e6,\n    '129Xe': -73.997e6,\n};\n//# sourceMappingURL=gyromagneticRatio.js.map","export default function profiling(result, action, options) {\n  if (result.profiling) {\n    result.profiling.push({\n      action,\n      time: Date.now() - options.start,\n    });\n  }\n}\n","export default function simpleChromatogram(result) {\n  let data = result.spectra[0].data;\n  result.chromatogram = {\n    times: data.x.slice(),\n    series: {\n      intensity: {\n        dimension: 1,\n        data: data.y.slice(),\n      },\n    },\n  };\n}\n","import add2D from './2d/add2D';\nimport { complexChromatogram } from './complexChromatogram';\nimport postProcessingNMR from './postProcessingNMR';\nimport profiling from './profiling';\nimport simpleChromatogram from './simpleChromatogram';\n\nexport default function postProcessing(entriesFlat, result, options) {\n  // converting Hz to ppm\n  postProcessingNMR(entriesFlat);\n\n  for (let entry of entriesFlat) {\n    if (Object.keys(entry.ntuples).length > 0) {\n      let newNtuples = [];\n      let keys = Object.keys(entry.ntuples);\n      for (let i = 0; i < keys.length; i++) {\n        let key = keys[i];\n        let values = entry.ntuples[key];\n        for (let j = 0; j < values.length; j++) {\n          if (!newNtuples[j]) newNtuples[j] = {};\n          newNtuples[j][key] = values[j];\n        }\n      }\n      entry.ntuples = newNtuples;\n    }\n\n    if (entry.twoD && options.wantXY) {\n      add2D(entry, options);\n\n      profiling(result, 'Finished countour plot calculation', options);\n\n      if (!options.keepSpectra) {\n        delete entry.spectra;\n      }\n    }\n\n    // maybe it is a GC (HPLC) / MS. In this case we add a new format\n    if (options.chromatogram) {\n      if (entry.spectra.length > 1) {\n        complexChromatogram(entry);\n      } else {\n        simpleChromatogram(entry);\n      }\n      profiling(result, 'Finished chromatogram calculation', options);\n    }\n\n    delete entry.tmp;\n  }\n}\n","import { gyromagneticRatio } from 'nmr-processing';\n\nexport default function postProcessingNMR(entriesFlat) {\n  // specific NMR functions\n\n  for (let entry of entriesFlat) {\n    let observeFrequency = 0;\n    let shiftOffsetVal = 0;\n    for (let spectrum of entry.spectra) {\n      if (entry.ntuples && entry.ntuples.symbol) {\n        if (!observeFrequency && spectrum.observeFrequency) {\n          observeFrequency = spectrum.observeFrequency;\n        }\n        if (!shiftOffsetVal && spectrum.shiftOffsetVal) {\n          shiftOffsetVal = spectrum.shiftOffsetVal;\n        }\n      } else {\n        observeFrequency = spectrum.observeFrequency;\n        shiftOffsetVal = spectrum.shiftOffsetVal;\n      }\n\n      if (observeFrequency) {\n        if (spectrum.xUnits && spectrum.xUnits.toUpperCase().includes('HZ')) {\n          spectrum.xUnits = 'PPM';\n          spectrum.xFactor = spectrum.xFactor / observeFrequency;\n          spectrum.firstX = spectrum.firstX / observeFrequency;\n          spectrum.lastX = spectrum.lastX / observeFrequency;\n          spectrum.deltaX = spectrum.deltaX / observeFrequency;\n          for (let i = 0; i < spectrum.data.x.length; i++) {\n            spectrum.data.x[i] /= observeFrequency;\n          }\n        }\n      }\n      if (shiftOffsetVal) {\n        let shift = spectrum.firstX - shiftOffsetVal;\n        spectrum.firstX = spectrum.firstX - shift;\n        spectrum.lastX = spectrum.lastX - shift;\n        for (let i = 0; i < spectrum.data.x.length; i++) {\n          spectrum.data.x[i] -= shift;\n        }\n      }\n\n      // we will check if some nucleus are missing ...\n      if (entry.ntuples && entry.ntuples.nucleus && entry.ntuples.symbol) {\n        for (let i = 0; i < entry.ntuples.nucleus.length; i++) {\n          let symbol = entry.ntuples.symbol[i];\n          let nucleus = entry.ntuples.nucleus[i];\n          if (symbol.startsWith('F') && !nucleus) {\n            if (symbol === 'F1') {\n              // if F1 is defined we will use F2\n              if (entry.tmp.$NUC2) {\n                entry.ntuples.nucleus[i] = entry.tmp.$NUC2;\n              } else {\n                let f2index = entry.ntuples.symbol.indexOf('F2');\n                if (f2index && entry.ntuples.nucleus[f2index]) {\n                  entry.ntuples.nucleus[i] = entry.ntuples.nucleus[f2index];\n                }\n              }\n            }\n            if (symbol === 'F2') entry.ntuples.nucleus[i] = entry.tmp.$NUC1;\n          }\n          if (symbol === 'F2') {\n            entry.yType = entry.ntuples.nucleus[0];\n          }\n        }\n      }\n\n      if (\n        observeFrequency &&\n        entry.ntuples &&\n        entry.ntuples.symbol &&\n        entry.ntuples.nucleus\n      ) {\n        let unit = '';\n        let pageSymbolIndex = entry.ntuples.symbol.indexOf(spectrum.pageSymbol);\n        if (entry.ntuples.units && entry.ntuples.units[pageSymbolIndex]) {\n          unit = entry.ntuples.units[pageSymbolIndex];\n        }\n        if (unit !== 'PPM') {\n          if (pageSymbolIndex !== 0) {\n            throw Error('Not sure about this ntuples format');\n          }\n\n          let ratio0 = gyromagneticRatio[entry.ntuples.nucleus[0]];\n          let ratio1 = gyromagneticRatio[entry.ntuples.nucleus[1]];\n          if (!ratio0 || !ratio1) {\n            throw Error('Problem with determination of gyromagnetic ratio');\n          }\n          let ratio = (ratio0 / ratio1) * observeFrequency;\n          spectrum.pageValue /= ratio;\n        }\n      }\n    }\n  }\n}\n","export default function prepareNtuplesDatatable(currentEntry, spectrum, kind) {\n  let xIndex = -1;\n  let yIndex = -1;\n  let firstVariable = '';\n  let secondVariable = '';\n  if (kind.indexOf('++') > 0) {\n    firstVariable = kind.replace(/.*\\(([a-zA-Z0-9]+)\\+\\+.*/, '$1');\n    secondVariable = kind.replace(/.*\\.\\.([a-zA-Z0-9]+).*/, '$1');\n  } else {\n    kind = kind.replace(/[^a-zA-Z]/g, '');\n    firstVariable = kind.charAt(0);\n    secondVariable = kind.charAt(1);\n    spectrum.variables = {};\n    for (let symbol of kind) {\n      let lowerCaseSymbol = symbol.toLowerCase();\n      let index = currentEntry.ntuples.symbol.indexOf(symbol);\n      if (index === -1) throw Error(`Symbol undefined: ${symbol}`);\n      spectrum.variables[lowerCaseSymbol] = {};\n      for (let key in currentEntry.ntuples) {\n        if (currentEntry.ntuples[key][index]) {\n          spectrum.variables[lowerCaseSymbol][key.replace(/^var/, '')] =\n            currentEntry.ntuples[key][index];\n        }\n      }\n    }\n  }\n  xIndex = currentEntry.ntuples.symbol.indexOf(firstVariable);\n  yIndex = currentEntry.ntuples.symbol.indexOf(secondVariable);\n\n  if (xIndex === -1) xIndex = 0;\n  if (yIndex === -1) yIndex = 0;\n\n  if (currentEntry.ntuples.first) {\n    if (currentEntry.ntuples.first.length > xIndex) {\n      spectrum.firstX = currentEntry.ntuples.first[xIndex];\n    }\n    if (currentEntry.ntuples.first.length > yIndex) {\n      spectrum.firstY = currentEntry.ntuples.first[yIndex];\n    }\n  }\n  if (currentEntry.ntuples.last) {\n    if (currentEntry.ntuples.last.length > xIndex) {\n      spectrum.lastX = currentEntry.ntuples.last[xIndex];\n    }\n    if (currentEntry.ntuples.last.length > yIndex) {\n      spectrum.lastY = currentEntry.ntuples.last[yIndex];\n    }\n  }\n  if (\n    currentEntry.ntuples.vardim &&\n    currentEntry.ntuples.vardim.length > xIndex\n  ) {\n    spectrum.nbPoints = currentEntry.ntuples.vardim[xIndex];\n  }\n  if (currentEntry.ntuples.factor) {\n    if (currentEntry.ntuples.factor.length > xIndex) {\n      spectrum.xFactor = currentEntry.ntuples.factor[xIndex];\n    }\n    if (currentEntry.ntuples.factor.length > yIndex) {\n      spectrum.yFactor = currentEntry.ntuples.factor[yIndex];\n    }\n  }\n  if (currentEntry.ntuples.units) {\n    if (currentEntry.ntuples.units.length > xIndex) {\n      if (\n        currentEntry.ntuples.varname &&\n        currentEntry.ntuples.varname[xIndex]\n      ) {\n        spectrum.xUnits = `${currentEntry.ntuples.varname[xIndex]} [${currentEntry.ntuples.units[xIndex]}]`;\n      } else {\n        spectrum.xUnits = currentEntry.ntuples.units[xIndex];\n      }\n    }\n    if (currentEntry.ntuples.units.length > yIndex) {\n      if (\n        currentEntry.ntuples.varname &&\n        currentEntry.ntuples.varname[yIndex]\n      ) {\n        spectrum.yUnits = `${currentEntry.ntuples.varname[yIndex]} [${currentEntry.ntuples.units[yIndex]}]`;\n      } else {\n        spectrum.yUnits = currentEntry.ntuples.units[yIndex];\n      }\n    }\n  }\n}\n","export default function prepareSpectrum(spectrum) {\n  if (!spectrum.xFactor) spectrum.xFactor = 1;\n  if (!spectrum.yFactor) spectrum.yFactor = 1;\n}\n","import { parseString } from 'dynamic-typing';\nimport { ensureString } from 'ensure-string';\n\nimport { isMSField, convertMSFieldToLabel } from './complexChromatogram';\nimport convertToFloatArray from './convertToFloatArray';\nimport fastParseXYData from './parse/fastParseXYData';\nimport parsePeakTable from './parse/parsePeakTable';\nimport parseXYA from './parse/parseXYA';\nimport postProcessing from './postProcessing';\nimport prepareNtuplesDatatable from './prepareNtuplesDatatable';\nimport prepareSpectrum from './prepareSpectrum';\nimport profiling from './profiling';\n\n// the following RegExp can only be used for XYdata, some peakTables have values with a \"E-5\" ...\nconst ntuplesSeparatorRegExp = /[ \\t]*,[ \\t]*/;\n\nclass Spectrum {}\n\nconst defaultOptions = {\n  keepRecordsRegExp: /^$/,\n  canonicDataLabels: true,\n  canonicMetadataLabels: false,\n  dynamicTyping: true,\n  withoutXY: false,\n  chromatogram: false,\n  keepSpectra: false,\n  noContour: false,\n  nbContourLevels: 7,\n  noiseMultiplier: 5,\n  profiling: false,\n};\n\n/**\n * Parse a jcamp.\n *\n * @param {string|ArrayBuffer|Uint8Array} jcamp\n * @param {object} [options]\n * @param {number} [options.keepRecordsRegExp=/^$/] - By default we don't keep meta information.\n * @param {number} [options.canonicDataLabels=true] - Canonize the Labels (uppercase without symbol).\n * @param {number} [options.canonicMetadataLabels=false] - Canonize the metadata Labels (uppercase without symbol).\n * @param {number} [options.dynamicTyping=false] - Convert numbers to Number.\n * @param {number} [options.withoutXY=false] - Remove the XY data.\n * @param {number} [options.chromatogram=false] - Special post-processing for GC / HPLC / MS.\n * @param {number} [options.keepSpectra=false] - Force to keep the spectra in case of 2D.\n * @param {number} [options.noContour=false] - Don't calculate countour in case of 2D.\n * @param {number} [options.nbContourLevels=7] - Number of positive / negative contour levels to calculate.\n * @param {number} [options.noiseMultiplier=5] - Define for 2D the level as 5 times the median as default.\n * @param {number} [options.profiling=false] - Add profiling information.\n * @returns {object}\n */\n\nexport function convert(jcamp, options = {}) {\n  jcamp = ensureString(jcamp);\n  options = { ...defaultOptions, ...options };\n  options.wantXY = !options.withoutXY;\n  options.start = Date.now();\n\n  let entriesFlat = [];\n\n  let result = {\n    profiling: options.profiling ? [] : false,\n    logs: [],\n    entries: [],\n  };\n\n  let tmpResult = { children: [] };\n  let currentEntry = tmpResult;\n  let parentsStack = [];\n\n  let spectrum = new Spectrum();\n\n  if (typeof jcamp !== 'string') {\n    throw new TypeError('the JCAMP should be a string');\n  }\n\n  profiling(result, 'Before split to LDRS', options);\n\n  let ldrs = jcamp.replace(/[\\r\\n]+##/g, '\\n##').split('\\n##');\n\n  profiling(result, 'Split to LDRS', options);\n\n  if (ldrs[0]) ldrs[0] = ldrs[0].replace(/^[\\r\\n ]*##/, '');\n\n  for (let ldr of ldrs) {\n    // This is a new LDR\n    let position = ldr.indexOf('=');\n    let dataLabel = position > 0 ? ldr.substring(0, position) : ldr;\n    let dataValue = position > 0 ? ldr.substring(position + 1).trim() : '';\n\n    let canonicDataLabel = dataLabel.replace(/[_ -]/g, '').toUpperCase();\n\n    if (canonicDataLabel === 'DATATABLE') {\n      let endLine = dataValue.indexOf('\\n');\n      if (endLine === -1) endLine = dataValue.indexOf('\\r');\n      if (endLine > 0) {\n        // ##DATA TABLE= (X++(I..I)), XYDATA\n        // We need to find the variables\n\n        let infos = dataValue.substring(0, endLine).split(/[ ,;\\t]+/);\n        prepareNtuplesDatatable(currentEntry, spectrum, infos[0]);\n\n        spectrum.datatable = infos[0];\n        if (infos[1] && infos[1].indexOf('PEAKS') > -1) {\n          canonicDataLabel = 'PEAKTABLE';\n        } else if (\n          infos[1] &&\n          (infos[1].indexOf('XYDATA') || infos[0].indexOf('++') > 0)\n        ) {\n          canonicDataLabel = 'XYDATA';\n          spectrum.deltaX =\n            (spectrum.lastX - spectrum.firstX) / (spectrum.nbPoints - 1);\n        }\n      }\n    }\n\n    if (canonicDataLabel === 'XYDATA') {\n      if (options.wantXY) {\n        prepareSpectrum(spectrum);\n        // well apparently we should still consider it is a PEAK TABLE if there are no '++' after\n        if (dataValue.match(/.*\\+\\+.*/)) {\n          // ex: (X++(Y..Y))\n          spectrum.deltaX =\n            (spectrum.lastX - spectrum.firstX) / (spectrum.nbPoints - 1);\n\n          fastParseXYData(spectrum, dataValue, result);\n        } else {\n          parsePeakTable(spectrum, dataValue, result);\n        }\n        currentEntry.spectra.push(spectrum);\n        spectrum = new Spectrum();\n      }\n      continue;\n    } else if (canonicDataLabel === 'PEAKTABLE') {\n      if (options.wantXY) {\n        prepareSpectrum(spectrum);\n        parsePeakTable(spectrum, dataValue, result);\n        currentEntry.spectra.push(spectrum);\n        spectrum = new Spectrum();\n      }\n      continue;\n    }\n    if (canonicDataLabel === 'PEAKASSIGNMENTS') {\n      if (options.wantXY) {\n        if (dataValue.match(/.*(XYA).*/)) {\n          // ex: (XYA)\n          parseXYA(spectrum, dataValue);\n        }\n        currentEntry.spectra.push(spectrum);\n        spectrum = new Spectrum();\n      }\n      continue;\n    }\n\n    if (canonicDataLabel === 'TITLE') {\n      let parentEntry = currentEntry;\n      if (!parentEntry.children) {\n        parentEntry.children = [];\n      }\n      currentEntry = {\n        spectra: [],\n        ntuples: {},\n        info: {},\n        meta: {},\n        tmp: {}, // tmp information we need to keep for postprocessing\n      };\n      parentEntry.children.push(currentEntry);\n      parentsStack.push(parentEntry);\n      entriesFlat.push(currentEntry);\n      currentEntry.title = dataValue;\n    } else if (canonicDataLabel === 'DATATYPE') {\n      currentEntry.dataType = dataValue;\n      if (dataValue.match(/(^nd|\\snd\\s)/i)) {\n        currentEntry.twoD = true;\n      }\n    } else if (canonicDataLabel === 'NTUPLES') {\n      if (dataValue.match(/(^nd|\\snd\\s)/i)) {\n        currentEntry.twoD = true;\n      }\n    } else if (canonicDataLabel === 'DATACLASS') {\n      currentEntry.dataClass = dataValue;\n    } else if (canonicDataLabel === 'XUNITS') {\n      spectrum.xUnits = dataValue;\n    } else if (canonicDataLabel === 'YUNITS') {\n      spectrum.yUnits = dataValue;\n    } else if (canonicDataLabel === 'FIRSTX') {\n      spectrum.firstX = Number(dataValue);\n    } else if (canonicDataLabel === 'LASTX') {\n      spectrum.lastX = Number(dataValue);\n    } else if (canonicDataLabel === 'FIRSTY') {\n      spectrum.firstY = Number(dataValue);\n    } else if (canonicDataLabel === 'LASTY') {\n      spectrum.lastY = Number(dataValue);\n    } else if (canonicDataLabel === 'NPOINTS') {\n      spectrum.nbPoints = Number(dataValue);\n    } else if (canonicDataLabel === 'XFACTOR') {\n      spectrum.xFactor = Number(dataValue);\n    } else if (canonicDataLabel === 'YFACTOR') {\n      spectrum.yFactor = Number(dataValue);\n    } else if (canonicDataLabel === 'MAXX') {\n      spectrum.maxX = Number(dataValue);\n    } else if (canonicDataLabel === 'MINX') {\n      spectrum.minX = Number(dataValue);\n    } else if (canonicDataLabel === 'MAXY') {\n      spectrum.maxY = Number(dataValue);\n    } else if (canonicDataLabel === 'MINY') {\n      spectrum.minY = Number(dataValue);\n    } else if (canonicDataLabel === 'DELTAX') {\n      spectrum.deltaX = Number(dataValue);\n    } else if (\n      canonicDataLabel === '.OBSERVEFREQUENCY' ||\n      canonicDataLabel === '$SFO1'\n    ) {\n      if (!spectrum.observeFrequency) {\n        spectrum.observeFrequency = Number(dataValue);\n      }\n    } else if (canonicDataLabel === '.OBSERVENUCLEUS') {\n      if (!spectrum.xType) {\n        currentEntry.xType = dataValue.replace(/[^a-zA-Z0-9]/g, '');\n      }\n    } else if (canonicDataLabel === '$OFFSET') {\n      // OFFSET for Bruker spectra\n      currentEntry.shiftOffsetNum = 0;\n      if (!spectrum.shiftOffsetVal) {\n        spectrum.shiftOffsetVal = Number(dataValue);\n      }\n    } else if (canonicDataLabel === '$REFERENCEPOINT') {\n      // OFFSET for Varian spectra\n      // if we activate this part it does not work for ACD specmanager\n      //         } else if (canonicDataLabel=='.SHIFTREFERENCE') {   // OFFSET FOR Bruker Spectra\n      //                 var parts = dataValue.split(/ *, */);\n      //                 currentEntry.shiftOffsetNum = parseInt(parts[2].trim());\n      //                 spectrum.shiftOffsetVal = Number(parts[3].trim());\n    } else if (canonicDataLabel === 'VARNAME') {\n      currentEntry.ntuples.varname = dataValue.split(ntuplesSeparatorRegExp);\n    } else if (canonicDataLabel === 'SYMBOL') {\n      currentEntry.ntuples.symbol = dataValue.split(ntuplesSeparatorRegExp);\n    } else if (canonicDataLabel === 'VARTYPE') {\n      currentEntry.ntuples.vartype = dataValue.split(ntuplesSeparatorRegExp);\n    } else if (canonicDataLabel === 'VARFORM') {\n      currentEntry.ntuples.varform = dataValue.split(ntuplesSeparatorRegExp);\n    } else if (canonicDataLabel === 'VARDIM') {\n      currentEntry.ntuples.vardim = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === 'UNITS') {\n      currentEntry.ntuples.units = dataValue.split(ntuplesSeparatorRegExp);\n    } else if (canonicDataLabel === 'FACTOR') {\n      currentEntry.ntuples.factor = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === 'FIRST') {\n      currentEntry.ntuples.first = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === 'LAST') {\n      currentEntry.ntuples.last = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === 'MIN') {\n      currentEntry.ntuples.min = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === 'MAX') {\n      currentEntry.ntuples.max = convertToFloatArray(\n        dataValue.split(ntuplesSeparatorRegExp),\n      );\n    } else if (canonicDataLabel === '.NUCLEUS') {\n      if (currentEntry.ntuples) {\n        currentEntry.ntuples.nucleus = dataValue.split(ntuplesSeparatorRegExp);\n      }\n    } else if (canonicDataLabel === 'PAGE') {\n      spectrum.page = dataValue.trim();\n      spectrum.pageValue = Number(dataValue.replace(/^.*=/, ''));\n      spectrum.pageSymbol = spectrum.page.replace(/[=].*/, '');\n    } else if (canonicDataLabel === 'RETENTIONTIME') {\n      spectrum.pageValue = Number(dataValue);\n    } else if (isMSField(canonicDataLabel)) {\n      spectrum[convertMSFieldToLabel(canonicDataLabel)] = dataValue;\n    } else if (canonicDataLabel === 'SAMPLEDESCRIPTION') {\n      spectrum.sampleDescription = dataValue;\n    } else if (canonicDataLabel.startsWith('$NUC')) {\n      if (!currentEntry.tmp[canonicDataLabel] && !dataValue.includes('off')) {\n        currentEntry.tmp[canonicDataLabel] = dataValue.replace(/[<>]/g, '');\n      }\n    } else if (canonicDataLabel === 'END') {\n      currentEntry = parentsStack.pop();\n    }\n\n    if (\n      currentEntry &&\n      currentEntry.info &&\n      currentEntry.meta &&\n      canonicDataLabel.match(options.keepRecordsRegExp)\n    ) {\n      let value = dataValue.trim();\n      let target, label;\n      if (dataLabel.startsWith('$')) {\n        label = options.canonicMetadataLabels\n          ? canonicDataLabel.substring(1)\n          : dataLabel.substring(1);\n        target = currentEntry.meta;\n      } else {\n        label = options.canonicDataLabels ? canonicDataLabel : dataLabel;\n        target = currentEntry.info;\n      }\n\n      if (options.dynamicTyping) {\n        value = parseString(value);\n      }\n      if (target[label]) {\n        if (!Array.isArray(target[label])) {\n          target[label] = [target[label]];\n        }\n        target[label].push(value);\n      } else {\n        target[label] = value;\n      }\n    }\n  }\n\n  profiling(result, 'Finished parsing', options);\n\n  postProcessing(entriesFlat, result, options);\n\n  profiling(result, 'Total time', options);\n\n  /*\n  if (result.children && result.children.length>0) {\n    result = { ...result, ...result.children[0] };\n  }\n  */\n  result.entries = tmpResult.children;\n  result.flatten = entriesFlat;\n\n  return result;\n}\n","import { convert } from 'jcampconverter';\r\nimport { Analysis } from '../Analysis';\r\n/**\r\n * Creates a new Analysis from a JCAMP string\r\n * @param {string} jcamp - String containing the JCAMP data\r\n * @param {object} [options={}]\r\n * @param {object} [options.id=Math.random()]\r\n * @param {string} [options.label=options.id] human redeable label\r\n * @param {string} [options.spectrumCallback] a callback to apply on variables when creating spectrum\r\n * @return {Analysis} - New class element with the given data\r\n */\r\nexport function fromJcamp(jcamp, options = {}) {\r\n    let analysis = new Analysis(options);\r\n    addJcamp(analysis, jcamp);\r\n    return analysis;\r\n}\r\nfunction addJcamp(analysis, jcamp) {\r\n    let converted = convert(jcamp, {\r\n        keepRecordsRegExp: /.*/,\r\n    });\r\n    for (let entry of converted.flatten) {\r\n        if (!entry.spectra || !entry.spectra[0])\r\n            continue;\r\n        let currentSpectrum = entry.spectra[0];\r\n        // we ensure variables\r\n        if (!currentSpectrum.variables) {\r\n            const variables = {};\r\n            currentSpectrum.variables = variables;\r\n            variables.x = {\r\n                label: currentSpectrum.xUnits,\r\n                symbol: 'X',\r\n                data: currentSpectrum.data.x || currentSpectrum.data.X,\r\n            };\r\n            variables.y = {\r\n                label: currentSpectrum.yUnits,\r\n                symbol: 'Y',\r\n                data: currentSpectrum.data.y || currentSpectrum.data.Y,\r\n            };\r\n        }\r\n        else {\r\n            for (let key in currentSpectrum.variables) {\r\n                const variable = currentSpectrum.variables[key];\r\n                if (variable.label)\r\n                    continue;\r\n                variable.label = variable.name || variable.symbol || key;\r\n                if (variable.units && !variable.label.includes(variable.units)) {\r\n                    variable.label += ` [${variable.units}]`;\r\n                }\r\n            }\r\n        }\r\n        analysis.pushSpectrum(currentSpectrum.variables, {\r\n            dataType: entry.dataType,\r\n            title: entry.title,\r\n            meta: entry.meta,\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbUpjYW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zyb20vZnJvbUpjYW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDOzs7Ozs7OztHQVFHO0FBQ0gsTUFBTSxVQUFVLFNBQVMsQ0FBQyxLQUEyQixFQUFFLE9BQU8sR0FBRyxFQUFFO0lBQ2pFLElBQUksUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDMUIsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFDLFFBQWtCLEVBQUUsS0FBMkI7SUFDL0QsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLEtBQUssRUFBRTtRQUM3QixpQkFBaUIsRUFBRSxJQUFJO0tBQ3hCLENBQUMsQ0FBQztJQUVILEtBQUssSUFBSSxLQUFLLElBQUksU0FBUyxDQUFDLE9BQU8sRUFBRTtRQUNuQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQUUsU0FBUztRQUNsRCxJQUFJLGVBQWUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZDLHNCQUFzQjtRQUN0QixJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsRUFBRTtZQUM5QixNQUFNLFNBQVMsR0FBcUMsRUFBRSxDQUFDO1lBQ3ZELGVBQWUsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxDQUFDLEdBQUc7Z0JBQ1osS0FBSyxFQUFFLGVBQWUsQ0FBQyxNQUFNO2dCQUM3QixNQUFNLEVBQUUsR0FBRztnQkFDWCxJQUFJLEVBQUUsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3ZELENBQUM7WUFDRixTQUFTLENBQUMsQ0FBQyxHQUFHO2dCQUNaLEtBQUssRUFBRSxlQUFlLENBQUMsTUFBTTtnQkFDN0IsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsSUFBSSxFQUFFLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN2RCxDQUFDO1NBQ0g7YUFBTTtZQUNMLEtBQUssSUFBSSxHQUFHLElBQUksZUFBZSxDQUFDLFNBQVMsRUFBRTtnQkFDekMsTUFBTSxRQUFRLEdBQUcsZUFBZSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxRQUFRLENBQUMsS0FBSztvQkFBRSxTQUFTO2dCQUM3QixRQUFRLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUM7Z0JBQ3pELElBQUksUUFBUSxDQUFDLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtvQkFDOUQsUUFBUSxDQUFDLEtBQUssSUFBSSxLQUFLLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQztpQkFDMUM7YUFDRjtTQUNGO1FBRUQsUUFBUSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFO1lBQy9DLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtZQUN4QixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7WUFDbEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO1NBQ2pCLENBQUMsQ0FBQztLQUNKO0FBQ0gsQ0FBQyJ9","/**\n * Ensure that the data is string. If it is an ArrayBuffer it will be converted to string using TextDecoder.\n * @param {string|ArrayBuffer} blob\n * @param {object} [options={}]\n * @param {string} [options.encoding='utf8']\n * @returns {string}\n */\n\nexport function ensureString(blob, options = {}) {\n  const { encoding = 'utf8' } = options;\n  if (ArrayBuffer.isView(blob) || blob instanceof ArrayBuffer) {\n    const decoder = new TextDecoder(encoding);\n    return decoder.decode(blob);\n  }\n  return blob;\n}\n","/**\n * In place modification of the 2 arrays to make X unique and sum the Y if X has the same value\n * @param {object} [points={}] : Object of points contains property x (an array) and y (an array)\n * @return points\n */\n\nexport default function uniqueX(points = {}) {\n  const { x, y } = points;\n  if (x.length < 2) return;\n  if (x.length !== y.length) {\n    throw new Error('The X and Y arrays mush have the same length');\n  }\n\n  let current = x[0];\n  let counter = 0;\n\n  for (let i = 1; i < x.length; i++) {\n    if (current !== x[i]) {\n      counter++;\n      current = x[i];\n      x[counter] = x[i];\n      if (i !== counter) {\n        y[counter] = 0;\n      }\n    }\n    if (i !== counter) {\n      y[counter] += y[i];\n    }\n  }\n\n  x.length = counter + 1;\n  y.length = counter + 1;\n}\n","import { ensureString } from \"ensure-string\";\nimport mlArrayMax from \"ml-array-max\";\nimport uniqueXFunction from \"ml-arrayxy-uniquex\";\nimport { xIsMonotone } from \"ml-spectra-processing\";\n\n/**\n * Parse a text-file and convert it to an array of XY points\n * @param {string} text - csv or tsv strings\n * @param {object} [options={}]\n * @param {boolean} [options.rescale = false] - will set the maximum value to 1\n * @param {boolean} [options.uniqueX = false] - Make the X values unique (works only with 'xxyy' format). If the X value is repeated the sum of Y is done.\n * @param {number} [options.xColumn = 0] - A number that specifies the x column\n * @param {number} [options.yColumn = 1] - A number that specifies the y column\n * @param {boolean} [options.bestGuess=false] Will try to guess which columns are the best\n * @param {number} [options.numberColumns=Number.MAX_SAFE_INTEGER] If the file has 10 columns and you specify here 2 it will reflow the file\n * @param {number} [options.maxNumberColumns = (Math.max(xColumn, yColumn)+1)] - A number that specifies the maximum number of y columns\n * @param {number} [options.minNumberColumns = (Math.min(xColumn, yColumn)+1)] - A number that specifies the minimum number of y columns\n * @param {boolean} [options.keepInfo = false] - shoud we keep the non numeric lines. In this case the system will return an object {data, info}\n * @return {object{x:<Array<number>>,y:<Array<number>>}\n */\nexport function parseXY(text, options = {}) {\n  let {\n    rescale = false,\n    uniqueX = false,\n    xColumn = 0,\n    yColumn = 1,\n    keepInfo = false,\n    bestGuess = false,\n    numberColumns = Number.MAX_SAFE_INTEGER,\n    maxNumberColumns = Number.MAX_SAFE_INTEGER,\n    minNumberColumns = 2,\n  } = options;\n\n  text = ensureString(text);\n\n  maxNumberColumns = Math.max(maxNumberColumns, xColumn + 1, yColumn + 1);\n  minNumberColumns = Math.max(xColumn + 1, yColumn + 1, minNumberColumns);\n\n  let lines = text.split(/[\\r\\n]+/);\n\n  let matrix = [];\n  let info = [];\n  let position = 0;\n  for (let l = 0; l < lines.length; l++) {\n    let line = lines[l].trim();\n    // we will consider only lines that contains only numbers\n    if (line.match(/[0-9]+/) && line.match(/^[0-9eE,;. \\t+-]+$/)) {\n      let fields = line.split(/,[; \\t]+|[; \\t]+/);\n      if (fields.length === 1) {\n        fields = line.split(/[,; \\t]+/);\n      }\n      if (\n        fields &&\n        fields.length >= minNumberColumns && // we filter lines that have not enough or too many columns\n        fields.length <= maxNumberColumns\n      ) {\n        matrix.push(fields.map((value) => parseFloat(value.replace(\",\", \".\"))));\n        position++;\n      }\n    } else if (line) {\n      info.push({ position, value: line });\n    }\n  }\n\n  if (bestGuess) {\n    if (\n      matrix[0] &&\n      matrix[0].length === 3 &&\n      options.xColumn === undefined &&\n      options.yColumn === undefined\n    ) {\n      // is the first column a seuqnetial number ?\n      let skipFirstColumn = true;\n      for (let i = 0; i < matrix.length - 1; i++) {\n        if (Math.abs(matrix[i][0] - matrix[i + 1][0]) !== 1) {\n          skipFirstColumn = false;\n        }\n      }\n      if (skipFirstColumn) {\n        xColumn = 1;\n        yColumn = 2;\n      }\n    }\n    if (matrix[0] && matrix[0].length > 3) {\n      let xs = [];\n      for (let row of matrix) {\n        for (let i = xColumn; i < row.length; i += 2) {\n          xs.push(row[i]);\n        }\n      }\n      if (xIsMonotone(xs)) {\n        numberColumns = 2;\n      }\n    }\n  }\n\n  if (numberColumns) {\n    const newMatrix = [];\n    for (const row of matrix) {\n      for (let i = 0; i < row.length; i += numberColumns) {\n        newMatrix.push(row.slice(i, i + numberColumns));\n      }\n    }\n    matrix = newMatrix;\n  }\n  const result = {\n    x: matrix.map((row) => row[xColumn]),\n    y: matrix.map((row) => row[yColumn]),\n  };\n\n  if (uniqueX) {\n    uniqueXFunction(result);\n  }\n\n  if (rescale) {\n    let maxY = mlArrayMax(result.y);\n    for (let i = 0; i < result.y.length; i++) {\n      result.y[i] /= maxY;\n    }\n  }\n\n  if (!keepInfo) return result;\n\n  return {\n    info,\n    data: result,\n  };\n}\n","import maxFct from 'ml-array-max';\nimport minFct from 'ml-array-min';\n\n/**\n * Parse from a xyxy data array\n * @param {Array<Array<number>>} variables\n * @param {object} [meta] - same metadata object format that the fromText\n * @return {string} JCAMP of the input\n */\nexport default function creatorNtuples(variables, options) {\n  const { meta = {}, info = {} } = options;\n\n  const { title = '', owner = '', origin = '', dataType = '' } = info;\n\n  const symbol = [];\n  const varName = [];\n  const varType = [];\n  const varDim = [];\n  const units = [];\n  const first = [];\n  const last = [];\n  const min = [];\n  const max = [];\n  const factor = [];\n\n  const keys = Object.keys(variables);\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    let variable = variables[key];\n\n    let name = variable.label && variable.label.replace(/ *\\[.*/, '');\n    let unit = variable.label && variable.label.replace(/.*\\[(.*)\\].*/, '$1');\n\n    symbol.push(variable.symbol || key);\n    varName.push(variable.name || name || key);\n    varDim.push(variables[key].data.length);\n\n    if (variable.isDependent !== undefined) {\n      varType.push(variable.isDependent ? 'DEPENDENT' : 'INDEPENDENT');\n    } else {\n      varType.push(\n        variable.type\n          ? variable.type.toUpperCase()\n          : i === 0\n          ? 'INDEPENDENT'\n          : 'DEPENDENT',\n      );\n    }\n\n    units.push(variable.units || unit || '');\n    first.push(variables[key][0]);\n    last.push(variables[key][variables[key].length - 1]);\n    min.push(minFct(variables[key].data));\n    max.push(maxFct(variables[key].data));\n    factor.push(1);\n  }\n\n  let header = `##TITLE=${title}\n##JCAMP-DX=6.00\n##DATA TYPE=${dataType}\n##ORIGIN=${origin}\n##OWNER=${owner}\\n`;\n\n  for (const key in meta) {\n    header +=\n      typeof meta[key] === 'object'\n        ? `##$${key}=${JSON.stringify(meta[key])}\\n`\n        : `##$${key}=${meta[key]}\\n`;\n  }\n\n  header += `##NTUPLES= ${dataType}\n##VAR_NAME=  ${varName.join()}\n##SYMBOL=    ${symbol.join()}\n##VAR_TYPE=  ${varType.join()}\n##VAR_DIM=   ${varDim.join()}\n##UNITS=     ${units.join()}\n##PAGE= N=1\\n`;\n\n  header += `##DATA TABLE= (${symbol.join('')}..${symbol.join('')}), PEAKS\\n`;\n\n  for (let i = 0; i < variables[keys[0]].data.length; i++) {\n    let point = [];\n    for (let key of keys) {\n      point.push(variables[key].data[i]);\n    }\n    header += `${point.join('\\t')}\\n`;\n  }\n\n  header += '##END';\n  return header;\n}\n","export function getNumber(number, factor) {\n  if (factor !== 1) number /= factor;\n  const rounded = Math.round(number);\n  if (rounded !== number && Math.abs(rounded - number) <= Number.EPSILON) {\n    return rounded;\n  }\n  return number;\n}\n","import { getNumber } from './getNumber.js';\n\nexport function peakTableCreator(data, options = {}) {\n  const { xFactor = 1, yFactor = 1 } = options;\n  let firstX = Number.POSITIVE_INFINITY;\n  let lastX = Number.NEGATIVE_INFINITY;\n  let firstY = Number.POSITIVE_INFINITY;\n  let lastY = Number.NEGATIVE_INFINITY;\n\n  let lines = [];\n\n  for (let i = 0; i < data.x.length; i++) {\n    let x = data.x[i];\n    let y = data.y[i];\n    if (firstX > x) {\n      firstX = x;\n    }\n    if (lastX < x) {\n      lastX = x;\n    }\n    if (firstY > y) {\n      firstY = y;\n    }\n    if (lastY < y) {\n      lastY = y;\n    }\n  }\n  lines.push(`##FIRSTX=${firstX}`);\n  lines.push(`##LASTX=${lastX}`);\n  lines.push(`##FIRSTY=${firstY}`);\n  lines.push(`##LASTY=${lastY}`);\n  lines.push(`##XFACTOR=${xFactor}`);\n  lines.push(`##YFACTOR=${yFactor}`);\n  lines.push('##PEAK TABLE=(XY..XY)');\n\n  for (let i = 0; i < data.x.length; i++) {\n    lines.push(\n      `${getNumber(data.x[i], xFactor)} ${getNumber(data.y[i], yFactor)}`,\n    );\n  }\n  return lines;\n}\n","import { getNumber } from './getNumber.js';\n\nexport function xyDataCreator(data, options = {}) {\n  const { xFactor = 1, yFactor = 1 } = options;\n  let firstX = data.x[0];\n  let lastX = data.x[data.x.length - 1];\n  let firstY = data.y[0];\n  let lastY = data.y[data.y.length - 1];\n  let nbPoints = data.x.length;\n  let deltaX = (lastX - firstX) / (nbPoints - 1);\n  let lines = [];\n\n  lines.push(`##FIRSTX=${firstX}`);\n  lines.push(`##LASTX=${lastX}`);\n  lines.push(`##FIRSTY=${firstY}`);\n  lines.push(`##LASTY=${lastY}`);\n  lines.push(`##DELTAX=${deltaX}`);\n  lines.push(`##XFACTOR=${xFactor}`);\n  lines.push(`##YFACTOR=${yFactor}`);\n  lines.push(`##DELTAX=${xFactor}`);\n  lines.push('##XYDATA=(X++(Y..Y))');\n\n  let line = data.x[0];\n  for (let i = 0; i < data.x.length; i++) {\n    line += ` ${getNumber(data.y[i], yFactor)}`;\n    if (line.length > 70) {\n      lines.push(line);\n      if (i < data.x.length - 1) {\n        line = getNumber(data.x[0] + i * deltaX, xFactor);\n      } else {\n        line = '';\n      }\n    }\n  }\n  if (line) lines.push(line);\n  return lines;\n}\n","import { peakTableCreator } from './utils/peakTableCreator';\nimport { xyDataCreator } from './utils/xyDataCreator';\n/**\n * Create a jcamp\n * @param {object} data object of array\n * @param {object} [options={}] metadata object\n * @param {string} [options.info={}] metadata of the file\n * @param {string} [options.info.title=''] title of the file\n * @param {string} [options.info.owner=''] owner of the file\n * @param {string} [options.info.origin=''] origin of the file\n * @param {string} [options.info.dataType=''] type of data\n * @param {string} [options.info.xUnits=''] units for the x axis for variables===undefined\n * @param {string} [options.info.yUnits=''] units for the y axis for variables===undefined\n * @param {number} [options.info.xFactor=1] factor to multiply X values\n * @param {number} [options.info.yFactor=1] factor to multiply Y values\n * @param {object} [options.meta={}] comments to add to the file\n * @param {boolean} [options.xydata=false] Use XYDATA format. Will use first / last X and equidistant Xs values if true\n * @return {string} JCAMP of the input\n */\nexport function fromJSON(data, options = {}) {\n  const { meta = {}, info = {}, xydata = false } = options;\n\n  const {\n    title = '',\n    owner = '',\n    origin = '',\n    dataType = '',\n    xUnits = '',\n    yUnits = '',\n    xFactor = 1,\n    yFactor = 1,\n  } = info;\n\n  data = { x: data.x, y: data.y };\n\n  let header = `##TITLE=${title}\n##JCAMP-DX=4.24\n##DATA TYPE=${dataType}\n##ORIGIN=${origin}\n##OWNER=${owner}\n##XUNITS=${xUnits}\n##YUNITS=${yUnits}\\n`;\n\n  for (const key in meta) {\n    header +=\n      key.toLowerCase() === 'cheminfo'\n        ? `##$${key}=${JSON.stringify(meta[key])}\\n`\n        : `##$${key}=${meta[key]}\\n`;\n  }\n\n  // we leave the header and utf8 fonts ${header.replace(/[^\\t\\r\\n\\x20-\\x7F]/g, '')\n\n  return `${header}##NPOINTS=${data.x.length}\n${(xydata\n  ? xyDataCreator(data, { xFactor, yFactor })\n  : peakTableCreator(data, { xFactor, yFactor })\n).join('\\n')}\n##END`;\n}\n","import { fromVariables } from 'convert-to-jcamp';\r\nexport function toJcamps(analysis, options = {}) {\r\n    let jcamps = [];\r\n    for (let spectrum of analysis.spectra) {\r\n        jcamps.push(getJcamp(spectrum, options));\r\n    }\r\n    return jcamps;\r\n}\r\nfunction getJcamp(spectrum, options) {\r\n    const { info = {}, meta = {} } = options;\r\n    let jcampOptions = {\r\n        options: {},\r\n        info: {\r\n            title: spectrum.title,\r\n            dataType: spectrum.dataType,\r\n            ...info,\r\n        },\r\n        meta: { ...spectrum.meta, ...meta },\r\n    };\r\n    return fromVariables(spectrum.variables, jcampOptions);\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9KY2FtcHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdG8vdG9KY2FtcHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBUWpELE1BQU0sVUFBVSxRQUFRLENBQUMsUUFBa0IsRUFBRSxVQUEyQixFQUFFO0lBQ3hFLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztJQUNoQixLQUFLLElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxPQUFPLEVBQUU7UUFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDMUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQsU0FBUyxRQUFRLENBQUMsUUFBa0IsRUFBRSxPQUF3QjtJQUM1RCxNQUFNLEVBQUUsSUFBSSxHQUFHLEVBQUUsRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDO0lBRXpDLElBQUksWUFBWSxHQUFHO1FBQ2pCLE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFO1lBQ0osS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLO1lBQ3JCLFFBQVEsRUFBRSxRQUFRLENBQUMsUUFBUTtZQUMzQixHQUFHLElBQUk7U0FDUjtRQUNELElBQUksRUFBRSxFQUFFLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksRUFBRTtLQUNwQyxDQUFDO0lBRUYsT0FBTyxhQUFhLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUN6RCxDQUFDIn0=","import creatorNtuples from './creatorNtuples';\nimport { fromJSON } from './fromJSON';\n\n/**\n * Create a jcamp from variables\n * @param {Array<Variable} [variables={}] - object of variables\n * @param {string} [options.info={}] - metadata of the file\n * @param {string} [options.info.title = ''] - title of the file\n * @param {string} [options.info.owner = ''] - owner of the file\n * @param {string} [options.info.origin = ''] - origin of the file\n * @param {string} [options.info.dataType = ''] - type of data\n * @param {object} [options.meta = {}] - comments to add to the file\n * @param {object} [options.forceNtuples = false] - force the ntuples format even if there is only x and y variables\n */\nexport function fromVariables(variables = {}, options = {}) {\n  const { info, meta, forceNtuples } = options;\n\n  let jcampOptions = {\n    info,\n    meta,\n  };\n\n  let keys = Object.keys(variables).map((key) => key.toLowerCase());\n  if (\n    keys.length === 2 &&\n    keys.includes('x') &&\n    keys.includes('y') &&\n    !forceNtuples\n  ) {\n    let x = variables.x;\n    let xLabel = x.label || x.name || 'x';\n\n    jcampOptions.info.xUnits = xLabel.includes(variables.x.units)\n      ? xLabel\n      : `${xLabel} [${variables.x.units}]`;\n\n    let y = variables.y;\n    let yLabel = y.label || y.name || 'y';\n\n    jcampOptions.info.yUnits = yLabel.includes(variables.y.units)\n      ? yLabel\n      : `${yLabel} [${variables.y.units}]`;\n    return fromJSON({ x: variables.x.data, y: variables.y.data }, jcampOptions);\n  } else {\n    return creatorNtuples(variables, options);\n  }\n}\n","export function toText(analysis, options = {}) {\r\n    // Export all the data to Csv\r\n    if (!options.selector) {\r\n        return exportText(analysis.spectra, options);\r\n    }\r\n    // Export selected variables\r\n    const spectra = analysis.getXYSpectrum(options.selector);\r\n    return exportText(spectra ? [spectra] : [], options);\r\n}\r\nfunction exportText(spectrums, options) {\r\n    const { endOfLine = '\\n', fieldSeparator = ',' } = options;\r\n    let result = new Array(spectrums.length);\r\n    for (let index = 0; index < spectrums.length; index++) {\r\n        const variables = Object.values(spectrums[index].variables);\r\n        const labels = variables.map((v) => v.label);\r\n        const maxNumberData = Math.max(...variables.map((v) => v.data.length));\r\n        let lines = [labels.join(fieldSeparator)];\r\n        for (let lineIndex = 0; lineIndex < maxNumberData; lineIndex++) {\r\n            lines.push(variables\r\n                .map(({ data }) => data[lineIndex] === undefined ? '' : data[lineIndex])\r\n                .join(fieldSeparator));\r\n        }\r\n        result[index] = lines.join(endOfLine);\r\n    }\r\n    return result;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9UZXh0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RvL3RvVGV4dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFXQSxNQUFNLFVBQVUsTUFBTSxDQUFDLFFBQWtCLEVBQUUsVUFBeUIsRUFBRTtJQUNwRSw2QkFBNkI7SUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUU7UUFDckIsT0FBTyxVQUFVLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztLQUM5QztJQUVELDRCQUE0QjtJQUM1QixNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6RCxPQUFPLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUN2RCxDQUFDO0FBRUQsU0FBUyxVQUFVLENBQUMsU0FBcUIsRUFBRSxPQUFzQjtJQUMvRCxNQUFNLEVBQUUsU0FBUyxHQUFHLElBQUksRUFBRSxjQUFjLEdBQUcsR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFDO0lBQzNELElBQUksTUFBTSxHQUFhLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuRCxLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRTtRQUNyRCxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU1RCxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUV2RSxJQUFJLEtBQUssR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztRQUMxQyxLQUFLLElBQUksU0FBUyxHQUFHLENBQUMsRUFBRSxTQUFTLEdBQUcsYUFBYSxFQUFFLFNBQVMsRUFBRSxFQUFFO1lBQzlELEtBQUssQ0FBQyxJQUFJLENBQ1IsU0FBUztpQkFDTixHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FDaEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQ3JEO2lCQUNBLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FDeEIsQ0FBQztTQUNIO1FBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7S0FDdkM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDIn0=","function getData(x, y) {\r\n    let data = new Array(x.length);\r\n    for (let i = 0; i < x.length; i++) {\r\n        data[i] = { x: x[i], y: y[i] };\r\n    }\r\n    return data;\r\n}\r\n/**\r\n * Generate a jsgraph chart format from an array of Analysis\r\n */\r\nexport function getReactPlotJSON(analyses, query, options = {}) {\r\n    const { enforceGrowing = false, xAxis: xAxisOptions = {}, yAxis: yAxisOptions = { labelSpace: 40 }, content: seriesOptions = { displayMarker: true }, dimensions = { width: 550, height: 500 }, ...otherOptions } = options;\r\n    let content = [];\r\n    let meta = [];\r\n    let xAxis = null;\r\n    let yAxis = null;\r\n    for (const analysis of analyses) {\r\n        let spectra = enforceGrowing\r\n            ? analysis.getNormalizedSpectrum({\r\n                selector: query,\r\n                normalization: {\r\n                    filters: [{ name: 'ensureGrowing' }],\r\n                    keepYUnits: true,\r\n                },\r\n            })\r\n            : analysis.getXYSpectrum(query);\r\n        if (!spectra)\r\n            continue;\r\n        if (spectra.meta) {\r\n            meta.push(spectra.meta);\r\n        }\r\n        xAxis = {\r\n            id: 'x',\r\n            label: spectra.variables.x.label +\r\n                (spectra.variables.x.units ? ` [${spectra.variables.x.units}]` : ''),\r\n            ...xAxisOptions,\r\n            position: 'bottom',\r\n            type: 'main',\r\n        };\r\n        yAxis = {\r\n            id: 'y',\r\n            label: spectra.variables.y.label +\r\n                (spectra.variables.y.units ? ` [${spectra.variables.y.units}]` : ''),\r\n            ...yAxisOptions,\r\n            position: 'left',\r\n            type: 'main',\r\n        };\r\n        const data = getData(spectra.variables.x.data, spectra.variables.y.data);\r\n        const serie = {\r\n            type: 'line',\r\n            label: spectra.title,\r\n            data,\r\n            ...seriesOptions,\r\n        };\r\n        content.push(serie);\r\n    }\r\n    if (xAxis === null || yAxis === null) {\r\n        throw new Error('The axes were not defined');\r\n    }\r\n    return {\r\n        content,\r\n        axes: [xAxis, yAxis],\r\n        dimensions,\r\n        meta,\r\n        ...otherOptions,\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0UmVhY3RQbG90SlNPTi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZWFjdFBsb3QvZ2V0UmVhY3RQbG90SlNPTi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFxQkEsU0FBUyxPQUFPLENBQUMsQ0FBYSxFQUFFLENBQWE7SUFDM0MsSUFBSSxJQUFJLEdBQWEsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2pDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0tBQ2hDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLFVBQVUsZ0JBQWdCLENBQzlCLFFBQW9CLEVBQ3BCLEtBQXVCLEVBQ3ZCLFVBQTRCLEVBQUU7SUFFOUIsTUFBTSxFQUNKLGNBQWMsR0FBRyxLQUFLLEVBQ3RCLEtBQUssRUFBRSxZQUFZLEdBQUcsRUFBRSxFQUN4QixLQUFLLEVBQUUsWUFBWSxHQUFHLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUN4QyxPQUFPLEVBQUUsYUFBYSxHQUFHLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxFQUNoRCxVQUFVLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFDeEMsR0FBRyxZQUFZLEVBQ2hCLEdBQUcsT0FBTyxDQUFDO0lBQ1osSUFBSSxPQUFPLEdBQThCLEVBQUUsQ0FBQztJQUM1QyxJQUFJLElBQUksR0FBNkIsRUFBRSxDQUFDO0lBRXhDLElBQUksS0FBSyxHQUFnQixJQUFJLENBQUM7SUFDOUIsSUFBSSxLQUFLLEdBQWdCLElBQUksQ0FBQztJQUU5QixLQUFLLE1BQU0sUUFBUSxJQUFJLFFBQVEsRUFBRTtRQUMvQixJQUFJLE9BQU8sR0FBRyxjQUFjO1lBQzFCLENBQUMsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUM7Z0JBQzdCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLGFBQWEsRUFBRTtvQkFDYixPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsQ0FBQztvQkFDcEMsVUFBVSxFQUFFLElBQUk7aUJBQ2pCO2FBQ0YsQ0FBQztZQUNKLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPO1lBQUUsU0FBUztRQUV2QixJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUU7WUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDekI7UUFFRCxLQUFLLEdBQUc7WUFDTixFQUFFLEVBQUUsR0FBRztZQUNQLEtBQUssRUFDSCxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLO2dCQUN6QixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3RFLEdBQUcsWUFBWTtZQUNmLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQztRQUNGLEtBQUssR0FBRztZQUNOLEVBQUUsRUFBRSxHQUFHO1lBQ1AsS0FBSyxFQUNILE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUs7Z0JBQ3pCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdEUsR0FBRyxZQUFZO1lBQ2YsUUFBUSxFQUFFLE1BQU07WUFDaEIsSUFBSSxFQUFFLE1BQU07U0FDYixDQUFDO1FBRUYsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6RSxNQUFNLEtBQUssR0FBbUI7WUFDNUIsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsSUFBSTtZQUNKLEdBQUcsYUFBYTtTQUNqQixDQUFDO1FBQ0YsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNyQjtJQUVELElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO1FBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztLQUM5QztJQUVELE9BQU87UUFDTCxPQUFPO1FBQ1AsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztRQUNwQixVQUFVO1FBQ1YsSUFBSTtRQUNKLEdBQUcsWUFBWTtLQUNoQixDQUFDO0FBQ0osQ0FBQyJ9","import { getJSGraph } from './jsgraph/getJSGraph';\r\nimport { getNormalizationAnnotations } from './jsgraph/getNormalizationAnnotations';\r\nexport * from './AnalysesManager';\r\nexport * from './Analysis';\r\nexport * from './from/fromJcamp';\r\nexport * from './from/fromText';\r\nexport * from './to/toJcamp';\r\nexport * from './to/toJcamps';\r\nexport * from './to/toText';\r\nexport * from './util/getNormalizedSpectrum';\r\nexport * from './util/peakPicking';\r\nexport * from './util/autoPeakPicking';\r\nexport * from './types/types';\r\nexport * from './types/AutoPeakPickingOptions';\r\nexport * from './types/NormalizedFilters';\r\nexport * from './types/NormalizedSpectrumOptions';\r\nexport * from './types/PlotObject';\r\nexport * from './types/SGOptions';\r\nexport * from './types/ShapeOptions';\r\nexport * from './types/SpectrumSelector';\r\nexport { getReactPlotJSON } from './reactPlot/getReactPlotJSON';\r\nexport const JSGraph = {\r\n    getJSGraph,\r\n    getNormalizationAnnotations,\r\n};\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBRXBGLGNBQWMsbUJBQW1CLENBQUM7QUFDbEMsY0FBYyxZQUFZLENBQUM7QUFDM0IsY0FBYyxrQkFBa0IsQ0FBQztBQUNqQyxjQUFjLGlCQUFpQixDQUFDO0FBQ2hDLGNBQWMsY0FBYyxDQUFDO0FBQzdCLGNBQWMsZUFBZSxDQUFDO0FBQzlCLGNBQWMsYUFBYSxDQUFDO0FBQzVCLGNBQWMsOEJBQThCLENBQUM7QUFFN0MsY0FBYyxvQkFBb0IsQ0FBQztBQUNuQyxjQUFjLHdCQUF3QixDQUFDO0FBRXZDLGNBQWMsZUFBZSxDQUFDO0FBQzlCLGNBQWMsZ0NBQWdDLENBQUM7QUFDL0MsY0FBYywyQkFBMkIsQ0FBQztBQUMxQyxjQUFjLG1DQUFtQyxDQUFDO0FBRWxELGNBQWMsb0JBQW9CLENBQUM7QUFDbkMsY0FBYyxtQkFBbUIsQ0FBQztBQUNsQyxjQUFjLHNCQUFzQixDQUFDO0FBQ3JDLGNBQWMsMEJBQTBCLENBQUM7QUFFekMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFaEUsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHO0lBQ3JCLFVBQVU7SUFDViwyQkFBMkI7Q0FDNUIsQ0FBQyJ9","import { xyFilterXPositive } from 'ml-spectra-processing';\r\nimport { addStyle } from './addStyle';\r\nimport { COLORS } from './colors';\r\n/**\r\n * Generate a jsgraph chart format from an array of Analysis\r\n */\r\nexport function getJSGraph(analyses, options = {}) {\r\n    const { colors = COLORS, opacities = [1], linesWidth = [1], selector = {}, normalization, xAxis = {}, yAxis = {}, } = options;\r\n    let series = [];\r\n    let xLabel = xAxis.label;\r\n    let yLabel = yAxis.label;\r\n    let xUnits = xAxis.units;\r\n    let yUnits = yAxis.units;\r\n    for (let i = 0; i < analyses.length; i++) {\r\n        const analysis = analyses[i];\r\n        let serie = {};\r\n        let currentData = analysis.getNormalizedSpectrum({\r\n            selector,\r\n            normalization,\r\n        });\r\n        if (!currentData)\r\n            continue;\r\n        if (!xLabel)\r\n            xLabel = currentData.variables.x.label;\r\n        if (!yLabel)\r\n            yLabel = currentData.variables.y.label;\r\n        if (!xUnits)\r\n            xUnits = currentData.variables.x.units;\r\n        if (!yUnits)\r\n            yUnits = currentData.variables.y.units;\r\n        addStyle(serie, analysis, {\r\n            color: colors[i % colors.length],\r\n            opacity: opacities[i % opacities.length],\r\n            lineWidth: linesWidth[i % linesWidth.length],\r\n        });\r\n        serie.dataType = currentData.dataType;\r\n        serie.data = {\r\n            x: currentData.variables.x.data,\r\n            y: currentData.variables.y.data,\r\n        };\r\n        if (xAxis.logScale) {\r\n            serie.data = xyFilterXPositive(serie.data);\r\n        }\r\n        series.push(serie);\r\n    }\r\n    return {\r\n        axes: {\r\n            x: {\r\n                label: xLabel,\r\n                unit: xUnits,\r\n                unitWrapperBefore: '(',\r\n                unitWrapperAfter: ')',\r\n                flipped: false,\r\n                display: true,\r\n                ...xAxis,\r\n            },\r\n            y: {\r\n                label: yLabel,\r\n                unit: yUnits,\r\n                unitWrapperBefore: '(',\r\n                unitWrapperAfter: ')',\r\n                flipped: false,\r\n                display: true,\r\n                ...yAxis,\r\n            },\r\n        },\r\n        series,\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0SlNHcmFwaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9qc2dyYXBoL2dldEpTR3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFLMUQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBdUJsQzs7R0FFRztBQUNILE1BQU0sVUFBVSxVQUFVLENBQUMsUUFBb0IsRUFBRSxVQUEwQixFQUFFO0lBQzNFLE1BQU0sRUFDSixNQUFNLEdBQUcsTUFBTSxFQUNmLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUNmLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUNoQixRQUFRLEdBQUcsRUFBRSxFQUNiLGFBQWEsRUFDYixLQUFLLEdBQUcsRUFBRSxFQUNWLEtBQUssR0FBRyxFQUFFLEdBQ1gsR0FBRyxPQUFPLENBQUM7SUFDWixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFFaEIsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztJQUN6QixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO0lBQ3pCLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDekIsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztJQUV6QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUN4QyxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxLQUFLLEdBQTRCLEVBQUUsQ0FBQztRQUN4QyxJQUFJLFdBQVcsR0FBRyxRQUFRLENBQUMscUJBQXFCLENBQUM7WUFDL0MsUUFBUTtZQUNSLGFBQWE7U0FDZCxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsV0FBVztZQUFFLFNBQVM7UUFDM0IsSUFBSSxDQUFDLE1BQU07WUFBRSxNQUFNLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ3BELElBQUksQ0FBQyxNQUFNO1lBQUUsTUFBTSxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNwRCxJQUFJLENBQUMsTUFBTTtZQUFFLE1BQU0sR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDcEQsSUFBSSxDQUFDLE1BQU07WUFBRSxNQUFNLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ3BELFFBQVEsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFO1lBQ3hCLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDaEMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUN4QyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDO1NBQzdDLENBQUMsQ0FBQztRQUNILEtBQUssQ0FBQyxRQUFRLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQztRQUN0QyxLQUFLLENBQUMsSUFBSSxHQUFHO1lBQ1gsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUk7WUFDL0IsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUk7U0FDaEMsQ0FBQztRQUVGLElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRTtZQUNsQixLQUFLLENBQUMsSUFBSSxHQUFHLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUM1QztRQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDcEI7SUFDRCxPQUFPO1FBQ0wsSUFBSSxFQUFFO1lBQ0osQ0FBQyxFQUFFO2dCQUNELEtBQUssRUFBRSxNQUFNO2dCQUNiLElBQUksRUFBRSxNQUFNO2dCQUNaLGlCQUFpQixFQUFFLEdBQUc7Z0JBQ3RCLGdCQUFnQixFQUFFLEdBQUc7Z0JBQ3JCLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSxJQUFJO2dCQUNiLEdBQUcsS0FBSzthQUNUO1lBQ0QsQ0FBQyxFQUFFO2dCQUNELEtBQUssRUFBRSxNQUFNO2dCQUNiLElBQUksRUFBRSxNQUFNO2dCQUNaLGlCQUFpQixFQUFFLEdBQUc7Z0JBQ3RCLGdCQUFnQixFQUFFLEdBQUc7Z0JBQ3JCLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSxJQUFJO2dCQUNiLEdBQUcsS0FBSzthQUNUO1NBQ0Y7UUFDRCxNQUFNO0tBQ1AsQ0FBQztBQUNKLENBQUMifQ==","export function getNormalizationAnnotations(filter = {}, boundary = { y: { min: '0px', max: '2000px' } }) {\r\n    let { exclusions = [] } = filter;\r\n    let annotations = [];\r\n    exclusions = exclusions.filter((exclusion) => !exclusion.ignore);\r\n    annotations = exclusions.map((exclusion) => {\r\n        let annotation = {\r\n            type: 'rect',\r\n            position: [\r\n                { x: exclusion.from, y: boundary.y.min },\r\n                { x: exclusion.to, y: boundary.y.max },\r\n            ],\r\n            strokeWidth: 0,\r\n            fillColor: 'rgba(255,255,224,1)',\r\n        };\r\n        return annotation;\r\n    });\r\n    if (filter.from !== undefined) {\r\n        annotations.push({\r\n            type: 'rect',\r\n            position: [\r\n                { x: Number.MIN_SAFE_INTEGER, y: boundary.y.min },\r\n                { x: filter.from, y: boundary.y.max },\r\n            ],\r\n            strokeWidth: 0,\r\n            fillColor: 'rgba(255,255,224,1)',\r\n        });\r\n    }\r\n    if (filter.to !== undefined) {\r\n        annotations.push({\r\n            type: 'rect',\r\n            position: [\r\n                { x: filter.to, y: boundary.y.min },\r\n                { x: Number.MAX_SAFE_INTEGER, y: boundary.y.max },\r\n            ],\r\n            strokeWidth: 0,\r\n            fillColor: 'rgba(255,255,224,1)',\r\n        });\r\n    }\r\n    return annotations;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0Tm9ybWFsaXphdGlvbkFubm90YXRpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzZ3JhcGgvZ2V0Tm9ybWFsaXphdGlvbkFubm90YXRpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVdBLE1BQU0sVUFBVSwyQkFBMkIsQ0FDekMsU0FBNEIsRUFBRSxFQUM5QixRQUFRLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsRUFBRTtJQUUvQyxJQUFJLEVBQUUsVUFBVSxHQUFHLEVBQUUsRUFBRSxHQUFHLE1BQU0sQ0FBQztJQUVqQyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDckIsVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pFLFdBQVcsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUU7UUFDekMsSUFBSSxVQUFVLEdBQUc7WUFDZixJQUFJLEVBQUUsTUFBTTtZQUNaLFFBQVEsRUFBRTtnQkFDUixFQUFFLENBQUMsRUFBRSxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDeEMsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUU7YUFDdkM7WUFDRCxXQUFXLEVBQUUsQ0FBQztZQUNkLFNBQVMsRUFBRSxxQkFBcUI7U0FDakMsQ0FBQztRQUNGLE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtRQUM3QixXQUFXLENBQUMsSUFBSSxDQUFDO1lBQ2YsSUFBSSxFQUFFLE1BQU07WUFDWixRQUFRLEVBQUU7Z0JBQ1IsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDakQsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUU7YUFDdEM7WUFDRCxXQUFXLEVBQUUsQ0FBQztZQUNkLFNBQVMsRUFBRSxxQkFBcUI7U0FDakMsQ0FBQyxDQUFDO0tBQ0o7SUFDRCxJQUFJLE1BQU0sQ0FBQyxFQUFFLEtBQUssU0FBUyxFQUFFO1FBQzNCLFdBQVcsQ0FBQyxJQUFJLENBQUM7WUFDZixJQUFJLEVBQUUsTUFBTTtZQUNaLFFBQVEsRUFBRTtnQkFDUixFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDbkMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRTthQUNsRDtZQUNELFdBQVcsRUFBRSxDQUFDO1lBQ2QsU0FBUyxFQUFFLHFCQUFxQjtTQUNqQyxDQUFDLENBQUM7S0FDSjtJQUNELE9BQU8sV0FBVyxDQUFDO0FBQ3JCLENBQUMifQ==","import { appendDistinctParameter } from './util/appendDistinctParameter';\r\nimport { appendDistinctValue } from './util/appendDistinctValue';\r\nexport class AnalysesManager {\r\n    constructor() {\r\n        this.analyses = [];\r\n    }\r\n    addAnalysis(analysis) {\r\n        let index = this.getAnalysisIndex(analysis.id);\r\n        if (index === undefined) {\r\n            this.analyses.push(analysis);\r\n        }\r\n        else {\r\n            this.analyses[index] = analysis;\r\n        }\r\n    }\r\n    getAnalyses(options = {}) {\r\n        const { ids } = options;\r\n        let analyses = [];\r\n        for (const analysis of this.analyses) {\r\n            if (!ids || ids.includes(analysis.id)) {\r\n                analyses.push(analysis);\r\n            }\r\n        }\r\n        return analyses;\r\n    }\r\n    getSpectra() {\r\n        const spectra = [];\r\n        for (const analysis of this.analyses) {\r\n            spectra.push(...analysis.spectra);\r\n        }\r\n        return spectra;\r\n    }\r\n    /**\r\n     * Get an array of objects (key + count) of all the titles\r\n     */\r\n    getDistinctTitles() {\r\n        let values = {};\r\n        for (let spectrum of this.getSpectra()) {\r\n            if (spectrum.title) {\r\n                appendDistinctValue(values, spectrum.title);\r\n            }\r\n        }\r\n        return Object.keys(values).map((key) => values[key]);\r\n    }\r\n    /**\r\n     * Get an array of objects (key + count) of all the units\r\n     */\r\n    getDistinctUnits() {\r\n        var _a;\r\n        let values = {};\r\n        for (let spectrum of this.getSpectra()) {\r\n            if (spectrum.variables) {\r\n                for (let [, variable] of Object.entries(spectrum.variables)) {\r\n                    const units = (_a = variable.units) === null || _a === void 0 ? void 0 : _a.replace(/\\s+\\[.*/, '');\r\n                    if (units) {\r\n                        appendDistinctValue(values, units);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return Object.keys(values).map((key) => values[key]);\r\n    }\r\n    /**\r\n     * Get an array of objects (key + count) of all the labels\r\n     */\r\n    getDistinctLabels() {\r\n        let values = {};\r\n        for (let spectrum of this.getSpectra()) {\r\n            if (spectrum.variables) {\r\n                for (let [, variable] of Object.entries(spectrum.variables)) {\r\n                    appendDistinctValue(values, variable.label.replace(/\\s+\\[.*/, ''));\r\n                }\r\n            }\r\n        }\r\n        return Object.keys(values).map((key) => values[key]);\r\n    }\r\n    /**\r\n     * Get an array of objects (key + count) of all the dataTypes\r\n     */\r\n    getDistinctDataTypes() {\r\n        let values = {};\r\n        for (let spectrum of this.getSpectra()) {\r\n            if (spectrum.dataType) {\r\n                appendDistinctValue(values, spectrum.dataType);\r\n            }\r\n        }\r\n        return Object.keys(values).map((key) => values[key]);\r\n    }\r\n    /**\r\n     * Get an array of objects (key + count) of all the meta\r\n     */\r\n    getDistinctMeta() {\r\n        let values = {};\r\n        for (let spectrum of this.getSpectra()) {\r\n            if (spectrum.meta) {\r\n                for (let key in spectrum.meta) {\r\n                    appendDistinctParameter(values, key, spectrum.meta[key]);\r\n                }\r\n            }\r\n        }\r\n        return Object.keys(values).map((key) => values[key]);\r\n    }\r\n    removeAllAnalyses() {\r\n        this.analyses.splice(0);\r\n    }\r\n    /**\r\n     * Remove the analysis from the AnalysesManager for the specified id\r\n     */\r\n    removeAnalysis(id) {\r\n        let index = this.getAnalysisIndex(id);\r\n        if (index === undefined)\r\n            return undefined;\r\n        return this.analyses.splice(index, 1);\r\n    }\r\n    /**\r\n     * Returns the index of the analysis in the analyses array\r\n     */\r\n    getAnalysisIndex(id) {\r\n        if (!id)\r\n            return undefined;\r\n        for (let i = 0; i < this.analyses.length; i++) {\r\n            let analysis = this.analyses[i];\r\n            if (analysis.id === id)\r\n                return i;\r\n        }\r\n        return undefined;\r\n    }\r\n    /**\r\n     * Checks if the ID of an analysis exists in the AnalysesManager\r\n     */\r\n    includes(id) {\r\n        const index = this.getAnalysisIndex(id);\r\n        return index === undefined ? false : !isNaN(index);\r\n    }\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5hbHlzZXNNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0FuYWx5c2VzTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN6RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQU1qRSxNQUFNLE9BQU8sZUFBZTtJQUcxQjtRQUNFLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFTSxXQUFXLENBQUMsUUFBa0I7UUFDbkMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQyxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDOUI7YUFBTTtZQUNMLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsUUFBUSxDQUFDO1NBQ2pDO0lBQ0gsQ0FBQztJQUVNLFdBQVcsQ0FBQyxVQUE4QixFQUFFO1FBQ2pELE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxPQUFPLENBQUM7UUFDeEIsSUFBSSxRQUFRLEdBQWUsRUFBRSxDQUFDO1FBQzlCLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNwQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUNyQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3pCO1NBQ0Y7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRU0sVUFBVTtRQUNmLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNuQixLQUFLLE1BQU0sUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDcEMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNuQztRQUNELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFRDs7T0FFRztJQUNJLGlCQUFpQjtRQUN0QixJQUFJLE1BQU0sR0FBZ0MsRUFBRSxDQUFDO1FBQzdDLEtBQUssSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3RDLElBQUksUUFBUSxDQUFDLEtBQUssRUFBRTtnQkFDbEIsbUJBQW1CLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUM3QztTQUNGO1FBQ0QsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0JBQWdCOztRQUNyQixJQUFJLE1BQU0sR0FBZ0MsRUFBRSxDQUFDO1FBQzdDLEtBQUssSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3RDLElBQUksUUFBUSxDQUFDLFNBQVMsRUFBRTtnQkFDdEIsS0FBSyxJQUFJLENBQUMsRUFBRSxRQUFRLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDM0QsTUFBTSxLQUFLLEdBQUcsTUFBQSxRQUFRLENBQUMsS0FBSywwQ0FBRSxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUNyRCxJQUFJLEtBQUssRUFBRTt3QkFDVCxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7cUJBQ3BDO2lCQUNGO2FBQ0Y7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRDs7T0FFRztJQUNJLGlCQUFpQjtRQUN0QixJQUFJLE1BQU0sR0FBZ0MsRUFBRSxDQUFDO1FBQzdDLEtBQUssSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3RDLElBQUksUUFBUSxDQUFDLFNBQVMsRUFBRTtnQkFDdEIsS0FBSyxJQUFJLENBQUMsRUFBRSxRQUFRLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDM0QsbUJBQW1CLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUNwRTthQUNGO1NBQ0Y7UUFDRCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxvQkFBb0I7UUFDekIsSUFBSSxNQUFNLEdBQWdDLEVBQUUsQ0FBQztRQUM3QyxLQUFLLElBQUksUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUN0QyxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3JCLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDaEQ7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRDs7T0FFRztJQUNJLGVBQWU7UUFDcEIsSUFBSSxNQUFNLEdBQWtDLEVBQUUsQ0FBQztRQUMvQyxLQUFLLElBQUksUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUN0QyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLEtBQUssSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLElBQUksRUFBRTtvQkFDN0IsdUJBQXVCLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBQzFEO2FBQ0Y7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFTSxpQkFBaUI7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksY0FBYyxDQUFDLEVBQVU7UUFDOUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLElBQUksS0FBSyxLQUFLLFNBQVM7WUFBRSxPQUFPLFNBQVMsQ0FBQztRQUMxQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxnQkFBZ0IsQ0FBQyxFQUFVO1FBQ2hDLElBQUksQ0FBQyxFQUFFO1lBQUUsT0FBTyxTQUFTLENBQUM7UUFDMUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzdDLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsSUFBSSxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUU7Z0JBQUUsT0FBTyxDQUFDLENBQUM7U0FDbEM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7O09BRUc7SUFDSSxRQUFRLENBQUMsRUFBVTtRQUN4QixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEMsT0FBTyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JELENBQUM7Q0FDRiJ9","import { gsd } from 'ml-gsd';\r\nimport { xyMaxClosestYPoint, xyMinClosestYPoint } from 'ml-spectra-processing';\r\nimport { getNormalizedSpectrum } from './getNormalizedSpectrum';\r\n/** Based on a x value we will return a peak*/\r\nexport function autoPeakPicking(spectrum, options = {}) {\r\n    var _a, _b;\r\n    const { xVariable = 'x', yVariable = 'y', normalizationOptions, minPeakWidth, } = options;\r\n    let x = (_a = spectrum.variables[xVariable]) === null || _a === void 0 ? void 0 : _a.data;\r\n    let y = (_b = spectrum.variables[yVariable]) === null || _b === void 0 ? void 0 : _b.data;\r\n    if (!x || !y)\r\n        return [];\r\n    if (normalizationOptions) {\r\n        const tempSpectrum = {\r\n            variables: {\r\n                x: { data: x, label: '' },\r\n                y: { data: y, label: '' },\r\n            },\r\n        };\r\n        const normalizedSpectrum = getNormalizedSpectrum(tempSpectrum, normalizationOptions);\r\n        x = normalizedSpectrum.variables.x.data;\r\n        y = normalizedSpectrum.variables.y.data;\r\n    }\r\n    if (!x || !y)\r\n        return;\r\n    let { from, to } = options;\r\n    let peaks = gsd({ x, y }, options);\r\n    if (normalizationOptions) {\r\n        // we need to recalculate the real count\r\n        const xyClosestYPoint = options.maxCriteria === undefined || options.maxCriteria\r\n            ? xyMaxClosestYPoint\r\n            : xyMinClosestYPoint;\r\n        for (let peak of peaks) {\r\n            const closest = xyClosestYPoint({ x: spectrum.variables.x.data, y: spectrum.variables.y.data }, { target: peak.x });\r\n            peak.x = closest.x;\r\n            peak.y = closest.y;\r\n        }\r\n    }\r\n    if (from !== undefined) {\r\n        peaks = peaks.filter((peak) => peak.x >= from);\r\n    }\r\n    if (to !== undefined) {\r\n        peaks = peaks.filter((peak) => peak.x <= to);\r\n    }\r\n    if (minPeakWidth) {\r\n        peaks = peaks.filter((peak) => peak.width >= minPeakWidth);\r\n    }\r\n    return peaks.map((peak) => {\r\n        const result = {};\r\n        for (const [key, variable] of Object.entries(spectrum.variables)) {\r\n            result[key] = variable.data[peak.index];\r\n        }\r\n        result.width = peak.width;\r\n        return result;\r\n    });\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b1BlYWtQaWNraW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvYXV0b1BlYWtQaWNraW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDN0IsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFJL0UsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFaEUsOENBQThDO0FBQzlDLE1BQU0sVUFBVSxlQUFlLENBQzdCLFFBQWtCLEVBQ2xCLFVBQWtDLEVBQUU7O0lBRXBDLE1BQU0sRUFDSixTQUFTLEdBQUcsR0FBRyxFQUNmLFNBQVMsR0FBRyxHQUFHLEVBQ2Ysb0JBQW9CLEVBQ3BCLFlBQVksR0FDYixHQUFHLE9BQU8sQ0FBQztJQUVaLElBQUksQ0FBQyxHQUFHLE1BQUEsUUFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsMENBQUUsSUFBSSxDQUFDO0lBQzVDLElBQUksQ0FBQyxHQUFHLE1BQUEsUUFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsMENBQUUsSUFBSSxDQUFDO0lBRTVDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFFeEIsSUFBSSxvQkFBb0IsRUFBRTtRQUN4QixNQUFNLFlBQVksR0FBYTtZQUM3QixTQUFTLEVBQUU7Z0JBQ1QsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO2dCQUN6QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7YUFDMUI7U0FDRixDQUFDO1FBQ0YsTUFBTSxrQkFBa0IsR0FBRyxxQkFBcUIsQ0FDOUMsWUFBWSxFQUNaLG9CQUFvQixDQUNyQixDQUFDO1FBQ0YsQ0FBQyxH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","// @ts-nocheck\r\nimport { parseXY } from 'xy-parser';\r\nimport { Analysis } from '../Analysis';\r\n/**\r\n * Convert strings into JCAMP and add extra information\r\n * @param {string} data - values to add to the file, usually a csv or tsv values\r\n * @param {object} [options={}]\r\n * @param {string} [options.info={}] - metadata of the file\r\n * @param {string} [options.info.title = ''] - title of the file\r\n * @param {string} [options.info.dataType = ''] - type of data\r\n * @param {string} [options.info.xUnits = ''] - units for the x axis\r\n * @param {string} [options.info.yUnits = ''] - units for the y axis\r\n * @param {string} [options.info.xLabel = ''] - label for the x axis\r\n * @param {string} [options.info.yLabel = ''] - label for the y axis\r\n * @param {object} [options.meta = {}] - comments to add to the file\r\n * @param {object} [options.parser = {}] - 'xy-parser' options. arrayType = 'xyxy' is enforced\r\n * @return {string} JCAMP of the input\r\n */\r\nexport function fromText(data, options = {}) {\r\n    let analysis = new Analysis(options);\r\n    const { info = {}, parser = {} } = options;\r\n    parser.keepInfo = true;\r\n    let parsed = parseXY(data, parser);\r\n    const variables = {\r\n        x: {\r\n            data: parsed.data.x,\r\n            units: info.xUnits,\r\n            label: info.xLabel,\r\n        },\r\n        y: {\r\n            data: parsed.data.y,\r\n            units: info.yUnits,\r\n            label: info.yLabel,\r\n        },\r\n    };\r\n    analysis.pushSpectrum(variables, options);\r\n    return analysis;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbVRleHQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZnJvbS9mcm9tVGV4dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxjQUFjO0FBRWQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVwQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDOzs7Ozs7Ozs7Ozs7OztHQWNHO0FBRUgsTUFBTSxVQUFVLFFBQVEsQ0FBQyxJQUEwQixFQUFFLE9BQU8sR0FBRyxFQUFFO0lBQy9ELElBQUksUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXJDLE1BQU0sRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLE1BQU0sR0FBRyxFQUFFLEVBQUUsR0FBRyxPQUFPLENBQUM7SUFFM0MsTUFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDdkIsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuQyxNQUFNLFNBQVMsR0FBRztRQUNoQixDQUFDLEVBQUU7WUFDRCxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25CLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTTtZQUNsQixLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU07U0FDbkI7UUFDRCxDQUFDLEVBQUU7WUFDRCxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25CLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTTtZQUNsQixLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU07U0FDbkI7S0FDRixDQUFDO0lBRUYsUUFBUSxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFMUMsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyJ9","import max from 'ml-array-max';\r\nimport { optimize as optimizePeak } from 'ml-spectra-fitting';\r\nimport { xFindClosestIndex } from 'ml-spectra-processing';\r\n/** Based on a x value we will return a peak\r\n * if you set optimize=True the returned positions will be\r\n * the closest actual datapoints to the fitted peak location.\r\n * the x/y of the fitted peak will be in xOptimized and yOptimized\r\n */\r\nexport function peakPicking(spectrum, \r\n/** value to search (on x axis) */\r\ntarget, options = {}) {\r\n    var _a, _b, _c;\r\n    const { xVariable = 'x', yVariable = 'y', optimize = false, expectedWidth = 1, max: isMax = true, shapeOptions = {}, } = options;\r\n    const x = (_a = spectrum.variables[xVariable]) === null || _a === void 0 ? void 0 : _a.data;\r\n    let y;\r\n    if (!isMax) {\r\n        y = (_b = spectrum.variables[yVariable]) === null || _b === void 0 ? void 0 : _b.data.slice(); // do deep copy as we maybe need to flip sign\r\n    }\r\n    else {\r\n        y = (_c = spectrum.variables[yVariable]) === null || _c === void 0 ? void 0 : _c.data;\r\n    }\r\n    if (!x || !y)\r\n        return;\r\n    let targetIndex;\r\n    targetIndex = xFindClosestIndex(x, target);\r\n    let optimizedPeak;\r\n    let optimizedIndex;\r\n    const result = {};\r\n    if (optimize) {\r\n        if (isMax === false) {\r\n            let maximumY = max(y);\r\n            for (let i = 0; i < y.length; i++) {\r\n                y[i] *= -1;\r\n                y[i] += maximumY; // This makes it somewhat more robust\r\n            }\r\n        }\r\n        optimizedPeak = optimizePeak({ x, y }, [{ x: x[targetIndex], y: y[targetIndex], width: expectedWidth }], shapeOptions);\r\n        optimizedIndex = xFindClosestIndex(x, optimizedPeak.peaks[0].x);\r\n        for (let [key, variable] of Object.entries(spectrum.variables)) {\r\n            result[key] = variable.data[optimizedIndex];\r\n        }\r\n        result.optimized = optimizedPeak.peaks[0];\r\n    }\r\n    else {\r\n        for (let [key, variable] of Object.entries(spectrum.variables)) {\r\n            result[key] = variable.data[targetIndex];\r\n        }\r\n    }\r\n    return result;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVha1BpY2tpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC9wZWFrUGlja2luZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDL0IsT0FBTyxFQUFFLFFBQVEsSUFBSSxZQUFZLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUkxRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLFdBQVcsQ0FDekIsUUFBa0I7QUFDbEIsa0NBQWtDO0FBQ2xDLE1BQWMsRUFDZCxVQUE4QixFQUFFOztJQUVoQyxNQUFNLEVBQ0osU0FBUyxHQUFHLEdBQUcsRUFDZixTQUFTLEdBQUcsR0FBRyxFQUNmLFFBQVEsR0FBRyxLQUFLLEVBQ2hCLGFBQWEsR0FBRyxDQUFDLEVBQ2pCLEdBQUcsRUFBRSxLQUFLLEdBQUcsSUFBSSxFQUNqQixZQUFZLEdBQUcsRUFBRSxHQUNsQixHQUFHLE9BQU8sQ0FBQztJQUVaLE1BQU0sQ0FBQyxHQUFHLE1BQUEsUUFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsMENBQUUsSUFBSSxDQUFDO0lBQzlDLElBQUksQ0FBQyxDQUFDO0lBQ04sSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNWLENBQUMsR0FBRyxNQUFBLFFBQVEsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLDBDQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLDZDQUE2QztLQUMvRjtTQUFNO1FBQ0wsQ0FBQyxHQUFHLE1BQUEsUUFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsMENBQUUsSUFBSSxDQUFDO0tBQ3pDO0lBRUQsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFBRSxPQUFPO0lBQ3JCLElBQUksV0FBVyxDQUFDO0lBQ2hCLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDM0MsSUFBSSxhQUFhLENBQUM7SUFDbEIsSUFBSSxjQUFjLENBQUM7SUFDbkIsTUFBTSxNQUFNLEdBQTJCLEVBQUUsQ0FBQztJQUMxQyxJQUFJLFFBQVEsRUFBRTtRQUNaLElBQUksS0FBSyxLQUFLLEtBQUssRUFBRTtZQUNuQixJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2pDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUMscUNBQXFDO2FBQ3hEO1NBQ0Y7UUFFRCxhQUFhLEdBQUcsWUFBWSxDQUMxQixFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFDUixDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsQ0FBQyxFQUNoRSxZQUFZLENBQ2IsQ0FBQztRQUVGLGNBQWMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoRSxLQUFLLElBQUksQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDOUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDN0M7UUFDRCxNQUFNLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDM0M7U0FBTTtRQUNMLEtBQUssSUFBSSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUM5RCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUMxQztLQUNGO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyJ9","import { toJcamps } from './toJcamps';\r\nexport function toJcamp(analysis, options = {}) {\r\n    return toJcamps(analysis, options).join('\\n');\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9KY2FtcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90by90b0pjYW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFNdEMsTUFBTSxVQUFVLE9BQU8sQ0FBQyxRQUFrQixFQUFFLFVBQTJCLEVBQUU7SUFDdkUsT0FBTyxRQUFRLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRCxDQUFDIn0="],"names":["toString","Object","prototype","isAnyArray","object","call","endsWith","a","d","e","f","length","g","h","i","j","c","b","_ref","module","exports","window","median","input","isArray","TypeError","quickSelectMedian","slice","xAdd","array1","array2","constant","isConstant","Error","Number","array3","Array","xMultiply","Float64Array","xDivide","xFindClosestIndex","array","target","low","high","middle","Math","abs","_typeof","obj","Symbol","iterator","constructor","sequentialFill","arguments","undefined","options","_options","_options$from","from","_options$to","to","_options$size","size","step","floor","push","_i","xIsMonotone","sum","sumValue","mean","min","_options$fromIndex","fromIndex","_options$toIndex","toIndex","isInteger","minValue","max","maxValue","xSubtract","xyCheck","data","x","y","xyEnsureGrowingX","prevX","Infinity","ansX","ansY","index","xyFilterXPositive","newX","newY","xyMaxClosestYPoint","targetIndex","previousIndex","MIN_SAFE_INTEGER","currentIndex","xyMaxY","xyMinClosestYPoint","minY","GAUSSIAN_EXP_FACTOR","LN2","ROOT_PI_OVER_LN2","sqrt","PI","ROOT_THREE","ROOT_2LN2","ROOT_2LN2_MINUS_ONE","erfinv","ln1MinusXSqrd","log","lnEtcBy2Plus2","firstSqrt","Shape1D","Gaussian","fwhm","sd","height","widthToFWHM","this","fwhmToWidth","width","fct","getArea","getFactor","area","getData","factor","ceil","pow","center","exp","Lorentzian","tan","PseudoVoigt","mu","lorentzian","gaussian","getFactorLorentzian","getFactorGaussian","getShape1D","kind","shapeOptions","SavitzkyGolay","ys","xs","windowSize","derivative","polynomial","RangeError","console","warn","half","np","ans","weights","fullWeights","hs","constantH","wg1","wg2","d1","d2","l","getHs","wg","count","GramPoly","m","k","s","Grampoly","GenFact","gf","Weight","t","n","gsd","noiseLevel","sgOptions","shape","smoothY","heightFactor","broadRatio","maxCriteria","minMaxRatio","derivativeThreshold","realTopDetection","yIn","equalSpaced","isEqualSpaced","getNoiseLevel","dY","ddY","yData","SG","xData","dX","maxDdy","maxY","lastMax","lastMin","minddY","intervalL","intervalR","broadMask","possible","frequency","distanceJ","minDistance","gettingCloser","widthProcessor","signals","lastK","MAX_VALUE","soft","left","right","yLeft","yRight","determineRealTop","base","sort","tmp","maxDx","minDx","MAX_SAFE_INTEGER","stddev","averageDeviations","peakList","alpha","beta","gamma","p","currentPoint","log10","isEnumerable","propertyIsEnumerable","getSymbols","getOwnPropertySymbols","isObject","val","assignSymbols","args","arg","names","key","isValidKey","assign","assignDeepModule","isPrimitive","keys","setFWHM","setHeight","squareFWHM","setMu","sumOfGaussianLorentzians","nL","result","sumOfGaussians","sumOfLorentzians","checkInput","peaks","paramsFunc","defaultParameters","optimization","toLowerCase","replace","init","peak","gradientDifference","getMaxValue","parameters","assignDeep","par","value","checkOptions","parameterizedFunction","timeout","minValues","maxValues","initialValues","damping","dampingStepUp","dampingStepDown","maxIterations","errorTolerance","centralDifference","improvementThreshold","filler","checkTimeout","fill","nbPoints","parLen","endTime","Date","now","weightSquare","errorCalculation","error","func","rescale","output","currentMin","currentMax","_options$min","autoMinMax","_options$max","indent","repeat","indentData","inspectMatrixWithOptions","matrix","maxRows","maxColumns","maxNumSize","name","inspectData","rows","columns","maxI","maxJ","line","formatNumber","get","join","num","numStr","String","padEnd","precise","toPrecision","exponential","toExponential","eIndex","indexOf","checkRowIndex","outer","checkColumnIndex","checkRowVector","vector","to1DArray","checkColumnVector","checkRowIndices","rowIndices","some","r","checkColumnIndices","columnIndices","checkRange","startRow","endRow","startColumn","endColumn","checkNumber","newArray","checkNonEmpty","isEmpty","AbstractMatrix","newRows","newColumns","newData","newMatrix","Matrix","row","column","set","random","interval","round","zeros","matrix1","matrix2","checkMatrix","isMatrix","klass","apply","callback","to2DArray","copy","toJSON","isRowVector","isColumnVector","isVector","isSquare","isSymmetric","isEchelonForm","previousColumn","checked","isReducedEchelonForm","echelonForm","clone","iMax","swapRows","reducedEchelonForm","maxRow","pivot","setSubMatrix","neg","mulS","getRow","getRowVector","rowVector","setRow","row1","row2","temp","getColumn","getColumnVector","columnVector","setColumn","swapColumns","column1","column2","addRowVector","subRowVector","mulRowVector","divRowVector","addColumnVector","subColumnVector","mulColumnVector","divColumnVector","mulRow","mulColumn","NaN","v","maxIndex","idx","minIndex","maxRowIndex","minRow","minRowIndex","maxColumn","maxColumnIndex","minColumn","minColumnIndex","diag","norm","type","cumulativeSum","dot","vector2","vector1","mmul","other","Bcolj","strassen2x2","a11","b11","a12","b12","a21","b21","a22","b22","m1","m2","m3","m4","m5","c00","c01","c10","c11","strassen3x3","a00","a01","a02","a10","a20","b00","b01","b02","b10","b20","m6","m7","m8","m9","m12","m13","m14","m15","m16","m17","m18","c02","c12","c20","c21","c22","mmulStrassen","r1","c1","r2","c2","embed","mat","cols","resultat","blockMult","halfRows","parseInt","halfCols","subMatrix","add","sub","scaleRows","isFinite","scaleColumns","flipRows","first","last","flipColumns","kroneckerProduct","q","kroneckerSum","AxI","eye","IxB","transpose","sortRows","compareFunction","compareNumbers","sortColumns","subMatrixRow","indices","subMatrixColumn","selection","checkIndices","rowIndex","columnIndex","trace","by","sumByRow","sumByColumn","sumAll","product","productByRow","productByColumn","productAll","variance","unbiased","sum1","sum2","varianceByRow","varianceByColumn","varianceAll","standardDeviation","centerByRow","centerByColumn","centerAll","scale","getScaleByRow","scaleByRow","getScaleByColumn","scaleByColumn","divider","getScaleAll","scaleAll","for","rand","randomInt","randInt","diagonal","identity","negate","tensorProduct","nRows","nColumns","arrayData","removeRow","splice","addRow","removeColumn","newRow","addColumn","addS","addM","subS","subM","subtract","subtractS","subtractM","mul","mulM","multiply","multiplyS","multiplyM","div","divS","divM","divide","divideS","divideM","mod","modS","modM","modulus","modulusS","modulusM","and","andS","andM","or","orS","orM","xor","xorS","xorM","leftShift","leftShiftS","leftShiftM","signPropagatingRightShift","signPropagatingRightShiftS","signPropagatingRightShiftM","rightShift","rightShiftS","rightShiftM","zeroFillRightShift","zeroFillRightShiftS","zeroFillRightShiftM","not","acos","acosh","asin","asinh","atan","atanh","cbrt","clz32","cos","cosh","expm1","fround","log1p","log2","sign","sin","sinh","tanh","trunc","arg0","powS","powM","installMathOperations","BaseView","MatrixTransposeView","WrapperMatrix2D","LuDecomposition","LUcolj","kmax","lu","pivotVector","pivotSign","LU","isSingular","col","solve","X","determinant","lowerTriangularMatrix","upperTriangularMatrix","pivotPermutationVector","hypotenuse","QrDecomposition","qr","rdiag","nrm","QR","Rdiag","isFullRank","orthogonalMatrix","SingularValueDecomposition","computeLeftSingularVectors","computeRightSingularVectors","autoTranspose","wantu","Boolean","wantv","swapped","aux","nu","ni","U","V","work","si","nct","nrt","mrc","pp","eps","EPSILON","kase","MIN_VALUE","isNaN","ks","cs","sn","sp","spm1","epm1","sk","ek","shift","Y","threshold","scols","Ls","rightSingularVectors","VL","vrows","urows","VLU","solveForDiagonal","inverse","vcols","ucols","condition","norm2","rank","tol","ii","leftSingularVectors","diagonalMatrix","useSVD","leftHandSide","rightHandSide","params","evaluatedData","gradientFunc","paramFunction","nbParams","param","delta","auxParams","funcParam","funcParam2","point","gradientFunction","residualError","matrixFunction","inverseMatrix","jacobianWeigthResidualError","perturbations","levenbergMarquardt","converged","iteration","previousError","parameterValues","parameterError","iterations","selectMethod","optimizationOptions","getKind","algorithm","LM","lmOptions","optimize","nbShapes","parameterKey","pMin","pMax","pInit","gradientDifferenceValue","pFit","addStyle","serie","spectrum","color","opacity","lineWidth","match","toUpperCase","style","dash","label","id","COLORS","appendDistinctParameter","values","includes","appendDistinctValue","prepare","M","P","Pinv","Mt","ar","ac","Ap","Ai","Ax","LNZ","coloffset","adr","D","Lp","Parent","Lnz","Flag","Pattern","bp1","kk","p2","ldlSymbolic","Lx","Li","yi","lKi","len","top","ldlNumeric","B","ldlPerm","ldlLsolve","ldlDsolve","ldlLTsolve","ldlPermt","compareNum","list","adj","visited","toVisit","eol","ptr","nbhd","u","getClosestNumber","goal","closest","reduce","prev","curr","getCloseIndex","updateSystem","newVector","w","next","getDeltaMatrix","lambda","lowerTriangularNonZeros","permutationEncodedArray","cuthillMckee","airPLS","baseline","factorCriterion","controlPoints","baseLineZones","forEach","arr","range","indexFrom","indexTo","sumNegDifferences","stopCriterion","cho","Cholesky","difference","map","calculateError","maxNegativeDiff","diff","corrected","airPLSBaseline","numberPoints","regressionOptions","airpls","correctedSpectrum","maybeToPrecision","digits","BaseRegression","predict","_predict","train","toLaTeX","score","y2","xSum","ySum","chi2","rmsd","xSquared","ySquared","xY","PolynomialRegression","degree","powers","coefficients","checkArrayLength","pr","F","FT","A","regress","precision","_toFormula","isLaTeX","sup","closeSup","times","fn","str","charAt","json","baselineCorrectionRegression","Regression","tolerance","regression","fitting","oldFitting","iterativePolynomialBaseline","baselineCorrection","xCheck","xPadding","fromEnd","toEnd","xRolling","padding","subArray","buffer","xRollingAverage","xRollingMedian","rollingAverageBaseline","defaults","actualOptions","rollingBall","maxima","minima","windowM","windowS","windowLeft","windowRight","rollingBallBaseline","rollingMedianBaseline","_options$algorithm","_options$sumValue","_options$maxValue","absoluteSumValue","absoluteSum","currentMaxValue","sumFactor","_i2","concat","normalize","zones","NEGATIVE_INFINITY","POSITIVE_INFINITY","JSON","parse","stringify","zone","filter","currentZone","invert","exclusions","exclusion","nextExclusion","zonesWithPoints","numberOfPoints","totalSize","previous","current","unitsPerPoint","currentTotal","integral","x0","x1","slope","intercept","equallySpaced","arrayXY","xLength","reverse","variant","xResult","yResult","zoneResult","processZone","halfStep","lastStep","start","previousX","previousY","nextX","nextY","frontOutsideSpectra","backOutsideSpectra","currentValue","currentPoints","main","equallySpacedSlot","initialOriginalStep","lastOriginalStep","sumAtMin","sumAtMax","equallySpacedSmooth","getZones","currentFrom","filterX","points","currentZoneIndex","position","defaultOptions","matrixCase","cond","arrayCase","factorial","savitzkyGolay","pad","padValue","C","padArray","J","ones","inic","Jtranspose","det","arithmeticMean","lnsum","means","samples","percent","alreadySorted","theMean","theVariance","stdev","quart","q1","q2","q3","pooledVariance","vari","itemCount","itemArray","mean1","mean2","cov","s2","s3","dev","s4","weightedVariance","weightedMean","z","inPlace","standardDev","getNormalizedSpectrum","variables","newSpectrum","units","title","dataType","meta","filters","processing","keepYUnits","_a","filterOptions","Stat","normed","isMonotone","isString","isFiniteImpl","isNumber","uniq","strings","seen","item","hasOwnProperty","compareArray","properties","mulSafe","decimals","getFractional","divSafe","den","QtyError","err","create","message","stack","throwIncompatibleUnits","UNITS","BASE_UNITS","UNITY","UNITY_ARRAY","validateUnitDefinition","unitDef","definition","scalar","numerator","denominator","unit","PREFIX_VALUES","PREFIX_MAP","UNIT_VALUES","UNIT_MAP","OUTPUT_MAP","getUnits","unitKeys","substr","getKinds","getAliases","unitName","SIGNATURE_VECTOR","unitSignature","signature","unitSignatureVector","isBase","toBase","SIGN","INTEGER","FRACTION","QTY_STRING_REGEX","RegExp","POWER_OP","SAFE_POWER","TOP_REGEX","BOTTOM_REGEX","trim","exec","scalarMatch","parseFloat","nx","bottom","UNIT_TEST_REGEX","test","parseUnits","PREFIX_REGEX","UNIT_REGEX","UNIT_MATCH","UNIT_MATCH_REGEX","parsedUnitsCache","cached","unitMatch","normalizedUnits","globalParse","isQty","Qty","initValue","initUnits","assertValidConstructorArgs","baseScalar","_conversionCache","isDefinitionObject","updateBaseScalar","isTemperature","KINDS","knownSignature","subtractTemperatures","lhs","rhs","lhsUnits","rhsConverted","dstDegrees","getDegreeUnits","subtractTempDegrees","deg","tempDegrees","addTempDegrees","toDegrees","src","dst","dstScalar","srcDegK","toDegK","dstUnits","qty","toTemp","toTempK","swiftConverter","srcUnits","convert","srcQty","dstQty","eq","isDegrees","isCompatible","isInverse","baseUnitCache","toBaseUnits","toFloat","isUnitless","toPrec","precQuantity","cleanTerms","num1","den1","num2","den2","notUnity","combined","combineTerms","terms","direction","prefix","prefixValue","combinedPrefixValue","prop","NestedMap","defaultFormatter","op1","op2","numdenscale","compareTo","lt","lte","gt","gte","same","every","_isBase","childMap","formatter","_units","numIsUnity","denIsUnity","numUnits","stringifyUnits","denUnits","targetUnitsOrMaxDecimalsOrPrec","maxDecimals","targetUnits","out","format","targetQty","stringifiedUnitsCache","stringified","simplify","getOutputNames","token","tokenNext","unitNames","acc","unitCounter","unitCount","version","factory","convertUnit","fromUnit","toUnit","testRegExp","ensureRegexp","string","parts","stringToRegexp","flags","getConvertedVariable","variable","newUnits","getPossibleVariable","selector","variableName","regexpLabel","_b","upper","lower","possibleFiltered","Analysis","substring","spectrumCallback","spectra","cache","pushSpectrum","analysisOptions","xVariable","yVariable","entries","standardizeData","getXYSpectrum","xUnits","yUnits","labels","xLabel","yLabel","split","getXY","normalization","getSpectrum","getXLabel","getYLabel","ensureString","blob","ArrayBuffer","isView","encoding","guessEncoding","TextDecoder","decode","uint8","Uint8Array","byteOffset","byteLength","parseString","lowercase","number","GC_MS_FIELDS","complexChromatogram","chromatogram","series","ms","dimension","existingGCMSFields","convertMSFieldToLabel","pageValue","isMSField","canonicDataLabel","convertToFloatArray","stringArray","floatArray","fastParseXYData","yFactor","deltaX","isXYdata","currentData","ascii","currentX","firstX","currentY","firstY","endLine","charCodeAt","newLine","isDifference","isLastDifference","lastDifference","isDuplicate","inComment","lastValue","isNegative","inValue","skipFirstValue","decimalPosition","duplicate","ascii2","removeCommentRegExp","peakTableSplitRegExp","parsePeakTable","isPeaktable","numberOfVariables","lines","logs","parseXYZ","xFactor","parseXY","parseXYA","removeSymbolRegExp","isXYAdata","add2D","zData","minZ","maxZ","ySize","xSize","lastX","lastY","medians","getMedian","minX","maxX","noise","convertTo3DZ","noContour","contourLines","povarHeight0","povarHeight1","povarHeight2","povarHeight3","isOver0","isOver1","isOver2","isOver3","pAx","pAy","pBx","pBy","lineZValue","nbSubSpectra","nbPovars","dx","y0","dy","iter","nbContourLevels","contourLevels","level","contourLevel","side","noiseMultiplier","zValue","iSubSpectra","subSpectra","subSpectraAfter","povar","segments","generateContourLines","minMax","gyromagneticRatio","profiling","action","time","simpleChromatogram","intensity","postProcessing","entriesFlat","entry","observeFrequency","shiftOffsetVal","ntuples","symbol","nucleus","startsWith","$NUC2","f2index","$NUC1","yType","pageSymbolIndex","pageSymbol","ratio0","ratio1","ratio","postProcessingNMR","newNtuples","twoD","wantXY","keepSpectra","prepareNtuplesDatatable","currentEntry","xIndex","yIndex","firstVariable","secondVariable","lowerCaseSymbol","vardim","varname","prepareSpectrum","ntuplesSeparatorRegExp","Spectrum","keepRecordsRegExp","canonicDataLabels","canonicMetadataLabels","dynamicTyping","withoutXY","addJcamp","analysis","jcamp","converted","tmpResult","children","parentsStack","ldrs","ldr","dataLabel","dataValue","infos","datatable","parentEntry","info","dataClass","xType","shiftOffsetNum","vartype","varform","page","sampleDescription","pop","flatten","currentSpectrum","uniqueX","counter","text","xColumn","yColumn","keepInfo","bestGuess","numberColumns","maxNumberColumns","minNumberColumns","fields","skipFirstColumn","uniqueXFunction","mlArrayMax","creatorNtuples","owner","origin","varName","varType","varDim","isDependent","minFct","maxFct","header","getNumber","rounded","peakTableCreator","xyDataCreator","fromJSON","xydata","toJcamps","jcamps","getJcamp","jcampOptions","forceNtuples","fromVariables","exportText","spectrums","endOfLine","fieldSeparator","maxNumberData","lineIndex","JSGraph","getJSGraph","analyses","colors","opacities","linesWidth","xAxis","yAxis","logScale","axes","unitWrapperBefore","unitWrapperAfter","flipped","display","getNormalizationAnnotations","boundary","annotations","ignore","strokeWidth","fillColor","addAnalysis","getAnalysisIndex","getAnalyses","ids","getSpectra","getDistinctTitles","getDistinctUnits","getDistinctLabels","getDistinctDataTypes","getDistinctMeta","removeAllAnalyses","removeAnalysis","normalizationOptions","minPeakWidth","normalizedSpectrum","xyClosestYPoint","parser","parsed","query","enforceGrowing","xAxisOptions","yAxisOptions","labelSpace","content","seriesOptions","displayMarker","dimensions","otherOptions","expectedWidth","isMax","optimizedPeak","optimizedIndex","_c","maximumY","optimizePeak","optimized"],"mappings":"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"}