!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CommonSpectrum={})}(this,(function(t){"use strict";const e=Object.prototype.toString;function r(t){return e.call(t).endsWith("Array]")}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n={exports:{}};!function(t){!function(){function e(t){for(var e=0,o=t.length-1,i=void 0,s=void 0,a=void 0,l=n(e,o);;){if(o<=e)return t[l];if(o==e+1)return t[e]>t[o]&&r(t,e,o),t[l];for(t[i=n(e,o)]>t[o]&&r(t,i,o),t[e]>t[o]&&r(t,e,o),t[i]>t[e]&&r(t,i,e),r(t,i,e+1),s=e+1,a=o;;){do{s++}while(t[e]>t[s]);do{a--}while(t[a]>t[e]);if(a<s)break;r(t,s,a)}r(t,e,a),a<=l&&(e=s),a>=l&&(o=a-1)}}var r=function(t,e,r){var n;return n=[t[r],t[e]],t[e]=n[0],t[r]=n[1],n},n=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}(n);var o=n.exports;function i(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");return o(t.slice())}function s(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]+n;else for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function a(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Float64Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]*n;else for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function l(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]/n;else for(let r=0;r<t.length;r++)i[r]=t[r]/e[r];return i}function h(t,e){let r=0,n=t.length-1,o=0;for(;n-r>1;)if(o=r+(n-r>>1),t[o]<e)r=o;else{if(!(t[o]>e))return o;n=o}return r<t.length-1?Math.abs(e-t[r])<Math.abs(t[r+1]-e)?r:r+1:r}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==u(t)||r(t)||(e=t,t=[]),!r(t))throw new TypeError("input must be an array");var n=e,o=n.from,i=void 0===o?0:o,s=n.to,a=void 0===s?10:s,l=n.size,h=void 0===l?t.length:l,c=n.step;if(0!==h&&c)throw new Error("step is defined by the array size");if(h||(h=c?Math.floor((a-i)/c)+1:a-i+1),!c&&h&&(c=(a-i)/(h-1)),Array.isArray(t)){t.length=0;for(var f=0;f<h;f++)t.push(i),i+=c}else{if(t.length!==h)throw new Error("sequentialFill typed array must have the correct length");for(var m=0;m<h;m++)t[m]=i,i+=c}return t}function f(t){if(t.length<=2)return!0;if(t[0]===t[1]){for(let e=1;e<t.length-1;e++)if(t[e]!==t[e+1])return!1;return!0}if(t[0]<t[t.length-1]){for(let e=0;e<t.length-1;e++)if(t[e]>=t[e+1])return!1}else for(let e=0;e<t.length-1;e++)if(t[e]<=t[e+1])return!1;return!0}function m(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function g(t){return m(t)/t.length}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,o=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=o||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[o],l=o+1;l<s;l++)t[l]<a&&(a=t[l]);return a}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,o=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=o||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[o],l=o+1;l<s;l++)t[l]>a&&(a=t[l]);return a}function w(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]-n;else for(let r=0;r<t.length;r++)i[r]=t[r]-e[r];return i}function y(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r(t.x)||!r(t.y))throw new Error("Data must be an object of x and y arrays");if(t.x.length!==t.y.length)throw new Error("The x and y arrays mush have the same length")}function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(t);const e=Array.from(t.x),r=Array.from(t.y);let n=-1/0,o=[],i=[];for(let t=0;t<e.length;t++)n<e[t]&&(o.push(e[t]),i.push(r[t]),n=e[t]);return{x:o,y:i}}function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(t);const{x:e,y:r}=t,n=[],o=[];for(let t=0;t<e.length;t++)e[t]>0&&(n.push(e[t]),o.push(r[t]));return{x:n,y:o}}function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(t);const{x:r,y:n}=t;let{target:o,targetIndex:i}=e;void 0===i&&(i=void 0!==o?h(r,o):0);let s=Number.MIN_SAFE_INTEGER,a=i,l=n[i];for(;a!==s;)s=a,a>0&&n[a-1]>l?a--:a<r.length-1&&n[a+1]>l&&a++,l=n[a];return{x:r[a],y:n[a],index:a}}function M(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(t);const{x:r,y:n}=t;let{target:o,targetIndex:i}=e;void 0===i&&(i=void 0!==o?h(r,o):0);let s=Number.MIN_SAFE_INTEGER,a=i,l=n[i];for(;a!==s;)s=a,a>0&&n[a-1]<l?a--:a<r.length-1&&n[a+1]<l&&a++,l=n[a];return{x:r[a],y:n[a],index:a}}const E=-4*Math.LN2,A=Math.sqrt(Math.PI/Math.LN2),S=Math.sqrt(3),T=Math.sqrt(2*Math.LN2),k=Math.sqrt(2*Math.LN2)-1;function N(t){if(0===t)return 0;let e=Math.log(1-t*t),r=e/2+2/(.147*Math.PI),n=Math.sqrt(r**2-e/.147);return Math.sqrt(n-r)*(t>0?1:-1)}class F{}class R extends F{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const{fwhm:e=500,sd:r,height:n}=t;this.fwhm=r?z(2*r):e,this.height=void 0===n?Math.sqrt(-E/Math.PI)/this.fwhm:n}fwhmToWidth(){return function(t){return t/T}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm)}widthToFWHM(t){return z(t)}fct(t){return I(t,this.fwhm)}getArea(){return function(t){let{fwhm:e,sd:r,height:n=1}=t;r&&(e=z(2*r));if(void 0===e)throw new Error("should pass fwhm or sd parameters");return n*A*e/2}({fwhm:this.fwhm,height:this.height})}getFactor(t){return C(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{length:e,factor:r}=t;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=C(),fwhm:n=500,sd:o,height:i}=t;o&&(n=z(2*o));i||(i=Math.sqrt(-E/Math.PI)/n);e||(e=Math.min(Math.ceil(n*r),Math.pow(2,25)-1),e%2==0&&e++);const s=(e-1)/2,a=new Float64Array(e);for(let t=0;t<=s;t++)a[t]=I(t-s,n)*i,a[e-1-t]=a[t];return a}({fwhm:this.fwhm,height:this.height,factor:r,length:e})}}function I(t,e){return Math.exp(E*Math.pow(t/e,2))}function z(t){return t*T}function C(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return Math.sqrt(2)*N(t)}class O extends F{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const{fwhm:e=500,height:r}=t;this.fwhm=e,this.height=void 0===r?2/Math.PI/e:r}fwhmToWidth(){return function(t){return t/S}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm)}widthToFWHM(t){return function(t){return t*S}(t)}fct(t){return $(t,this.fwhm)}getArea(){return function(t){const{fwhm:e,height:r=1}=t;if(void 0===e)throw new Error("should pass fwhm or sd parameters");return r*Math.PI*e/2}({fwhm:this.fwhm,height:this.height})}getFactor(t){return D(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{length:e,factor:r}=t;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=D(),fwhm:n=500,height:o}=t;o||(o=2/Math.PI/n);e||(e=Math.min(Math.ceil(n*r),Math.pow(2,25)-1),e%2==0&&e++);const i=(e-1)/2,s=new Float64Array(e);for(let t=0;t<=i;t++)s[t]=$(t-i,n)*o,s[e-1-t]=s[t];return s}({fwhm:this.fwhm,height:this.height,factor:r,length:e})}}function $(t,e){return Math.pow(e,2)/(4*Math.pow(t,2)+Math.pow(e,2))}function D(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return 2*Math.tan(Math.PI*(t-.5))}class P extends F{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const{fwhm:e=500,height:r,mu:n=.5}=t;this.mu=n,this.fwhm=e,this.height=void 0===r?1/(n/Math.sqrt(-E/Math.PI)*e+(1-n)*e*Math.PI/2):r}fwhmToWidth(){return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t/(e*k+1)}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mu)}widthToFWHM(t){return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t*(e*k+1)}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mu)}fct(t){return V(t,this.fwhm,this.mu)}getArea(){return function(t){const{fwhm:e,height:r=1,mu:n=.5}=t;if(void 0===e)throw new Error("should pass fwhm or sd parameters");return e*r*(n*A+(1-n)*Math.PI)/2}({fwhm:this.fwhm,height:this.height,mu:this.mu})}getFactor(t){return U(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{length:e,factor:r}=t;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=U(),fwhm:n=500,height:o,mu:i=.5}=t;o||(o=1/(i/Math.sqrt(-E/Math.PI)*n+(1-i)*n*Math.PI/2));e||(e=Math.min(Math.ceil(n*r),Math.pow(2,25)-1),e%2==0&&e++);const s=(e-1)/2,a=new Float64Array(e);for(let t=0;t<=s;t++)a[t]=V(t-s,n,i)*o,a[e-1-t]=a[t];return a}({fwhm:this.fwhm,height:this.height,mu:this.mu,factor:r,length:e})}}function V(t,e,r){return(1-r)*$(t,e)+r*I(t,e)}function U(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e<1?D(t):C(t)}function j(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case"gaussian":return new R(e);case"lorentzian":return new O(e);case"pseudoVoigt":return new P(e);default:throw Error(`Unknown distribution ${t}`)}}function X(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{windowSize:n=9,derivative:o=0,polynomial:i=3}=r;if(n%2==0||n<5||!Number.isInteger(n))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(n>t.length)throw new RangeError(`Window size is higher than the data length ${n}>${t.length}`);if(o<0||!Number.isInteger(o))throw new RangeError("Derivative should be a positive integer");if(i<1||!Number.isInteger(i))throw new RangeError("Polynomial should be a positive integer");i>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");let s=Math.floor(n/2),a=t.length,l=new Array(a),h=W(n,i,o),u=0,c=!0;Array.isArray(e)?c=!1:u=Math.pow(e,o);for(let r=0;r<s;r++){let i=h[s-r-1],f=h[s+r+1],m=0,g=0;for(let e=0;e<n;e++)m+=i[e]*t[e],g+=f[e]*t[a-n+e];c?(l[s-r-1]=m/u,l[a-s+r]=g/u):(u=q(e,s-r-1,s,o),l[s-r-1]=m/u,u=q(e,a-s+r,s,o),l[a-s+r]=g/u)}let f=h[s];for(let r=n;r<=a;r++){let i=0;for(let e=0;e<n;e++)i+=f[e]*t[e+r-n];c||(u=q(e,r-s-1,s,o)),l[r-s-1]=i/u}return l}function q(t,e,r,n){let o=0,i=0;for(let n=e-r;n<e+r;n++)n>=0&&n<t.length-1&&(o+=t[n+1]-t[n],i++);return Math.pow(o/i,n)}function _(t,e,r,n){let o=0;return o=r>0?(4*r-2)/(r*(2*e-r+1))*(t*_(t,e,r-1,n)+n*_(t,e,r-1,n-1))-(r-1)*(2*e+r)/(r*(2*e-r+1))*_(t,e,r-2,n):0===r&&0===n?1:0,o}function L(t,e){let r=1;if(t>=e)for(let n=t-e+1;n<=t;n++)r*=n;return r}function Y(t,e,r,n,o){let i=0;for(let s=0;s<=n;s++)i+=(2*s+1)*(L(2*r,s)/L(2*r+s+1,s+1))*_(t,r,s,0)*_(e,r,s,o);return i}function W(t,e,r){let n=new Array(t),o=Math.floor(t/2);for(let i=-o;i<=o;i++){n[i+o]=new Array(t);for(let t=-o;t<=o;t++)n[i+o][t+o]=Y(t,i,o,e,r)}return n}function B(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{noiseLevel:r,sgOptions:n={windowSize:9,polynomial:3},shape:o={},smoothY:i=!0,heightFactor:s=0,broadRatio:a=0,maxCriteria:l=!0,minMaxRatio:h=25e-5,derivativeThreshold:u=-1,realTopDetection:c=!1}=e,{y:f,x:m}=t;const g=f.slice();let p=H(m);if(!1===l)for(let t=0;t<g.length;t++)g[t]*=-1;void 0===r&&(r=p?K(g):0);for(let t=0;t<g.length;t++)g[t]-=r;for(let t=0;t<g.length;t++)g[t]<0&&(g[t]=0);let d,w,y=g;const{windowSize:b,polynomial:v}=n;p?(i&&(y=X(g,m[1]-m[0],{windowSize:b,polynomial:v,derivative:0})),d=X(g,m[1]-m[0],{windowSize:b,polynomial:v,derivative:1}),w=X(g,m[1]-m[0],{windowSize:b,polynomial:v,derivative:2})):(i&&(y=X(g,m,{windowSize:b,polynomial:v,derivative:0})),d=X(g,m,{windowSize:b,polynomial:v,derivative:1}),w=X(g,m,{windowSize:b,polynomial:v,derivative:2}));const x=m,M=m[1]-m[0];let E=0,A=0;for(let t=0;t<y.length;t++)Math.abs(w[t])>E&&(E=Math.abs(w[t])),Math.abs(y[t])>A&&(A=Math.abs(y[t]));let S=null,T=null,k=[],N=[],F=[],R=[];for(let t=1;t<y.length-1;++t)Math.abs(d[t])>u&&((d[t]<d[t-1]&&d[t]<=d[t+1]||d[t]<=d[t-1]&&d[t]<d[t+1])&&(T={x:x[t],index:t},M>0&&null!==S&&(N.push(S),F.push(T))),(d[t]>=d[t-1]&&d[t]>d[t+1]||d[t]>d[t-1]&&d[t]>=d[t+1])&&(S={x:x[t],index:t},M<0&&null!==T&&(N.push(S),F.push(T)))),w[t]<w[t-1]&&w[t]<w[t+1]&&(k.push(t),R.push(Math.abs(w[t])<=a*E));let I,z,C,O,$,D=o.kind?j(o.kind,o.options).widthToFWHM:t=>t,P=[],V=-1;for(let t=0;t<k.length;++t){z=x[k[t]],I=-1;let e=V+1;for(O=Number.MAX_VALUE,C=0,$=!0;-1===I&&e<N.length&&$;)C=Math.abs(z-(N[e].x+F[e].x)/2),C<O?O=C:$=!1,C<Math.abs(N[e].x-F[e].x)/2&&(I=e,V=e),++e;if(-1!==I&&Math.abs(y[k[t]])>h*A){let e=Math.abs(F[I].x-N[I].x);if(P.push({index:k[t],x:z,y:l?y[k[t]]+r:-y[k[t]]-r,width:D(e),soft:R[t]}),P[P.length-1].left=N[I],P[P.length-1].right=F[I],s){let t=y[N[I].index],e=y[F[I].index];P[P.length-1].height=s*(P[P.length-1].y-(t+e)/2)}}}c&&G(P,x,y);for(let t=0;t<P.length;t++)P[t].base=r;return P.sort(((t,e)=>t.x-e.x)),P}const H=t=>{let e,r=0,n=Number.MAX_SAFE_INTEGER;for(let o=0;o<t.length-1;++o)e=Math.abs(t[o+1]-t[o]),e<n&&(n=e),e>r&&(r=e);return(r-n)/r<.05},K=t=>{let e=0,r=0,n=t.length;for(let r=0;r<n;++r)e+=t[r];e/=n;let o=new Array(n);for(let r=0;r<n;++r)o[r]=Math.abs(t[r]-e);return o.sort(((t,e)=>t-e)),r=n%2==1?o[(n-1)/2]/.6745:.5*(o[n/2]+o[n/2-1])/.6745,r},G=(t,e,r)=>{let n,o,i,s,a;for(let l=0;l<t.length;l++)a=t[l].index,r[a-1]>=r[a-2]&&r[a-1]>=r[a]?a--:r[a+1]>=r[a]&&r[a+1]>=r[a+2]?a++:r[a-2]>=r[a-3]&&r[a-2]>=r[a-1]?a-=2:r[a+2]>=r[a+1]&&r[a+2]>=r[a+3]&&(a+=2),r[a-1]>0&&r[a+1]>0&&r[a]>=r[a-1]&&r[a]>=r[a+1]&&(r[a]!==r[a-1]||r[a]!==r[a+1])&&(n=20*Math.log10(r[a-1]),o=20*Math.log10(r[a]),i=20*Math.log10(r[a+1]),s=.5*(n-i)/(n-2*o+i),t[l].x=e[a]+(e[a]-e[a-1])*s,t[l].y=r[a]-.25*(r[a-1]-r[a+1])*s)};var J={exports:{}};
/*!
   * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
   *
   * Copyright (c) 2015-present, Jon Schlinkert.
   * Licensed under the MIT License.
   */const Z=Object.prototype.toString,Q=Object.prototype.propertyIsEnumerable,tt=Object.getOwnPropertySymbols;function et(t){return"function"==typeof t||"[object Object]"===Z.call(t)||Array.isArray(t)}
/*!
   * assign-deep <https://github.com/jonschlinkert/assign-deep>
   *
   * Copyright (c) 2017-present, Jon Schlinkert.
   * Released under the MIT License.
   */const rt=Object.prototype.toString,nt=function(t){if(!et(t))throw new TypeError("expected the first argument to be an object");for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if(0===r.length||"function"!=typeof Symbol||"function"!=typeof tt)return t;for(let e of r){let r=tt(e);for(let n of r)Q.call(e,n)&&(t[n]=e[n])}return t},ot=t=>"__proto__"!==t&&"constructor"!==t&&"prototype"!==t,it=J.exports=function(t){let e=0;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(at(t)&&(t=n[e++]),t||(t={});e<n.length;e++)if(st(n[e])){for(const r of Object.keys(n[e]))ot(r)&&(st(t[r])&&st(n[e][r])?it(t[r],n[e][r]):t[r]=n[e][r]);nt(t,n[e])}return t};function st(t){return"function"==typeof t||"[object Object]"===rt.call(t)}function at(t){return"object"==typeof t?null===t:"function"!=typeof t}var lt=J.exports;const ht=-4*Math.LN2,ut=Math.sqrt(Math.PI/Math.LN2),ct=Math.sqrt(3),ft=Math.sqrt(2*Math.LN2),mt=Math.sqrt(2*Math.LN2)-1;function gt(t){if(0===t)return 0;let e=Math.log(1-t*t),r=e/2+2/(.147*Math.PI),n=Math.sqrt(r**2-e/.147);return Math.sqrt(n-r)*(t>0?1:-1)}class pt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fwhm=t.sd?pt.widthToFWHM(2*t.sd):t.fwhm?t.fwhm:500,this.height=void 0===t.height?Math.sqrt(-ht/Math.PI)/this.fwhm:t.height}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=this.getFactor()}=t;e||(e=Math.min(Math.ceil(this.fwhm*r),Math.pow(2,25)-1),e%2==0&&e++);const n=(e-1)/2,o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return pt.fct(t,this.fwhm)}getFactor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return pt.getFactor(t)}getArea(){return pt.getArea(this.fwhm,{height:this.height})}widthToFWHM(t){return pt.widthToFWHM(t)}fwhmToWidth(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm;return pt.fwhmToWidth(t)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}}pt.fct=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return Math.exp(ht*Math.pow(t/e,2))},pt.widthToFWHM=function(t){return t*ft},pt.fwhmToWidth=function(t){return t/ft},pt.getArea=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{height:r=1}=e;return r*ut*t/2},pt.getFactor=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return Math.sqrt(2)*gt(t)};class dt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fwhm=void 0===t.fwhm?500:t.fwhm,this.height=void 0===t.height?2/Math.PI/this.fwhm:t.height}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=this.getFactor()}=t;e||(e=Math.min(Math.ceil(this.fwhm*r),Math.pow(2,25)-1),e%2==0&&e++);const n=(e-1)/2,o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return dt.fct(t,this.fwhm)}getFactor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return dt.getFactor(t)}getArea(){return dt.getArea(this.fwhm,{height:this.height})}fwhmToWidth(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm;return dt.fwhmToWidth(t)}widthToFWHM(t){return dt.widthToFWHM(t)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}}dt.fct=function(t,e){const r=e*e;return r/(4*Math.pow(t,2)+r)},dt.fwhmToWidth=function(t){return t/ct},dt.widthToFWHM=function(t){return t*ct},dt.getArea=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{height:r=1}=e;return r*Math.PI*t/2},dt.getFactor=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999;return 2*Math.tan(Math.PI*(t-.5))};class wt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mu=void 0===t.mu?.5:t.mu,this.fwhm=void 0===t.fwhm?500:t.fwhm,this.height=void 0===t.height?1/(this.mu/Math.sqrt(-ht/Math.PI)*this.fwhm+(1-this.mu)*this.fwhm*Math.PI/2):t.height}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{length:e,factor:r=this.getFactor()}=t;e||(e=Math.ceil(this.fwhm*r),e%2==0&&e++);const n=(e-1)/2;let o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return wt.fct(t,this.fwhm,this.mu)}getFactor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mu;return wt.getFactor(t,e)}getArea(){return wt.getArea(this.fwhm,{height:this.height,mu:this.mu})}widthToFWHM(t,e){return wt.widthToFWHM(t,e)}fwhmToWidth(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fwhm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mu;return wt.fwhmToWidth(t,e)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}setMu(t){this.mu=t}}function yt(t){return function(e){let r=t.length/4,n=0;for(let o=0;o<r;o++)n+=t[o+r]*wt.fct(e-t[o],t[o+2*r],t[o+3*r]);return n}}function bt(t){return function(e){let r=t.length/3,n=0;for(let o=0;o<r;o++)n+=t[o+r]*pt.fct(e-t[o],t[o+2*r]);return n}}function vt(t){return function(e){let r=t.length/3,n=0;for(let o=0;o<r;o++)n+=t[o+r]*dt.fct(e-t[o],t[o+2*r]);return n}}function xt(t,e,r){let n,o,{shape:i={kind:"gaussian"},optimization:s={kind:"lm"}}=r;if("string"!=typeof i.kind)throw new Error("kind should be a string");switch(i.kind.toLowerCase().replace(/[^a-z]/g,"")){case"gaussian":n=bt,o={x:{init:t=>t.x,max:t=>t.x+2*t.width,min:t=>t.x-2*t.width,gradientDifference:t=>.002*t.width},y:{init:t=>t.y,max:()=>1.5,min:()=>0,gradientDifference:()=>.001},width:{init:t=>t.width,max:t=>4*t.width,min:t=>.25*t.width,gradientDifference:t=>.002*t.width}};break;case"lorentzian":n=vt,o={x:{init:t=>t.x,max:t=>t.x+2*t.width,min:t=>t.x-2*t.width,gradientDifference:t=>.002*t.width},y:{init:t=>t.y,max:()=>1.5,min:()=>0,gradientDifference:()=>.001},width:{init:t=>t.width,max:t=>4*t.width,min:t=>.25*t.width,gradientDifference:t=>.002*t.width}};break;case"pseudovoigt":n=yt,o={x:{init:t=>t.x,max:t=>t.x+2*t.width,min:t=>t.x-2*t.width,gradientDifference:t=>.002*t.width},y:{init:t=>t.y,max:()=>1.5,min:()=>0,gradientDifference:()=>.001},width:{init:t=>t.width,max:t=>4*t.width,min:t=>.25*t.width,gradientDifference:t=>.002*t.width},mu:{init:t=>void 0!==t.mu?t.mu:.5,min:()=>0,max:()=>1,gradientDifference:()=>.01}};break;default:throw new Error("kind of shape is not supported")}let a=t.x,l=d(t.y),h=new Array(a.length);for(let e=0;e<a.length;e++)h[e]=t.y[e]/l;for(let t=0;t<e.length;t++)e[t].y/=l;let u=lt({},s.parameters,o);for(let t in u)for(let r in u[t]){if(Array.isArray(u[t][r])||(u[t][r]=[u[t][r]]),1!==u[t][r].length&&u[t][r].length!==e.length)throw new Error(`The length of ${t}-${r} is not correct`);for(let e=0;e<u[t][r].length;e++)if("number"==typeof u[t][r][e]){let n=u[t][r][e];u[t][r][e]=()=>n}}return s.parameters=u,{y:h,x:a,maxY:l,peaks:e,paramsFunc:n,optimization:s}}function Mt(t,e,n){let{timeout:o,minValues:i,maxValues:s,initialValues:a,weights:l=1,damping:h=.01,dampingStepUp:u=11,dampingStepDown:c=9,maxIterations:f=100,errorTolerance:m=1e-7,centralDifference:g=!1,gradientDifference:p=.1,improvementThreshold:d=.001}=n;if(h<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!r(t.x)||t.x.length<2||!r(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");let w,y,b=a||new Array(e.length).fill(1),v=t.y.length,x=b.length;if(s=s||new Array(x).fill(Number.MAX_SAFE_INTEGER),i=i||new Array(x).fill(Number.MIN_SAFE_INTEGER),s.length!==i.length)throw new Error("minValues and maxValues must be the same size");if(!r(b))throw new Error("initialValues must be an array");if("number"==typeof p)p=new Array(b.length).fill(p);else{if(!r(p))throw new Error("gradientDifference should be a number or array with length equal to the number of parameters");p.length!==x&&(p=new Array(x).fill(p[0]))}if("number"==typeof l){let t=1/l**2;w=()=>t}else{if(!r(l))throw new Error("weights should be a number or array with length equal to the number of data points");if(l.length<t.x.length){let t=1/l[0]**2;w=()=>t}else w=t=>1/l[t]**2}if(void 0!==o){if("number"!=typeof o)throw new Error("timeout should be a number");let t=Date.now()+1e3*o;y=()=>Date.now()>t}else y=()=>!1;let M=new Array(t.x.length);for(let t=0;t<v;t++)M[t]=w(t);return{checkTimeout:y,minValues:i,maxValues:s,parameters:b,weightSquare:M,damping:h,dampingStepUp:u,dampingStepDown:c,maxIterations:f,errorTolerance:m,centralDifference:g,gradientDifference:p,improvementThreshold:d}}function Et(t,e,r,n){let o=0;const i=r(e);for(let e=0;e<t.x.length;e++)o+=Math.pow(t.y[e]-i(t.x[e]),2)/n[e];return o}function At(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!r(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var o=p(t),i=d(t);if(o===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=n.min,a=void 0===s?n.autoMinMax?o:0:s,l=n.max,h=void 0===l?n.autoMinMax?i:1:l;if(a>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-a)/(i-o),c=0;c<t.length;c++)e[c]=(t[c]-o)*u+a;return e}wt.fct=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return(1-r)*dt.fct(t,e)+r*pt.fct(t,e)},wt.widthToFWHM=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t*(e*mt+1)},wt.fwhmToWidth=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t/(e*mt+1)},wt.getArea=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{height:r=1,mu:n=.5}=e;return t*r*(n*ut+(1-n)*Math.PI)/2},wt.getFactor=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e<1?dt.getFactor(t):pt.getFactor(t)};const St=" ".repeat(2),Tt=" ".repeat(4);function kt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{maxRows:r=15,maxColumns:n=10,maxNumSize:o=8}=e;return`${t.constructor.name} {\n${St}[\n${Tt}${Nt(t,r,n,o)}\n${St}]\n${St}rows: ${t.rows}\n${St}columns: ${t.columns}\n}`}function Nt(t,e,r,n){const{rows:o,columns:i}=t,s=Math.min(o,e),a=Math.min(i,r),l=[];for(let e=0;e<s;e++){let r=[];for(let o=0;o<a;o++)r.push(Ft(t.get(e,o),n));l.push(`${r.join(" ")}`)}return a!==i&&(l[l.length-1]+=` ... ${i-r} more columns`),s!==o&&l.push(`... ${o-e} more rows`),l.join(`\n${Tt}`)}function Ft(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const n=t.toPrecision(e-2);if(n.length<=e)return n;const o=t.toExponential(e-2),i=o.indexOf("e"),s=o.slice(i);return o.slice(0,e-s.length)+s}function Rt(t,e,r){let n=r?t.rows:t.rows-1;if(e<0||e>n)throw new RangeError("Row index out of range")}function It(t,e,r){let n=r?t.columns:t.columns-1;if(e<0||e>n)throw new RangeError("Column index out of range")}function zt(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Ct(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Ot(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some((e=>e<0||e>=t.rows)))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function $t(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some((e=>e<0||e>=t.columns)))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Dt(t,e,r,n,o){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(Vt("startRow",e),Vt("endRow",r),Vt("startColumn",n),Vt("endColumn",o),e>r||n>o||e<0||e>=t.rows||r<0||r>=t.rows||n<0||n>=t.columns||o<0||o>=t.columns)throw new RangeError("Submatrix indices are out of range")}function Pt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[];for(let n=0;n<t;n++)r.push(e);return r}function Vt(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function Ut(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class jt{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let n=new qt(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)n.set(o,t,r[o*e+t]);return n}static rowVector(t){let e=new qt(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new qt(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new qt(t,e)}static ones(t,e){return new qt(t,e).fill(1)}static rand(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=typeof r)throw new TypeError("options must be an object");const{random:n=Math.random}=r;let o=new qt(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)o.set(r,t,n());return o}static randInt(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=typeof r)throw new TypeError("options must be an object");const{min:n=0,max:o=1e3,random:i=Math.random}=r;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let s=o-n,a=new qt(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=n+Math.round(i()*s);a.set(r,t,e)}return a}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let n=Math.min(t,e),o=this.zeros(t,e);for(let t=0;t<n;t++)o.set(t,t,r);return o}static diag(t,e,r){let n=t.length;void 0===e&&(e=n),void 0===r&&(r=e);let o=Math.min(n,e,r),i=this.zeros(e,r);for(let e=0;e<o;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,n=t.columns,o=new qt(r,n);for(let i=0;i<r;i++)for(let r=0;r<n;r++)o.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return o}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,n=t.columns,o=new this(r,n);for(let i=0;i<r;i++)for(let r=0;r<n;r++)o.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return o}static checkMatrix(t){return jt.isMatrix(t)?t:new qt(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,n=!0,o=!1;for(;t<this.rows&&n;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(n=!1,o=!0);t++}return n}isReducedEchelonForm(){let t=0,e=0,r=-1,n=!0,o=!1;for(;t<this.rows&&n;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(n=!1,o=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(n=!1);t++}return n}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let n=e;for(let o=e;o<t.rows;o++)t.get(o,r)>t.get(n,r)&&(n=o);if(0===t.get(n,r))r++;else{t.swapRows(e,n);let o=t.get(e,r);for(let n=r;n<t.columns;n++)t.set(e,n,t.get(e,n)/o);for(let n=e+1;n<t.rows;n++){let o=t.get(n,r)/t.get(e,r);t.set(n,r,0);for(let i=r+1;i<t.columns;i++)t.set(n,i,t.get(n,i)-t.get(e,i)*o)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,n=r-1;for(;n>=0;)if(0===t.maxRow(n))n--;else{let o=0,i=!1;for(;o<r&&!1===i;)1===t.get(n,o)?i=!0:o++;for(let r=0;r<n;r++){let i=t.get(r,o);for(let s=o;s<e;s++){let e=t.get(r,s)-i*t.get(n,s);t.set(r,s,e)}}n--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let n=new qt(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)n.setSubMatrix(this,this.rows*t,this.columns*e);return n}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){Rt(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return qt.rowVector(this.getRow(t))}setRow(t,e){Rt(this,t),e=zt(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){Rt(this,t),Rt(this,e);for(let r=0;r<this.columns;r++){let n=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,n)}return this}getColumn(t){It(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return qt.columnVector(this.getColumn(t))}setColumn(t,e){It(this,t),e=Ct(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){It(this,t),It(this,e);for(let r=0;r<this.rows;r++){let n=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,n)}return this}addRowVector(t){t=zt(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=zt(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=zt(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=zt(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=Ct(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=Ct(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=Ct(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=Ct(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){Rt(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){It(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){Ut(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t&&(t=this.get(r,n),e[0]=r,e[1]=n);return e}min(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){Ut(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t&&(t=this.get(r,n),e[0]=r,e[1]=n);return e}maxRow(t){if(Rt(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){Rt(this,t),Ut(this);let e=this.get(t,0),r=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[1]=n);return r}minRow(t){if(Rt(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){Rt(this,t),Ut(this);let e=this.get(t,0),r=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[1]=n);return r}maxColumn(t){if(It(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){It(this,t),Ut(this);let e=this.get(0,t),r=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t),r[0]=n);return r}minColumn(t){if(It(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){It(this,t),Ut(this);let e=this.get(0,t),r=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t),r[0]=n);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frobenius",e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){jt.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let n=0;n<e.length;n++)r+=e[n]*t[n];return r}mmul(t){t=qt.checkMatrix(t);let e=this.rows,r=this.columns,n=t.columns,o=new qt(e,n),i=new Float64Array(r);for(let s=0;s<n;s++){for(let e=0;e<r;e++)i[e]=t.get(e,s);for(let t=0;t<e;t++){let e=0;for(let n=0;n<r;n++)e+=this.get(t,n)*i[n];o.set(t,s,e)}}return o}strassen2x2(t){t=qt.checkMatrix(t);let e=new qt(2,2);const r=this.get(0,0),n=t.get(0,0),o=this.get(0,1),i=t.get(0,1),s=this.get(1,0),a=t.get(1,0),l=this.get(1,1),h=t.get(1,1),u=(r+l)*(n+h),c=(s+l)*n,f=r*(i-h),m=l*(a-n),g=(r+o)*h,p=u+m-g+(o-l)*(a+h),d=f+g,w=c+m,y=u-c+f+(s-r)*(n+i);return e.set(0,0,p),e.set(0,1,d),e.set(1,0,w),e.set(1,1,y),e}strassen3x3(t){t=qt.checkMatrix(t);let e=new qt(3,3);const r=this.get(0,0),n=this.get(0,1),o=this.get(0,2),i=this.get(1,0),s=this.get(1,1),a=this.get(1,2),l=this.get(2,0),h=this.get(2,1),u=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),g=t.get(1,0),p=t.get(1,1),d=t.get(1,2),w=t.get(2,0),y=t.get(2,1),b=t.get(2,2),v=(r-i)*(-f+p),x=(-r+i+s)*(c-f+p),M=(i+s)*(-c+f),E=r*c,A=(-r+l+h)*(c-m+d),S=(-r+l)*(m-d),T=(l+h)*(-c+m),k=(-o+h+u)*(p+w-y),N=(o-u)*(p-y),F=o*w,R=(h+u)*(-w+y),I=(-o+s+a)*(d+w-b),z=(o-a)*(d-b),C=(s+a)*(-w+b),O=E+F+n*g,$=(r+n+o-i-s-h-u)*p+x+M+E+k+F+R,D=E+A+T+(r+n+o-s-a-l-h)*d+F+I+C,P=v+s*(-c+f+g-p-d-w+b)+x+E+F+I+z,V=v+x+M+E+a*y,U=F+I+z+C+i*m,j=E+A+S+h*(-c+m+g-p-d-w+y)+k+N+F,X=k+N+F+R+l*f,q=E+A+S+T+u*b;return e.set(0,0,O),e.set(0,1,$),e.set(0,2,D),e.set(1,0,P),e.set(1,1,V),e.set(1,2,U),e.set(2,0,j),e.set(2,1,X),e.set(2,2,q),e}mmulStrassen(t){t=qt.checkMatrix(t);let e=this.clone(),r=e.rows,n=e.columns,o=t.rows,i=t.columns;function s(t,e,r){let n=t.rows,o=t.columns;if(n===e&&o===r)return t;{let n=jt.zeros(e,r);return n=n.setSubMatrix(t,0,0),n}}n!==o&&console.warn(`Multiplying ${r} x ${n} and ${o} x ${i} matrix: dimensions do not match.`);let a=Math.max(r,o),l=Math.max(n,i);return e=s(e,a,l),function t(e,r,n,o){if(n<=512||o<=512)return e.mmul(r);n%2==1&&o%2==1?(e=s(e,n+1,o+1),r=s(r,n+1,o+1)):n%2==1?(e=s(e,n+1,o),r=s(r,n+1,o)):o%2==1&&(e=s(e,n,o+1),r=s(r,n,o+1));let i=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),l=e.subMatrix(0,i-1,0,a-1),h=r.subMatrix(0,i-1,0,a-1),u=e.subMatrix(0,i-1,a,e.columns-1),c=r.subMatrix(0,i-1,a,r.columns-1),f=e.subMatrix(i,e.rows-1,0,a-1),m=r.subMatrix(i,r.rows-1,0,a-1),g=e.subMatrix(i,e.rows-1,a,e.columns-1),p=r.subMatrix(i,r.rows-1,a,r.columns-1),d=t(jt.add(l,g),jt.add(h,p),i,a),w=t(jt.add(f,g),h,i,a),y=t(l,jt.sub(c,p),i,a),b=t(g,jt.sub(m,h),i,a),v=t(jt.add(l,u),p,i,a),x=t(jt.sub(f,l),jt.add(h,c),i,a),M=t(jt.sub(u,g),jt.add(m,p),i,a),E=jt.add(d,b);E.sub(v),E.add(M);let A=jt.add(y,v),S=jt.add(w,b),T=jt.sub(d,w);T.add(y),T.add(x);let k=jt.zeros(2*E.rows,2*E.columns);return k=k.setSubMatrix(E,0,0),k=k.setSubMatrix(A,E.rows,0),k=k.setSubMatrix(S,0,E.columns),k=k.setSubMatrix(T,E.rows,E.columns),k.subMatrix(0,n-1,0,o-1)}(e,t=s(t,a,l),a,l)}scaleRows(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let n=new qt(this.rows,this.columns);for(let t=0;t<this.rows;t++){const o=this.getRow(t);o.length>0&&At(o,{min:e,max:r,output:o}),n.setRow(t,o)}return n}scaleColumns(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let n=new qt(this.rows,this.columns);for(let t=0;t<this.columns;t++){const o=this.getColumn(t);o.length&&At(o,{min:e,max:r,output:o}),n.setColumn(t,o)}return n}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),n=this.get(e,this.columns-1-r);this.set(e,r,n),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),n=this.get(this.rows-1-r,e);this.set(r,e,n),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=qt.checkMatrix(t);let e=this.rows,r=this.columns,n=t.rows,o=t.columns,i=new qt(e*n,r*o);for(let s=0;s<e;s++)for(let e=0;e<r;e++)for(let r=0;r<n;r++)for(let a=0;a<o;a++)i.set(n*s+r,o*e+a,this.get(s,e)*t.get(r,a));return i}kroneckerSum(t){if(t=qt.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,n=this.kroneckerProduct(qt.eye(r,r)),o=qt.eye(e,e).kroneckerProduct(t);return n.add(o)}transpose(){let t=new qt(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt;for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt;for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,n){Dt(this,t,e,r,n);let o=new qt(e-t+1,n-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=n;e++)o.set(i-t,e-r,this.get(i,e));return o}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let n=new qt(t.length,r-e+1);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.rows)throw new RangeError(`Row index out of range: ${t[o]}`);n.set(o,i-e,this.get(t[o],i))}return n}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let n=new qt(r-e+1,t.length);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.columns)throw new RangeError(`Column index out of range: ${t[o]}`);n.set(i-e,o,this.get(i,t[o]))}return n}setSubMatrix(t,e,r){if((t=qt.checkMatrix(t)).isEmpty())return this;Dt(this,e,e+t.rows-1,r,r+t.columns-1);for(let n=0;n<t.rows;n++)for(let o=0;o<t.columns;o++)this.set(e+n,r+o,t.get(n,o));return this}selection(t,e){let r=function(t,e,r){return{row:Ot(t,e),column:$t(t,r)}}(this,t,e),n=new qt(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let o=0;o<r.column.length;o++){let i=r.column[o];n.set(t,o,this.get(e,i))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new qt(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=Pt(t.rows);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]+=t.get(r,n);return e}(this);case"column":return function(t){let e=Pt(t.columns);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]+=t.get(r,n);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e+=t.get(r,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=Pt(t.rows,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]*=t.get(r,n);return e}(this);case"column":return function(t){let e=Pt(t.columns,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]*=t.get(r,n);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e*=t.get(r,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:n=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const n=t.rows,o=t.columns,i=[];for(let s=0;s<n;s++){let n=0,a=0,l=0;for(let e=0;e<o;e++)l=t.get(s,e)-r[s],n+=l,a+=l*l;e?i.push((a-n*n/o)/(o-1)):i.push((a-n*n/o)/o)}return i}(this,r,n);case"column":if(!Array.isArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const n=t.rows,o=t.columns,i=[];for(let s=0;s<o;s++){let o=0,a=0,l=0;for(let e=0;e<n;e++)l=t.get(e,s)-r[s],o+=l,a+=l*l;e?i.push((a-o*o/n)/(n-1)):i.push((a-o*o/n)/n)}return i}(this,r,n);case void 0:if("number"!=typeof n)throw new TypeError("mean must be a number");return function(t,e,r){const n=t.rows,o=t.columns,i=n*o;let s=0,a=0,l=0;for(let e=0;e<n;e++)for(let n=0;n<o;n++)l=t.get(e,n)-r,s+=l,a+=l*l;return e?(a-s*s/i)/(i-1):(a-s*s/i)/i}(this,r,n);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[n])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let n=0;for(let e=0;e<t.columns;e++)n+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(n))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let n=0;for(let e=0;e<t.rows;e++)n+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(n))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[n])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let n=0;n<t.columns;n++)for(let o=0;o<t.rows;o++)r+=Math.pow(t.get(o,n),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return kt(this,t)}}function Xt(t,e){return t-e}jt.prototype.klass="Matrix","undefined"!=typeof Symbol&&(jt.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return kt(this)}),jt.random=jt.rand,jt.randomInt=jt.randInt,jt.diagonal=jt.diag,jt.prototype.diagonal=jt.prototype.diag,jt.identity=jt.eye,jt.prototype.negate=jt.prototype.neg,jt.prototype.tensorProduct=jt.prototype.kroneckerProduct;class qt extends jt{constructor(t,e){if(super(),qt.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<t;n++){if(r[n].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[n]))}}}this.rows=t,this.columns=e}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return Rt(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),Rt(this,t,!0),e=Float64Array.from(zt(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){It(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let n=0;n<t;n++)r[n]=this.data[e][n];for(let n=t+1;n<this.columns;n++)r[n-1]=this.data[e][n];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),It(this,t,!0),e=Ct(this,e);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns+1);let o=0;for(;o<t;o++)n[o]=this.data[r][o];for(n[o++]=e[r];o<this.columns+1;o++)n[o]=this.data[r][o-1];this.data[r]=n}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}(jt,qt);class _t extends jt{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class Lt extends _t{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class Yt extends jt{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class Wt{constructor(t){let e,r,n,o,i,s,a,l,h,u=(t=Yt.checkMatrix(t)).clone(),c=u.rows,f=u.columns,m=new Float64Array(c),g=1;for(e=0;e<c;e++)m[e]=e;for(l=new Float64Array(c),r=0;r<f;r++){for(e=0;e<c;e++)l[e]=u.get(e,r);for(e=0;e<c;e++){for(h=Math.min(e,r),i=0,n=0;n<h;n++)i+=u.get(e,n)*l[n];l[e]-=i,u.set(e,r,l[e])}for(o=r,e=r+1;e<c;e++)Math.abs(l[e])>Math.abs(l[o])&&(o=e);if(o!==r){for(n=0;n<f;n++)s=u.get(o,n),u.set(o,n,u.get(r,n)),u.set(r,n,s);a=m[o],m[o]=m[r],m[r]=a,g=-g}if(r<c&&0!==u.get(r,r))for(e=r+1;e<c;e++)u.set(e,r,u.get(e,r)/u.get(r,r))}this.LU=u,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=qt.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,n,o,i=t.columns,s=t.subMatrixRow(this.pivotVector,0,i-1),a=e.columns;for(o=0;o<a;o++)for(r=o+1;r<a;r++)for(n=0;n<i;n++)s.set(r,n,s.get(r,n)-s.get(o,n)*e.get(r,o));for(o=a-1;o>=0;o--){for(n=0;n<i;n++)s.set(o,n,s.get(o,n)/e.get(o,o));for(r=0;r<o;r++)for(n=0;n<i;n++)s.set(r,n,s.get(r,n)-s.get(o,n)*e.get(r,o))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let n=0;n<r;n++)e*=t.get(n,n);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,n=new qt(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o>e?n.set(o,e,t.get(o,e)):o===e?n.set(o,e,1):n.set(o,e,0);return n}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,n=new qt(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o<=e?n.set(o,e,t.get(o,e)):n.set(o,e,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Bt(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class Ht{constructor(t){let e,r,n,o,i=(t=Yt.checkMatrix(t)).clone(),s=t.rows,a=t.columns,l=new Float64Array(a);for(n=0;n<a;n++){let t=0;for(e=n;e<s;e++)t=Bt(t,i.get(e,n));if(0!==t){for(i.get(n,n)<0&&(t=-t),e=n;e<s;e++)i.set(e,n,i.get(e,n)/t);for(i.set(n,n,i.get(n,n)+1),r=n+1;r<a;r++){for(o=0,e=n;e<s;e++)o+=i.get(e,n)*i.get(e,r);for(o=-o/i.get(n,n),e=n;e<s;e++)i.set(e,r,i.get(e,r)+o*i.get(e,n))}}l[n]=-t}this.QR=i,this.Rdiag=l}solve(t){t=qt.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n,o,i,s,a=t.columns,l=t.clone(),h=e.columns;for(i=0;i<h;i++)for(o=0;o<a;o++){for(s=0,n=i;n<r;n++)s+=e.get(n,i)*l.get(n,o);for(s=-s/e.get(i,i),n=i;n<r;n++)l.set(n,o,l.get(n,o)+s*e.get(n,i))}for(i=h-1;i>=0;i--){for(o=0;o<a;o++)l.set(i,o,l.get(i,o)/this.Rdiag[i]);for(n=0;n<i;n++)for(o=0;o<a;o++)l.set(n,o,l.get(n,o)-l.get(i,o)*e.get(n,i))}return l.subMatrix(0,h-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,n=r.columns,o=new qt(n,n);for(t=0;t<n;t++)for(e=0;e<n;e++)t<e?o.set(t,e,r.get(t,e)):t===e?o.set(t,e,this.Rdiag[t]):o.set(t,e,0);return o}get orthogonalMatrix(){let t,e,r,n,o=this.QR,i=o.rows,s=o.columns,a=new qt(i,s);for(r=s-1;r>=0;r--){for(t=0;t<i;t++)a.set(t,r,0);for(a.set(r,r,1),e=r;e<s;e++)if(0!==o.get(r,r)){for(n=0,t=r;t<i;t++)n+=o.get(t,r)*a.get(t,e);for(n=-n/o.get(r,r),t=r;t<i;t++)a.set(t,e,a.get(t,e)+n*o.get(t,r))}}return a}}class Kt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((t=Yt.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,n=t.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:i=!0,autoTranspose:s=!1}=e;let a,l=Boolean(o),h=Boolean(i),u=!1;if(r<n)if(s){a=t.transpose(),r=a.rows,n=a.columns,u=!0;let e=l;l=h,h=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let c=Math.min(r,n),f=Math.min(r+1,n),m=new Float64Array(f),g=new qt(r,c),p=new qt(n,n),d=new Float64Array(n),w=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let b=Math.min(r-1,n),v=Math.max(0,Math.min(n-2,r)),x=Math.max(b,v);for(let t=0;t<x;t++){if(t<b){m[t]=0;for(let e=t;e<r;e++)m[t]=Bt(m[t],a.get(e,t));if(0!==m[t]){a.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)a.set(e,t,a.get(e,t)/m[t]);a.set(t,t,a.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<n;e++){if(t<b&&0!==m[t]){let n=0;for(let o=t;o<r;o++)n+=a.get(o,t)*a.get(o,e);n=-n/a.get(t,t);for(let o=t;o<r;o++)a.set(o,e,a.get(o,e)+n*a.get(o,t))}d[e]=a.get(t,e)}if(l&&t<b)for(let e=t;e<r;e++)g.set(e,t,a.get(e,t));if(t<v){d[t]=0;for(let e=t+1;e<n;e++)d[t]=Bt(d[t],d[e]);if(0!==d[t]){d[t+1]<0&&(d[t]=0-d[t]);for(let e=t+1;e<n;e++)d[e]/=d[t];d[t+1]+=1}if(d[t]=-d[t],t+1<r&&0!==d[t]){for(let e=t+1;e<r;e++)w[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<n;r++)w[e]+=d[r]*a.get(e,r);for(let e=t+1;e<n;e++){let n=-d[e]/d[t+1];for(let o=t+1;o<r;o++)a.set(o,e,a.get(o,e)+n*w[o])}}if(h)for(let e=t+1;e<n;e++)p.set(e,t,d[e])}}let M=Math.min(n,r+1);if(b<n&&(m[b]=a.get(b,b)),r<M&&(m[M-1]=0),v+1<M&&(d[v]=a.get(v,M-1)),d[M-1]=0,l){for(let t=b;t<c;t++){for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=b-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<c;e++){let n=0;for(let o=t;o<r;o++)n+=g.get(o,t)*g.get(o,e);n=-n/g.get(t,t);for(let o=t;o<r;o++)g.set(o,e,g.get(o,e)+n*g.get(o,t))}for(let e=t;e<r;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}}if(h)for(let t=n-1;t>=0;t--){if(t<v&&0!==d[t])for(let e=t+1;e<n;e++){let r=0;for(let o=t+1;o<n;o++)r+=p.get(o,t)*p.get(o,e);r=-r/p.get(t+1,t);for(let o=t+1;o<n;o++)p.set(o,e,p.get(o,e)+r*p.get(o,t))}for(let e=0;e<n;e++)p.set(e,t,0);p.set(t,t,1)}let E=M-1,A=Number.EPSILON;for(;M>0;){let t,e;for(t=M-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+A*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(d[t])<=e||Number.isNaN(d[t])){d[t]=0;break}}if(t===M-2)e=4;else{let r;for(r=M-1;r>=t&&r!==t;r--){let e=(r!==M?Math.abs(d[r]):0)+(r!==t+1?Math.abs(d[r-1]):0);if(Math.abs(m[r])<=A*e){m[r]=0;break}}r===t?e=3:r===M-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=d[M-2];d[M-2]=0;for(let r=M-2;r>=t;r--){let o=Bt(m[r],e),i=m[r]/o,s=e/o;if(m[r]=o,r!==t&&(e=-s*d[r-1],d[r-1]=i*d[r-1]),h)for(let t=0;t<n;t++)o=i*p.get(t,r)+s*p.get(t,M-1),p.set(t,M-1,-s*p.get(t,r)+i*p.get(t,M-1)),p.set(t,r,o)}break}case 2:{let e=d[t-1];d[t-1]=0;for(let n=t;n<M;n++){let o=Bt(m[n],e),i=m[n]/o,s=e/o;if(m[n]=o,e=-s*d[n],d[n]=i*d[n],l)for(let e=0;e<r;e++)o=i*g.get(e,n)+s*g.get(e,t-1),g.set(e,t-1,-s*g.get(e,n)+i*g.get(e,t-1)),g.set(e,n,o)}break}case 3:{const e=Math.max(Math.abs(m[M-1]),Math.abs(m[M-2]),Math.abs(d[M-2]),Math.abs(m[t]),Math.abs(d[t])),o=m[M-1]/e,i=m[M-2]/e,s=d[M-2]/e,a=m[t]/e,u=d[t]/e,c=((i+o)*(i-o)+s*s)/2,f=o*s*(o*s);let w=0;0===c&&0===f||(w=c<0?0-Math.sqrt(c*c+f):Math.sqrt(c*c+f),w=f/(c+w));let y=(a+o)*(a-o)+w,b=a*u;for(let e=t;e<M-1;e++){let o=Bt(y,b);0===o&&(o=Number.MIN_VALUE);let i=y/o,s=b/o;if(e!==t&&(d[e-1]=o),y=i*m[e]+s*d[e],d[e]=i*d[e]-s*m[e],b=s*m[e+1],m[e+1]=i*m[e+1],h)for(let t=0;t<n;t++)o=i*p.get(t,e)+s*p.get(t,e+1),p.set(t,e+1,-s*p.get(t,e)+i*p.get(t,e+1)),p.set(t,e,o);if(o=Bt(y,b),0===o&&(o=Number.MIN_VALUE),i=y/o,s=b/o,m[e]=o,y=i*d[e]+s*m[e+1],m[e+1]=-s*d[e]+i*m[e+1],b=s*d[e+1],d[e+1]=i*d[e+1],l&&e<r-1)for(let t=0;t<r;t++)o=i*g.get(t,e)+s*g.get(t,e+1),g.set(t,e+1,-s*g.get(t,e)+i*g.get(t,e+1)),g.set(t,e,o)}d[M-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,h))for(let e=0;e<=E;e++)p.set(e,t,-p.get(e,t));for(;t<E&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,h&&t<n-1)for(let r=0;r<n;r++)e=p.get(r,t+1),p.set(r,t+1,p.get(r,t)),p.set(r,t,e);if(l&&t<r-1)for(let n=0;n<r;n++)e=g.get(n,t+1),g.set(n,t+1,g.get(n,t)),g.set(n,t,e);t++}M--}}if(u){let t=p;p=g,g=t}this.m=r,this.n=n,this.s=m,this.U=g,this.V=p}solve(t){let e=t,r=this.threshold,n=this.s.length,o=qt.zeros(n,n);for(let t=0;t<n;t++)Math.abs(this.s[t])<=r?o.set(t,t,0):o.set(t,t,1/this.s[t]);let i=this.U,s=this.rightSingularVectors,a=s.mmul(o),l=s.rows,h=i.rows,u=qt.zeros(l,h);for(let t=0;t<l;t++)for(let e=0;e<h;e++){let r=0;for(let o=0;o<n;o++)r+=a.get(t,o)*i.get(e,o);u.set(t,e,r)}return u.mmul(e)}solveForDiagonal(t){return this.solve(qt.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,n=t.columns,o=new qt(r,this.s.length);for(let i=0;i<r;i++)for(let r=0;r<n;r++)Math.abs(this.s[r])>e&&o.set(i,r,t.get(i,r)/this.s[r]);let i=this.U,s=i.rows,a=i.columns,l=new qt(r,s);for(let t=0;t<r;t++)for(let e=0;e<s;e++){let r=0;for(let n=0;n<a;n++)r+=o.get(t,n)*i.get(e,n);l.set(t,e,r)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let n=0,o=r.length;n<o;n++)r[n]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return qt.diag(this.s)}}function Gt(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t=Yt.checkMatrix(t),e?new Kt(t).inverse():Jt(t,qt.eye(t.rows))}function Jt(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t=Yt.checkMatrix(t),e=Yt.checkMatrix(e),r?new Kt(t).solve(e):t.isSquare()?new Wt(t).solve(e):new Ht(t).solve(e)}function Zt(t,e,r,n,o,i,s){let a=r,l=qt.eye(e.length,e.length,a);const h=o(e);let u=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)u[e]=h(t.x[e]);let c=function(t,e,r,n,o,i){const s=r.length,a=t.x.length;let l=qt.zeros(s,a),h=0;for(let u=0;u<s;u++){if(0===n[u])continue;let s=n[u],c=r.slice();c[u]+=s;let f=o(c);if(i){c=r.slice(),c[u]-=s,s*=2;let e=o(c);for(let r=0;r<a;r++)l.set(h,r,(e(t.x[r])-f(t.x[r]))/s)}else for(let r=0;r<a;r++)l.set(h,r,(e[r]-f(t.x[r]))/s);h++}return l}(t,u,e,n,o,i),f=function(t,e){const r=t.x.length;let n=new qt(r,1);for(let o=0;o<r;o++)n.set(o,0,t.y[o]-e[o]);return n}(t,u),m=Gt(l.add(c.mmul(c.transpose().scale("row",{scale:s})))),g=c.mmul(f.scale("row",{scale:s}));return{perturbations:m.mmul(g),jacobianWeigthResidualError:g}}function Qt(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{checkTimeout:n,minValues:o,maxValues:i,parameters:s,weightSquare:a,damping:l,dampingStepUp:h,dampingStepDown:u,maxIterations:c,errorTolerance:f,centralDifference:m,gradientDifference:g,improvementThreshold:p}=Mt(t,e,r),d=Et(t,s,e,a),w=d<=f,y=0;for(;y<c&&!w;y++){let c=d,{perturbations:y,jacobianWeigthResidualError:b}=Zt(t,s,l,g,e,m,a);for(let t=0;t<s.length;t++)s[t]=Math.min(Math.max(o[t],s[t]-y.get(t,0)),i[t]);if(d=Et(t,s,e,a),isNaN(d))break;if((c-d)/y.transpose().mmul(y.mulS(l).add(b)).get(0,0)>p?l=Math.max(l/u,1e-7):(d=c,l=Math.min(l*h,1e7)),n())throw new Error(`The execution time is over to ${r.timeout} seconds`);w=d<=f}return{parameterValues:s,parameterError:d,iterations:y}}function te(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{kind:e,options:r}=t;if(e=re(e),1===e)return{algorithm:Qt,optimizationOptions:ee(e,r)};throw new Error("Unknown kind algorithm")}function ee(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(1===t)return Object.assign({},ne,e)}function re(t){if("string"!=typeof t)return t;switch(t.toLowerCase().replace(/[^a-z]/g,"")){case"lm":case"levenbergmarquardt":return 1;default:throw new Error("Unknown kind algorithm")}}const ne={damping:1.5,maxIterations:100,errorTolerance:1e-8};function oe(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{y:n,x:o,maxY:i,peaks:s,paramsFunc:a,optimization:l}=xt(t,e,r);let h=l.parameters,u=s.length,c=Object.keys(h),f=u*c.length,m=new Float64Array(f),g=new Float64Array(f),p=new Float64Array(f),d=new Float64Array(f);for(let t=0;t<u;t++){let e=s[t];for(let r=0;r<c.length;r++){let n=c[r],o=h[n].init,i=h[n].min,s=h[n].max,a=h[n].gradientDifference;p[t+r*u]=o[t%o.length](e),m[t+r*u]=i[t%i.length](e),g[t+r*u]=s[t%s.length](e),d[t+r*u]=a[t%a.length](e)}}let{algorithm:w,optimizationOptions:y}=te(l);y.minValues=m,y.maxValues=g,y.initialValues=p,y.gradientDifference=d;let b=w({x:o,y:n},a,y),{parameterError:v,iterations:x}=b,M={error:v,iterations:x,peaks:s};for(let t=0;t<u;t++){b.parameterValues[t+u]*=i;for(let e=0;e<c.length;e++)s[t][c[e]]=b.parameterValues[t+e*u]}return M}function ie(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{color:n="#A9A9A9",opacity:o=1,lineWidth:i=1}=r;n=n.match(/#[0-9A-F]{6}$/i)?(n+(255*o>>0).toString(16)).toUpperCase():n.replace(/rgb ?\((.*)\)/,`rgba($1,${o})`),t.style=[{name:"unselected",style:{line:{color:n,width:i,dash:1}}},{name:"selected",style:{line:{color:n,width:i+2,dash:1}}}],t.name=e.label||e.id}const se=["#FFB300","#803E75","#FF6800","#A6BDD7","#C10020","#CEA262","#817066","#007D34","#F6768E","#00538A","#FF7A5C","#53377A","#FF8E00","#B32851","#F4C800","#7F180D","#93AA00","#593315","#F13A13","#232C16"];function ae(t,e,r){t[e]||(t[e]={key:e,values:[],count:0}),t[e].values.includes(r)||t[e].values.push(r),t[e].count++}function le(t,e){t[e]||(t[e]={key:e,count:0}),t[e].count++}function he(t,e,r){if(r){let n=new Array(e);for(let t=0;t<e;t++)n[r[t]]=t;let o=[];for(let e=0;e<t.length;++e){let r=n[t[e][0]],i=n[t[e][1]];if(i<r){let t=i;i=r,r=t}o[e]=[],o[e][0]=r,o[e][1]=i,o[e][2]=t[e][2]}t=o}else{r=[];for(let t=0;t<e;++t)r[t]=t}let n=new Array(e+1),o=new Array(t.length),i=new Array(t.length),s=[];for(let t=0;t<e;++t)s[t]=0;for(let e=0;e<t.length;++e)s[t[e][1]]++;n[0]=0;for(let t=0;t<e;++t)n[t+1]=n[t]+s[t];let a=[];for(let t=0;t<e;++t)a[t]=0;for(let e=0;e<t.length;++e){let r=t[e],s=r[1],l=n[s]+a[s];o[l]=r[0],i[l]=r[2],a[s]++}let l,h=new Array(e),u=new Array(e),c=new Array(e+1),f=new Array(e),m=new Array(e),g=new Array(e),p=new Array(e),d=new Array(e),w=new Array(e);!function(t,e,r,n,o,i,s){let a,l,h,u,c;for(l=0;l<t;l++)for(o[l]=-1,s[l]=l,i[l]=0,u=l,c=e[u+1],h=e[u];h<c;h++)if(a=r[h],a<l)for(;s[a]!==l;a=o[a])-1===o[a]&&(o[a]=l),i[a]++,s[a]=l;for(n[0]=0,l=0;l<t;l++)n[l+1]=n[l]+i[l]}(e,n,o,c,f,m,g);let y=new Array(c[e]),b=new Array(c[e]);return l=function(t,e,r,n,o,i,s,a,l,h,u,c,f){let m,g,p,d,w,y,b,v,x;for(d=0;d<t;d++){for(u[d]=0,x=t,f[d]=d,s[d]=0,y=d,b=e[y+1],w=e[y];w<b;w++)if(p=r[w],p<=d){for(u[p]+=n[w],v=0;f[p]!==d;p=i[p])c[v++]=p,f[p]=d;for(;v>0;)c[--x]=c[--v]}for(h[d]=u[d],u[d]=0;x<t;x++){for(p=c[x],m=u[p],u[p]=0,b=o[p]+s[p],w=o[p];w<b;w++)u[a[w]]-=l[w]*m;g=m/h[p],h[d]-=g*m,a[w]=d,l[w]=g,s[p]++}if(0===h[d])return d}return t}(e,n,o,i,c,f,m,b,y,h,u,p,g),l===e?function(t){return function(t,e,r,n){let o;for(o=0;o<t;o++)e[o]=r[n[o]]}(e,d,t,r),function(t,e,r,n,o){let i,s,a;for(i=0;i<t;i++)for(a=r[i+1],s=r[i];s<a;s++)e[n[s]]-=o[s]*e[i]}(e,d,c,b,y),function(t,e,r){let n;for(n=0;n<t;n++)e[n]/=r[n]}(e,d,h),function(t,e,r,n,o){let i,s,a;for(i=t-1;i>=0;i--)for(a=r[i+1],s=r[i];s<a;s++)e[i]-=o[s]*e[n[s]]}(e,d,c,b,y),function(t,e,r,n){let o;for(o=0;o<t;o++)e[n[o]]=r[o]}(e,w,d,r),w}:null}function ue(t,e){return t-e}var ce=function(t,e){for(var r=new Array(e),n=new Array(e),o=0;o<e;++o)r[o]=[],n[o]=!1;for(o=0;o<t.length;++o){var i=t[o];r[i[0]].push(i[1])}var s=new Array(e),a=0,l=0;for(o=0;o<e;++o)if(!n[o])for(s[a++]=o,n[o]=!0;l<a;){var h=s[l++],u=r[h];u.sort(ue);for(var c=0;c<u.length;++c){var f=u[c];n[f]||(n[f]=!0,s[a++]=f)}}var m=new Array(e);for(o=0;o<e;++o)m[s[o]]=o;return m};const fe=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.reduce(((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t));return r},me=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=fe(t,e);return t.indexOf(r)},ge=(t,e,r)=>{let n=e.length,o=n-1,i=new Array(t.length),s=new Float64Array(n);for(let n=0;n<o;n++){let o=r[n],a=2*n,l=a+1;i[a]=t[a].slice(),i[l]=t[l].slice(),0===o?s[n]=0:(s[n]=e[n]*o,i[a][2]+=o)}return s[o]=e[o]*r[o],i[2*o]=t[2*o].slice(),i[2*o][2]+=r[o],[i,s]},pe=(t,e)=>{let r=[],n=t-1;for(let t=0;t<n;t++)r.push([t,t,2*e]),r.push([t+1,t,-1*e]);return r[0][2]=e,r.push([n,n,e]),{lowerTriangularNonZeros:r,permutationEncodedArray:ce(r,t)}};function de(t,e){let r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{maxIterations:i=100,lambda:s=100,factorCriterion:a=.001,weights:l=new Array(e.length).fill(1),controlPoints:h=[],baseLineZones:u=[]}=o;h.length>0&&h.forEach(((e,r,n)=>n[r]=me(t,e))),u.length>0&&u.forEach((e=>{let r=me(t,e.from),n=me(t,e.to);r>n&&([r,n]=[n,r]);for(let t=r;t<n;t++)h.push(t)}));let c=e.length,f=c-1,m=Number.MAX_SAFE_INTEGER,g=a*e.reduce(((t,e)=>Math.abs(e)+t),0),{lowerTriangularNonZeros:p,permutationEncodedArray:d}=pe(c,s);for(n=0;n<i&&Math.abs(m)>g;n++){let[t,o]=ge(p,e,l),i=he(t,c,d);r=i(o),m=0;let s=e.map(w),a=-1*Number.MAX_SAFE_INTEGER;for(let t=1;t<f;t++){let e=s[t];e>=0?l[t]=0:(l[t]=Math.exp(n*e/m),a<e&&(a=e))}let u=Math.exp(n*a/m);l[0]=u,l[f]=u,h.forEach((t=>l[t]=u))}return{corrected:e.map(((t,e)=>t-r[e])),baseline:r,iteration:n,error:m};function w(t,e){let n=t-r[e];return n<0&&(m+=n),n}}function we(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t.length;let{x:n,regressionOptions:o}=e;n||(n=c({from:0,to:r-1,size:r}));let i=de(n,t,o);return{baseline:i.baseline,correctedSpectrum:i.corrected}}function ye(t,e){return t<0?(t=0-t,"number"==typeof e?`- ${t.toPrecision(e)}`:`- ${t.toString()}`):"number"==typeof e?t.toPrecision(e):t.toString()}class be{constructor(){if(new.target===be)throw new Error("BaseRegression must be subclassed")}predict(t){if("number"==typeof t)return this._predict(t);if(r(t)){const e=[];for(let r=0;r<t.length;r++)e.push(this._predict(t[r]));return e}throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!r(t)||!r(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const n=t.length,o=new Array(n);for(let e=0;e<n;e++)o[e]=this._predict(t[e]);let i=0,s=0,a=0,l=0,h=0,u=0,c=0;for(let t=0;t<n;t++)i+=o[t],s+=e[t],h+=o[t]*o[t],u+=e[t]*e[t],c+=o[t]*e[t],0!==e[t]&&(a+=(e[t]-o[t])*(e[t]-o[t])/e[t]),l+=(e[t]-o[t])*(e[t]-o[t]);const f=(n*c-i*s)/Math.sqrt((n*h-i*i)*(n*u-s*s));return{r:f,r2:f*f,chi2:a,rmsd:Math.sqrt(l/n)}}}class ve extends be{constructor(t,e,n){super(),!0===t?(this.degree=e.degree,this.powers=e.powers,this.coefficients=e.coefficients):(function(t,e){if(!r(t)||!r(e))throw new TypeError("x and y must be arrays");if(t.length!==e.length)throw new RangeError("x and y arrays must have the same length")}(t,e),function(t,e,r,n){const o=e.length;let i;if(Array.isArray(n))i=n,n=i.length;else{n++,i=new Array(n);for(let t=0;t<n;t++)i[t]=t}const s=new qt(o,n),a=new qt([r]);for(let t=0;t<n;t++)for(let r=0;r<o;r++)0===i[t]?s.set(r,t,1):s.set(r,t,Math.pow(e[r],i[t]));const l=new Lt(s),h=l.mmul(s),u=l.mmul(new Lt(a));t.degree=n-1,t.powers=i,t.coefficients=Jt(h,u).to1DArray()}(this,t,e,n))}_predict(t){let e=0;for(let r=0;r<this.powers.length;r++)e+=this.coefficients[r]*Math.pow(t,this.powers[r]);return e}toJSON(){return{name:"polynomialRegression",degree:this.degree,powers:this.powers,coefficients:this.coefficients}}toString(t){return this._toFormula(t,!1)}toLaTeX(t){return this._toFormula(t,!0)}_toFormula(t,e){let r="^",n="",o=" * ";e&&(r="^{",n="}",o="");let i="",s="";for(let e=0;e<this.coefficients.length;e++)s="",0!==this.coefficients[e]&&(s=0===this.powers[e]?ye(this.coefficients[e],t):1===this.powers[e]?`${ye(this.coefficients[e],t)+o}x`:`${ye(this.coefficients[e],t)+o}x${r}${this.powers[e]}${n}`,this.coefficients[e]>0&&e!==this.coefficients.length-1?s=` + ${s}`:e!==this.coefficients.length-1&&(s=` ${s}`)),i=s+i;return"+"===i.charAt(0)&&(i=i.slice(1)),`f(x) = ${i}`}static load(t){if("polynomialRegression"!==t.name)throw new TypeError("not a polynomial regression model");return new ve(!0,t)}}function xe(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{maxIterations:n=100,Regression:o=ve,regressionOptions:i,tolerance:s=.001}=r;i||o!==ve||(i=3);let a,l,h=e.slice(),u=e.slice(),c=e,f=0;for(;f<n;){l=new o(t,h,i),a=0;for(let e=0;e<h.length;e++)u[e]=l.predict(t[e]),h[e]>u[e]&&(h[e]=u[e]),a+=Math.abs((u[e]-c[e])/c[e]);if(a<s)break;c=u.slice(),f++}let m=new Array(h.length);for(let t=0;t<h.length;t++)m[t]=e[t]-h[t];return{corrected:m,delta:a,iteration:f,baseline:h,regression:l}}function Me(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t.length;let{x:n,regressionOptions:o}=e;n||(n=c({from:0,to:r-1,size:r}));let i=xe(n,t,o);return{baseline:i.baseline,correctedSpectrum:i.corrected}}function Ee(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty")}function Ae(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{size:r=0,value:n=0,algorithm:o=""}=e;if(Ee(t),!o)return t instanceof Float64Array?t.slice():Float64Array.from(t);let i=new Float64Array(t.length+2*r);for(let e=0;e<t.length;e++)i[e+r]=t[e];let s=r+t.length,a=2*r+t.length;switch(o.toLowerCase()){case"value":for(let t=0;t<r;t++)i[t]=n;for(let t=s;t<a;t++)i[t]=n;break;case"duplicate":for(let e=0;e<r;e++)i[e]=t[0];for(let e=s;e<a;e++)i[e]=t[t.length-1];break;case"circular":for(let e=0;e<r;e++)i[e]=t[(t.length-r%t.length+e)%t.length];for(let e=0;e<r;e++)i[e+s]=t[e%t.length];break;default:throw Error("xPadding: unknown algorithm")}return i}function Se(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Ee(t),"function"!=typeof e)throw Error("fct has to be a function");const{window:n=5,padding:o={}}=r,{size:i=n-1,algorithm:s,value:a}=o;t=Ae(t,{size:i,algorithm:s,value:a});const l=[];for(let r=0;r<t.length-n+1;r++){let o=new Float64Array(t.buffer,8*r,n);l.push(e(o))}return l}function Te(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Se(t,g,e)}function ke(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Se(t,i,e)}function Ne(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Math.max(Math.round(.1*t.length),2),n={window:r,padding:{size:r-1,algorithm:"duplicate",value:0}},o=Object.assign({},n,e),i=Te(t,o),s=new Float64Array(t.length);for(let e=0;e<s.length;e++)s[e]=t[e]-i[e];return{baseline:i,correctedSpectrum:s}}function Fe(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new Error("Spectrum must be an array");if(0===t.length)throw new TypeError("Spectrum must not be empty");const n=t.length,o=new Float64Array(n),i=new Float64Array(n),s=new Float64Array(n),{windowM:a=Math.round(.04*n),windowS:l=Math.round(.08*n)}=e;for(let e=0;e<t.length;e++){let r=d([0,e-a]),n=p([e+a+1,t.length]);i[e]=p(t.slice(r,n))}for(let t=0;t<i.length;t++){let e=d([0,t-a]),r=p([t+a+1,i.length]);o[t]=d(i.slice(e,r))}for(let t=0;t<i.length;t++){let e=d([0,t-l]),r=p([t+l+1,o.length]);s[t]=g(o.slice(e,r))}return s}function Re(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Fe(t,e);let n=new Float64Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[e]-r[e];return{baseline:r,correctedSpectrum:n}}function Ie(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Math.max(Math.round(.1*t.length),2),n={window:r,padding:{size:r-1,algorithm:"duplicate",value:0}},o=Object.assign({},n,e),i=ke(t,o),s=new Float64Array(t.length);for(let e=0;e<s.length;e++)s[e]=t[e]-i[e];return{baseline:i,correctedSpectrum:s}}function ze(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.algorithm,i=void 0===o?"absolute":o,s=n.sumValue,a=void 0===s?1:s,l=n.maxValue,h=void 0===l?1:l;if(!r(t))throw new Error("input must be an array");if(void 0!==n.output){if(!r(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);if(0===t.length)throw new Error("input must not be empty");switch(i.toLowerCase()){case"absolute":var u=Ce(t)/a;if(0===u)return t.slice(0);for(var c=0;c<t.length;c++)e[c]=t[c]/u;return e;case"max":var f=d(t);if(0===f)return t.slice(0);for(var g=h/f,p=0;p<t.length;p++)e[p]=t[p]*g;return e;case"sum":var w=m(t)/a;if(0===w)return t.slice(0);for(var y=0;y<t.length;y++)e[y]=t[y]/w;return e;default:throw new Error("norm: unknown algorithm: ".concat(i))}}function Ce(t){for(var e=0,r=0;r<t.length;r++)e+=Math.abs(t[r]);return e}function Oe(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===t.length)return[];let{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=e;if(r>n&&([r,n]=[n,r]),t=JSON.parse(JSON.stringify(t)).map((t=>t.from>t.to?{from:t.to,to:t.from}:t)),t=t.sort(((t,e)=>t.from!==e.from?t.from-e.from:t.to-e.to)),t.forEach((t=>{r>t.from&&(t.from=r),n<t.to&&(t.to=n)})),t=t.filter((t=>t.from<=t.to)),0===t.length)return[];let o=t[0],i=[o];for(let e=1;e<t.length;e++){let r=t[e];r.from<=o.to?o.to=r.to:(o=r,i.push(o))}return i}function $e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=e;if(r>n&&([r,n]=[n,r]),t=Oe(t,{from:r,to:n}),0===t.length)return[{from:r,to:n}];let o=[];for(let e=0;e<t.length;e++){let i=t[e],s=t[e+1];0===e&&i.from>r&&o.push({from:r,to:i.from}),e===t.length-1?i.to<n&&o.push({from:i.to,to:n}):o.push({from:i.to,to:s.from})}return o}function De(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===t.length)return t;const n=(t=Oe(t,r)).reduce(((t,e)=>t+(e.to-e.from)),0);let o=n/e,i=0;for(let r=0;r<t.length-1;r++){let n=t[r];n.numberOfPoints=Math.min(Math.round((n.to-n.from)/o),e-i),i+=n.numberOfPoints}return t[t.length-1].numberOfPoints=e-i,t}function Pe(t,e,r,n){return.5*r*e*e+n*e-(.5*r*t*t+n*t)}function Ve(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{x:r,y:n}=t,o=r.length,i=!1;r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),n=n.slice().reverse(),i=!0);let{from:s=r[0],to:a=r[o-1],variant:l="smooth",numberOfPoints:h=100,exclusions:u=[],zones:c=[]}=e;if(o!==n.length)throw new RangeError("the x and y vector doesn't have the same size.");if("number"!=typeof s||isNaN(s))throw new RangeError("'from' option must be a number");if("number"!=typeof a||isNaN(a))throw new RangeError("'to' option must be a number");if("number"!=typeof h||isNaN(h))throw new RangeError("'numberOfPoints' option must be a number");if(h<2)throw new RangeError("'numberOfPoints' option must be greater than 1");0===c.length&&(c=$e(u,{from:s,to:a})),c=De(c,h,{from:s,to:a});let f=[],m=[];for(let t of c){let e=Ue(r,n,t.from,t.to,t.numberOfPoints,l);f=f.concat(e.x),m=m.concat(e.y)}return i?s<a?{x:f.reverse(),y:m.reverse()}:{x:f,y:m}:s<a?{x:f,y:m}:{x:f.reverse(),y:m.reverse()}}function Ue(t,e,r,n,o,i){if(o<1)throw new RangeError("the number of points must be at least 1");let s="slot"===i?function(t,e,r,n,o){let i=t.length,s=(n-r)/(o>1?o-1:1),a=s/2,l=t[t.length-1]-t[t.length-2],h=r-a,u=new Array(o),c=h,f=h+s,m=-Number.MAX_VALUE,g=0,p=t[0],d=e[0],w=0,y=!0,b=0,v=0,x=1,M=0;t:for(;;){if(m>=p)throw new Error("x must be a growing series");for(;m-f>0;){if(y&&(v++,y=!1),u[M]=v<=0?0:b/v,M++,M===o)break t;c=f,f+=s,b=0,v=0}m>c&&(b+=g,v++),(m===-Number.MAX_VALUE||w>1)&&v--,m=p,g=d,x<i?(p=t[x],d=e[x],x++):(p+=l,d=0,w++)}return u}(t,e,r,n,o):function(t,e,r,n,o){let i=t.length,s=(n-r)/(o>1?o-1:1),a=s/2,l=new Array(o),h=t[1]-t[0],u=t[i-1]-t[i-2],c=r-a,f=r+a,m=Number.MIN_SAFE_INTEGER,g=0,p=t[0]-h,d=0,w=0,y=0,b=0,v=0,x=0,M=0,E=0,A=0;t:for(;;){if(m>=p)throw new Error("x must be a growing series");for(m<=c&&c<=p&&(A=Pe(0,c-m,y,g),v=w+A);p-f>=0;){if(A=Pe(0,f-m,y,g),x=w+A,l[E++]=(x-v)/s,E===o)break t;c=f,f+=s,v=x}w+=Pe(m,p,y,b),m=p,g=d,M<i?(p=t[M],d=e[M],M++):M===i&&(p+=u,d=0),y=(d-g)/(p-m),b=-y*m+g}return l}(t,e,r,n,o);return{x:c({from:r,to:n,size:o}),y:s}}function je(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t>e&&([t,e]=[e,t]),r=r.filter((t=>void 0!==t.from&&void 0!==t.to)),r=JSON.parse(JSON.stringify(r)),r.forEach((t=>{t.from>t.to&&([t.to,t.from]=[t.from,t.to])})),r.sort(((t,e)=>t.from-e.from)),r.forEach((r=>{r.from<t&&(r.from=t),r.to>e&&(r.to=e)}));for(let t=0;t<r.length-1;t++)r[t].to>r[t+1].from&&(r[t].to=r[t+1].from);if(r=r.filter((t=>t.from<t.to)),!r||0===r.length)return[{from:t,to:e}];let n=[],o=t;for(let t of r)o<t.from&&n.push({from:o,to:t.from}),o=t.to;return o<e&&n.push({from:o,to:e}),n}function Xe(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{x:r,y:n}=t,{from:o=r[0],to:i=r[r.length-1],exclusions:s=[]}=e;let a=je(o,i,s),l=0,h=[],u=[],c=0;for(;c<r.length;){if(r[c]<=a[l].to&&r[c]>=a[l].from)h.push(r[c]),u.push(n[c]);else if(r[c]>a[l].to&&(l++,!a[l]))break;c++}return{x:h,y:u}}var qe={size:1,value:0};var _e=function(t,e){if(e=Object.assign({},qe,e),Array.isArray(t))return Array.isArray(t[0])?function(t,e){throw void 0===e.size[0]&&(e.size=[e.size,e.size,e.size,e.size]),new Error("matrix not supported yet, sorry")}(0,e):function(t,e){var r=t.length;"number"==typeof e.size&&(e.size=[e.size,e.size]);var n,o,i=r+e.size[0]+e.size[1];if(e.output){if(e.output.length!==i)throw new RangeError("Wrong output size");n=e.output}else n=new Array(i);if("circular"===e.value)for(o=0;o<i;o++)o<e.size[0]?n[o]=t[(r-e.size[0]%r+o)%r]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[(o-e.size[0])%r];else if("replicate"===e.value)for(o=0;o<i;o++)o<e.size[0]?n[o]=t[0]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[r-1];else if("symmetric"===e.value){if(e.size[0]>r||e.size[1]>r)throw new RangeError("expanded value should not be bigger than the data length");for(o=0;o<i;o++)o<e.size[0]?n[o]=t[e.size[0]-1-o]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[2*r+e.size[0]-o-1]}else for(o=0;o<i;o++)o<e.size[0]?n[o]=e.value:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=e.value;return n}(t,e);throw new TypeError("data should be an array")};function Le(t){let e=1;for(;t>0;)e*=t--;return e}function Ye(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{windowSize:n=5,derivative:o=1,polynomial:i=2,pad:s="none",padValue:a="replicate"}=r;if(n%2==0||n<5||!Number.isInteger(n))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(o<0||!Number.isInteger(o))throw new RangeError("Derivative should be a positive integer");if(i<1||!Number.isInteger(i))throw new RangeError("Polynomial should be a positive integer");let l,h,u=Math.floor(n/2);"pre"===s&&(t=_e(t,{size:u,value:a}));let c=new Array(t.length-2*u);if(5!==n||2!==i||1!==o&&2!==o){let t=qt.ones(n,i+1),e=-(n-1)/2;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e+1===0&&0===n||t.set(r,n,Math.pow(e+r,n));let r=new Lt(t);l=Gt(r.mmul(t)).mmul(r),l=l.getRow(o),h=1/Le(o)}else 1===o?(l=[-2,-1,0,1,2],h=10):(l=[2,-1,-2,-1,2],h=7);let f=h*Math.pow(e,o);for(let e=0;e<t.length-2*u;e++){let r=0;for(let n=0;n<l.length;n++)r+=l[n]*t[n+e]/f;c[e]=r}return"post"===s&&(c=_e(c,{size:u,value:a})),c}var We={};!function(t){function e(t,e){return t-e}t.sum=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e},t.max=function(t){for(var e=t[0],r=t.length,n=1;n<r;n++)t[n]>e&&(e=t[n]);return e},t.min=function(t){for(var e=t[0],r=t.length,n=1;n<r;n++)t[n]<e&&(e=t[n]);return e},t.minMax=function(t){for(var e=t[0],r=t[0],n=t.length,o=1;o<n;o++)t[o]<e&&(e=t[o]),t[o]>r&&(r=t[o]);return{min:e,max:r}},t.arithmeticMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=t[n];return e/r},t.mean=t.arithmeticMean,t.geometricMean=function(t){for(var e=1,r=t.length,n=0;n<r;n++)e*=t[n];return Math.pow(e,1/r)},t.logMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=Math.log(t[n]);return e/r},t.grandMean=function(t,e){for(var r=0,n=0,o=t.length,i=0;i<o;i++)r+=e[i]*t[i],n+=e[i];return r/n},t.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=[].concat(t).sort(e));for(var o=t.length,i=Math.floor(o*r),s=0,a=i;a<o-i;a++)s+=t[a];return s/(o-2*i)},t.harmonicMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");e+=1/t[n]}return r/e},t.contraHarmonicMean=function(t){for(var e=0,r=0,n=t.length,o=0;o<n;o++)e+=t[o]*t[o],r+=t[o];if(r<0)throw new RangeError("sum of values is negative");return e/r},t.median=function(t,r){void 0===r&&(r=!1),r||(t=[].concat(t).sort(e));var n=t.length,o=Math.floor(n/2);return n%2==0?.5*(t[o-1]+t[o]):t[o]},t.variance=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=e.length,s=0;s<i;s++){var a=e[s]-n;o+=a*a}return r?o/(i-1):o/i},t.standardDeviation=function(e,r){return Math.sqrt(t.variance(e,r))},t.standardError=function(e){return t.standardDeviation(e)/Math.sqrt(e.length)},t.robustMeanAndStdev=function(t){var r=0,n=t.length,o=0;for(o=0;o<n;o++)r+=t[o];r/=n;var i=new Array(n);for(o=0;o<n;o++)i[o]=Math.abs(t[o]-r);return i.sort(e),{mean:r,stdev:n%2==1?i[(n-1)/2]/.6745:.5*(i[n/2]+i[n/2-1])/.6745}},t.quartiles=function(r,n){void 0===n&&(n=!1),n||(r=[].concat(r).sort(e));var o=r.length/4;return{q1:r[Math.ceil(o)-1],q2:t.median(r,!0),q3:r[Math.ceil(3*o)-1]}},t.pooledStandardDeviation=function(e,r){return Math.sqrt(t.pooledVariance(e,r))},t.pooledVariance=function(e,r){void 0===r&&(r=!0);for(var n=0,o=0,i=e.length,s=0;s<i;s++){var a=e[s],l=t.variance(a);n+=(a.length-1)*l,o+=r?a.length-1:a.length}return n/o},t.mode=function(t){var e,r=t.length,n=new Array(r);for(e=0;e<r;e++)n[e]=0;var o=new Array(r),i=0;for(e=0;e<r;e++){var s=o.indexOf(t[e]);s>=0?n[s]++:(o[i]=t[e],n[i]=1,i++)}var a=0,l=0;for(e=0;e<i;e++)n[e]>a&&(a=n[e],l=e);return o[l]},t.covariance=function(e,r,n){void 0===n&&(n=!0);var o=t.mean(e),i=t.mean(r);if(e.length!==r.length)throw"Vectors do not have the same dimensions";for(var s=0,a=e.length,l=0;l<a;l++){s+=(e[l]-o)*(r[l]-i)}return n?s/(a-1):s/a},t.skewness=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=0,s=e.length,a=0;a<s;a++){var l=e[a]-n;o+=l*l,i+=l*l*l}var h=o/s,u=i/s/Math.pow(h,1.5);return r?Math.sqrt(s*(s-1))/(s-2)*u:u},t.kurtosis=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=e.length,i=0,s=0,a=0;a<o;a++){var l=e[a]-n;i+=l*l,s+=l*l*l*l}var h=i/o;if(r){var u=i/(o-1);return o*(o+1)/((o-1)*(o-2)*(o-3))*(s/(u*u))-3*((o-1)*(o-1)/((o-2)*(o-3)))}return s/o/(h*h)-3},t.entropy=function(t,e){void 0===e&&(e=0);for(var r=0,n=t.length,o=0;o<n;o++)r+=t[o]*Math.log(t[o]+e);return-r},t.weightedMean=function(t,e){for(var r=0,n=t.length,o=0;o<n;o++)r+=t[o]*e[o];return r},t.weightedStandardDeviation=function(e,r){return Math.sqrt(t.weightedVariance(e,r))},t.weightedVariance=function(e,r){for(var n=t.weightedMean(e,r),o=0,i=e.length,s=0,a=0,l=0;l<i;l++){var h=e[l]-n,u=r[l];o+=u*(h*h),a+=u,s+=u*u}return o*(a/(a*a-s))},t.center=function(e,r){void 0===r&&(r=!1);var n=e;r||(n=[].concat(e));for(var o=t.mean(n),i=n.length,s=0;s<i;s++)n[s]-=o},t.standardize=function(e,r,n){void 0===r&&(r=t.standardDeviation(e)),void 0===n&&(n=!1);for(var o=e.length,i=n?e:new Array(o),s=0;s<o;s++)i[s]=e[s]/r;return i},t.cumulativeSum=function(t){var e=t.length,r=new Array(e);r[0]=t[0];for(var n=1;n<e;n++)r[n]=r[n-1]+t[n];return r}}(We);var Be=We;function He(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;let n={x:t.variables.x.data,y:t.variables.y.data},o={variables:{x:{data:t.variables.x.data,units:t.variables.x.units,label:t.variables.x.label},y:{data:t.variables.y.data,units:t.variables.y.units,label:t.variables.y.label}}};t.title&&(o.title=t.title),t.dataType&&(o.dataType=t.dataType),t.meta&&(o.meta=t.meta);let{from:i=t.variables.x.min,to:h=t.variables.x.max,numberOfPoints:u,filters:c=[],exclusions:m=[],processing:g="",keepYUnits:y=!1}=e,{x:v,y:x}=Xe(n,{from:i,to:h});switch(g){case"Smoothing":e.processing&&(x=Ye(x,1,{derivative:0,polynomial:3,windowSize:5,pad:"post",padValue:"replicate"}),v=v.slice(2,v.length-2));break;case"firstDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`1st derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Ye(x,1,{derivative:1,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2));break;case"secondDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`2nd derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Ye(x,1,{derivative:2,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2));break;case"thirdDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`3rd derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Ye(x,1,{derivative:3,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2))}!y&&c.length&&(o.variables.y.units="",o.variables.y.label=null===(r=o.variables.y.label)||void 0===r?void 0:r.replace(/\s*\[.*\]/,""));for(let t of c){let e=t.options||{};switch(t.name.toLowerCase()){case"centermean":x=w(x,Be.mean(x));break;case"dividebysd":x=l(x,Be.standardDeviation(x));break;case"normalize":x=ze(x,{sumValue:e.value?Number(e.value):1,algorithm:"absolute"});break;case"rescale":x=At(x,{min:e.min?Number(e.min):0,max:e.max?Number(e.max):1});break;case"dividebymax":x=l(x,d(x));break;case"multiply":x=a(x,e.value?Number(e.value):1);break;case"add":x=s(x,e.value?Number(e.value):0);break;case"airplsbaseline":x=we(x,e).correctedSpectrum;break;case"rollingaveragebaseline":x=Ne(x,e).correctedSpectrum;break;case"iterativepolynomialbaseline":x=Me(x,void 0,e).correctedSpectrum;break;case"rollingballbaseline":x=Re(x,e).correctedSpectrum;break;case"rollingmedianbaseline":x=Ie(x,e).correctedSpectrum;break;case"ensuregrowing":{const t=b({x:v,y:x});v=t.x,x=t.y;break}case"":case void 0:break;default:throw new Error(`Unknown process kind: ${t.name}`)}}return n=u?Ve({x:v,y:x},{from:i,to:h,numberOfPoints:u,exclusions:m}):Xe({x:v,y:x},{from:i,to:h,exclusions:m}),o.variables.x.data=v,o.variables.x.min=p(v),o.variables.x.max=d(v),o.variables.x.isMonotone=f(v),o.variables.y.data=x,o.variables.y.min=p(x),o.variables.y.max=d(x),o.variables.y.isMonotone=f(x),o}var Ke={exports:{}};!function(t,e){t.exports=function(){function t(t){return"string"==typeof t||t instanceof String}var e=Number.isFinite||window.isFinite;function r(t){return e(t)}function n(t){return t}function o(t){var e={};return t.filter((function(t){return!e.hasOwnProperty(t)&&(e[t]=!0)}))}function i(t,e){if(e.length!==t.length)return!1;for(var r=0;r<t.length;r++){if(e[r].compareArray&&!e[r].compareArray(t[r]))return!1;if(e[r]!==t[r])return!1}return!0}function s(t,e){Object.keys(e).forEach((function(r){t[r]=e[r]}))}function a(){for(var t=1,e=0,r=0;r<arguments.length;r++){var n=arguments[r];e+=u(n),t*=n}return 0!==e?h(t,e):t}function l(t,e){if(0===e)throw new Error("Divide by zero");var r=Math.pow(10,u(e));return a(t,r/(r*e))}function h(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function u(t){if(!isFinite(t))return 0;for(var e=0;t%1!=0;)t*=10,e++;return e}function c(){var t;if(!this)return t=Object.create(c.prototype),c.apply(t,arguments),t;t=Error.apply(this,arguments),this.name="QtyError",this.message=t.message,this.stack=t.stack}function f(t,e){throw new c("Incompatible units: "+t+" and "+e)}c.prototype=Object.create(Error.prototype,{constructor:{value:c}});var m={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],86400,"time",["<second>"]],"<week>":[["wk","week","weeks"],604800,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},g=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],p="<1>",d=[p];function w(t,e){var n=e[1],o=e[3]||[],i=e[4]||[];if(!r(n))throw new c(t+": Invalid unit definition. 'scalar' must be a number");o.forEach((function(e){if(void 0===m[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'numerator' is not recognized")})),i.forEach((function(e){if(void 0===m[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'denominator' is not recognized")}))}var y={},b={},v={},x={},M={};for(var E in m)if(m.hasOwnProperty(E)){var A=m[E];if("prefix"===A[2]){y[E]=A[1];for(var S=0;S<A[0].length;S++)b[A[0][S]]=E}else{w(E,A),v[E]={scalar:A[1],numerator:A[3],denominator:A[4]};for(var T=0;T<A[0].length;T++)x[A[0][T]]=E}M[E]=A[0][0]}function k(t){var e,r=[],n=Object.keys(m);if(void 0===t)for(e=0;e<n.length;e++)-1===["","prefix"].indexOf(m[n[e]][2])&&r.push(n[e].substr(1,n[e].length-2));else{if(-1===this.getKinds().indexOf(t))throw new c("Kind not recognized");for(e=0;e<n.length;e++)m[n[e]][2]===t&&r.push(n[e].substr(1,n[e].length-2))}return r.sort((function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}))}function N(t){if(!x[t])throw new c("Unit not recognized");return m[x[t]][0]}var F=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function R(){if(this.signature)return this.signature;for(var t=I.call(this),e=0;e<t.length;e++)t[e]*=Math.pow(20,e);return t.reduce((function(t,e){return t+e}),0)}function I(){if(!this.isBase())return I.call(this.toBase());for(var t,e,r=new Array(F.length),n=0;n<r.length;n++)r[n]=0;for(var o=0;o<this.numerator.length;o++)(t=m[this.numerator[o]])&&(e=F.indexOf(t[2]))>=0&&(r[e]=r[e]+1);for(var i=0;i<this.denominator.length;i++)(t=m[this.denominator[i]])&&(e=F.indexOf(t[2]))>=0&&(r[e]=r[e]-1);return r}var z="[+-]",C="\\d+",O="\\."+C,$=new RegExp("^("+z+"?\\s*(?:(?:"+C+"(?:"+O+")?)|(?:"+O+"))(?:[Ee]"+z+"?"+C+")?)?\\s*([^/]*)(?:/(.+))?$"),D="\\^|\\*{2}",P="[01234]",V=new RegExp("([^ \\*\\d]+?)(?:"+D+")?(-?"+P+"(?![a-zA-Z]))"),U=new RegExp("([^ \\*\\d]+?)(?:"+D+")?("+P+"(?![a-zA-Z]))");function j(e){t(e)||(e=e.toString()),e=e.trim();var r=$.exec(e);if(!r)throw new c(e+": Quantity not recognized");var n=r[1];n?(n=n.replace(/\s/g,""),this.scalar=parseFloat(n)):this.scalar=1;for(var o,i,s,a=r[2],l=r[3];r=V.exec(a);){if(o=parseFloat(r[2]),isNaN(o))throw new c("Unit exponent is not a number");if(0===o&&!L.test(r[1]))throw new c("Unit not recognized");i=r[1]+" ",s="";for(var h=0;h<Math.abs(o);h++)s+=i;o>=0?a=a.replace(r[0],s):(l=l?l+s:s,a=a.replace(r[0],""))}for(;r=U.exec(l);){if(o=parseFloat(r[2]),isNaN(o))throw new c("Unit exponent is not a number");if(0===o&&!L.test(r[1]))throw new c("Unit not recognized");i=r[1]+" ",s="";for(var u=0;u<o;u++)s+=i;l=l.replace(r[0],s)}a&&(this.numerator=B(a.trim())),l&&(this.denominator=B(l.trim()))}var X=Object.keys(b).sort((function(t,e){return e.length-t.length})).join("|"),q=Object.keys(x).sort((function(t,e){return e.length-t.length})).join("|"),_="("+X+")??("+q+")(?:\\b|$)",L=new RegExp("^\\s*("+_+"[\\s\\*]*)+$"),Y=new RegExp(_,"g"),W={};function B(t){var e=W[t];if(e)return e;var r,n=[];if(!L.test(t))throw new c("Unit not recognized");for(;r=Y.exec(t);)n.push(r.slice(1));return n=(n=(n=n.map((function(t){return b[t[0]]?[b[t[0]],x[t[1]]]:[x[t[1]]]}))).reduce((function(t,e){return t.concat(e)}),[])).filter((function(t){return t})),W[t]=n,n}function H(e){if(!t(e))throw new c("Argument should be a string");try{return this(e)}catch(t){return null}}function K(t){return t instanceof G}function G(t,e){if(J.apply(null,arguments),!K(this))return new G(t,e);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=d,this.denominator=d,Z(t)?(this.scalar=t.scalar,this.numerator=t.numerator&&0!==t.numerator.length?t.numerator:d,this.denominator=t.denominator&&0!==t.denominator.length?t.denominator:d):e?(j.call(this,e),this.scalar=t):j.call(this,t),this.denominator.join("*").indexOf("temp")>=0)throw new c("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new c("Cannot multiply by temperatures");if(!i(this.denominator,d))throw new c("Cannot divide with temperatures")}if(this.initValue=t,Q.call(this),this.isTemperature()&&this.baseScalar<0)throw new c("Temperatures must not be less than absolute zero")}function J(e,n){if(n){if(!r(e)||!t(n))throw new c("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(e)||r(e)||K(e)||Z(e)))throw new c("Only string, number or quantity accepted as single initialization value")}function Z(t){return t&&"object"==typeof t&&t.hasOwnProperty("scalar")}function Q(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=R.call(this);else{var t=this.toBase();this.baseScalar=t.scalar,this.signature=t.signature}}G.prototype={constructor:G};var tt={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency",25599999980:"information_rate",256e8:"information",511999999980:"angular_velocity",512e9:"angle"};function et(){return o(Object.keys(tt).map((function(t){return tt[t]})))}function rt(t,e){var r=t.units(),n=e.to(r),o=G(it(r));return G({scalar:t.scalar-n.scalar,numerator:o.numerator,denominator:o.denominator})}function nt(t,e){var r=e.to(it(t.units()));return G({scalar:t.scalar-r.scalar,numerator:t.numerator,denominator:t.denominator})}function ot(t,e){var r=e.to(it(t.units()));return G({scalar:t.scalar+r.scalar,numerator:t.numerator,denominator:t.denominator})}function it(t){if("tempK"===t)return"degK";if("tempC"===t)return"degC";if("tempF"===t)return"degF";if("tempR"===t)return"degR";throw new c("Unknown type for temp conversion from: "+t)}function st(t,e){var r,n=at(t),o=e.units();if("degK"===o)r=n.scalar;else if("degC"===o)r=n.scalar;else if("degF"===o)r=9*n.scalar/5;else{if("degR"!==o)throw new c("Unknown type for degree conversion to: "+o);r=9*n.scalar/5}return G({scalar:r,numerator:e.numerator,denominator:e.denominator})}function at(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar;else if("tempF"===r)e=5*t.scalar/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return G({scalar:e,numerator:["<kelvin>"],denominator:d})}function lt(t,e){var r,n=e.units();if("tempK"===n)r=t.baseScalar;else if("tempC"===n)r=t.baseScalar-273.15;else if("tempF"===n)r=9*t.baseScalar/5-459.67;else{if("tempR"!==n)throw new c("Unknown type for temp conversion to: "+n);r=9*t.baseScalar/5}return G({scalar:r,numerator:e.numerator,denominator:e.denominator})}function ht(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar+273.15;else if("tempF"===r)e=5*(t.scalar+459.67)/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return G({scalar:e,numerator:["<temp-K>"],denominator:d})}function ut(t,e){var r,o=G(t),i=G(e);return o.eq(i)?n:(r=o.isTemperature()?function(t){return o.mul(t).to(i).scalar}:function(t){return t*o.baseScalar/i.baseScalar},function(t){var e,n,o;if(Array.isArray(t)){for(n=t.length,o=[],e=0;e<n;e++)o.push(r(t[e]));return o}return r(t)})}G.prototype.kind=function(){return tt[this.signature.toString()]},s(G.prototype,{isDegrees:function(){return(null===this.signature||400===this.signature)&&1===this.numerator.length&&i(this.denominator,d)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}}),s(G.prototype,{to:function(e){var r,n;return null==e?this:t(e)?(r=this._conversionCache[e])?r:(n=G(e)).units()===this.units()?this:(this.isCompatible(n)?n=n.isTemperature()?lt(this,n):n.isDegrees()?st(this,n):G({scalar:l(this.baseScalar,n.baseScalar),numerator:n.numerator,denominator:n.denominator}):this.isInverse(n)?n=this.inverse().to(e):f(this.units(),n.units()),this._conversionCache[e]=n,n):this.to(e.units())},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return ht(this);var t=ct[this.units()];return t||(t=ft(this.numerator,this.denominator),ct[this.units()]=t),t.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new c("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(e){if(t(e)&&(e=G(e)),r(e)&&(e=G(e+" "+this.units())),this.isUnitless()?e.isUnitless()||f(this.units(),e.units()):e=e.to(this.units()),0===e.scalar)throw new c("Divide by zero");return G(a(Math.round(this.scalar/e.scalar),e.scalar)+this.units())}});var ct={};function ft(t,e){for(var r,n=[],o=[],i=1,s=0;s<t.length;s++)r=t[s],y[r]?i=a(i,y[r]):v[r]&&(i*=v[r].scalar,v[r].numerator&&n.push(v[r].numerator),v[r].denominator&&o.push(v[r].denominator));for(var l=0;l<e.length;l++)r=e[l],y[r]?i/=y[r]:v[r]&&(i/=v[r].scalar,v[r].numerator&&o.push(v[r].numerator),v[r].denominator&&n.push(v[r].denominator));return G({scalar:i,numerator:n=n.reduce((function(t,e){return t.concat(e)}),[]),denominator:o=o.reduce((function(t,e){return t.concat(e)}),[])})}function mt(t,e,r,n){function o(t){return t!==p}t=t.filter(o),r=r.filter(o),e=e.filter(o),n=n.filter(o);var i={};function s(t,e){for(var r,n,o,s=0;s<t.length;s++)if(y[t[s]]?(r=t[s+1],n=t[s],o=y[n],s++):(r=t[s],n=null,o=1),r&&r!==p)if(i[r]){i[r][0]+=e;var a=i[r][2]?y[i[r][2]]:1;i[r][1===e?3:4]*=l(o,a)}else i[r]=[e,r,n,1,1]}s(t,1),s(e,-1),s(r,1),s(n,-1);var a=[],h=[],u=1;for(var c in i)if(i.hasOwnProperty(c)){var f,m=i[c];if(m[0]>0)for(f=0;f<m[0];f++)a.push(null===m[2]?m[1]:[m[2],m[1]]);else if(m[0]<0)for(f=0;f<-m[0];f++)h.push(null===m[2]?m[1]:[m[2],m[1]]);u*=l(m[3],m[4])}return 0===a.length&&(a=d),0===h.length&&(h=d),[a=a.reduce((function(t,e){return t.concat(e)}),[]),h=h.reduce((function(t,e){return t.concat(e)}),[]),u]}function gt(){}function pt(t,e){return(t+" "+e).trim()}G.parse=H,G.getUnits=k,G.getAliases=N,G.mulSafe=a,G.divSafe=l,G.getKinds=et,G.swiftConverter=ut,G.Error=c,s(G.prototype,{add:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||f(this.units(),e.units()),this.isTemperature()&&e.isTemperature())throw new c("Cannot add two temperatures");return this.isTemperature()?ot(this,e):e.isTemperature()?ot(e,this):G({scalar:this.scalar+e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||f(this.units(),e.units()),this.isTemperature()&&e.isTemperature())return rt(this,e);if(this.isTemperature())return nt(this,e);if(e.isTemperature())throw new c("Cannot subtract a temperature from a differential degree unit");return G({scalar:this.scalar-e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(e){if(r(e))return G({scalar:a(this.scalar,e),numerator:this.numerator,denominator:this.denominator});if(t(e)&&(e=G(e)),(this.isTemperature()||e.isTemperature())&&!this.isUnitless()&&!e.isUnitless())throw new c("Cannot multiply by temperatures");var n=this,o=e;n.isCompatible(o)&&400!==n.signature&&(o=o.to(n));var i=mt(n.numerator,n.denominator,o.numerator,o.denominator);return G({scalar:a(n.scalar,o.scalar,i[2]),numerator:i[0],denominator:i[1]})},div:function(e){if(r(e)){if(0===e)throw new c("Divide by zero");return G({scalar:this.scalar/e,numerator:this.numerator,denominator:this.denominator})}if(t(e)&&(e=G(e)),0===e.scalar)throw new c("Divide by zero");if(e.isTemperature())throw new c("Cannot divide with temperatures");if(this.isTemperature()&&!e.isUnitless())throw new c("Cannot divide with temperatures");var n=this,o=e;n.isCompatible(o)&&400!==n.signature&&(o=o.to(n));var i=mt(n.numerator,n.denominator,o.denominator,o.numerator);return G({scalar:a(n.scalar,i[2])/o.scalar,numerator:i[0],denominator:i[1]})},inverse:function(){if(this.isTemperature())throw new c("Cannot divide with temperatures");if(0===this.scalar)throw new c("Divide by zero");return G({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}}),s(G.prototype,{eq:function(t){return 0===this.compareTo(t)},lt:function(t){return-1===this.compareTo(t)},lte:function(t){return this.eq(t)||this.lt(t)},gt:function(t){return 1===this.compareTo(t)},gte:function(t){return this.eq(t)||this.gt(t)},compareTo:function(e){return t(e)?this.compareTo(G(e)):(this.isCompatible(e)||f(this.units(),e.units()),this.baseScalar<e.baseScalar?-1:this.baseScalar===e.baseScalar?0:this.baseScalar>e.baseScalar?1:void 0)},same:function(t){return this.scalar===t.scalar&&this.units()===t.units()}}),s(G.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every((function(t){return i(t,d)}))},isCompatible:function(e){return t(e)?this.isCompatible(G(e)):!!K(e)&&void 0!==e.signature&&this.signature===e.signature},isInverse:function(t){return this.inverse().isCompatible(t)},isBase:function(){return void 0!==this._isBase?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach((function(t){t!==p&&-1===g.indexOf(t)&&(this._isBase=!1)}),this),!1===this._isBase||(this._isBase=!0),this._isBase)}}),gt.prototype.get=function(t){return arguments.length>1&&(t=Array.apply(null,arguments)),t.reduce((function(e,r,n){if(e){var o=e[r];return n===t.length-1?o?o.data:void 0:o}}),this)},gt.prototype.set=function(t,e){return arguments.length>2&&(t=Array.prototype.slice.call(arguments,0,-1),e=arguments[arguments.length-1]),t.reduce((function(r,n,o){var i=r[n];return void 0===i&&(i=r[n]={}),o===t.length-1?(i.data=e,e):i}),this)},G.formatter=pt,s(G.prototype,{units:function(){if(void 0!==this._units)return this._units;var t=i(this.numerator,d),e=i(this.denominator,d);if(t&&e)return this._units="",this._units;var r=wt(this.numerator),n=wt(this.denominator);return this._units=r+(e?"":"/"+n),this._units},toString:function(e,n){var o;if(r(e))o=this.units(),n=e;else if(t(e))o=e;else if(K(e))return this.toPrec(e).toString(n);var i=this.to(o);return i=((void 0!==n?h(i.scalar,n):i.scalar)+" "+i.units()).trim()},format:function(t,e){1===arguments.length&&"function"==typeof t&&(e=t,t=void 0),e=e||G.formatter;var r=this.to(t);return e.call(this,r.scalar,r.units())}});var dt=new gt;function wt(t){var e=dt.get(t);return e||(e=i(t,d)?"1":bt(yt(t)).join("*"),dt.set(t,e),e)}function yt(t){for(var e,r,n=[],o=0;o<t.length;o++)e=t[o],r=t[o+1],y[e]?(n.push(M[e]+M[r]),o++):n.push(M[e]);return n}function bt(t){return t.reduce((function(t,e){var r=t[e];return r||t.push(r=t[e]=[e,0]),r[1]++,t}),[]).map((function(t){return t[0]+(t[1]>1?t[1]:"")}))}return G.version="1.7.6",G}()}(Ke);var Ge=Ke.exports;function Je(t,e,r){if((e=Ze(e))===(r=Ze(r)))return t;try{return Ge.swiftConverter(e,r)(t)}catch(t){return}}function Ze(t){return t=(t=(t=t.replace(/°C/g,"tempC")).replace(/°F/g,"tempF")).replace(/(^|\W)K(\W|$)/g,"$1tempK$2")}const Qe=/^\/((?:\\\/|[^/])+)\/([migyu]{0,5})?$/;function tr(t){if("string"!=typeof t)return t;const e=Qe.exec(t);if(!e)return er(t);try{return new RegExp(e[1],e[2])}catch(e){return er(t)}}function er(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i";return new RegExp(t.replace(/[[\]\\{}()+*?.$^|]/g,(t=>`\\${t}`)),e)}function rr(t,e){const r=void 0!==t.units&&t.units!==e?Je(Array.from(t.data),t.units,e):t.data;return{units:e,label:t.label.replace(`[${t.units||""}]`,`[${e}]`),data:r||[],min:r?p(r):void 0,max:r?d(r):void 0,isMonotone:f(r)}}function nr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n;const{units:o,label:i,variableName:s}=e;let a,l={...t};if(void 0!==o)for(a in l){const e=t[a];Je(1,(null==e?void 0:e.units)||"",o)&&e?l[a]=rr(e,o):delete l[a]}if(void 0!==i){const e=tr(i);for(a in l)e.exec(null!==(n=null===(r=t[a])||void 0===r?void 0:r.label)&&void 0!==n?n:"")||delete l[a]}if(void 0!==s){if(l[s])return l[s];const t=s.toUpperCase();if(Object.prototype.hasOwnProperty.call(l,t))return l[t];const e=s.toLowerCase();if(Object.prototype.hasOwnProperty.call(l,e))return l[e]}const h=Object.values(l).filter((t=>void 0!==t));if(h.length>0)return h[0]}class or{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.id=t.id||Math.random().toString(36).substring(2,10),this.label=t.label||this.id,this.spectrumCallback=t.spectrumCallback,this.spectra=[],this.cache={}}pushSpectrum(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.spectra.push(function(t,e,n){let{meta:o={},dataType:i="",title:s=""}=e;const{spectrumCallback:a}=n;a&&a(t);let l=t.x,h=t.y;if(!l||!h)throw Error("A spectrum must contain at least x and y variables");if(!r(l.data)||!r(h.data))throw Error("x and y variables must contain an array data");let u=l.data,c=u&&u.length>1&&u[0]>u[u.length-1];for(let[e,r]of Object.entries(t)){if(c&&(r.data=r.data.reverse()),r.label=r.label||e,r.label.match(/^.*[([](?<units>.*)[)\]].*$/)){const t=r.label.replace(/^.*[([](?<units>.*)[)\]].*$/,"$<units>");r.units&&r.units!==t||(r.units=t,r.label=r.label.replace(/[([].*[)\]]/,"").trim())}r.min=p(r.data),r.max=d(r.data),r.isMonotone=f(r.data)}return{variables:t,title:s,dataType:i,meta:o}}(t,e,{spectrumCallback:this.spectrumCallback})),this.cache={}}getXYSpectrum(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.stringify(t);return this.cache[e]||(this.cache[e]=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.length<1)return;let{dataType:r,title:n,xUnits:o,yUnits:i,variables:s,xVariable:a="x",yVariable:l="y",units:h,labels:u,xLabel:c,yLabel:f,meta:m,index:g}=e;if(void 0!==g)return t[g];if(r&&(r=tr(r)),n&&(n=tr(n)),!h||o||i||([i,o]=h.split(/\s*vs\s*/)),!u||c||f||([f,c]=u.split(/\s*vs\s*/)),s){const t=s.split(/\s*vs\s*/);2===t.length&&(a=t[1],l=t[0])}c&&(c=tr(c)),f&&(f=tr(f));for(let e of t){if(!(Object.keys(e.variables).length>1))continue;if(r&&(!e.dataType||!r.exec(e.dataType)))continue;if(n&&(!e.title||!n.exec(e.title)))continue;if(m&&"object"==typeof m){if(!e.meta)continue;for(let t in e.meta)e.meta[t]&&tr(e.meta[t]).exec(e.meta[t])}let t=nr(e.variables,{units:o,label:c,variableName:a}),s=nr(e.variables,{units:i,label:f,variableName:l});if(t&&s)return{title:e.title,dataType:e.dataType,meta:e.meta,variables:{x:t,y:s}}}}(this.spectra,t)),this.cache[e]}getXY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getXYSpectrum(t);if(e)return{x:e.variables.x.data,y:e.variables.y.data}}getNormalizedSpectrum(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{normalization:e,selector:r}=t,n=this.getXYSpectrum(r);if(n)return He(n,e)}getSpectrum(){return this.spectra[0]}getXLabel(t){var e;return null===(e=this.getXYSpectrum(t))||void 0===e?void 0:e.variables.x.label}getYLabel(t){var e;return null===(e=this.getXYSpectrum(t))||void 0===e?void 0:e.variables.y.label}}function ir(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t)return t;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer){const{encoding:r=sr(t)}=e;return new TextDecoder(r).decode(t)}throw new TypeError("blob must be a string, ArrayBuffer or ArrayBufferView")}function sr(t){const e=ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t);if(e.length>=2){if(254===e[0]&&255===e[1])return"utf-16be";if(255===e[0]&&254===e[1])return"utf-16le"}return"utf-8"}function ar(t){if(4===t.length||5===t.length){let e=t.toLowerCase();if("true"===e)return!0;if("false"===e)return!1}let e=Number(t);return 0!==e||t.includes("0")?Number.isNaN(e)?t:e:t}const lr=["TIC",".RIC","SCANNUMBER"];function hr(t){let e=t.spectra,r=e.length,n={times:new Array(r),series:{ms:{dimension:2,data:new Array(r)}}},o=[];for(let t=0;t<lr.length;t++){let i=cr(lr[t]);e[0][i]&&(o.push(i),n.series[i]={dimension:1,data:new Array(r)})}for(let t=0;t<r;t++){let r=e[t];n.times[t]=r.pageValue;for(let e=0;e<o.length;e++)n.series[o[e]].data[t]=Number(r[o[e]]);r.data&&(n.series.ms.data[t]=[r.data.x,r.data.y])}t.chromatogram=n}function ur(t){return-1!==lr.indexOf(t)}function cr(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function fr(t){let e=[];for(let r=0;r<t.length;r++)e.push(Number(t[r]));return e}function mr(t,e){let r=t.yFactor,n=t.deltaX;t.isXYdata=!0;let o={x:[],y:[]};t.data=o;let i,s=t.firstX,a=t.firstY,l=!1,h=0;for(;h<e.length;h++)if(i=e.charCodeAt(h),13===i||10===i)l=!0;else if(l)break;let u=!0,c=!1,f=!1,m=0,g=!1,p=!1,d=0,w=0,y=!1,b=!1,v=!1,x=0;for(;h<=e.length;h++)if(i=h===e.length?13:e.charCodeAt(h),p)13!==i&&10!==i||(u=!0,p=!1);else if(i<=57&&i>=48)b=!0,x>0?d+=(i-48)/Math.pow(10,x++):(d*=10,d+=i-48);else if(44===i||46===i)b=!0,x++;else{if(b){if(u)u=!1,f&&(v=!0);else if(v)v=!1;else{c?(m=y?0-d:d,f=!0,c=!1):g||(w=y?0-d:d);let t=g?d-1:1;for(let e=0;e<t;e++)f?a+=m:a=w,o.x.push(s),o.y.push(a*r),s+=n}y=!1,d=0,x=0,b=!1,g=!1}if(i<74&&i>63)b=!0,f=!1,d=i-64;else if(i>96&&i<106)b=!0,f=!1,d=i-96,y=!0;else if(115===i)b=!0,g=!0,d=9;else if(i>82&&i<91)b=!0,g=!0,d=i-82;else if(i>73&&i<83)b=!0,c=!0,d=i-73;else if(i>105&&i<115)b=!0,c=!0,d=i-105,y=!0;else if(36===i&&36===e.charCodeAt(h+1))b=!0,p=!0;else if(37===i)b=!0,c=!0,d=0,y=!1;else if(45===i){let t=e.charCodeAt(h+1);(t>=48&&t<=57||44===t||46===t)&&(b=!0,u||(f=!1),y=!0)}else 13!==i&&10!==i||(u=!0,p=!1)}}const gr=/\$\$.*/,pr=/[,\t ]+/;function dr(t,e,r){if(t.isPeaktable=!0,t.variables&&2!==Object.keys(t.variables)?function(t,e,r){let n={},o=Object.keys(t.variables),i=o.length;o.forEach((t=>n[t]=[])),t.data=n;let s=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++){let e=s[t].trim().replace(gr,"").split(pr);if(e.length%i==0)for(let t=0;t<e.length;t++)n[o[t%i]].push(Number(e[t]));else r.logs.push(`Format error: ${e}`)}}(t,e,r):function(t,e,r){let n={x:[],y:[]};t.data=n;let o=e.split(/,? *,?[;\r\n]+ */);for(let e=1;e<o.length;e++){let i=o[e].trim().replace(gr,"").split(pr);if(i.length%2==0)for(let e=0;e<i.length;e+=2)n.x.push(Number(i[e])*t.xFactor),n.y.push(Number(i[e+1])*t.yFactor);else r.logs.push(`Format error: ${i}`)}}(t,e,r),t.variables)for(let e in t.variables)t.variables[e].data=t.data[e]}function wr(t,e){let r,n=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;let o={x:[],y:[]};t.data=o;let i=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<i.length;t++)r=i[t].trim().replace(n,"").split(","),o.x.push(Number(r[0])),o.y.push(Number(r[1]))}function yr(t,e){let r=function(t){let e=t[0].data.y[0],r=e,n=t.length,o=t[0].data.x.length,s=new Array(n);for(let i=0;i<n;i++){s[i]=t[i].data.y;for(let t=0;t<o;t++){let n=s[i][t];n<e&&(e=n),n>r&&(r=n)}}const a=t[0].data.x[0],l=t[0].data.x[t[0].data.x.length-1],h=t[0].pageValue,u=t[n-1].pageValue;if(a>l)for(let t of s)t.reverse();h>u&&s.reverse();const c=[];for(let t=0;t<s.length;t++){const e=Float64Array.from(s[t]);for(let t=0;t<e.length;t++)e[t]<0&&(e[t]=-e[t]);c.push(i(e))}const f=i(c);return{z:s,minX:Math.min(a,l),maxX:Math.max(a,l),minY:Math.min(h,u),maxY:Math.max(h,u),minZ:e,maxZ:r,noise:f}}(t.spectra);e.noContour||(t.contourLines=function(t,e){let r,n,o,i,s,a,l,h,u,c,f,m,g,p=t.noise,d=t.z,w=d.length,y=d[0].length,b=t.minX,v=(t.maxX-b)/(y-1),x=t.minY,M=(t.maxY-x)/(w-1),E=t.minZ,A=t.maxZ,S=2*e.nbContourLevels,T=new Array(S);for(let t=0;t<S;t++){let S={};T[t]=S;let k=t%2,N=(A-e.noiseMultiplier*p)*Math.exp((t>>1)-e.nbContourLevels);g=0===k?N+e.noiseMultiplier*p:0-N-e.noiseMultiplier*p;let F=[];if(S.zValue=g,S.lines=F,!(g<=E||g>=A))for(let t=0;t<w-1;t++){let e=d[t],p=d[t+1];for(let d=0;d<y-1;d++)r=e[d],n=e[d+1],o=p[d],i=p[d+1],s=r>g,a=n>g,l=o>g,h=i>g,s!==a&&s!==l&&(u=d+(g-r)/(n-r),c=t,f=d,m=t+(g-r)/(o-r),F.push(u*v+b),F.push(c*M+x),F.push(f*v+b),F.push(m*M+x)),h!==a&&h!==l&&(u=d+1,c=t+1-(g-i)/(n-i),f=d+1-(g-i)/(o-i),m=t+1,F.push(u*v+b),F.push(c*M+x),F.push(f*v+b),F.push(m*M+x)),a!==l&&(u=(d+1-(g-n)/(o-n))*v+b,c=(t+(g-n)/(o-n))*M+x,a!==s&&(f=d+1-(g-n)/(r-n),m=t,F.push(u),F.push(c),F.push(f*v+b),F.push(m*M+x)),l!==s&&(f=d,m=t+1-(g-o)/(r-o),F.push(u),F.push(c),F.push(f*v+b),F.push(m*M+x)),a!==h&&(f=d+1,m=t+(g-n)/(i-n),F.push(u),F.push(c),F.push(f*v+b),F.push(m*M+x)),l!==h&&(f=d+(g-o)/(i-o),m=t+1,F.push(u),F.push(c),F.push(f*v+b),F.push(m*M+x)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:T}}(r,e),delete r.z),t.minMax=r}const br={"1H":267522187.44,"2H":41065e3,"3H":285350800,"3He":-203789e3,"7Li":103962e3,"13C":67282840,"14N":19331e3,"15N":-27116e3,"17O":-36264e3,"19F":251662e3,"23Na":70761e3,"27Al":69763e3,"29Si":-5319e4,"31P":108291e3,"57Fe":8681e3,"63Cu":71118e3,"67Zn":16767e3,"129Xe":-73997e3};function vr(t,e,r){t.profiling&&t.profiling.push({action:e,time:Date.now()-r.start})}function xr(t){let e=t.spectra[0].data;t.chromatogram={times:e.x.slice(),series:{intensity:{dimension:1,data:e.y.slice()}}}}function Mr(t,e,r){!function(t){for(let e of t){let t=0,r=0;for(let n of e.spectra){if(e.ntuples&&e.ntuples.symbol?(!t&&n.observeFrequency&&(t=n.observeFrequency),!r&&n.shiftOffsetVal&&(r=n.shiftOffsetVal)):(t=n.observeFrequency,r=n.shiftOffsetVal),t&&n.xUnits&&n.xUnits.toUpperCase().includes("HZ")){n.xUnits="PPM",n.xFactor=n.xFactor/t,n.firstX=n.firstX/t,n.lastX=n.lastX/t,n.deltaX=n.deltaX/t;for(let e=0;e<n.data.x.length;e++)n.data.x[e]/=t}if(r){let t=n.firstX-r;n.firstX=n.firstX-t,n.lastX=n.lastX-t;for(let e=0;e<n.data.x.length;e++)n.data.x[e]-=t}if(e.ntuples&&e.ntuples.nucleus&&e.ntuples.symbol)for(let t=0;t<e.ntuples.nucleus.length;t++){let r=e.ntuples.symbol[t],n=e.ntuples.nucleus[t];if(r.startsWith("F")&&!n){if("F1"===r)if(e.tmp.$NUC2)e.ntuples.nucleus[t]=e.tmp.$NUC2;else{let r=e.ntuples.symbol.indexOf("F2");r&&e.ntuples.nucleus[r]&&(e.ntuples.nucleus[t]=e.ntuples.nucleus[r])}"F2"===r&&(e.ntuples.nucleus[t]=e.tmp.$NUC1)}"F2"===r&&(e.yType=e.ntuples.nucleus[0])}if(t&&e.ntuples&&e.ntuples.symbol&&e.ntuples.nucleus){let r="",o=e.ntuples.symbol.indexOf(n.pageSymbol);if(e.ntuples.units&&e.ntuples.units[o]&&(r=e.ntuples.units[o]),"PPM"!==r){if(0!==o)throw Error("Not sure about this ntuples format");let r=br[e.ntuples.nucleus[0]],i=br[e.ntuples.nucleus[1]];if(!r||!i)throw Error("Problem with determination of gyromagnetic ratio");let s=r/i*t;n.pageValue/=s}}}}}(t);for(let n of t){if(Object.keys(n.ntuples).length>0){let t=[],e=Object.keys(n.ntuples);for(let r=0;r<e.length;r++){let o=e[r],i=n.ntuples[o];for(let e=0;e<i.length;e++)t[e]||(t[e]={}),t[e][o]=i[e]}n.ntuples=t}n.twoD&&r.wantXY&&(yr(n,r),vr(e,"Finished countour plot calculation",r),r.keepSpectra||delete n.spectra),r.chromatogram&&(n.spectra.length>1?hr(n):xr(n),vr(e,"Finished chromatogram calculation",r)),delete n.tmp}}function Er(t,e,r){let n=-1,o=-1,i="",s="";if(r.indexOf("++")>0)i=r.replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),s=r.replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");else{i=(r=r.replace(/[^a-zA-Z]/g,"")).charAt(0),s=r.charAt(1),e.variables={};for(let n of r){let r=n.toLowerCase(),o=t.ntuples.symbol.indexOf(n);if(-1===o)throw Error(`Symbol undefined: ${n}`);e.variables[r]={};for(let n in t.ntuples)t.ntuples[n][o]&&(e.variables[r][n.replace(/^var/,"")]=t.ntuples[n][o])}}n=t.ntuples.symbol.indexOf(i),o=t.ntuples.symbol.indexOf(s),-1===n&&(n=0),-1===o&&(o=0),t.ntuples.first&&(t.ntuples.first.length>n&&(e.firstX=t.ntuples.first[n]),t.ntuples.first.length>o&&(e.firstY=t.ntuples.first[o])),t.ntuples.last&&(t.ntuples.last.length>n&&(e.lastX=t.ntuples.last[n]),t.ntuples.last.length>o&&(e.lastY=t.ntuples.last[o])),t.ntuples.vardim&&t.ntuples.vardim.length>n&&(e.nbPoints=t.ntuples.vardim[n]),t.ntuples.factor&&(t.ntuples.factor.length>n&&(e.xFactor=t.ntuples.factor[n]),t.ntuples.factor.length>o&&(e.yFactor=t.ntuples.factor[o])),t.ntuples.units&&(t.ntuples.units.length>n&&(t.ntuples.varname&&t.ntuples.varname[n]?e.xUnits=`${t.ntuples.varname[n]} [${t.ntuples.units[n]}]`:e.xUnits=t.ntuples.units[n]),t.ntuples.units.length>o&&(t.ntuples.varname&&t.ntuples.varname[o]?e.yUnits=`${t.ntuples.varname[o]} [${t.ntuples.units[o]}]`:e.yUnits=t.ntuples.units[o]))}function Ar(t){t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1)}const Sr=/[ \t]*,[ \t]*/;class Tr{}const kr={keepRecordsRegExp:/^$/,canonicDataLabels:!0,canonicMetadataLabels:!1,dynamicTyping:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function Nr(t,e){let r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=ir(t),e={...kr,...e},e.wantXY=!e.withoutXY,e.start=Date.now();let r=[],n={profiling:!!e.profiling&&[],logs:[],entries:[]},o={children:[]},i=o,s=[],a=new Tr;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");vr(n,"Before split to LDRS",e);let l=t.replace(/[\r\n]+##/g,"\n##").split("\n##");vr(n,"Split to LDRS",e),l[0]&&(l[0]=l[0].replace(/^[\r\n ]*##/,""));for(let t of l){let o=t.indexOf("="),l=o>0?t.substring(0,o):t,h=o>0?t.substring(o+1).trim():"",u=l.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===u){let t=h.indexOf("\n");if(-1===t&&(t=h.indexOf("\r")),t>0){let e=h.substring(0,t).split(/[ ,;\t]+/);Er(i,a,e[0]),a.datatable=e[0],e[1]&&e[1].indexOf("PEAKS")>-1?u="PEAKTABLE":e[1]&&(e[1].indexOf("XYDATA")||e[0].indexOf("++")>0)&&(u="XYDATA",a.deltaX=(a.lastX-a.firstX)/(a.nbPoints-1))}}if("XYDATA"!==u)if("PEAKTABLE"!==u)if("PEAKASSIGNMENTS"!==u){if("TITLE"===u){let t=i;t.children||(t.children=[]),i={spectra:[],ntuples:{},info:{},meta:{},tmp:{}},t.children.push(i),s.push(t),r.push(i),i.title=h}else"DATATYPE"===u?(i.dataType=h,h.match(/(^nd|\snd\s)/i)&&(i.twoD=!0)):"NTUPLES"===u?h.match(/(^nd|\snd\s)/i)&&(i.twoD=!0):"DATACLASS"===u?i.dataClass=h:"XUNITS"===u?a.xUnits=h:"YUNITS"===u?a.yUnits=h:"FIRSTX"===u?a.firstX=Number(h):"LASTX"===u?a.lastX=Number(h):"FIRSTY"===u?a.firstY=Number(h):"LASTY"===u?a.lastY=Number(h):"NPOINTS"===u?a.nbPoints=Number(h):"XFACTOR"===u?a.xFactor=Number(h):"YFACTOR"===u?a.yFactor=Number(h):"MAXX"===u?a.maxX=Number(h):"MINX"===u?a.minX=Number(h):"MAXY"===u?a.maxY=Number(h):"MINY"===u?a.minY=Number(h):"DELTAX"===u?a.deltaX=Number(h):".OBSERVEFREQUENCY"===u||"$SFO1"===u?a.observeFrequency||(a.observeFrequency=Number(h)):".OBSERVENUCLEUS"===u?a.xType||(i.xType=h.replace(/[^a-zA-Z0-9]/g,"")):"$OFFSET"===u?(i.shiftOffsetNum=0,a.shiftOffsetVal||(a.shiftOffsetVal=Number(h))):"$REFERENCEPOINT"===u||("VARNAME"===u?i.ntuples.varname=h.split(Sr):"SYMBOL"===u?i.ntuples.symbol=h.split(Sr):"VARTYPE"===u?i.ntuples.vartype=h.split(Sr):"VARFORM"===u?i.ntuples.varform=h.split(Sr):"VARDIM"===u?i.ntuples.vardim=fr(h.split(Sr)):"UNITS"===u?i.ntuples.units=h.split(Sr):"FACTOR"===u?i.ntuples.factor=fr(h.split(Sr)):"FIRST"===u?i.ntuples.first=fr(h.split(Sr)):"LAST"===u?i.ntuples.last=fr(h.split(Sr)):"MIN"===u?i.ntuples.min=fr(h.split(Sr)):"MAX"===u?i.ntuples.max=fr(h.split(Sr)):".NUCLEUS"===u?i.ntuples&&(i.ntuples.nucleus=h.split(Sr)):"PAGE"===u?(a.page=h.trim(),a.pageValue=Number(h.replace(/^.*=/,"")),a.pageSymbol=a.page.replace(/[=].*/,"")):"RETENTIONTIME"===u?a.pageValue=Number(h):ur(u)?a[cr(u)]=h:"SAMPLEDESCRIPTION"===u?a.sampleDescription=h:u.startsWith("$NUC")?i.tmp[u]||h.includes("off")||(i.tmp[u]=h.replace(/[<>]/g,"")):"END"===u&&(i=s.pop()));if(i&&i.info&&i.meta&&u.match(e.keepRecordsRegExp)){let t,r,n=h.trim();l.startsWith("$")?(r=e.canonicMetadataLabels?u.substring(1):l.substring(1),t=i.meta):(r=e.canonicDataLabels?u:l,t=i.info),e.dynamicTyping&&(n=ar(n)),t[r]?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(n)):t[r]=n}}else e.wantXY&&(h.match(/.*(XYA).*/)&&wr(a,h),i.spectra.push(a),a=new Tr);else e.wantXY&&(Ar(a),dr(a,h,n),i.spectra.push(a),a=new Tr);else e.wantXY&&(Ar(a),h.match(/.*\+\+.*/)?(a.deltaX=(a.lastX-a.firstX)/(a.nbPoints-1),mr(a,h)):dr(a,h,n),i.spectra.push(a),a=new Tr)}return vr(n,"Finished parsing",e),Mr(r,n,e),vr(n,"Total time",e),n.entries=o.children,n.flatten=r,n}(e,{keepRecordsRegExp:/.*/});for(let e of r.flatten){if(!e.spectra||!e.spectra[0])continue;let r=e.spectra[0];if(r.variables)for(let t in r.variables){const e=r.variables[t];e.label||(e.label=e.name||e.symbol||t,e.units&&!e.label.includes(e.units)&&(e.label+=` [${e.units}]`))}else{const t={};r.variables=t,t.x={label:r.xUnits,symbol:"X",data:r.data.x||r.data.X},t.y={label:r.yUnits,symbol:"Y",data:r.data.y||r.data.Y}}t.pushSpectrum(r.variables,{dataType:e.dataType,title:e.title,meta:e.meta})}}function Fr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{encoding:r="utf8"}=e;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer){return new TextDecoder(r).decode(t)}return t}function Rr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:e,y:r}=t;if(e.length<2)return;if(e.length!==r.length)throw new Error("The X and Y arrays mush have the same length");let n=e[0],o=0;for(let t=1;t<e.length;t++)n!==e[t]&&(o++,n=e[t],e[o]=e[t],t!==o&&(r[o]=0)),t!==o&&(r[o]+=r[t]);e.length=o+1,r.length=o+1}function Ir(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{rescale:r=!1,uniqueX:n=!1,xColumn:o=0,yColumn:i=1,keepInfo:s=!1,bestGuess:a=!1,numberColumns:l=Number.MAX_SAFE_INTEGER,maxNumberColumns:h=Number.MAX_SAFE_INTEGER,minNumberColumns:u=2}=e;t=Fr(t),h=Math.max(h,o+1,i+1),u=Math.max(o+1,i+1,u);let c=t.split(/[\r\n]+/),m=[],g=[],p=0;for(let t=0;t<c.length;t++){let e=c[t].trim();if(e.match(/[0-9]+/)&&e.match(/^[0-9eE,;. \t+-]+$/)){let t=e.split(/,[; \t]+|[; \t]+/);1===t.length&&(t=e.split(/[,; \t]+/)),t&&t.length>=u&&t.length<=h&&(m.push(t.map((t=>parseFloat(t.replace(",","."))))),p++)}else e&&g.push({position:p,value:e})}if(a){if(m[0]&&3===m[0].length&&void 0===e.xColumn&&void 0===e.yColumn){let t=!0;for(let e=0;e<m.length-1;e++)1!==Math.abs(m[e][0]-m[e+1][0])&&(t=!1);t&&(o=1,i=2)}if(m[0]&&m[0].length>3){let t=[];for(let e of m)for(let r=o;r<e.length;r+=2)t.push(e[r]);f(t)&&(l=2)}}if(l){const t=[];for(const e of m)for(let r=0;r<e.length;r+=l)t.push(e.slice(r,r+l));m=t}const w={x:m.map((t=>t[o])),y:m.map((t=>t[i]))};if(n&&Rr(w),r){let t=d(w.y);for(let e=0;e<w.y.length;e++)w.y[e]/=t}return s?{info:g,data:w}:w}function zr(t,e){const{meta:r={},info:n={}}=e,{title:o="",owner:i="",origin:s="",dataType:a=""}=n,l=[],h=[],u=[],c=[],f=[],m=[],g=[],w=[],y=[],b=Object.keys(t);for(let e=0;e<b.length;e++){const r=b[e];let n=t[r],o=n.label&&n.label.replace(/ *\[.*/,""),i=n.label&&n.label.replace(/.*\[(.*)\].*/,"$1");l.push(n.symbol||r),h.push(n.name||o||r),c.push(t[r].data.length),void 0!==n.isDependent?u.push(n.isDependent?"DEPENDENT":"INDEPENDENT"):u.push(n.type?n.type.toUpperCase():0===e?"INDEPENDENT":"DEPENDENT"),f.push(n.units||i||""),m.push(t[r][0]),g.push(t[r][t[r].length-1]),w.push(p(t[r].data)),y.push(d(t[r].data))}let v=`##TITLE=${o}\n##JCAMP-DX=6.00\n##DATA TYPE=${a}\n##ORIGIN=${s}\n##OWNER=${i}\n`;for(const t in r)v+="object"==typeof r[t]?`##$${t}=${JSON.stringify(r[t])}\n`:`##$${t}=${r[t]}\n`;v+=`##NTUPLES= ${a}\n##VAR_NAME=  ${h.join()}\n##SYMBOL=    ${l.join()}\n##VAR_TYPE=  ${u.join()}\n##VAR_DIM=   ${c.join()}\n##UNITS=     ${f.join()}\n##PAGE= N=1\n`,v+=`##DATA TABLE= (${l.join("")}..${l.join("")}), PEAKS\n`;for(let e=0;e<t[b[0]].data.length;e++){let r=[];for(let n of b)r.push(t[n].data[e]);v+=`${r.join("\t")}\n`}return v+="##END",v}function Cr(t,e){1!==e&&(t/=e);const r=Math.round(t);return r!==t&&Math.abs(r-t)<=Number.EPSILON?r:t}function Or(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xFactor:r=1,yFactor:n=1}=e;let o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=[];for(let e=0;e<t.x.length;e++){let r=t.x[e],n=t.y[e];o>r&&(o=r),i<r&&(i=r),s>n&&(s=n),a<n&&(a=n)}l.push(`##FIRSTX=${o}`),l.push(`##LASTX=${i}`),l.push(`##FIRSTY=${s}`),l.push(`##LASTY=${a}`),l.push(`##XFACTOR=${r}`),l.push(`##YFACTOR=${n}`),l.push("##PEAK TABLE=(XY..XY)");for(let e=0;e<t.x.length;e++)l.push(`${Cr(t.x[e],r)} ${Cr(t.y[e],n)}`);return l}function $r(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xFactor:r=1,yFactor:n=1}=e;let o=t.x[0],i=t.x[t.x.length-1],s=t.y[0],a=t.y[t.y.length-1],l=t.x.length,h=(i-o)/(l-1),u=[];u.push(`##FIRSTX=${o}`),u.push(`##LASTX=${i}`),u.push(`##FIRSTY=${s}`),u.push(`##LASTY=${a}`),u.push(`##DELTAX=${h}`),u.push(`##XFACTOR=${r}`),u.push(`##YFACTOR=${n}`),u.push(`##DELTAX=${r}`),u.push("##XYDATA=(X++(Y..Y))");let c=t.x[0];for(let e=0;e<t.x.length;e++)c+=` ${Cr(t.y[e],n)}`,c.length>70&&(u.push(c),c=e<t.x.length-1?Cr(t.x[0]+e*h,r):"");return c&&u.push(c),u}function Dr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{meta:r={},info:n={},xydata:o=!1}=e,{title:i="",owner:s="",origin:a="",dataType:l="",xUnits:h="",yUnits:u="",xFactor:c=1,yFactor:f=1}=n;t={x:t.x,y:t.y};let m=`##TITLE=${i}\n##JCAMP-DX=4.24\n##DATA TYPE=${l}\n##ORIGIN=${a}\n##OWNER=${s}\n##XUNITS=${h}\n##YUNITS=${u}\n`;for(const t in r)m+="cheminfo"===t.toLowerCase()?`##$${t}=${JSON.stringify(r[t])}\n`:`##$${t}=${r[t]}\n`;return`${m}##NPOINTS=${t.x.length}\n${(o?$r(t,{xFactor:c,yFactor:f}):Or(t,{xFactor:c,yFactor:f})).join("\n")}\n##END`}function Pr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[];for(let n of t.spectra)r.push(Vr(n,e));return r}function Vr(t,e){const{info:r={},meta:n={}}=e;let o={options:{},info:{title:t.title,dataType:t.dataType,...r},meta:{...t.meta,...n}};return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{info:r,meta:n,forceNtuples:o}=e;let i={info:r,meta:n},s=Object.keys(t).map((t=>t.toLowerCase()));if(2===s.length&&s.includes("x")&&s.includes("y")&&!o){let e=t.x,r=e.label||e.name||"x";i.info.xUnits=r.includes(t.x.units)?r:`${r} [${t.x.units}]`;let n=t.y,o=n.label||n.name||"y";return i.info.yUnits=o.includes(t.y.units)?o:`${o} [${t.y.units}]`,Dr({x:t.x.data,y:t.y.data},i)}return zr(t,e)}(t.variables,o)}function Ur(t,e){const{endOfLine:r="\n",fieldSeparator:n=","}=e;let o=new Array(t.length);for(let e=0;e<t.length;e++){const i=Object.values(t[e].variables),s=i.map((t=>t.label)),a=Math.max(...i.map((t=>t.data.length)));let l=[s.join(n)];for(let t=0;t<a;t++)l.push(i.map((e=>{let{data:r}=e;return void 0===r[t]?"":r[t]})).join(n));o[e]=l.join(r)}return o}function jr(t,e){let r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]={x:t[n],y:e[n]};return r}const Xr={getJSGraph:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colors:r=se,opacities:n=[1],linesWidth:o=[1],selector:i={},normalization:s,xAxis:a={},yAxis:l={}}=e;let h=[],u=a.label,c=l.label,f=a.units,m=l.units;for(let e=0;e<t.length;e++){const l=t[e];let g={},p=l.getNormalizedSpectrum({selector:i,normalization:s});p&&(u||(u=p.variables.x.label),c||(c=p.variables.y.label),f||(f=p.variables.x.units),m||(m=p.variables.y.units),ie(g,l,{color:r[e%r.length],opacity:n[e%n.length],lineWidth:o[e%o.length]}),g.dataType=p.dataType,g.data={x:p.variables.x.data,y:p.variables.y.data},a.logScale&&(g.data=v(g.data)),h.push(g))}return{axes:{x:{label:u,unit:f,unitWrapperBefore:"(",unitWrapperAfter:")",flipped:!1,display:!0,...a},y:{label:c,unit:m,unitWrapperBefore:"(",unitWrapperAfter:")",flipped:!1,display:!0,...l}},series:h}},getNormalizationAnnotations:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{y:{min:"0px",max:"2000px"}},{exclusions:r=[]}=t,n=[];return r=r.filter((t=>!t.ignore)),n=r.map((t=>({type:"rect",position:[{x:t.from,y:e.y.min},{x:t.to,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}))),void 0!==t.from&&n.push({type:"rect",position:[{x:Number.MIN_SAFE_INTEGER,y:e.y.min},{x:t.from,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}),void 0!==t.to&&n.push({type:"rect",position:[{x:t.to,y:e.y.min},{x:Number.MAX_SAFE_INTEGER,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}),n}};t.AnalysesManager=class{constructor(){this.analyses=[]}addAnalysis(t){let e=this.getAnalysisIndex(t.id);void 0===e?this.analyses.push(t):this.analyses[e]=t}getAnalyses(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{ids:e}=t;let r=[];for(const t of this.analyses)e&&!e.includes(t.id)||r.push(t);return r}getSpectra(){const t=[];for(const e of this.analyses)t.push(...e.spectra);return t}getDistinctTitles(){let t={};for(let e of this.getSpectra())e.title&&le(t,e.title);return Object.keys(t).map((e=>t[e]))}getDistinctUnits(){var t;let e={};for(let r of this.getSpectra())if(r.variables)for(let[,n]of Object.entries(r.variables)){const r=null===(t=n.units)||void 0===t?void 0:t.replace(/\s+\[.*/,"");r&&le(e,r)}return Object.keys(e).map((t=>e[t]))}getDistinctLabels(){let t={};for(let e of this.getSpectra())if(e.variables)for(let[,r]of Object.entries(e.variables))le(t,r.label.replace(/\s+\[.*/,""));return Object.keys(t).map((e=>t[e]))}getDistinctDataTypes(){let t={};for(let e of this.getSpectra())e.dataType&&le(t,e.dataType);return Object.keys(t).map((e=>t[e]))}getDistinctMeta(){let t={};for(let e of this.getSpectra())if(e.meta)for(let r in e.meta)ae(t,r,e.meta[r]);return Object.keys(t).map((e=>t[e]))}removeAllAnalyses(){this.analyses.splice(0)}removeAnalysis(t){let e=this.getAnalysisIndex(t);if(void 0!==e)return this.analyses.splice(e,1)}getAnalysisIndex(t){if(t)for(let e=0;e<this.analyses.length;e++){if(this.analyses[e].id===t)return e}}includes(t){const e=this.getAnalysisIndex(t);return void 0!==e&&!isNaN(e)}},t.Analysis=or,t.JSGraph=Xr,t.autoPeakPicking=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n;const{xVariable:o="x",yVariable:i="y",normalizationOptions:s,minPeakWidth:a}=e;let l=null===(r=t.variables[o])||void 0===r?void 0:r.data,h=null===(n=t.variables[i])||void 0===n?void 0:n.data;if(!l||!h)return[];if(s){const t=He({variables:{x:{data:l,label:""},y:{data:h,label:""}}},s);l=t.variables.x.data,h=t.variables.y.data}if(!l||!h)return;let{from:u,to:c}=e,f=B({x:l,y:h},e);if(s){const r=void 0===e.maxCriteria||e.maxCriteria?x:M;for(let e of f){const n=r({x:t.variables.x.data,y:t.variables.y.data},{target:e.x});e.x=n.x,e.y=n.y}}return void 0!==u&&(f=f.filter((t=>t.x>=u))),void 0!==c&&(f=f.filter((t=>t.x<=c))),a&&(f=f.filter((t=>t.width>=a))),f.map((e=>{const r={};for(const[n,o]of Object.entries(t.variables))r[n]=o.data[e.index];return r.width=e.width,r}))},t.fromJcamp=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new or(e);return Nr(r,t),r},t.fromText=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new or(e);const{info:n={},parser:o={}}=e;o.keepInfo=!0;let i=Ir(t,o);const s={x:{data:i.data.x,units:n.xUnits,label:n.xLabel},y:{data:i.data.y,units:n.yUnits,label:n.yLabel}};return r.pushSpectrum(s,e),r},t.getNormalizedSpectrum=He,t.getReactPlotJSON=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{enforceGrowing:n=!1,xAxis:o={},yAxis:i={labelSpace:40},content:s={displayMarker:!0},dimensions:a={width:550,height:500},...l}=r;let h=[],u=[],c=null,f=null;for(const r of t){let t=n?r.getNormalizedSpectrum({selector:e,normalization:{filters:[{name:"ensureGrowing"}],keepYUnits:!0}}):r.getXYSpectrum(e);if(!t)continue;t.meta&&u.push(t.meta),c={id:"x",label:t.variables.x.label+(t.variables.x.units?` [${t.variables.x.units}]`:""),...o,position:"bottom",type:"main"},f={id:"y",label:t.variables.y.label+(t.variables.y.units?` [${t.variables.y.units}]`:""),...i,position:"left",type:"main"};const a=jr(t.variables.x.data,t.variables.y.data),l={type:"line",label:t.title,data:a,...s};h.push(l)}if(null===c||null===f)throw new Error("The axes were not defined");return{content:h,axes:[c,f],dimensions:a,meta:u,...l}},t.peakPicking=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n,o,i;const{xVariable:s="x",yVariable:a="y",optimize:l=!1,expectedWidth:u=1,max:c=!0,shapeOptions:f={}}=r,m=null===(n=t.variables[s])||void 0===n?void 0:n.data;let g,p,w,y;if(g=c?null===(i=t.variables[a])||void 0===i?void 0:i.data:null===(o=t.variables[a])||void 0===o?void 0:o.data.slice(),!m||!g)return;p=h(m,e);const b={};if(l){if(!1===c){let t=d(g);for(let e=0;e<g.length;e++)g[e]*=-1,g[e]+=t}w=oe({x:m,y:g},[{x:m[p],y:g[p],width:u}],f),y=h(m,w.peaks[0].x);for(let[e,r]of Object.entries(t.variables))b[e]=r.data[y];b.optimized=w.peaks[0]}else for(let[e,r]of Object.entries(t.variables))b[e]=r.data[p];return b},t.toJcamp=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Pr(t,e).join("\n")},t.toJcamps=Pr,t.toText=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.selector)return Ur(t.spectra,e);const r=t.getXYSpectrum(e.selector);return Ur(r?[r]:[],e)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=common-spectrum.min.js.map
